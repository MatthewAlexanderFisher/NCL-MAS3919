<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>1&nbsp; Overview of Machine Learning â€“ MAS3919: Foundations of Machine Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../content/main/2-machine-learning-models.html" rel="next">
<link href="../../index.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-b651517ce65839d647a86e2780455cfb.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-eee127bcbcf69f6d1c4f39497eef8043.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-ca592282aabca1dce090d3def4fc59bb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-eee127bcbcf69f6d1c4f39497eef8043.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "F"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<script>
  (function () {
    // Compute book root for both environments
    function computeRoots() {
      const onPages = /github\.io$/i.test(location.hostname);
      // >>>> CHANGE THIS to your repo name <<
      const repoBase = '/NCL-MAS2901/';

      if (onPages) {
        // GitHub Pages: use fixed base path
        return { 
          rootPath: repoBase,
          abs: location.origin + repoBase
        };
      } else {
        // Local preview: find the book root by looking for index.html
        // This works by going up the directory tree until we find the root
        let pathSegments = location.pathname.split('/').filter(s => s);
        
        // Remove the current file if it exists
        if (pathSegments.length > 0 && pathSegments[pathSegments.length - 1].includes('.')) {
          pathSegments.pop();
        }
        
        // For local development, we need to find the actual root
        // Quarto typically serves from the root, so we can use '/'
        // If your local setup is different, adjust accordingly
        const rootPath = '/';
        const abs = location.origin + rootPath;
        
        return { rootPath, abs };
      }
    }

    function appendOrReplace(selector, makeEl) {
      const existing = document.querySelector(selector);
      if (existing) existing.remove();
      document.head.appendChild(makeEl());
    }

    const roots = computeRoots();

    // Helper function to build absolute URLs
    function buildUrl(path) {
      // Ensure path doesn't start with /
      const cleanPath = path.replace(/^\//, '');
      // Ensure roots.abs ends with /
      const base = roots.abs.endsWith('/') ? roots.abs : roots.abs + '/';
      return base + cleanPath;
    }

    // Inject links ASAP (don't wait for load)
    appendOrReplace('link[rel="manifest"]', () => {
      const l = document.createElement('link');
      l.rel = 'manifest';
      l.href = buildUrl('pwa/manifest.webmanifest');
      return l;
    });

    // Favicons (tab icons)
    appendOrReplace('link[rel="icon"][sizes="16x16"]', () => {
      const l = document.createElement('link');
      l.rel = 'icon'; 
      l.type = 'image/png'; 
      l.sizes = '16x16';
      l.href = buildUrl('pwa/icons/icon-16.png');
      return l;
    });
    
    appendOrReplace('link[rel="icon"][sizes="32x32"]', () => {
      const l = document.createElement('link');
      l.rel = 'icon'; 
      l.type = 'image/png'; 
      l.sizes = '32x32';
      l.href = buildUrl('pwa/icons/icon-32.png');
      return l;
    });
    
    // Legacy ICO (optional)
    appendOrReplace('link[rel="icon"][type="image/x-icon"]', () => {
      const l = document.createElement('link');
      l.rel = 'icon'; 
      l.type = 'image/x-icon';
      l.href = buildUrl('pwa/icons/favicon.ico');
      return l;
    });

    // Apple touch icon
    appendOrReplace('link[rel="apple-touch-icon"]', () => {
      const l = document.createElement('link');
      l.rel = 'apple-touch-icon';
      l.href = buildUrl('pwa/icons/icon-180.png');
      return l;
    });

    // Register SW (use absolute URL)
    if ('serviceWorker' in navigator) {
      const swUrl = buildUrl('service-worker.js');
      const scope = roots.rootPath.endsWith('/') ? roots.rootPath : roots.rootPath + '/';
      
      navigator.serviceWorker.register(swUrl, { scope: scope })
        .then(reg => console.log('SW registered for scope:', scope))
        .catch(err => console.error('SW registration failed:', err));
    }
  })();
</script>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/math-scroll.css">
<link rel="stylesheet" href="../../theming/callout-style.css">
<link rel="stylesheet" href="../../theming/floating-code.css">
<link rel="stylesheet" href="../../theming/font.css">
<link rel="stylesheet" href="../../theming/no-xref-suffix.css">
<link rel="stylesheet" href="../../theming/scrollbar.css">
<link rel="stylesheet" href="../../theming/nav-tabs.css">
<link rel="stylesheet" href="../../theming/header.css">
<link rel="stylesheet" href="../../theming/question-bank.css">
<link rel="stylesheet" href="../../theming/sidebar.css">
<link rel="stylesheet" href="../../theming/lecture-zoom.css">
<link rel="stylesheet" href="../../theming/visualisation-controls.css">
<link rel="stylesheet" href="../../theming/tables.css">
<link rel="stylesheet" href="../../theming/custom-block.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/ncl_logo_light.png" alt="" class="navbar-logo light-content">
    <img src="../../images/ncl_logo_light.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">MAS3919: Foundations of Machine Learning</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/main/1-overview-of-machine-learning.html">Lecture Notes</a></li><li class="breadcrumb-item"><a href="../../content/main/1-overview-of-machine-learning.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview of Machine Learning</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Lecture Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/main/1-overview-of-machine-learning.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview of Machine Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/main/2-machine-learning-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Machine Learning Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/main/3-stochastic-optimisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Stochastic Optimisation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/main/4-generalisation-error.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Generalisation Error</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/main/5-online-supervised-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Online Supervised Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/main/6-beyond-supervised-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Beyond Supervised Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/main/7-ethics-of-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Ethics of Machine Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Practicals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/practicals/1-intro-to-pytorch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction to PyTorch</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/practicals/2-ml-models-in-pytorch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Machine Learning Models in PyTorch</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Additional Material</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/appendix/formula-sheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Formula Sheet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/appendix/revision-sheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Revision Sheet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/appendix/distribution-explorer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distribution Explorer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/appendix/question-bank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Question Bank</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/ide/python-ide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python IDE</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-what-is-ml" id="toc-sec-what-is-ml" class="nav-link active" data-scroll-target="#sec-what-is-ml"><span class="header-section-number">1.1</span> What is Machine Learning?</a>
  <ul class="collapse">
  <li><a href="#tasks" id="toc-tasks" class="nav-link" data-scroll-target="#tasks"><span class="header-section-number">1.1.1</span> Tasks</a></li>
  <li><a href="#sec-models" id="toc-sec-models" class="nav-link" data-scroll-target="#sec-models"><span class="header-section-number">1.1.2</span> Models</a></li>
  </ul></li>
  <li><a href="#sec-training" id="toc-sec-training" class="nav-link" data-scroll-target="#sec-training"><span class="header-section-number">1.2</span> Training</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/main/1-overview-of-machine-learning.html">Lecture Notes</a></li><li class="breadcrumb-item"><a href="../../content/main/1-overview-of-machine-learning.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview of Machine Learning</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-overview-of-ml" class="quarto-section-identifier"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview of Machine Learning</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="9" data-source-offset="-42"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 8;"><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>ACCENT  <span class="op">=</span> <span class="st">"var(--brand-teal)"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>ACCENT2 <span class="op">=</span> <span class="st">"var(--brand-red)"</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>GRID    <span class="op">=</span> <span class="st">"var(--border)"</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Numerical helpers</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>linspace <span class="op">=</span> (a<span class="op">,</span> b<span class="op">,</span> n<span class="op">=</span><span class="dv">401</span>) <span class="kw">=&gt;</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span>n}<span class="op">,</span> (_<span class="op">,</span>i)<span class="kw">=&gt;</span> a <span class="op">+</span> (b<span class="op">-</span>a)<span class="op">*</span>(i<span class="op">/</span>(n<span class="op">-</span><span class="dv">1</span>)))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Log-Gamma (Lanczos) and friends (for stable PMFs/PDFs)</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">logGamma</span>(z){</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> g <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> p <span class="op">=</span> [</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.99999999999980993</span><span class="op">,</span> <span class="fl">676.5203681218851</span><span class="op">,</span> <span class="op">-</span><span class="fl">1259.1392167224028</span><span class="op">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="fl">771.32342877765313</span><span class="op">,</span> <span class="op">-</span><span class="fl">176.61502916214059</span><span class="op">,</span> <span class="fl">12.507343278686905</span><span class="op">,</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">0.13857109526572012</span><span class="op">,</span> <span class="fl">9.9843695780195716e-6</span><span class="op">,</span> <span class="fl">1.5056327351493116e-7</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(z <span class="op">&lt;</span> <span class="fl">0.5</span>){</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span>z)) <span class="op">-</span> <span class="fu">logGamma</span>(<span class="dv">1</span> <span class="op">-</span> z)<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  z <span class="op">-=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> x <span class="op">=</span> p[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="kw">let</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span> i<span class="op">&lt;</span>p<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) x <span class="op">+=</span> p[i] <span class="op">/</span> (z <span class="op">+</span> i)<span class="op">;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> t <span class="op">=</span> z <span class="op">+</span> g <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fl">0.5</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">+</span> (z<span class="op">+</span><span class="fl">0.5</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(t) <span class="op">-</span> t <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x)<span class="op">;</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>logChoose <span class="op">=</span> (n<span class="op">,</span>k) <span class="kw">=&gt;</span> <span class="fu">logGamma</span>(n<span class="op">+</span><span class="dv">1</span>) <span class="op">-</span> <span class="fu">logGamma</span>(k<span class="op">+</span><span class="dv">1</span>) <span class="op">-</span> <span class="fu">logGamma</span>(n<span class="op">-</span>k<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">// Discrete PMFs (stable in log-domain)</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>binomPMF <span class="op">=</span> (n<span class="op">,</span>p<span class="op">,</span>k) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="fu">logChoose</span>(n<span class="op">,</span>k) <span class="op">+</span> k<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(p) <span class="op">+</span> (n<span class="op">-</span>k)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span><span class="op">-</span>p))</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>poisPMF  <span class="op">=</span> (lambda<span class="op">,</span>k) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(k<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(lambda) <span class="op">-</span> lambda <span class="op">-</span> <span class="fu">logGamma</span>(k<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>geomPMF1 <span class="op">=</span> (p<span class="op">,</span>k) <span class="kw">=&gt;</span> p <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">1</span><span class="op">-</span>p<span class="op">,</span> k<span class="op">-</span><span class="dv">1</span>) <span class="co">// support {1,2,...}</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>negbinPMF <span class="op">=</span> (r<span class="op">,</span>p<span class="op">,</span>x) <span class="kw">=&gt;</span> {</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="op">&lt;</span> r) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="fu">logChoose</span>(x<span class="op">-</span><span class="dv">1</span><span class="op">,</span> r<span class="op">-</span><span class="dv">1</span>) <span class="op">+</span> r<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(p) <span class="op">+</span> (x<span class="op">-</span>r)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span><span class="op">-</span>p))<span class="op">;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co">// Continuous PDFs</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>normPDF <span class="op">=</span> (x<span class="op">,</span>mu<span class="op">,</span>sig) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>((x<span class="op">-</span>mu)<span class="op">/</span>sig)<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>(sig<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>))</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>lognormPDF <span class="op">=</span> (x<span class="op">,</span>mu<span class="op">,</span>sig) <span class="kw">=&gt;</span> x<span class="op">&lt;=</span><span class="dv">0</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>((<span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x)<span class="op">-</span>mu)<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>sig<span class="op">*</span>sig)) <span class="op">/</span> (x<span class="op">*</span>sig<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>))</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>unifPDF <span class="op">=</span> (x<span class="op">,</span>a<span class="op">,</span>b) <span class="kw">=&gt;</span> (x<span class="op">&gt;</span>a <span class="op">&amp;&amp;</span> x<span class="op">&lt;</span>b) <span class="op">?</span> <span class="dv">1</span><span class="op">/</span>(b<span class="op">-</span>a) <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>expPDF <span class="op">=</span> (x<span class="op">,</span>lambda) <span class="kw">=&gt;</span> x<span class="op">&gt;</span><span class="dv">0</span> <span class="op">?</span> lambda<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>lambda<span class="op">*</span>x) <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>gammaPDF <span class="op">=</span> (x<span class="op">,</span>a<span class="op">,</span>b) <span class="kw">=&gt;</span> { <span class="co">// shape a, rate b</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x<span class="op">&lt;=</span><span class="dv">0</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(a<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(b) <span class="op">-</span> <span class="fu">logGamma</span>(a) <span class="op">+</span> (a<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x) <span class="op">-</span> b<span class="op">*</span>x)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>betaPDF <span class="op">=</span> (x<span class="op">,</span>a<span class="op">,</span>b) <span class="kw">=&gt;</span> {</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x<span class="op">&lt;=</span><span class="dv">0</span> <span class="op">||</span> x<span class="op">&gt;=</span><span class="dv">1</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> logB <span class="op">=</span> <span class="fu">logGamma</span>(a)<span class="op">+</span><span class="fu">logGamma</span>(b)<span class="op">-</span><span class="fu">logGamma</span>(a<span class="op">+</span>b)<span class="op">;</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>((a<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x) <span class="op">+</span> (b<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span><span class="op">-</span>x) <span class="op">-</span> logB)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>chisqPDF <span class="op">=</span> (x<span class="op">,</span>nu) <span class="kw">=&gt;</span> <span class="fu">gammaPDF</span>(x<span class="op">,</span> nu<span class="op">/</span><span class="dv">2</span><span class="op">,</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>tPDF <span class="op">=</span> (x<span class="op">,</span>nu) <span class="kw">=&gt;</span> {</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> logC <span class="op">=</span> <span class="fu">logGamma</span>((nu<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>) <span class="op">-</span> (<span class="fl">0.5</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(nu<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">+</span> <span class="fu">logGamma</span>(nu<span class="op">/</span><span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(logC <span class="op">-</span> ((nu<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span> <span class="op">+</span> (x<span class="op">*</span>x)<span class="op">/</span>nu))<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>fPDF <span class="op">=</span> (x<span class="op">,</span>d1<span class="op">,</span>d2) <span class="kw">=&gt;</span> {</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x<span class="op">&lt;=</span><span class="dv">0</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> logC <span class="op">=</span> <span class="fu">logGamma</span>((d1<span class="op">+</span>d2)<span class="op">/</span><span class="dv">2</span>) <span class="op">-</span> (<span class="fu">logGamma</span>(d1<span class="op">/</span><span class="dv">2</span>)<span class="op">+</span><span class="fu">logGamma</span>(d2<span class="op">/</span><span class="dv">2</span>)) <span class="op">+</span> (d1<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(d1<span class="op">/</span>d2)<span class="op">;</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(logC <span class="op">+</span> (d1<span class="op">/</span><span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(x) <span class="op">-</span> ((d1<span class="op">+</span>d2)<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">1</span> <span class="op">+</span> (d1<span class="op">/</span>d2)<span class="op">*</span>x))</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="co">// Convenient domain heuristics</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>domainNormal <span class="op">=</span> (mu<span class="op">,</span>sig) <span class="kw">=&gt;</span> [mu <span class="op">-</span> <span class="dv">4</span><span class="op">*</span>sig<span class="op">,</span> mu <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>sig]</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>domainGamma  <span class="op">=</span> (a<span class="op">,</span>b) <span class="kw">=&gt;</span> [<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">5</span><span class="op">,</span> a<span class="op">/</span>b <span class="op">+</span> <span class="dv">6</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(a)<span class="op">/</span>b)]</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>domainExp    <span class="op">=</span> (lambda) <span class="kw">=&gt;</span> [<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">/</span>lambda)]</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>domainBeta   <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span><span class="dv">1</span>]</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>domainPos    <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-24" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Remark (A comment on terminology)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="rem-terminology" class="proof remark">
<p><span class="proof-title"><em>Remark 1.1</em> (A comment on terminology). </span>MAS2909 introduced the term â€œdistributionâ€ as a synonym for â€œ(cumulative) distribution functionâ€, and this is classically how the term â€œdistributionâ€ has been used.</p>
<p>However, in recent decade(s) it has become more common to talk about probability measures as â€œdistributionsâ€ and to make statements such as â€œa random variable <span class="math inline">X</span> has distribution <span class="math inline">P</span>â€ (a classical statistician would say â€œ<span class="math inline">X</span> has law <span class="math inline">P</span>â€).</p>
<p>In our opinion there are good reasons to prefer the modern terminology (for one, this is almost certainly the terminology that you learned at school), and so in this module we will use â€œdistributionâ€ exclusively to mean â€œprobability measureâ€ throughout.</p>
<p>To avoid confusion, if we ever need to refer to a (cumulative) distribution function we shall do so using the acronym CDF.</p>
</div>
</div>
</div>
</div>
<section id="sec-what-is-ml" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sec-what-is-ml"><span class="header-section-number">1.1</span> What is Machine Learning?</h2>
<p>You might be surprised to learn that <em>machine learning</em> is not just a buzzword; it is a rich collection of mathematical concepts that can be rigorously studied.</p>
<section id="tasks" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="tasks"><span class="header-section-number">1.1.1</span> Tasks</h3>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-supervised-learning-task" class="definition theorem">
<p><span class="theorem-title"><strong>Definition 1.1 (Supervised Learning Task)</strong></span> Fix sets <span class="math inline">\mathcal{X}</span>, <span class="math inline">\mathcal{Y}</span>, and <span class="math inline">\mathcal{Z}</span>, a probability distribution <span class="math inline">P</span> on <span class="math inline">\mathcal{X} \times \mathcal{Y}</span>, and a loss function <span class="math inline">L : \mathcal{Y} \times \mathcal{Z} \rightarrow \mathbb{R}</span>.</p>
<p>Given a <em>training dataset</em> <span class="math inline">\{(\mathbf{x}_i,\mathbf{y}_i)\}_{i=1}^n</span> consisting of <span class="math inline">n</span> independent samples from <span class="math inline">P</span>, try to find a function <span class="math inline">f : \mathcal{X} \rightarrow \mathcal{Z}</span> for which <span class="math display">
\mathbb{E}_{(\mathbf{X},\mathbf{Y}) \sim P} [ L(\mathbf{Y},f(\mathbf{X})) ]
</span> is minimal.</p>
</div>
</div>
</div>
</div>
<p>To unpack this definition we are going to recap some of the prerequisite mathematical concepts, which you should have already studied:</p>
<div id="recap-set-notation1" class="recap">
<section id="set-notation-i" class="level6" data-number="1.1.1.0.0.1">
<h6 data-number="1.1.1.0.0.1" class="anchored" data-anchor-id="set-notation-i"><span class="header-section-number">1.1.1.0.0.1</span> Set Notation I</h6>
<p>A <strong>set</strong> is a collection of objects, e.g.&nbsp;<span class="math inline">\mathbb{N}</span> is the set of natural numbers, <span class="math inline">\mathbb{N}_0 = \{0\} \cup \mathbb{N}</span> is the set of non-negative integers, and <span class="math inline">\mathbb{R}</span> is the set of real numbers.</p>
<p>Given a pair of sets, say <span class="math inline">\mathcal{X}</span> and <span class="math inline">\mathcal{Y}</span>, the <strong>Cartesian product</strong> of <span class="math inline">\mathcal{X}</span> and <span class="math inline">\mathcal{Y}</span> consists of all (ordered) pairs <span class="math inline">(x,y)</span> where <span class="math inline">x</span> is an element of <span class="math inline">\mathcal{X}</span> and <span class="math inline">y</span> is an element of <span class="math inline">\mathcal{Y}</span>.</p>
<p>As a shorthand for set membership we can write <span class="math inline">x \in \mathcal{X}</span> and <span class="math inline">y \in \mathcal{Y}</span>. The Cartesian product of <span class="math inline">\mathcal{X}</span> and <span class="math inline">\mathcal{Y}</span> is denoted <span class="math inline">\mathcal{X} \times \mathcal{Y}</span>. For example, <span class="math inline">\mathbb{R} \times \mathbb{R}</span> is the two-dimensional Euclidean plane; we often abbreviate this to <span class="math inline">\mathbb{R}^2</span>.</p>
<p>More generally we could consider <span class="math inline">d</span>-fold Cartesian products such as <span class="math inline">\mathbb{R}^d</span>.</p>
</section>
</div>
<div id="recap-pmf" class="recap">
<section id="probability-mass-functions-definition-7-in-mas2909" class="level6" data-number="1.1.1.0.0.2">
<h6 data-number="1.1.1.0.0.2" class="anchored" data-anchor-id="probability-mass-functions-definition-7-in-mas2909"><span class="header-section-number">1.1.1.0.0.2</span> Probability mass functions; Definition 7 in MAS2909</h6>
<p>Let <span class="math inline">P</span> be a probability distribution on a countable set <span class="math inline">\mathcal{X} = \{x_1, x_2, \dots \}</span>.</p>
<p>Then <span class="math inline">P</span> is characterised by its <em>probability mass function</em> <span class="math display">
p : \mathcal{X} \rightarrow [0,\infty).
</span> Indeed, <span class="math inline">P</span> assigns an amount of probability <span class="math inline">P(S) = \sum_{x \in S} p(x)</span> to each <span class="math inline">S \subset \mathcal{X}</span>.</p>
<p>From the definition of a <em>probability</em> measure it must hold that <span class="math inline">p(\mathcal{X}) = \sum_{x \in \mathcal{X}} p(x) = 1</span>.</p>
</section>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-binomial-distribution" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.1 (Binomial Distribution)</strong></span> The <span class="xref-no-num"><a href="../appendix/formula-sheet.html#sec-binom" class="quarto-xref">Binomial Distribution&nbsp;<span>1.2</span></a></span>, with <span class="math inline">n</span> <strong>trials</strong> and <strong>success</strong> parameter <span class="math inline">\rho \in [0,1]</span>, is a probability distribution on <span class="math inline">\mathcal{X} = \{0,1,2, \dots , n \}</span> with probability mass function <span class="math display">
p(x) = \binom{n}{x} \rho^x (1-\rho)^{n-x}.
</span> In shorthand this is denoted <span class="math inline">\mathrm{Binom}(n,\rho)</span>.</p>
<hr>
<details>
<summary><strong>Show Visualisation</strong></summary>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="152" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 151;"><span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> n <span class="op">=</span> binom_n<span class="op">,</span> p <span class="op">=</span> binom_p<span class="op">;</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> n <span class="op">+</span> <span class="dv">1</span> }<span class="op">,</span> (_<span class="op">,</span> k) <span class="kw">=&gt;</span> ({ <span class="dt">x</span><span class="op">:</span> k<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fu">binomPMF</span>(n<span class="op">,</span> p<span class="op">,</span> k) }))<span class="op">;</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xDomain <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> n <span class="op">+</span> <span class="dv">1</span> }<span class="op">,</span> (_<span class="op">,</span> k) <span class="kw">=&gt;</span> k)<span class="op">;</span>  <span class="co">// &lt;-- 0..n categories</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stats <span class="op">=</span> <span class="fu">md</span><span class="vs">`**Mean** </span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`= n</span><span class="sc">\r</span><span class="vs">ho`</span><span class="sc">}</span><span class="vs"> = </span><span class="sc">${</span>(n <span class="op">*</span> p)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">; </span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a><span class="vs">  **Variance** </span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`= n</span><span class="sc">\r</span><span class="vs">ho(1-</span><span class="sc">\r</span><span class="vs">ho)`</span><span class="sc">}</span><span class="vs"> = </span><span class="sc">${</span>(n <span class="op">*</span> p <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> p))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">.`</span><span class="op">;</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>        width<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">260</span><span class="op">,</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    <span class="dt">background</span><span class="op">:</span> <span class="st">"var(--plot-panel-bg)"</span><span class="op">,</span></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"var(--brand-fg)"</span>           <span class="co">// drives 'currentColor'</span></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"PMF"</span> }<span class="op">,</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"band"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> xDomain<span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="fl">0.05</span> }<span class="op">,</span>  <span class="co">// &lt;-- band scale</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">barY</span>(data<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> ACCENT })<span class="op">,</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> { <span class="dt">stroke</span><span class="op">:</span> GRID<span class="op">,</span> <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.6</span> })</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;div class="dist-panel"&gt;&lt;div class="stats"&gt;</span><span class="sc">${</span>stats<span class="sc">}</span><span class="vs">&lt;/div&gt;</span><span class="sc">${</span>plot<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="182" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 181;"><span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>viewof binom_n <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">200</span>]<span class="op">,</span> { <span class="dt">value</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span>  <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`n`</span><span class="sc">}</span><span class="vs">`</span> })</span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>viewof binom_p <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.99</span>]<span class="op">,</span> { <span class="dt">value</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\r</span><span class="vs">ho`</span><span class="sc">}</span><span class="vs">`</span> })</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-poisson-distribution" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.2 (Poisson Distribution)</strong></span> The <span class="xref-no-num"><a href="../appendix/formula-sheet.html#sec-pois" class="quarto-xref">Poisson Distribution&nbsp;<span>1.4</span></a></span>, with <strong>rate</strong> parameter <span class="math inline">\lambda &gt;0</span>, is a probability distribution on <span class="math inline">\mathcal{X} = \{0,1,2, \dots  \}</span> with probability mass function <span class="math display">
p(x) = \frac{ e^{-\lambda} \lambda^x }{ x! } .
</span> In shorthand this is denoted <span class="math inline">\mathrm{Pois}(\lambda)</span>.</p>
<hr>
<details>
<summary><strong>Show Visualisation</strong></summary>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="208" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 207;"><span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a>  <span class="co">// compute locally (no exported names)</span></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> L     <span class="op">=</span> pois_lambda<span class="op">;</span></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> kmax  <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">15</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(L <span class="op">+</span> <span class="dv">6</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(L)))<span class="op">;</span></span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pois_data <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> kmax <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> k) <span class="kw">=&gt;</span> ({ <span class="dt">x</span><span class="op">:</span> k<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fu">poisPMF</span>(L<span class="op">,</span> k) }))<span class="op">;</span></span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a>  <span class="co">// build the UI bits</span></span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stats <span class="op">=</span> <span class="fu">md</span><span class="vs">`**Mean** </span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`= </span><span class="sc">\l</span><span class="vs">ambda`</span><span class="sc">}</span><span class="vs"> = </span><span class="sc">${</span>L<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">; </span></span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a><span class="vs">  **Variance** </span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`= </span><span class="sc">\l</span><span class="vs">ambda`</span><span class="sc">}</span><span class="vs"> = </span><span class="sc">${</span>L<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">.`</span><span class="op">;</span></span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a>        width<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">260</span><span class="op">,</span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>    <span class="dt">background</span><span class="op">:</span> <span class="st">"var(--plot-panel-bg)"</span><span class="op">,</span></span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"var(--brand-fg)"</span>           <span class="co">// drives 'currentColor'</span></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"PMF"</span> }<span class="op">,</span></span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">barY</span>(pois_data<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"var(--brand-teal)"</span> })<span class="op">,</span></span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> { <span class="dt">stroke</span><span class="op">:</span> <span class="st">"var(--border)"</span><span class="op">,</span> <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.6</span> })</span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return both in a single wrapper</span></span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;div class="dist-panel"&gt;</span></span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="stats"&gt;</span><span class="sc">${</span>stats<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>plot<span class="sc">}</span></span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="243" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 242;"><span id="cb5-243"><a href="#cb5-243" aria-hidden="true" tabindex="-1"></a>viewof pois_lambda <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.2</span><span class="op">,</span> <span class="dv">30</span>]<span class="op">,</span> {</span>
<span id="cb5-244"><a href="#cb5-244" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="dv">6</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.2</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\l</span><span class="vs">ambda`</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb5-245"><a href="#cb5-245" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
</details>
</div>
</div>
</div>
</div>
<div id="recap-set-notation2" class="recap">
<section id="set-notation-ii" class="level6" data-number="1.1.1.0.0.3">
<h6 data-number="1.1.1.0.0.3" class="anchored" data-anchor-id="set-notation-ii"><span class="header-section-number">1.1.1.0.0.3</span> Set Notation II</h6>
<p>If a set <span class="math inline">\mathcal{X}</span> is contained in another set <span class="math inline">\mathcal{Y}</span> we write <span class="math inline">\mathcal{X} \subset \mathcal{Y}</span>.</p>
<p>In this case, the <strong>indicator function</strong> of the set <span class="math inline">\mathcal{X}</span> is the function <span class="math inline">1_{\mathcal{X}} : \mathcal{Y} \rightarrow \{0,1\}</span> for which <span class="math inline">f_{\mathcal{X}}(y) = 1</span> if and only if <span class="math inline">y \in \mathcal{X}</span>.</p>
<p>For example, <span class="math inline">1_{[0,1]}(x)</span> is equal to <span class="math inline">1</span> when <span class="math inline">0 \leq x \leq 1</span> and equal to <span class="math inline">0</span> if <span class="math inline">x</span> lies outside this interval.</p>
</section>
</div>
<div id="recap-pdf" class="recap">
<section id="probability-density-function" class="level6" data-number="1.1.1.0.0.4">
<h6 data-number="1.1.1.0.0.4" class="anchored" data-anchor-id="probability-density-function"><span class="header-section-number">1.1.1.0.0.4</span> Probability Density Function</h6>
<p>Let <span class="math inline">P</span> be a sufficiently regular<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> probability distribution on <span class="math inline">\mathbb{R}^d</span>.</p>
<p>Then <span class="math inline">P</span> is characterised by its <strong>probability density function</strong> <span class="math display">
p : \mathbb{R}^d \rightarrow [0,\infty).
</span> Indeed, <span class="math inline">P</span> assigns an amount of probability <span class="math inline">P(S) = \int 1_S(\mathbf{x}) p(\mathbf{x}) \; \mathrm{d}\mathbf{x}</span> to each set <span class="math inline">S \subset \mathbb{R}^d</span>.</p>
<p>From the definition of a <strong>probability measure</strong> it must hold that <span class="math inline">\int p(\mathbf{x}) \; \mathrm{d}\mathbf{x} = 1</span>.</p>
</section>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-uniform-distribution" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.3 (Uniform Distribution; Section 1.4 in MAS2909)</strong></span> The <span class="xref-no-num"><a href="../appendix/formula-sheet.html#sec-unif" class="quarto-xref">Uniform Distribution&nbsp;<span>2.1</span></a></span> on an interval <span class="math inline">[a,b]</span> with <span class="math inline">a &lt; b</span> has probability density function <span class="math display">
p(x) = \frac{1}{b-a} 1_{[a,b]}(x).
</span> In shorthand this is denoted <span class="math inline">\mathcal{U}(a,b)</span>.</p>
<hr>
<details>
<summary><strong>Show Visualisation</strong></summary>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="293" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 292;"><span id="cb6-293"><a href="#cb6-293" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-294"><a href="#cb6-294" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a <span class="op">=</span> unif_a<span class="op">,</span> b <span class="op">=</span> unif_b<span class="op">;</span></span>
<span id="cb6-295"><a href="#cb6-295" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="fu">linspace</span>(a <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> b <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">401</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> ({ x<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fu">unifPDF</span>(x<span class="op">,</span> a<span class="op">,</span> b) }))<span class="op">;</span></span>
<span id="cb6-296"><a href="#cb6-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-297"><a href="#cb6-297" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stats <span class="op">=</span> <span class="fu">md</span><span class="vs">`**Mean** </span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`= (a+b)/2`</span><span class="sc">}</span><span class="vs"> = </span><span class="sc">${</span>(((a<span class="op">+</span>b)<span class="op">/</span><span class="dv">2</span>))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">; </span></span>
<span id="cb6-298"><a href="#cb6-298" aria-hidden="true" tabindex="-1"></a><span class="vs">  **Variance** </span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`= (b-a)^2/12`</span><span class="sc">}</span><span class="vs"> = </span><span class="sc">${</span>(((b<span class="op">-</span>a)<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">12</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="vs">.`</span><span class="op">;</span></span>
<span id="cb6-299"><a href="#cb6-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-300"><a href="#cb6-300" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb6-301"><a href="#cb6-301" aria-hidden="true" tabindex="-1"></a>        width<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">260</span><span class="op">,</span></span>
<span id="cb6-302"><a href="#cb6-302" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb6-303"><a href="#cb6-303" aria-hidden="true" tabindex="-1"></a>    <span class="dt">background</span><span class="op">:</span> <span class="st">"var(--plot-panel-bg)"</span><span class="op">,</span></span>
<span id="cb6-304"><a href="#cb6-304" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"var(--brand-fg)"</span>           <span class="co">// drives 'currentColor'</span></span>
<span id="cb6-305"><a href="#cb6-305" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb6-306"><a href="#cb6-306" aria-hidden="true" tabindex="-1"></a> <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"PDF"</span> }<span class="op">,</span> <span class="dt">x</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb6-307"><a href="#cb6-307" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb6-308"><a href="#cb6-308" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">lineY</span>(data<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> ACCENT<span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span> })<span class="op">,</span></span>
<span id="cb6-309"><a href="#cb6-309" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">areaY</span>(data<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> ACCENT<span class="op">,</span> <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.18</span> })<span class="op">,</span></span>
<span id="cb6-310"><a href="#cb6-310" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> { <span class="dt">stroke</span><span class="op">:</span> GRID<span class="op">,</span> <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.6</span> })</span>
<span id="cb6-311"><a href="#cb6-311" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb6-312"><a href="#cb6-312" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-313"><a href="#cb6-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-314"><a href="#cb6-314" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;div class="dist-panel"&gt;&lt;div class="stats"&gt;</span><span class="sc">${</span>stats<span class="sc">}</span><span class="vs">&lt;/div&gt;</span><span class="sc">${</span>plot<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb6-315"><a href="#cb6-315" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="321" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 320;"><span id="cb7-321"><a href="#cb7-321" aria-hidden="true" tabindex="-1"></a>viewof unif_a <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">5</span><span class="op">,</span> <span class="dv">5</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`a`</span><span class="sc">}</span><span class="vs">`</span>})</span>
<span id="cb7-322"><a href="#cb7-322" aria-hidden="true" tabindex="-1"></a>viewof unif_b <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([unif_a <span class="op">+</span> <span class="fl">0.2</span><span class="op">,</span> unif_a <span class="op">+</span> <span class="dv">10</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`b`</span><span class="sc">}</span><span class="vs">`</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-uniform-distribution" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.4 (Normal Distribution on <span class="math inline">\mathbb{R}</span>; Section 1.4 in MAS2909)</strong></span> The <span class="xref-no-num"><a href="../appendix/formula-sheet.html#sec-normal" class="quarto-xref">Normal Distribution&nbsp;<span>2.5</span></a></span>, with <strong>mean</strong> parameter <span class="math inline">\mu \in \mathbb{R}</span> and <strong>variance</strong> parameter <span class="math inline">\sigma^2 &gt; 0</span>, has probability density function <span class="math display">
p(x) = \frac{1}{\sqrt{2 \pi \sigma^2}} \exp\left( - \frac{1}{2 \sigma^2} (x-\mu)^2 \right).
</span> In shorthand this is denoted <span class="math inline">\mathcal{N}(\mu,\sigma^2)</span>.</p>
<hr>
<details>
<summary><strong>Show Visualisation</strong></summary>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="348" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 347;"><span id="cb8-348"><a href="#cb8-348" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-349"><a href="#cb8-349" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Î¼ <span class="op">=</span> norm_mu<span class="op">,</span> Ïƒ <span class="op">=</span> norm_sig<span class="op">;</span></span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [lo<span class="op">,</span> hi] <span class="op">=</span> <span class="fu">domainNormal</span>(Î¼<span class="op">,</span> Ïƒ)<span class="op">;</span></span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="fu">linspace</span>(lo<span class="op">,</span> hi)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> ({ x<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="fu">normPDF</span>(x<span class="op">,</span> Î¼<span class="op">,</span> Ïƒ) }))<span class="op">;</span></span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stats <span class="op">=</span> <span class="fu">md</span><span class="vs">`**Mean** </span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`= </span><span class="sc">\m</span><span class="vs">u`</span><span class="sc">}</span><span class="vs"> = </span><span class="sc">${</span>Î¼<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">; </span></span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true" tabindex="-1"></a><span class="vs">  **Variance** </span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`= </span><span class="sc">\s</span><span class="vs">igma^2`</span><span class="sc">}</span><span class="vs"> = </span><span class="sc">${</span>(Ïƒ<span class="op">**</span><span class="dv">2</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">.`</span><span class="op">;</span></span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true" tabindex="-1"></a>    width<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">260</span><span class="op">,</span></span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> { <span class="dt">background</span><span class="op">:</span> <span class="st">"var(--plot-panel-bg)"</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"var(--brand-fg)"</span> }<span class="op">,</span></span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"PDF"</span> }<span class="op">,</span></span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true" tabindex="-1"></a>      <span class="co">// shaded area under the PDF:</span></span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">areaY</span>(data<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> ACCENT<span class="op">,</span> <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.18</span> })<span class="op">,</span></span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true" tabindex="-1"></a>      <span class="co">// PDF outline:</span></span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">lineY</span>(data<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> ACCENT<span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span> })<span class="op">,</span></span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> { <span class="dt">stroke</span><span class="op">:</span> GRID<span class="op">,</span> <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.6</span> })</span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-371"><a href="#cb8-371" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;div class="dist-panel"&gt;&lt;div class="stats"&gt;</span><span class="sc">${</span>stats<span class="sc">}</span><span class="vs">&lt;/div&gt;</span><span class="sc">${</span>plot<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb8-372"><a href="#cb8-372" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="378" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 377;"><span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a>viewof norm_mu  <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">3</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.05</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\m</span><span class="vs">u`</span><span class="sc">}</span><span class="vs">`</span>})</span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a>viewof norm_sig <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.05</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.05</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\s</span><span class="vs">igma`</span><span class="sc">}</span><span class="vs">`</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
</div>
<p>Random variables were formally defined in MAS2909. Following standard convention, we will use upper-case Roman letters (e.g.&nbsp;<span class="math inline">X</span>) for random variables and lower-case Roman letters (e.g.&nbsp;<span class="math inline">x</span>) for specific values that could be taken by <span class="math inline">X</span>.</p>
<div id="recap-rv-distribution" class="recap">
<section id="distribution-of-a-random-variable" class="level6" data-number="1.1.1.0.0.5">
<h6 data-number="1.1.1.0.0.5" class="anchored" data-anchor-id="distribution-of-a-random-variable"><span class="header-section-number">1.1.1.0.0.5</span> Distribution of a Random Variable</h6>
<p>Let <span class="math inline">X</span> be a random variable taking values in a set <span class="math inline">\mathcal{X}</span>.</p>
<p>The <strong>distribution</strong> of <span class="math inline">X</span> is the probability distribution <span class="math inline">P</span> for which <span class="math inline">P(S) = \mathrm{Prob}(X \in S)</span> for each <span class="math inline">S \subset \mathcal{X}</span>.</p>
</section>
</div>
<p>It is common to write <span class="math inline">X \sim P</span> as shorthand for â€œ<span class="math inline">X</span> has distribution <span class="math inline">P</span>â€. Another reasonably common notation, which will be used in this module, is <span class="math inline">\mathcal{P}(\mathcal{X})</span> to denote the set of probability distributions on a set <span class="math inline">\mathcal{X}</span>.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exr-coin-tossing" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 1.1 (Coin Tossing)</strong></span> A biased coin, which with probability <span class="math inline">0.6</span> lands on heads, is tossed <span class="math inline">10</span> times in total.</p>
<p>What is the probability of observing at least <span class="math inline">8</span> heads?</p>
<details>
<summary><strong>Solution</strong></summary>
<p>Let <span class="math inline">X</span> denote the number of heads.</p>
<p>Then <span class="math inline">X</span> is a random variable with distribution <span class="math inline">P = \mathrm{Binom}(10,0.6)</span>. We have <span class="math inline">P(\{8,9,10\}) = p(8) + p(9) + p(10) = \binom{10}{8} 0.6^8 (1-0.6)^{2} + \binom{10}{9} 0.6^9 (1-0.6)^1 + \binom{10}{10} 0.6^{10} (1-0.6)^0 = 0.1673</span> (4 s.f.)</p>
</details>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exr-sums-of-rvs" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 1.2 (Sums of random variables)</strong></span> Let <span class="math inline">X_1 \sim \mathcal{U}(0,1)</span> and <span class="math inline">X_2 \sim \mathcal{U}(0,1)</span> be independent.</p>
<p>Let <span class="math inline">Z = X_1 + X_2</span>.</p>
<p>Find a probability density function for <span class="math inline">Z</span>.</p>
<p><em>(Hint: Recall Proposition 1 in MAS2909.)</em></p>
<details>
<summary><strong>Solution</strong></summary>
<p>From Proposition 1 in MAS2909 we have <span class="math display">
p(z) = \int 1_{[0,1]}(x) 1_{[0,1]}(z-x) \; \mathrm{d}x
</span> and we can evaluate this integral: <span class="math display">\begin{align*}
p(z)   &amp;= \int 1_{[\max\{0 , z-1 \},\min\{1,z\}]}(x) \; \mathrm{d}x \\
    &amp;= \max\{ \min\{1,z\} - \max\{0 , z-1 \} , 0 \} \\
    &amp;= \left\{ \begin{array}{ll} z &amp; 0 &lt; z \leq 1 \\ 2 - z &amp; 1 &lt; z &lt; 2 \\ 0 &amp; \text{otherwise} \end{array} \right.
\end{align*}</span> This is called the <strong>triangular</strong> distribution.</p>
</details>
</div>
</div>
</div>
</div>
<div id="recap-prob-calc" class="recap">
<section id="probabilistic-calculus" class="level6" data-number="1.1.1.0.0.6">
<h6 data-number="1.1.1.0.0.6" class="anchored" data-anchor-id="probabilistic-calculus"><span class="header-section-number">1.1.1.0.0.6</span> Probabilistic calculus</h6>
<p>Which of the following equivalent statements do you think is most natural?</p>
<ul>
<li><p><span class="math inline">Z = X_1 + X_2</span> where <span class="math inline">X_1 \sim \mathcal{U}(a,b)</span> and <span class="math inline">X_2 \sim \mathcal{N}(\mu,\sigma^2)</span> are independent</p></li>
<li><p><span class="math inline">Z</span> has probability density function <span class="math display">
\frac{1}{b-a} \int 1_{[a,b]}(x) \frac{1}{\sqrt{2 \pi \sigma^2}} \exp\left(-\frac{1}{2 \sigma^2} (z - x - \mu)^2 \right) \; \mathrm{d}x
</span></p></li>
</ul>
<p>It of course depends on what we are trying to do - a good rule of thumb is to â€œuse random variables for intuition, and use densities for computationâ€.</p>
</section>
</div>
<div id="recap-joint-dist" class="recap">
<section id="joint-distribution" class="level6" data-number="1.1.1.0.0.7">
<h6 data-number="1.1.1.0.0.7" class="anchored" data-anchor-id="joint-distribution"><span class="header-section-number">1.1.1.0.0.7</span> Joint Distribution</h6>
<p>Given random variables <span class="math inline">X_1</span> and <span class="math inline">X_2</span>, we can define a new random variable as <span class="math inline">\mathbf{X} = (X_1,X_2)</span>.</p>
<p>The distribution of <span class="math inline">\mathbf{X}</span> is called the <strong>joint distribution</strong> of <span class="math inline">X_1</span> and <span class="math inline">X_2</span>.</p>
<p>The concept naturally extends to more than two random variables as well.</p>
</section>
</div>
<div id="recap-marginal" class="recap">
<section id="marginal-distribution-section-2.3-of-mas2909" class="level6" data-number="1.1.1.0.0.8">
<h6 data-number="1.1.1.0.0.8" class="anchored" data-anchor-id="marginal-distribution-section-2.3-of-mas2909"><span class="header-section-number">1.1.1.0.0.8</span> Marginal Distribution; Section 2.3 of MAS2909</h6>
<p>Given a random variable <span class="math inline">\mathbf{X} = (X_1,X_2)</span> with probability (mass or) density function <span class="math inline">p</span>.</p>
<p>The distribution of <span class="math inline">X_1</span> is called the <strong>marginal distribution</strong> of <span class="math inline">X_1</span>; i.e.&nbsp;the probability distribution whose probability (mass or) density function is <span class="math display">
p_1(x_1) = \int p(\mathbf{x}) \; \mathrm{d}x_2,
</span> where <span class="math inline">\mathbf{x} = (x_1,x_2)</span>.</p>
<p>(For probability mass functions this integral should be replaced by a sum.)</p>
<p>Intuitively, the marginal distribution of <span class="math inline">X_1</span> is just the distribution of <span class="math inline">X_1</span> if we have not observed <span class="math inline">X_2</span>.</p>
</section>
</div>
<div id="recap-conditional" class="recap">
<section id="conditional-distribution-section-2.4-of-mas2909" class="level6" data-number="1.1.1.0.0.9">
<h6 data-number="1.1.1.0.0.9" class="anchored" data-anchor-id="conditional-distribution-section-2.4-of-mas2909"><span class="header-section-number">1.1.1.0.0.9</span> Conditional Distribution; Section 2.4 of MAS2909</h6>
<p>Given a random variable <span class="math inline">\mathbf{X} = (X_1,X_2)</span> with probability (mass or) density function <span class="math inline">p</span>, let <span class="math inline">p_1</span> and <span class="math inline">p_2</span> denote probability (mass or) density functions for the marginal distributions of <span class="math inline">X_1</span> and <span class="math inline">X_2</span>.</p>
<p>The <strong>conditional distribution</strong> of <span class="math inline">X_1</span> given <span class="math inline">X_2 = x_2</span> is the probability distribution whose probability (mass or) density function is <span class="math display">
p(\mathbf{x}) / p_2(x_2),
</span> where <span class="math inline">\mathbf{x} = (x_1,x_2)</span>. The associated random variable is usually denoted <span class="math inline">X_1 | X_2 = x_2</span>.</p>
<p>Intuitively, the conditional distribution of <span class="math inline">X_1</span> given <span class="math inline">X_2</span> represents our understanding of <span class="math inline">X_1</span> if we had observed the value of <span class="math inline">X_2</span> (e.g.&nbsp;our understanding of the weather given we had observed someone putting on a coat).</p>
</section>
</div>
<div id="recap-conditional" class="recap">
<section id="independence-section-2.5-of-mas2909" class="level6" data-number="1.1.1.0.0.10">
<h6 data-number="1.1.1.0.0.10" class="anchored" data-anchor-id="independence-section-2.5-of-mas2909"><span class="header-section-number">1.1.1.0.0.10</span> Independence; Section 2.5 of MAS2909</h6>
<p>Two random variables <span class="math inline">X_1</span> and <span class="math inline">X_2</span> are <strong>independent</strong> if their joint distribution admits a probability (mass or) density function of the form <span class="math inline">p(\mathbf{x}) = p_1(x_1) p_2(x_2)</span> where <span class="math inline">p_i</span> is a probability density function for <span class="math inline">X_i</span> and <span class="math inline">\mathbf{x} = (x_1,x_2)</span>.</p>
<p>Intuitively, if <span class="math inline">X_1</span> and <span class="math inline">X_2</span> are independent, then observing <span class="math inline">X_2</span> tells us nothing about <span class="math inline">X_1</span> (and vice versa).</p>
<p>The concept naturally extends to multiple random variables; we say <span class="math inline">X_1,\dots,X_n</span> are independent if <span class="math display">
p(\mathbf{x}) = p_1(x_1) p_2(x_2) \cdots p_n(x_n)
</span> where <span class="math inline">\mathbf{x} = (x_1,\dots,x_n)</span>.</p>
</section>
</div>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exr-mvn" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 1.3 (Normal distribution on <span class="math inline">\mathbb{R}^d</span>)</strong></span> Let <span class="math inline">X_1 , \dots X_d</span> be independent with <span class="math inline">X_i \sim \mathcal{N}(\mu_i , \sigma_i^2)</span> for each <span class="math inline">i \in \{1,\dots,d\}</span>. Let <span class="math inline">\mathbf{X} = (X_1, \dots , X_d)</span>.</p>
<p>Show that <span class="math inline">\mathbf{X} \sim \mathcal{N}(\bm{\mu},\bm{\Sigma})</span> where <span class="math inline">\bm{\mu} = (\mu_1,\dots,\mu_d)^\top</span> and <span class="math inline">\bm{\Sigma} = \mathrm{diag}(\sigma_1^2 , \dots , \sigma_d^2)</span>.</p>
<details>
<summary><strong>Solution</strong></summary>
<p>From independence we know that <span class="math inline">\mathbf{X}</span> has distribution <span class="math inline">p(\mathbf{x}) = p_1(x_1) \cdots p_d(x_d)</span> where <span class="math inline">p_i(x_i) = \frac{1}{\sqrt{2 \pi \sigma_i^2}} \exp( - \frac{1}{2 \sigma_i^2} (x_i-\mu_i)^2 )</span>.</p>
<p>Algebra gives the result.</p>
</details>
</div>
</div>
</div>
</div>
<div id="recap-notation-expectation" class="recap">
<section id="notation-for-expectations" class="level6" data-number="1.1.1.0.0.11">
<h6 data-number="1.1.1.0.0.11" class="anchored" data-anchor-id="notation-for-expectations"><span class="header-section-number">1.1.1.0.0.11</span> Notation for Expectations</h6>
<p>Let <span class="math inline">P</span> be a probability distribution on a set <span class="math inline">\mathcal{X}</span> and let <span class="math inline">f : \mathcal{X} \rightarrow \mathbb{R}</span> be a function of interest.</p>
<p>The following notations are all equivalent and widely-used:</p>
<ul>
<li><span class="math inline">\mathbb{E}_{X \sim P}[f(X)]</span></li>
<li><span class="math inline">\mathbb{E}[f(X)]</span> where <span class="math inline">X \sim P</span></li>
<li><span class="math inline">P(f)</span></li>
<li><span class="math inline">\int f \; \mathrm{d}P</span></li>
<li><span class="math inline">\int f(x) p(x) \; \mathrm{d}x</span> (if <span class="math inline">P</span> has a probability density function <span class="math inline">p</span>)</li>
<li><span class="math inline">\sum_{x \in \mathcal{X}} f(x) p(x)</span> (if <span class="math inline">P</span> has a probability mass function <span class="math inline">p</span>)</li>
</ul>
</section>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Remark (Disclaimer: MAS3716 Prequisite)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="rem-mas3716" class="proof remark">
<p><span class="proof-title"><em>Remark 1.2</em> (Disclaimer: MAS3716 Prequisite). </span>This course does not require MAS3716 and so we will not work rigorously with measure theory; any expectations that we write down will always be assumed to exist.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-exp-loss1" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.5 (Expected Loss 1)</strong></span> &nbsp;</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-exp-loss2" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.6 (Expected Loss 2)</strong></span> &nbsp;</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-exp-loss3" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.7 (Expected Loss 3)</strong></span> &nbsp;</p>
</div>
</div>
</div>
</div>
<p>Now we are ready to unpack <a href="#def-supervised-learning-task" class="quarto-xref">Definition&nbsp;<span>1.1</span></a>. The easiest way is to see some examples of supervised learning tasks:</p>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-regression" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.8 (Regression)</strong></span> Regression models are powerful statistical tools used to understand the relationship between variables and make predictions. At their core, these models aim to identify how one or more <strong>independent variables</strong> (also often called <strong>covariates</strong> or <strong>predictors</strong>), influence a <strong>dependent variable</strong> (also often called a <strong>response variable</strong>) of interest.</p>
<p>For example, suppose we are interested in the (statistical) relationship between the frequency of pedestrians walking up the Queen Victoria Road next to campus and the time of day.</p>
<div id="fig-map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/map.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.1: Map of the main university campus, with the location of the measurements on the Queen Victoria Road highlighted.
</figcaption>
</figure>
</div>
<p>The independent variable here is the time of day, which we denote <span class="math inline">X</span>, and the dependent variable is the frequency of pedestrians (i.e.&nbsp;the number of pedestrians per unit time), which we denote <span class="math inline">Y</span>. It is reasonable to suppose <span class="math inline">X \in \mathbb{R}</span> and <span class="math inline">Y \in [0,\infty)</span>.</p>
<p>One can freely access such data via the universityâ€™s <a href="https://urbanobservatory.ac.uk">Urban Observatory</a>; the data shown below are from September 2025:</p>
<div id="fig-footfall-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-footfall-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/walking_data.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-footfall-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.2: Footfall data for the Queen Victoria Road in September 2025. The vertical axis represents the frequency of pedestrians.
</figcaption>
</figure>
</div>
<p>Predicting pedestrian footfall has important applications in transport, retail, and public safety; other independent variables that could be of interest in this context include the weather and whether or not large public events (e.g.&nbsp;the freshersâ€™ fair) are being held. The goal in regression is to directly predict the dependent variable, so that <span class="math inline">\mathcal{Z} = \mathcal{Y}</span> in the notation of <a href="#def-supervised-learning-task" class="quarto-xref">Definition&nbsp;<span>1.1</span></a>.</p>
<p>Simple examples of loss functions, which measure the loss incurred when a true response <span class="math inline">y</span> is predicted as <span class="math inline">y'</span>, include <span class="math inline">L(y,y') = |y-y'|</span> and <span class="math inline">L(y,y') = (y-y')^2</span>.</p>
<p>Regression models are widely used in various fields, including economics for forecasting financial trends, in medicine for assessing treatment effects, and in social sciences for understanding behavioral patterns. They provide insights that are crucial for making informed decisions and formulating strategies.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-classification" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.9 (Classification)</strong></span> Continuing on from <a href="#exm-regression" class="quarto-xref">Example&nbsp;<span>1.8</span></a>, how do you think these footfall data on the Queen Victoria Road were collected?</p>
<p>It will not be a surprise to you that CCTV cameras are abundant in large cities such as Newcastle; take a look at the latest feeds for yourself:</p>
<p><a href="https://api.newcastle.urbanobservatory.ac.uk/camera/" class="uri">https://api.newcastle.urbanobservatory.ac.uk/camera/</a></p>
<p>Counting the number of people in an image obtained from CCTV is an example of a <strong>classification</strong> task. Classification is a fundamental concept in machine learning that involves categorising data into predefined groups or classes.</p>
<p>Here <span class="math inline">\mathbf{X}</span> is the CCTV image, which we can consider as an element of <span class="math inline">\mathbb{R}^{w \times h \times 3}</span>, where the image is <span class="math inline">w</span> pixels wide, <span class="math inline">h</span> pixels high, and contains information for each of the red, green and blue colour channels, and <span class="math inline">Y</span> is the number of pedestrians in the image, which is an element of <span class="math inline">\mathbb{N}_0</span> (here the â€œclassesâ€).</p>
<p>The goal in classification is to directly predict the class, so that <span class="math inline">\mathcal{Z} = \mathcal{Y}</span> in the notation of <a href="#def-supervised-learning-task" class="quarto-xref">Definition&nbsp;<span>1.1</span></a>.</p>
<p>The most common loss function used in classification applications is <span class="math inline">L(y,y') = 1</span> if <span class="math inline">y = y'</span>, and otherwise <span class="math inline">L(y,y') = 0</span>; in fact, this is sometimes called the <strong>classification loss</strong>, or the <strong>0-1 loss</strong>.</p>
<p>For this footfall application it might also be reasonable to use a loss function such as <span class="math inline">L(y,y') = |y-y'|</span>, which is more tolerant to small counting errors than the 0-1 loss.</p>
<p>(Note that the <strong>scale</strong> of the loss is irrelevant; the supervised learning task is invariant to whether we use the loss function <span class="math inline">L(y,y')</span> of the loss function <span class="math inline">cL(y,y')</span> for any constant <span class="math inline">c &gt; 0</span>, since we only care about the function <span class="math inline">f</span> for which the expected loss is minimised; cf. <a href="#def-supervised-learning-task" class="quarto-xref">Definition&nbsp;<span>1.1</span></a>.)</p>
<div id="fig-counting-people" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-counting-people-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/counting_people.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-counting-people-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.3: Several companies have emerged to sell â€œpeople countersâ€ as a product. <a href="www.footfallcam.com">This image</a> is taken from one such company.}.
</figcaption>
</figure>
</div>
<p>The independent variable here is the time of day, which we denote <span class="math inline">X</span>, and the dependent variable is the frequency of pedestrians (i.e.&nbsp;the number of pedestrians per unit time), which we denote <span class="math inline">Y</span>. It is reasonable to suppose <span class="math inline">X \in \mathbb{R}</span> and <span class="math inline">Y \in [0,\infty)</span>.</p>
<p>One can freely access such data via the universityâ€™s <a href="https://urbanobservatory.ac.uk">Urban Observatory</a>; the data shown below are from September 2025:</p>
<div id="fig-footfall-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-footfall-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/walking_data.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-footfall-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.4: Footfall data for the Queen Victoria Road in September 2025. The vertical axis represents the frequency of pedestrians.
</figcaption>
</figure>
</div>
<p>Classification is widely used in various fields, from spam detection in emails to diagnosing diseases in the medical field.</p>
<p>Classifiers are trained on a dataset where the categories, or labels, are already known; training helps the system learn the patterns and characteristics that differentiate one class from another (cf. <a href="#sec-training" class="quarto-xref"><span>Section 1.2</span></a>).</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-prob-forecast" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.10 (Probabilistic Forecasting)</strong></span> Probabilistic forecasting refers to predicting future events or outcomes along with an associated probability distribution.</p>
<p>Unlike regression, which provides a single outcome prediction, probabilistic forecasting provides a range of potential outcomes and the likelihood of each occurring, offering a more comprehensive view of future uncertainties.</p>
<p>One of the key advantages of probabilistic forecasting is its ability to provide decision-makers with a range of possible scenarios, along with their associated probabilities. This allows organisations to plan for various contingencies and make informed decisions based on the level of risk they are willing to accept.</p>
<p>Suppose, at time <span class="math inline">t</span>, we want to predict footfall on the Queen Victoria Road at a future time <span class="math inline">t + 1</span>. Our input <span class="math inline">X</span> represents all data available to us at time <span class="math inline">t</span>, and our task is to select a probability distribution that represents a probabilistic prediction of the actual footfall <span class="math inline">Y</span>. In the setting of <a href="#def-supervised-learning-task" class="quarto-xref">Definition&nbsp;<span>1.1</span></a>, we have <span class="math inline">\mathcal{Y} = \mathbb{N}_0</span> and <span class="math inline">\mathcal{Z} = \mathcal{P}(\mathbb{N}_0)</span>.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-text-to-vid" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.11 (Text-to-Video)</strong></span> Text-to-video technology represents a groundbreaking development in the field of artificial intelligence and multimedia content generation.</p>
<p>By employing advanced algorithms, this technology can transform textual descriptions <span class="math inline">X</span> into dynamic video content <span class="math inline">f(X)</span>, offering a novel way to create visual media without the traditional constraints of video production.</p>
<p>In the setting of <a href="#def-supervised-learning-task" class="quarto-xref">Definition&nbsp;<span>1.1</span></a>, <span class="math inline">\mathcal{X}</span> is the set of text strings and <span class="math inline">\mathcal{Z}</span> is the set of all possible video content.</p>
<p>For coherence we can define <span class="math inline">Y</span> equal to <span class="math inline">X</span>, so that the loss function <span class="math inline">L(Y,f(X))</span> can be interpreted as a critical assessment of whether the video content <span class="math inline">f(X)</span> is an accurate instantiation of the text string <span class="math inline">X</span>.</p>
</div>
</div>
</div>
</div>
</section>
<section id="sec-models" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="sec-models"><span class="header-section-number">1.1.2</span> Models</h3>
<p>Now that we have seen several examples of supervised learning tasks, a natural question is <strong>how to solve them</strong>? That is, in the notation of <a href="#def-supervised-learning-task" class="quarto-xref">Definition&nbsp;<span>1.1</span></a>, how do we find a suitable function <span class="math inline">f : \mathcal{X} \rightarrow \mathcal{Z}</span>?</p>
<p>The answer to this question will be broken down into two parts:</p>
<ol type="1">
<li>First we will talk about how to identify a set <span class="math inline">\mathcal{F}</span> whose elements are candidates for the function <span class="math inline">f</span> in a given learning task; this set <span class="math inline">\mathcal{F}</span> is called the <strong>machine learning model</strong>.</li>
<li>Then we will see how to identify a suitable element <span class="math inline">f \in \mathcal{F}</span>; this second step is called <strong>training</strong> the machine learning model, and we will defer this discussion to <a href="#sec-training" class="quarto-xref"><span>Section 1.2</span></a>.</li>
</ol>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-ml-model" class="definition theorem">
<p><span class="theorem-title"><strong>Definition 1.2 (Machine Learning Model)</strong></span> A <strong>machine learning model</strong> (or simply <strong>model</strong>) for a supervised learning task as in <a href="#def-supervised-learning-task" class="quarto-xref">Definition&nbsp;<span>1.1</span></a> is a collection <span class="math inline">\mathcal{F}</span> of maps <span class="math display">
f : \mathcal{X} \rightarrow \mathcal{Y}.
</span></p>
</div>
</div>
</div>
</div>
<p>In practice the elements of <span class="math inline">\mathcal{F}</span> are usually parametrised, denoted <span class="math inline">f_\theta : \mathcal{X} \rightarrow \mathcal{Y}</span> for some <strong>parameters</strong> <span class="math inline">\theta</span> from a suitable index set <span class="math inline">\Theta</span>. It is then equivalent to specify either the set <span class="math inline">\mathcal{F}</span> or the form of the parametric function <span class="math inline">f_\theta</span> together with the set of allowed parameters <span class="math inline">\Theta</span>.</p>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-linear-regression" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.12 (Linear Regression)</strong></span> Linear models are one of the simplest examples of a machine learning model for a regression task (cf. <a href="#exm-regression" class="quarto-xref">Example&nbsp;<span>1.8</span></a>).</p>
<p>Recall that linear regression refers to using a linear function <span id="eq-lin-reg"><span class="math display">
f_{\bm{\theta}}(\mathbf{x}) = \theta_1 x_1 + \dots + \theta_d x_d
\tag{1.1}</span></span></p>
<p>to predict the value of the dependent variable <span class="math inline">Y \in \mathbb{R}</span> based on the values of the independent variables <span class="math inline">\mathbf{X} \in \mathbb{R}^d</span>.</p>
<p>Despite their simplicity, linear models are widely used in applications where scientific interpretation of the parameters <span class="math inline">\bm{\theta}</span> is required.</p>
<p>Indeed, <span class="math inline">\theta_i</span> carries the interpretation of how the prediction for the dependent variable <span class="math inline">Y</span> changes per unit change in the associated independent variable <span class="math inline">X_i</span> in <a href="#eq-lin-reg" class="quarto-xref">Equation&nbsp;<span>1.1</span></a>.</p>
<p>In fact, linear regression models can be quite sophisticated, e.g. <span id="eq-lin-model-basis"><span class="math display">
f_{\bm{\theta}}(\mathbf{x}) = \theta_1 \phi_1(\mathbf{x}) + \dots + \theta_p \phi_p(\mathbf{x})
\tag{1.2}</span></span></p>
<p>for a fixed collection of <span class="math inline">\bm{\theta}</span>-independent functions <span class="math inline">\phi_i</span>, <span class="math inline">i = 1 , \dots , p</span>, called <strong>features</strong> (cf. <span class="quarto-unresolved-ref">?sec-featurisation</span>) which could include an intercept (<span class="math inline">\phi_i(\mathbf{x}) = 1</span>), nonlinearities (e.g.&nbsp;<span class="math inline">\phi_i(\mathbf{x}) = x_1^2</span>), and interactions (e.g.&nbsp;<span class="math inline">\phi_i(\mathbf{x}) = x_1 x_2</span>).</p>
<p>In this module a <strong>linear regression model</strong> refers to a machine learning model <span class="math inline">f_{\bm{\theta}}</span> that is <strong>linear in the parameters</strong> <span class="math inline">\bm{\theta}</span>; the map <span class="math inline">f_{\bm{\theta}}(\mathbf{x})</span> need not be linear in <span class="math inline">\mathbf{x}</span>, as <a href="#eq-lin-model-basis" class="quarto-xref">Equation&nbsp;<span>1.2</span></a> demonstrated.</p>
<p>Note also that no concepts from probability appear in our definition of a linear regression model (though sometimes concepts from probability are used to <strong>train</strong> such a model; see <a href="#sec-training" class="quarto-xref"><span>Section 1.2</span></a>).</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-logistic-classifier" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.13 (Logistic Classifier)</strong></span> A <strong>logistic classifier</strong> is a machine learning model used for binary classification tasks, i.e.&nbsp;where the classes can be represented using the binary labels <span class="math inline">\mathcal{Y} = \{0,1\}</span>. The model has the form <span class="math display">\begin{align*}
    f_{\bm{\theta}}(\mathbf{x}) = \left\{ \begin{array}{ll} 1 &amp; \text{if} \quad \sigma( g_{\bm{\theta}}(\textbf{x}) ) &gt; \tau \\ 0 &amp; \text{if} \quad \sigma( g_{\bm{\theta}}(\mathbf{x}) ) \leq \tau \end{array} \right.
\end{align*}</span> where <span class="math inline">g_{\bm{\theta}} : \mathcal{X} \rightarrow \mathbb{R}</span> is a linear regression model of the form <a href="#eq-lin-reg" class="quarto-xref">Equation&nbsp;<span>1.1</span></a> parametrised by <span class="math inline">\bm{\theta}</span>, <span class="math inline">\sigma(\cdot)</span> is the <strong>logistic function</strong> <span id="eq-logistic"><span class="math display">
\sigma(z) = \frac{1}{1 + e^{-z}} ,
\tag{1.3}</span></span></p>
<p>also known as the <strong>sigmoid</strong> function, which converts the output <span class="math inline">g_{\bm{\theta}}(\mathbf{x})</span> from the linear regression model into a score that ranges from <span class="math inline">0</span> to <span class="math inline">1</span>, and <span class="math inline">\tau \in (0,1)</span> is a fixed threshold, which is commonly <span class="math inline">\tau = \frac{1}{2}</span>.</p>
<p>As with the linear regression model, no concepts from probability are required to define a logistic classifier (though sometimes concepts from probability are used to <strong>train</strong> such a model; see <a href="#sec-training" class="quarto-xref"><span>Section 1.2</span></a>).</p>
<p>Logistic classifiers are widely used in various fields, including finance for credit scoring, healthcare for disease prediction, and marketing for customer segmentation.</p>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sec-training" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="sec-training"><span class="header-section-number">1.2</span> Training</h2>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Students who have taken MAS3716 will understand that we require <span class="math inline">P</span> to be <strong>absolutely continuous with respect to the Lebesgue measure on <span class="math inline">\mathbb{R}^d</span></strong> in order for a density to exist. An example of a probability distribution which fails this requirement is the distribution that places all mass at a single point. Such issues will not be the focus of this module; cf. <a href="#rem-mas3716" class="quarto-xref">Remark&nbsp;<span>1.2</span></a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸Ž</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.xref-no-num a.quarto-xref').forEach(a => {
    const nodes = Array.from(a.childNodes);
    // Find the trailing <span> (the number)
    const last = nodes[nodes.length - 1];
    const prev = nodes[nodes.length - 2];

    if (last && last.nodeType === Node.ELEMENT_NODE && last.tagName === 'SPAN') {
      // Remove the number <span>
      last.remove();
      // Strip any trailing NBSP/space left before it
      if (prev && prev.nodeType === Node.TEXT_NODE) {
        prev.nodeValue = prev.nodeValue.replace(/\u00a0\s*$/, '');
      }
    }
  });
});
</script>
<script>
(function () {
  if (window.__closeCodeFoldBound) return;
  window.__closeCodeFoldBound = true;

  const onDocClick = (e) => {
    // Close any open code-fold if the click is outside it
    document.querySelectorAll('details.code-fold[open]').forEach((d) => {
      if (!d.contains(e.target)) d.removeAttribute('open');
    });
  };

  const onKey = (e) => {
    if (e.key === 'Escape') {
      document.querySelectorAll('details.code-fold[open]').forEach((d) => {
        d.removeAttribute('open');
      });
    }
  };

  // Capture-phase click so we run reliably even with other handlers
  document.addEventListener('click', onDocClick, true);
  document.addEventListener('keydown', onKey);
})();
</script>



<script>
document.addEventListener('DOMContentLoaded', function () {
  // 1) Find the brand container and the existing logo <img>
  const brandContainer = document.querySelector('#quarto-header .navbar-brand-container');
  const img = brandContainer && brandContainer.querySelector('img.navbar-logo');
  if (!brandContainer || !img) return;

  // 2) Build an <a> like Quarto's, and inject inline SVG inside it
  const a = document.createElement('a');
  a.className = 'navbar-brand navbar-brand-logo';
  a.href = (img.closest('a') && img.closest('a').getAttribute('href')) || '/';

  a.innerHTML = `
        <svg class="navbar-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 181 52" fill="none">
            <g class="logo-text" fill="currentColor">
                <path d="M71.52 21.8003C66.9224 21.8003 63.928 18.5373 63.928 13.673C63.928 8.92948 67.1342 5.48517 71.7317 5.48517C76.1175 5.48517 78.8398 8.59713 78.8398 13.7938C78.8398 14.0053 78.8398 14.2168 78.8398 14.4283H68.4953C68.4953 17.1475 69.6749 18.5977 71.7015 18.5977C73.1231 18.5977 74.212 17.7518 74.6052 16.2713L78.749 16.6339C77.7811 19.9271 75.1496 21.8003 71.52 21.8003ZM74.3632 11.8904C74.333 9.62439 73.2743 8.44607 71.4595 8.44607C69.7657 8.44607 68.6465 9.68481 68.5558 11.8904H74.3632Z"/>
                <path d="M173.18 21.8003C168.583 21.8003 165.588 18.5373 165.588 13.673C165.588 8.92948 168.794 5.48517 173.392 5.48517C177.778 5.48517 180.5 8.59713 180.5 13.7938C180.5 14.0053 180.5 14.2168 180.5 14.4283H170.155C170.155 17.1475 171.335 18.5977 173.362 18.5977C174.783 18.5977 175.872 17.7518 176.265 16.2713L180.409 16.6339C179.441 19.9271 176.81 21.8003 173.18 21.8003ZM176.023 11.8904C175.993 9.62439 174.934 8.44607 173.12 8.44607C171.426 8.44607 170.307 9.68481 170.216 11.8904H176.023Z"/>
                <path d="M79.2632 5.9082H84.1027L86.3712 15.0024L88.5188 5.9082H92.5416L94.7799 15.1535L97.4719 5.9082H101.102L96.625 21.3774H92.5719L90.0009 11.3164L87.4601 21.3774H83.7397L79.2632 5.9082Z"/>
                <path d="M109.268 8.62735C107.302 8.62735 105.971 10.3193 105.911 13.6125C105.85 16.9058 107.211 18.6279 109.117 18.6279C110.599 18.6279 112.021 17.4798 112.263 15.4858L116.104 15.939C115.59 19.5041 112.747 21.8003 108.784 21.8003C104.187 21.8003 101.041 18.5373 101.132 13.673C101.223 8.7482 104.519 5.48517 109.419 5.48517C113.14 5.48517 115.711 7.66052 116.134 11.3465L112.142 11.7695C111.9 9.74524 110.629 8.62735 109.268 8.62735Z"/>
                <path d="M127.477 18.8696C126.479 20.7429 124.785 21.7701 122.607 21.7701C119.401 21.7701 117.465 19.8969 117.465 17.0568C117.465 13.4313 120.793 11.4976 127.386 11.4372V10.7725C127.386 9.2014 126.57 8.38564 124.936 8.38564C123.122 8.38564 122.093 9.14097 121.881 10.561L117.889 10.1078C118.584 7.05626 121.034 5.51538 125.178 5.51538C129.806 5.51538 131.621 7.32818 131.621 11.558V18.4164C131.621 19.6854 131.742 20.6824 132.044 21.4076H127.78C127.598 20.6522 127.507 19.8063 127.477 18.8696ZM122.002 16.7849C122.002 18.0539 122.819 18.8092 124.241 18.8092C126.055 18.8092 127.417 17.2986 127.417 15.2138V13.7938C123.817 13.8542 122.002 14.9419 122.002 16.7849Z"/>
                <path d="M136.914 16.5432C137.277 17.9632 138.578 18.779 140.483 18.779C142.117 18.779 143.024 18.0539 143.024 17.0871C143.024 15.7275 141.723 15.7879 139.455 15.3045C135.795 14.5491 133.95 13.3104 133.95 10.5308C133.95 7.63031 136.309 5.48517 140.181 5.48517C143.357 5.48517 145.504 6.90519 146.412 9.50353L142.964 10.1682C142.449 8.92948 141.512 8.41586 140.03 8.41586C138.608 8.41586 137.822 8.95969 137.822 9.95673C137.822 11.3163 139.304 11.2559 142.086 11.8602C145.444 12.5853 147.077 13.7938 147.077 16.4828C147.077 19.5343 144.506 21.7097 140.12 21.7097C136.581 21.7097 134.071 19.9271 133.345 17.0568L136.914 16.5432Z"/>
                <path d="M159.206 0.5H163.622V21.3774H159.206V0.5Z"/>
                <path d="M68.7374 33.9461C69.3726 32.8886 70.1287 32.0729 71.0059 31.5592C71.8831 31.0154 72.851 30.7435 73.9399 30.7435C74.8775 30.7435 75.6639 30.9247 76.2991 31.3175C76.9343 31.6801 77.4485 32.2843 77.8417 33.1001C78.2349 33.9159 78.4164 34.8223 78.4164 35.8193V42.8288C78.4164 43.3424 78.5374 43.7352 78.7794 43.9467C79.0214 44.1582 79.4146 44.279 79.959 44.279H80.9572V45.3969H73.3954V44.279H74.1213C74.7868 44.279 75.2707 44.1582 75.5127 43.9467C75.7849 43.7352 75.9059 43.4028 75.9059 42.9798V36.8466C75.9059 35.5172 75.6942 34.5201 75.301 33.8856C74.7263 32.9793 73.8794 32.4958 72.73 32.4958C71.5806 32.4958 70.6429 32.949 69.8868 33.8856C69.1306 34.8223 68.7374 36.0308 68.7374 37.5112V42.8288C68.7374 43.3424 68.8584 43.705 69.1003 43.9467C69.3423 44.1582 69.7355 44.279 70.28 44.279H71.2781V45.3969H63.5954V44.279H64.5935C65.0775 44.279 65.4707 44.1884 65.7429 43.9769C66.0151 43.7654 66.1361 43.5237 66.1361 43.2215V33.9159C66.1361 33.3116 65.9849 32.8282 65.6522 32.5261C65.3195 32.2239 64.8355 32.0426 64.2306 32.0426H63.5046V31.0154L68.6164 30.7737L68.7374 33.9461Z"/>
                <path d="M81.2292 31.0759L87.0064 30.8946V43.2518C87.0064 43.5842 87.0972 43.8259 87.2484 43.9769C87.4904 44.1884 87.7928 44.2791 88.1558 44.2791H89.7892V45.3969H81.562V44.2791H83.0743C83.528 44.2791 83.8607 44.1582 84.0725 43.9467C84.2842 43.7352 84.3749 43.4029 84.3749 42.9799V33.9159C84.3749 33.3419 84.2237 32.9189 83.891 32.6167C83.5583 32.3146 83.0743 32.1937 82.4391 32.1937H81.2595V31.0759M85.2823 25.0332C85.7361 25.0332 86.1595 25.2145 86.4922 25.5468C86.8249 25.9094 87.0064 26.3022 87.0064 26.7856C87.0064 27.2388 86.8249 27.6315 86.4922 27.9941C86.1595 28.3265 85.7361 28.5077 85.2823 28.5077C84.7984 28.5077 84.4052 28.3265 84.0725 27.9941C83.7397 27.6618 83.5583 27.2388 83.5583 26.7856C83.5583 26.3324 83.7397 25.9094 84.0725 25.577C84.4354 25.2145 84.8286 25.0332 85.2823 25.0332Z"/>
                <path d="M144.99 31.0759L150.767 30.8946V43.2518C150.767 43.5842 150.858 43.8259 151.009 43.9769C151.251 44.1884 151.554 44.2791 151.917 44.2791H153.55V45.3969H145.292V44.2791H146.805C147.259 44.2791 147.591 44.1582 147.803 43.9467C148.015 43.7352 148.105 43.4029 148.105 42.9799V33.9159C148.105 33.3419 147.954 32.9189 147.621 32.6167C147.289 32.3146 146.805 32.1937 146.17 32.1937H144.99V31.0759ZM149.043 25.0332C149.497 25.0332 149.92 25.2145 150.253 25.5468C150.616 25.9094 150.767 26.3022 150.767 26.7856C150.767 27.2388 150.586 27.6315 150.253 27.9941C149.92 28.3265 149.497 28.5077 149.043 28.5077C148.559 28.5077 148.166 28.3265 147.833 27.9941C147.5 27.6618 147.319 27.2388 147.319 26.7856C147.319 26.3324 147.5 25.9094 147.833 25.577C148.166 25.2145 148.589 25.0332 149.043 25.0332Z"/>
                <path d="M88.791 31.0154H95.8991V32.0728C94.9614 32.1031 94.3565 32.1635 94.0842 32.3146C93.812 32.4656 93.691 32.6771 93.691 32.949C93.691 33.1605 93.7515 33.4022 93.8423 33.6137L97.6534 42.1037L101.162 33.8554C101.223 33.7044 101.253 33.5835 101.253 33.4324C101.253 32.6771 100.497 32.2239 99.0145 32.0426V31.0154H105.003V32.0728C104.398 32.1333 103.915 32.2843 103.552 32.5563C103.189 32.8282 102.916 33.1605 102.705 33.6137L97.4114 45.8501H96.5645L90.9386 33.2814C90.7268 32.8282 90.4849 32.526 90.1824 32.3448C89.8799 32.1635 89.4262 32.0728 88.791 32.0728V31.0154Z"/>
                <path d="M117.677 38.2968H107.302C107.363 40.5024 107.756 42.0432 108.542 42.9496C109.419 43.9769 110.569 44.4603 111.93 44.4603C113.957 44.4603 115.59 43.3424 116.83 41.0764L117.798 41.4994C116.286 44.3999 114.138 45.8501 111.295 45.8501C109.359 45.8501 107.726 45.1552 106.425 43.7654C105.094 42.3756 104.459 40.593 104.459 38.4176C104.459 36.0912 105.094 34.1878 106.395 32.7375C107.695 31.2873 109.299 30.5622 111.204 30.5622C112.595 30.5622 113.805 30.9248 114.834 31.6499C115.832 32.375 116.618 33.4022 117.132 34.7316C117.465 35.6682 117.647 36.8768 117.677 38.2968ZM107.302 37.2393H113.654C114.017 37.2393 114.32 37.1185 114.531 36.8768C114.743 36.6351 114.834 36.2121 114.834 35.5776C114.834 34.4597 114.471 33.4929 113.745 32.7073C113.019 31.9218 112.172 31.529 111.204 31.529C110.115 31.529 109.208 32.0124 108.452 32.949C107.726 33.8857 107.332 35.3359 107.302 37.2393Z"/>
                <path d="M133.012 40.0794C133.647 41.862 134.373 43.1007 135.22 43.7654C136.037 44.4603 137.065 44.7926 138.275 44.7926C139.394 44.7926 140.272 44.5509 140.846 44.0675C141.451 43.5841 141.754 42.9496 141.754 42.1943C141.754 41.7713 141.633 41.3785 141.421 41.0462C141.209 40.7138 140.907 40.4721 140.514 40.3211C140.12 40.17 139.092 39.9283 137.459 39.6262C135.886 39.324 134.797 38.9917 134.192 38.6593C133.587 38.327 133.103 37.8436 132.77 37.2695C132.438 36.6653 132.256 36.0308 132.256 35.3359C132.256 34.2784 132.619 33.3116 133.315 32.4656C134.222 31.3779 135.493 30.8039 137.126 30.8039C138.366 30.8039 139.515 31.1967 140.604 32.0124L141.633 30.9247H142.268L142.661 36.0912H141.663C141.209 34.6108 140.604 33.5231 139.818 32.8584C139.062 32.1937 138.094 31.8614 136.975 31.8614C136.007 31.8614 135.22 32.1031 134.676 32.5865C134.131 33.0699 133.829 33.6742 133.829 34.3691C133.829 34.9733 134.071 35.4869 134.585 35.9099C135.099 36.3329 136.067 36.6653 137.549 36.8768C139.243 37.1487 140.362 37.3904 140.877 37.6019C141.723 37.904 142.359 38.3874 142.812 39.0219C143.266 39.6564 143.508 40.4419 143.508 41.3483C143.508 42.6173 142.994 43.6747 141.996 44.5509C140.997 45.4271 139.727 45.8803 138.185 45.8803C136.763 45.8803 135.432 45.3969 134.222 44.4905L133.103 45.7595H132.286L131.984 40.1096H133.012"/>
                <path d="M164.167 31.0154H171.093V32.0728H170.458C169.853 32.0728 169.43 32.1635 169.218 32.3146C169.006 32.4656 168.885 32.7073 168.885 32.9792C168.885 33.1001 168.916 33.2512 168.976 33.372L172.999 41.9828L176.024 34.8525C176.235 34.3388 176.356 33.8554 176.356 33.372C176.356 33.0095 176.205 32.7073 175.903 32.4958C175.6 32.2843 175.025 32.1635 174.118 32.1031V31.0154H180.107V32.0728C178.958 32.1937 178.201 32.6771 177.808 33.5835L172.394 45.9709C171.486 48.0859 170.549 49.5361 169.641 50.2914C168.704 51.077 167.736 51.4698 166.677 51.4698C165.921 51.4698 165.286 51.2583 164.832 50.8353C164.378 50.4123 164.136 49.8987 164.136 49.2944C164.136 48.8412 164.288 48.4484 164.56 48.1463C164.862 47.8442 165.195 47.6931 165.649 47.6931C166.042 47.6931 166.375 47.814 166.647 48.0859C166.919 48.3276 167.04 48.6297 167.04 48.9923C167.04 49.1131 167.01 49.2642 166.98 49.4455C166.949 49.5965 166.919 49.7174 166.919 49.7778C166.919 50.0195 167.07 50.1404 167.403 50.1404C167.736 50.1404 168.129 50.0195 168.553 49.7778C168.976 49.5361 169.369 49.1433 169.762 48.5995C170.125 48.0557 170.791 46.8471 171.698 44.9739L166.224 33.3116C166.012 32.9188 165.77 32.6167 165.498 32.4052C165.195 32.2239 164.772 32.0728 164.197 32.0124V31.0154"/>
                <path d="M44.0557 0.5H49.7119L57.6366 13.3709L57.6063 0.5H62.0526V21.3774H57.3341L48.4717 6.875V21.3774H44.0557V0.5Z"/>
                <path d="M41.4243 24.5195H50.8614V25.6374H49.2885C48.7441 25.6374 48.3509 25.7281 48.1089 25.9093C47.8972 26.0906 47.7762 26.3625 47.7762 26.7553V38.1759C47.7762 39.5053 47.8972 40.5326 48.1392 41.2275C48.4719 42.2547 49.1373 43.0403 50.0447 43.6445C50.9824 44.2488 52.1923 44.5509 53.6744 44.5509C55.7312 44.5509 57.304 44.0071 58.3929 42.9496C59.4818 41.8922 60.0262 40.4419 60.0262 38.6593V29.6256C60.0262 28.689 59.9657 27.9941 59.8447 27.5409C59.7238 27.0574 59.5423 26.6949 59.3003 26.423C59.0583 26.151 58.7559 25.9698 58.3929 25.8187C58.0299 25.6978 57.3947 25.6374 56.5478 25.6374V24.5195H65.1985V25.6374H64.5935C63.6256 25.6374 62.9299 25.9093 62.446 26.423C61.962 26.9366 61.7503 27.6919 61.7503 28.689V38.4478C61.7503 40.8951 61.0546 42.7683 59.6633 44.0675C58.0904 45.548 56.0034 46.2731 53.4021 46.2731C51.1336 46.2731 49.3793 45.9407 48.0787 45.3063C46.778 44.6718 45.8404 43.7352 45.2657 42.5569C44.812 41.6505 44.6003 40.5024 44.6003 39.1125V26.7553C44.6003 26.423 44.4793 26.1208 44.2373 25.9396C43.9953 25.7281 43.6323 25.6374 43.1484 25.6374H41.5151V24.5195"/>
                <path d="M157.18 18.1747C156.696 18.2654 156.242 18.3258 155.849 18.3258C154.306 18.3258 153.973 17.6309 153.973 15.8785V8.92948H157.18V5.93836H153.973V1.43658L149.497 2.25234V5.90815H147.5V8.89926H149.497V16.3317C149.497 20.1084 150.949 21.7701 154.578 21.7701C155.395 21.7701 156.272 21.6795 157.18 21.4982V18.1747Z"/>
                <path d="M163.199 39.9283C163.108 41.439 162.836 42.5267 162.352 43.1914C161.868 43.8561 161.263 44.1884 160.567 44.1884C159.992 44.1884 159.509 43.9769 159.115 43.5539C158.722 43.131 158.541 42.4965 158.541 41.6807V32.2844H163.078V31.0154H158.541V25.0332H157.482C157.391 27.0575 156.907 28.6286 156 29.7465C155.395 30.532 154.487 31.0154 153.308 31.1967V32.2542H155.879V42.1037C155.879 43.1914 156.212 44.0374 156.907 44.702C157.603 45.3667 158.541 45.6991 159.75 45.6991C161.051 45.6991 162.14 45.2157 162.957 44.2791C163.773 43.3424 164.227 41.8922 164.288 39.9283H163.199Z"/>
                <path d="M129.201 30.5018C126.691 30.5018 124.573 33.4325 123.696 36.7257V30.7737L118.463 31.0154V32.1333H119.704C120.248 32.1333 120.671 32.2844 120.974 32.6167C121.276 32.949 121.428 33.4325 121.428 34.1576V43.3122C121.428 43.5841 121.307 43.7956 121.065 44.0071C120.823 44.1884 120.46 44.279 119.976 44.279H118.554V45.3969H127.537V44.279H125.723C125.118 44.279 124.694 44.1884 124.452 44.0071C124.21 43.8258 124.089 43.5539 124.089 43.2216V40.5628C124.089 37.7832 125.269 33.0699 127.598 33.0699C128.233 33.0699 128.112 34.0971 129.383 34.0971C130.411 34.0971 131.137 33.3418 131.137 32.3448C131.137 31.2269 130.229 30.5018 129.201 30.5018Z"/>
            </g>
            <path d="M0.5 0.5C0.5 0.5 0.5 12.827 0.5 18.8092C0.5 36.1214 20.0093 46.122 20.0093 46.122C20.0093 46.122 39.5187 36.1819 39.5187 18.8092C39.5187 12.827 39.5187 0.5 39.5187 0.5H0.5Z" fill="#003A65"/>
            <path d="M38.3088 1.70853V18.8092C38.3088 22.5557 37.3409 26.2417 35.4353 29.8069C33.8927 32.6771 31.7149 35.4568 28.9927 38.0551C25.2421 41.6505 21.4309 43.9467 20.0396 44.7322C18.6482 43.9467 14.8673 41.6505 11.1167 38.0551C8.36422 35.4568 6.15619 32.6771 4.61359 29.8069C2.67779 26.2417 1.70988 22.5557 1.70988 18.8092C1.70988 13.9751 1.70988 4.97156 1.70988 1.70853H38.3088ZM39.5187 0.5H0.5C0.5 0.5 0.5 12.827 0.5 18.8092C0.5 36.1214 20.0093 46.122 20.0093 46.122C20.0093 46.122 39.5187 36.1819 39.5187 18.8092C39.5187 12.827 39.5187 0.5 39.5187 0.5Z" fill="white"/>
            <path d="M30.626 31.4082C30.626 30.3507 30.4747 29.3235 30.1723 28.3264C27.2686 30.2299 24.4253 30.7133 22.7013 29.686C22.792 29.5652 22.8525 29.4141 22.8525 29.2631C22.8525 28.8703 22.55 28.5682 22.1568 28.5682C22.0056 28.5682 21.8543 28.6286 21.7334 28.7192C20.705 27.0273 21.1889 24.157 23.0945 21.2565C22.0963 20.9544 21.0679 20.8033 20.0093 20.8033C18.9506 20.8033 17.9222 20.9544 16.9241 21.2565C18.8296 24.157 19.3136 26.9971 18.2852 28.7192C18.1642 28.6286 18.013 28.5682 17.8617 28.5682C17.4685 28.5682 17.1661 28.8703 17.1661 29.2631C17.1661 29.4141 17.2266 29.5652 17.3173 29.686C15.6235 30.7133 12.75 30.2299 9.84628 28.3264C9.54381 29.3235 9.39258 30.3507 9.39258 31.4082C9.39258 32.4657 9.54381 33.4929 9.84628 34.49C12.75 32.5865 15.5932 32.1031 17.3173 33.1304C17.2266 33.2512 17.1661 33.4023 17.1661 33.5533C17.1661 33.9461 17.4685 34.2483 17.8617 34.2483C18.013 34.2483 18.1642 34.1878 18.2852 34.0972C19.3136 35.7891 18.8296 38.6594 16.9241 41.5599C17.9222 41.862 18.9506 42.0131 20.0093 42.0131C21.0679 42.0131 22.0963 41.862 23.0945 41.5599C21.1889 38.6594 20.705 35.8193 21.7334 34.0972C21.8543 34.1878 22.0056 34.2483 22.1568 34.2483C22.55 34.2483 22.8525 33.9461 22.8525 33.5533C22.8525 33.4023 22.792 33.2512 22.7013 33.1304C24.3951 32.1031 27.2686 32.5865 30.1723 34.49C30.4747 33.4929 30.626 32.4657 30.626 31.4082Z" fill="white"/>
            <path d="M21.9451 31.4082C21.9451 32.4657 21.0982 33.3418 20.0093 33.3418C18.9507 33.3418 18.0735 32.4959 18.0735 31.4082C18.0735 30.3507 18.9204 29.4745 20.0093 29.4745C21.0679 29.5048 21.9451 30.3507 21.9451 31.4082Z" fill="#003A65"/>
            <path d="M38.3693 1.61792H1.61914V18.8093H38.3693V1.61792Z" fill="white"/>
            <path d="M22.9736 13.8543C23.1551 13.9751 23.0643 14.1262 22.9736 14.2169C22.8828 14.3075 21.9452 14.9118 21.3402 14.7305C20.8865 14.5794 20.8865 13.7637 20.2513 13.4917C19.7371 13.2802 19.1624 13.673 19.1624 13.673C20.0699 13.6428 20.3421 14.942 20.3421 14.942C18.9507 13.8543 17.6803 14.6096 17.5896 15.3045C18.7995 14.5794 19.7371 15.5764 19.7371 15.5764C19.3137 15.6369 18.3458 16.3318 19.0717 17.4497C19.1927 16.1505 20.4933 15.939 20.4933 15.939C20.3723 16.5433 20.9168 17.7518 21.9452 17.5101C21.2192 17.0267 21.3402 16.5433 21.3402 16.2109C21.3402 16.0296 21.552 15.9088 21.7939 15.8786C23.2155 15.7275 23.2155 16.8152 23.2155 16.8152C23.6088 16.785 24.6674 15.365 24.6069 14.6398C25.0001 15.2441 26.0588 15.5764 26.8149 15.0326C25.847 14.8815 25.4236 13.9147 25.3631 13.7334C25.3026 13.5522 25.0606 12.3738 24.6069 11.9206C23.9717 11.2862 22.9433 11.7696 22.4291 12.2832C22.2476 12.4343 21.7637 13.3105 22.3686 13.5824C22.7921 13.7032 22.8828 13.7939 22.9736 13.8543Z" fill="#D70929"/>
            <path d="M7.51742 11.0143C6.03532 11.0143 4.37173 8.02315 4.2205 7.78144C5.06741 7.72102 5.03717 7.29803 4.94643 7.02611C4.64396 6.02907 2.73839 6.96568 2.58716 7.14696C2.64765 6.18014 3.7063 5.78737 4.34149 5.90822C4.2205 4.42777 2.85938 4.33713 2.85938 4.33713C4.03902 3.46094 4.79519 4.57884 5.03717 5.42481C6.2168 4.54862 5.09766 3.37031 4.88593 3.24945C4.88593 3.24945 5.82359 3.15881 6.2168 4.12564C6.57976 5.03203 6.12606 5.57587 6.12606 5.57587C6.12606 5.57587 6.42853 5.57587 6.61001 5.42481C7.27545 4.97161 7.2452 4.36734 7.21495 4.24649C7.21495 4.24649 7.6989 4.54862 7.63841 5.12267C7.60816 5.51545 7.21495 5.81758 7.03347 6.02907C6.88224 6.24057 6.48902 6.69376 6.97298 8.144C7.21495 8.83891 7.57792 9.38275 7.85014 9.5036C7.66866 9.77552 7.39643 10.1381 7.51742 11.0143Z" fill="#D70929"/>
            <path d="M4.25067 13.1897C3.31301 13.2501 1.67967 13.6429 2.52659 15.3348C2.55684 14.1867 4.09944 14.0658 4.40191 14.1565C3.64573 15.4254 4.52289 16.634 5.21858 16.5735C4.52289 16.0297 5.15808 15.2139 5.21858 14.942C5.27907 14.7305 5.52105 14.6097 5.79327 14.7003C6.64019 14.942 6.03525 15.6671 6.03525 15.6671C7.91056 16.5131 8.75748 15.788 9.12044 15.365C9.12044 15.365 9.69513 15.9089 9.12044 16.3318C9.42291 16.5131 11.2075 16.5735 11.8729 15.7578C12.0846 16.4225 14.2019 16.4225 14.5347 16.1203C14.5347 16.1203 14.1112 15.8786 14.1112 15.5765C14.1112 15.0629 14.6859 14.6399 15.4118 14.3378C16.2587 13.9752 17.6199 13.7939 19.0112 13.1594C21.552 11.9509 24.6977 9.71513 25.6958 11.1049C26.21 11.8301 26.089 12.525 26.6032 13.0084C27.1174 13.4918 27.9341 13.2803 28.4483 13.2199C29.6884 13.0688 31.473 12.8875 32.5619 12.8271C33.6508 12.7667 33.9532 13.5522 33.9532 13.6429C34.044 13.8846 33.923 14.0356 33.7718 14.0054C33.4088 13.9752 32.7434 13.8241 32.3502 14.0356C31.8057 14.3378 31.9569 15.0931 31.9569 15.0931C32.4106 14.3075 33.681 14.4284 34.1347 14.4888C33.7113 14.8514 32.9248 16.2714 34.044 16.9059C33.7415 15.8182 34.7699 15.0629 34.7699 15.0629C34.8607 15.365 35.5261 15.9995 37.0082 15.9089C35.4656 15.4254 35.7076 14.6399 35.7076 14.6399C36.2218 14.8514 37.3107 14.7003 37.8249 13.5824C36.0705 14.6701 35.5866 13.6429 35.5261 13.522C35.2236 12.9782 36.0705 12.8573 36.0705 12.8573C35.8891 12.4948 33.4693 10.9841 34.6792 10.5309C34.2557 10.2892 33.2576 10.3798 32.3804 11.0445C32.4106 10.833 32.3804 10.259 32.1082 10.0173C32.1082 10.0173 30.6563 11.0143 29.5069 10.833C28.3575 10.6517 28.8113 8.92959 28.8113 8.92959C28.8113 8.92959 31.7452 9.29215 32.8341 8.77852C33.923 8.26489 33.923 7.50956 34.8304 7.02615C35.5563 6.63338 36.4335 6.96572 36.4335 6.96572C36.3125 6.21039 34.8607 5.60613 33.7718 6.78444C33.7718 6.78444 33.681 4.6393 31.0798 4.91122C29.4464 5.06229 28.2366 5.72698 26.5427 6.02911C24.9094 6.33124 23.3668 6.60316 22.3384 6.60316C21.31 6.60316 19.8279 6.33124 19.7069 5.18314C19.6464 4.51845 20.1606 4.21632 20.6748 4.21632C21.4612 4.21632 22.5501 4.66952 23.4273 4.97165C24.0625 5.18314 24.6674 5.18314 25.0304 5.18314C25.968 5.18314 27.1174 4.72994 27.6921 4.48824C28.2668 4.24653 28.7508 4.12568 29.8699 4.21632C29.5069 3.76312 27.0267 2.67544 25.3328 2.76608C23.7298 2.85672 23.6088 3.61205 22.0359 3.52141C20.4631 3.46098 19.0717 3.70269 19.0112 4.91122C18.981 6.08954 20.0094 7.3585 22.6106 7.17722C23.6693 7.11679 27.6014 6.4521 28.3878 6.21039C29.4162 5.87805 33.3483 5.12271 32.5921 7.05636C32.4409 7.47935 31.9569 7.90234 30.8076 7.90234C29.6582 7.90234 28.2063 7.56999 27.8131 7.50956C27.4199 7.44914 26.3915 7.32828 25.3933 7.47935C24.4557 7.6002 17.9828 8.53681 16.8032 8.68788C16.8032 9.08065 16.5612 10.3194 17.6803 11.0143C17.1964 11.256 16.2285 11.7394 15.2908 11.3466C15.2303 11.6488 15.5933 12.2228 16.0168 12.7062C15.6538 12.8271 14.2624 13.4918 13.5365 13.0084C13.234 13.522 12.3871 14.8212 10.2698 14.3982C10.3908 14.3075 10.3303 13.6731 9.84637 13.4616C9.33217 13.522 9.27168 13.8241 7.21488 13.5824C6.60994 13.522 6.09574 13.3105 5.91426 12.9177C5.73277 12.4948 5.97475 11.9207 5.85376 11.5884C5.58154 10.8934 4.55314 10.9841 4.55314 10.9841C5.46055 11.679 4.85561 12.6458 4.85561 12.6458C4.0087 11.7998 2.67783 10.9539 2.22412 12.4645C3.58524 11.9207 4.25067 13.1897 4.25067 13.1897Z" fill="#D70929"/>
            <path d="M17.4988 5.57586C16.9846 4.57882 15.8352 5.30394 15.8352 5.30394C16.1376 4.94138 15.8654 3.82349 15.4722 3.58178C15.4722 4.15583 14.9883 4.33711 14.6253 4.24647C14.1716 4.12562 14.3531 3.49114 14.4741 3.21922C14.1111 3.18901 13.3852 3.15879 12.871 3.88391C12.75 2.97751 11.9031 2.58474 11.0561 2.82645C11.9636 3.88391 9.9975 5.0018 9.30182 4.66946C8.9691 5.33415 10.058 6.11969 10.2092 5.9082C9.63454 6.75417 8.69688 6.57289 8.15243 6.39161C8.12219 6.75417 8.54565 7.53972 9.30182 7.53972C8.90861 8.14398 8.03145 8.20441 7.78947 8.08356C7.66848 8.65761 8.63639 9.20145 8.87836 9.23166C8.09194 10.4704 8.36416 12.0113 8.78762 12.6155L9.09009 13.1292C9.72528 11.8602 11.2074 12.3436 10.9654 13.5824C12.3568 13.7334 13.0222 12.5249 13.3247 11.7998C13.8086 12.3134 14.3833 12.3738 14.716 12.3134C14.2623 11.4674 14.4741 10.6215 14.6555 10.2891C15.1395 10.7423 15.8049 10.833 16.1679 10.7423C15.7142 10.1381 15.7142 8.59718 15.8352 8.05334C16.1376 8.26484 16.8333 8.47633 17.166 7.721C16.5914 7.53972 16.4704 5.54564 17.4988 5.57586ZM11.2376 5.75714C11.3284 5.6665 11.5099 5.51543 11.5703 5.60607C11.7216 5.81756 11.7518 5.96863 12.0241 6.24055C12.2055 6.42183 12.508 6.51247 12.6592 6.57289C12.7197 6.87503 12.145 7.29801 11.4796 6.69375C11.1469 6.3614 11.0259 5.96863 11.2376 5.75714ZM12.75 9.89635C12.0241 10.8934 11.3284 10.4402 11.3284 10.4402C11.3284 10.4402 10.5117 10.1381 10.9049 8.95974C10.3907 8.59718 10.5722 8.11377 10.7234 8.02313C10.7839 8.1742 10.8444 8.47633 11.2981 8.71804C11.7518 8.95974 11.9333 8.80868 11.9636 8.71804C12.0543 8.53676 11.8426 8.35548 11.6611 8.20441C11.5099 8.02313 11.4796 7.75121 11.5703 7.63036C11.7216 7.44908 11.9636 7.47929 12.0845 7.56993C11.5401 7.66057 12.266 8.11377 12.4173 8.20441C12.5987 8.29505 13.3852 8.59718 13.1432 8.11377C13.2642 8.14398 13.4154 8.35548 13.3852 8.56697C13.3549 8.71804 13.1129 8.8691 12.871 8.83889C12.629 8.80868 12.3568 8.74825 12.266 8.92953C12.2055 9.02017 12.266 9.29209 12.7197 9.50358C13.1734 9.74529 13.3549 9.59422 13.5667 9.53379C13.6271 9.68486 13.3549 10.1078 12.75 9.89635ZM15.0488 7.66057C14.9883 7.9627 14.6253 8.08356 14.2018 7.99292C13.3247 7.81164 13.3247 7.14695 13.5969 7.02609C13.7179 7.11673 13.9599 7.29801 14.2018 7.32823C14.5648 7.38865 14.716 7.32823 14.958 7.32823C15.079 7.32823 15.079 7.53972 15.0488 7.66057Z" fill="#D70929"/>
        </svg>
  `;

  // 3) Swap: remove the old <a><img/></a>, insert the new <a><svg/></a>
  const oldAnchor = img.closest('a.navbar-brand-logo') || img;
  brandContainer.replaceChild(a, oldAnchor);
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Only target IMPORTANT callouts; add more types if needed.
  const sel = '.callout.callout-important .callout-title-container';

  document.querySelectorAll(sel).forEach(el => {
    // Prefer operating on the first text node
    const first = el.firstChild;
    const re = /^\s*(?:Important)\s*(?:&nbsp;|\u00A0|\s)?\d+(?:\.\d+)*\s*:\s*/i;

    if (first && first.nodeType === Node.TEXT_NODE) {
      first.textContent = first.textContent.replace(re, '');
    } else {
      // Fallback: operate on HTML if the first child isn't a text node
      el.innerHTML = el.innerHTML.replace(re, '');
    }
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const tools = document.querySelector('#quarto-header .quarto-navbar-tools');
  if (!tools) return;

  // Create the button
  const btn = document.createElement('button');
  btn.id = 'lecture-zoom-header-toggle';
  btn.className = 'btn-zoom-toggle';
  btn.type = 'button';
  btn.setAttribute('aria-pressed', 'false');
  btn.setAttribute('aria-label', 'Lecture zoom');
  btn.setAttribute('title', 'Lecture zoom (X)');

  // svg icon
  btn.innerHTML = `
    <!-- ENTER: four corners -->
    <svg class="icon-enter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M3 9V3h6"/>
        <path d="M21 9V3h-6"/>
        <path d="M3 15v6h6"/>
        <path d="M21 15v6h-6"/>
    </svg>

    <!-- EXIT: corners-in (contract) -->
    <svg class="icon-exit" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M9 3v6H3"/>
        <path d="M15 3v6h6"/>
        <path d="M3 15h6v6"/>
        <path d="M21 15h-6v6"/>
    </svg>
  `;

  // Place it next to the colour-scheme toggle (after it, if present)
  const colorToggle = tools.querySelector('.quarto-color-scheme-toggle');
  if (colorToggle && colorToggle.parentNode) {
    colorToggle.parentNode.insertBefore(btn, colorToggle.nextSibling);
  } else {
    tools.appendChild(btn);
  }

  // Toggle logic
  const KEY = 'lecture-zoom-enabled';
  
  // Helper: are we in lecture zoom?
  const isLectureZoom = () =>
    document.body.classList.contains('lecture-zoom') ||
    document.documentElement.classList.contains('lecture-zoom');

  // Define closeLectureSearch early (forward declaration)
  let closeLectureSearch;

  const apply = (on) => {
    document.body.classList.toggle('lecture-zoom', on);
    document.documentElement.classList.toggle('lecture-zoom', on);
    btn.setAttribute('aria-pressed', on ? 'true' : 'false');
    
    // Close search overlay when exiting lecture zoom
    if (!on && closeLectureSearch) {
      closeLectureSearch();
    }
    
    // Nudge charts/layouts to recompute
    window.dispatchEvent(new Event('resize'));
    sessionStorage.setItem(KEY, on ? '1' : '0');
  };

  // Restore per-tab state
  apply(sessionStorage.getItem(KEY) === '1');

  // Click handler
  btn.addEventListener('click', () => apply(!isLectureZoom()));
  
  // Keyboard shortcut (Z)
  document.addEventListener('keydown', (e) => {
    if (e.key.toLowerCase() === 'x' && !/input|textarea|select/i.test(e.target.tagName)) {
      apply(!isLectureZoom());
    }
  });

  let acAnchor = null;          // where the autocomplete root came from
  let panelObserver = null;     // to catch newly created panels

  function ensureLectureOverlay() {
    let overlay = document.getElementById('lecture-search-overlay');
    if (!overlay) {
      overlay = document.createElement('div');
      overlay.id = 'lecture-search-overlay';
      overlay.innerHTML = '<div class="lecture-search-modal"></div>';
      document.body.appendChild(overlay);

      // Close on backdrop click
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay && closeLectureSearch) closeLectureSearch();
      });

      // Close on Esc
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && closeLectureSearch) closeLectureSearch();
      });
    }
    return overlay;
  }

  function findAutocomplete() {
    const root =
      document.querySelector('.aa-Autocomplete') ||
      document.querySelector('.quarto-search .aa-Autocomplete') ||
      document.querySelector('.quarto-search-panel .aa-Autocomplete');

    const input = root?.querySelector('input.aa-Input');
    return { root, input };
  }

  // Move the results panel (if any) into the modal and normalize its positioning
  function reparentPanel(modal) {
    const panel = document.querySelector('.aa-Panel');
    if (!panel || modal.contains(panel)) return;
    modal.appendChild(panel);
    // Let CSS control layout/width; clear inline positioning from Algolia
    panel.style.left = '';
    panel.style.top = '';
    panel.style.width = '';
  }

  function startPanelObserver(modal) {
    if (panelObserver) return;
    panelObserver = new MutationObserver(() => reparentPanel(modal));
    // Listen on body, since Algolia often inserts the panel there
    panelObserver.observe(document.body, { childList: true, subtree: true });
  }

  function stopPanelObserver() {
    panelObserver?.disconnect();
    panelObserver = null;
  }

  function openLectureSearch() {
    if (!isLectureZoom()) return false;

    const { root, input } = findAutocomplete();
    if (!root || !input) return false;

    const overlay = ensureLectureOverlay();
    const modal = overlay.querySelector('.lecture-search-modal');

    // Anchor the current position of the autocomplete root (only once)
    if (!acAnchor) {
      acAnchor = document.createComment('autocomplete-anchor');
      root.parentNode.insertBefore(acAnchor, root);
    }

    // Move the autocomplete *root* into the modal
    modal.appendChild(root);

    // Ensure any results panel gets moved into the modal too
    reparentPanel(modal);
    startPanelObserver(modal);

    overlay.classList.add('open');
    document.documentElement.classList.add('search-open');

    // Focus the input after layout
    requestAnimationFrame(() => {
      input.focus();
      input.select?.();
      // In case Algolia computes sizes on resize, give it a nudge
      window.dispatchEvent(new Event('resize'));
    });

    return true;
  }

  // Now properly define closeLectureSearch
  closeLectureSearch = function() {
    const overlay = document.getElementById('lecture-search-overlay');
    if (!overlay || !overlay.classList.contains('open')) return;

    stopPanelObserver();

    const { root } = findAutocomplete();

    // Move panel (if currently inside modal) back to body to let Algolia clean up normally
    const modal = overlay.querySelector('.lecture-search-modal');
    const panel = modal?.querySelector('.aa-Panel');
    if (panel) document.body.appendChild(panel);

    // Put the autocomplete root back where it came from
    if (root && acAnchor && acAnchor.parentNode) {
      acAnchor.parentNode.insertBefore(root, acAnchor.nextSibling);
    }

    overlay.classList.remove('open');
    document.documentElement.classList.remove('search-open');
  };

  // Existing hotkeys:
  document.addEventListener('keydown', (e) => {
    const tag = e.target.tagName.toLowerCase();
    const typing = tag === 'input' || tag === 'textarea' || tag === 'select' || e.isComposing;
    if (typing) return;

    if (e.key === 'F' && e.shiftKey) {
      if (openLectureSearch()) {
        e.preventDefault();
        e.stopPropagation();
      }
    }
    if (e.key === 'Escape') {
      closeLectureSearch();
    }
  });

});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const tools = document.querySelector('#quarto-header .quarto-navbar-tools');
  if (!tools) return;

  // Create the print/save button
  const printBtn = document.createElement('button');
  printBtn.id = 'print-pdf-header-toggle';
  printBtn.className = 'btn-print-pdf';
  printBtn.type = 'button';
  printBtn.setAttribute('aria-label', 'Print or save as PDF');
  printBtn.setAttribute('title', 'Print/Save PDF (Ctrl+P)');

  // SVG icon (printer icon without control dot)
  printBtn.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <!-- Paper/document -->
      <path d="M6 9V2h12v7"/>
      <!-- Printer body -->
      <path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/>
      <!-- Output paper -->
      <rect x="6" y="14" width="12" height="8" rx="1"/>
    </svg>
  `;

  // Place it after the zoom button (if present) or color toggle
  const zoomToggle = tools.querySelector('#lecture-zoom-header-toggle');
  const colorToggle = tools.querySelector('.quarto-color-scheme-toggle');
  
  if (zoomToggle && zoomToggle.parentNode) {
    zoomToggle.parentNode.insertBefore(printBtn, zoomToggle.nextSibling);
  } else if (colorToggle && colorToggle.parentNode) {
    colorToggle.parentNode.insertBefore(printBtn, colorToggle.nextSibling);
  } else {
    tools.appendChild(printBtn);
  }

  // Helper function to expand all collapsible content
  const expandAllContent = () => {
    const expandedElements = [];

    // Quarto callout blocks with collapse
    document.querySelectorAll('.callout.collapse').forEach(callout => {
      if (!callout.classList.contains('show')) {
        callout.classList.add('show', 'printing-expanded');
        expandedElements.push(callout);
      }
    });

    // Details/summary elements
    document.querySelectorAll('details:not([open])').forEach(details => {
      details.setAttribute('open', '');
      details.classList.add('printing-expanded');
      expandedElements.push(details);
    });

    // Bootstrap collapse elements
    document.querySelectorAll('.collapse:not(.show)').forEach(collapse => {
      collapse.classList.add('show', 'printing-expanded');
      expandedElements.push(collapse);
    });

    // Quarto tabsets - show all tab content
    document.querySelectorAll('.tab-pane:not(.active)').forEach(tab => {
      tab.classList.add('active', 'show', 'printing-expanded');
      expandedElements.push(tab);
    });

    return expandedElements;
  };

  // Helper function to restore collapsed state
  const restoreCollapsedContent = (elements) => {
    elements.forEach(el => {
      if (el.classList.contains('printing-expanded')) {
        if (el.tagName === 'DETAILS') {
          el.removeAttribute('open');
        } else if (el.classList.contains('callout')) {
          el.classList.remove('show');
        } else if (el.classList.contains('collapse')) {
          el.classList.remove('show');
        } else if (el.classList.contains('tab-pane')) {
          el.classList.remove('active', 'show');
        }
        el.classList.remove('printing-expanded');
      }
    });
  };

  // Show print options dialog
  const showPrintDialog = () => {
    // Remove any existing dialog
    const existingDialog = document.getElementById('print-options-dialog');
    if (existingDialog) existingDialog.remove();

    // Get chapter list from sidebar
    const chapters = getChapterList();
    const currentChapter = getCurrentChapterInfo();

    const dialog = document.createElement('div');
    dialog.id = 'print-options-dialog';
    dialog.className = 'print-dialog-overlay';
    dialog.innerHTML = `
      <div class="print-dialog">
        <h3>Print Options</h3>
        
        <div class="print-option">
          <label>
            Print scope:
            <select id="print-scope">
              <option value="current">Current page only</option>
              <option value="chapter">Current chapter (${currentChapter.name})</option>
              <option value="part">Current part (${currentChapter.partName})</option>
              <option value="selected">Selected chapters...</option>
              <option value="all">Entire book</option>
            </select>
          </label>
        </div>

        <div class="print-option" id="chapter-selection" style="display: none;">
          <label>Select chapters to print:</label>
          <div class="chapter-list">
            ${chapters.map(ch => `
              <label class="chapter-item">
                <input type="checkbox" value="${ch.href}" data-title="${ch.title}">
                ${ch.part ? `<strong>${ch.part}</strong>` : ''} ${ch.title}
              </label>
            `).join('')}
          </div>
        </div>
        
        <div class="print-option">
          <label>
            <input type="checkbox" id="print-expand-all" checked>
            Expand all collapsed content
          </label>
        </div>
        
        <div class="print-option">
          <label>
            <input type="checkbox" id="print-page-numbers" checked>
            Add page numbers
          </label>
        </div>
        
        <div class="print-option">
          <label>
            <input type="checkbox" id="print-chapter-info" checked>
            Include chapter/section headers
          </label>
        </div>

        <div class="print-option">
          <label>
            Layout:
            <select id="print-layout">
              <option value="default">Default</option>
              <option value="compact">Compact (smaller margins)</option>
              <option value="wide">Wide (full width)</option>
            </select>
          </label>
        </div>
        
        <div class="print-progress" id="print-progress" style="display: none;">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <div class="progress-text">Preparing pages...</div>
        </div>
        
        <div class="print-actions">
          <button class="btn-print-cancel">Cancel</button>
          <button class="btn-print-confirm">Print</button>
        </div>
      </div>
    `;

    document.body.appendChild(dialog);

    // Handle scope change
    const scopeSelect = dialog.querySelector('#print-scope');
    const chapterSelection = dialog.querySelector('#chapter-selection');
    
    scopeSelect.addEventListener('change', () => {
      chapterSelection.style.display = scopeSelect.value === 'selected' ? 'block' : 'none';
    });

    // Handle dialog actions
    const confirmBtn = dialog.querySelector('.btn-print-confirm');
    const cancelBtn = dialog.querySelector('.btn-print-cancel');

    confirmBtn.addEventListener('click', () => {
      const scope = dialog.querySelector('#print-scope').value;
      const options = {
        expandAll: dialog.querySelector('#print-expand-all').checked,
        pageNumbers: dialog.querySelector('#print-page-numbers').checked,
        chapterInfo: dialog.querySelector('#print-chapter-info').checked,
        layout: dialog.querySelector('#print-layout').value,
        scope: scope
      };
      
      // Get selected chapters if scope is 'selected'
      if (scope === 'selected') {
        options.chapters = Array.from(dialog.querySelectorAll('.chapter-item input:checked'))
          .map(cb => ({ href: cb.value, title: cb.dataset.title }));
      }
      
      dialog.remove();
      
      // Handle different scopes
      if (scope === 'current') {
        triggerPrint(options);
      } else {
        triggerMultiPagePrint(options);
      }
    });

    cancelBtn.addEventListener('click', () => {
      dialog.remove();
    });

    // Close on backdrop click
    dialog.addEventListener('click', (e) => {
      if (e.target === dialog) dialog.remove();
    });

    // Close on Escape
    const escHandler = (e) => {
      if (e.key === 'Escape') {
        dialog.remove();
        document.removeEventListener('keydown', escHandler);
      }
    };
    document.addEventListener('keydown', escHandler);
  };

  // Get chapter list from sidebar
  const getChapterList = () => {
    const chapters = [];
    const sidebar = document.querySelector('.sidebar-navigation');
    if (!sidebar) return chapters;
    
    let currentPart = '';
    sidebar.querySelectorAll('.sidebar-item').forEach(item => {
      if (item.querySelector('.sidebar-item-text')?.classList.contains('sidebar-part')) {
        currentPart = item.textContent.trim();
      } else if (item.querySelector('a')) {
        const link = item.querySelector('a');
        chapters.push({
          href: link.getAttribute('href'),
          title: link.textContent.trim(),
          part: currentPart,
          element: item
        });
      }
    });
    
    return chapters;
  };

  // Get current chapter info - FIXED version
  const getCurrentChapterInfo = () => {
    // Try to find the active sidebar item
    let active = document.querySelector('.sidebar-item.active a');
    if (!active) {
      // Fallback: check if we're on a chapter page
      const chapterTitle = document.querySelector('h1.chapter-title, .title')?.textContent?.trim();
      return { name: chapterTitle || 'Current Page', partName: 'No part' };
    }
    
    const title = active.textContent.trim();
    
    // Find part name by traversing up from the active item
    let partName = '';
    let currentEl = active.closest('.sidebar-item');
    
    // Go up through previous siblings until we find a part
    while (currentEl) {
      currentEl = currentEl.previousElementSibling;
      if (currentEl && currentEl.querySelector('.sidebar-part, .chapter-part')) {
        partName = currentEl.textContent.trim();
        break;
      }
    }
    
    // If not found, check parent sections
    if (!partName) {
      const parentSection = active.closest('.chapter-section');
      if (parentSection) {
        const partEl = parentSection.querySelector('.sidebar-part, .chapter-part');
        if (partEl) partName = partEl.textContent.trim();
      }
    }
    
    return { name: title, partName: partName || 'Main Content' };
  };

  // Get chapters for current part
  const getChaptersInPart = (partName) => {
    const chapters = getChapterList();
    const inPart = [];
    let foundPart = false;
    
    for (const ch of chapters) {
      if (ch.part === partName) {
        foundPart = true;
        inPart.push(ch);
      } else if (foundPart && ch.part !== partName) {
        break; // Moved to next part
      }
    }
    
    return inPart;
  };

  // Multi-page print handler
  const triggerMultiPagePrint = async (options) => {
    const progressEl = document.getElementById('print-progress');
    const progressBar = progressEl?.querySelector('.progress-fill');
    const progressText = progressEl?.querySelector('.progress-text');
    
    if (progressEl) progressEl.style.display = 'block';
    
    // Determine which chapters to print
    let chaptersToPrint = [];
    
    switch (options.scope) {
      case 'all':
        chaptersToPrint = getChapterList();
        break;
      case 'part':
        const currentInfo = getCurrentChapterInfo();
        chaptersToPrint = getChaptersInPart(currentInfo.partName);
        break;
      case 'chapter':
        // For current chapter, just use single page print
        triggerPrint(options);
        return;
      case 'selected':
        chaptersToPrint = options.chapters || [];
        break;
    }
    
    if (chaptersToPrint.length === 0) {
      alert('No chapters selected for printing');
      return;
    }
    
    // Create iframe for loading pages
    const iframe = document.createElement('iframe');
    iframe.style.position = 'absolute';
    iframe.style.left = '-9999px';
    iframe.style.width = '1000px';
    iframe.style.height = '1000px';
    document.body.appendChild(iframe);
    
    // Collect all pages
    const printPages = [];
    
    for (let i = 0; i < chaptersToPrint.length; i++) {
      const chapter = chaptersToPrint[i];
      const progress = ((i + 1) / chaptersToPrint.length) * 100;
      
      if (progressBar) progressBar.style.width = progress + '%';
      if (progressText) progressText.textContent = `Loading ${chapter.title}...`;
      
      try {
        // Load page in iframe
        const pageContent = await loadPageInIframe(iframe, chapter.href);
        
        // Process the page
        if (options.expandAll) {
          expandAllContentInDocument(iframe.contentDocument);
        }
        
        // Extract and store the content
        const content = iframe.contentDocument.querySelector('.content, main, article')?.innerHTML || '';
        printPages.push({
          title: chapter.title,
          content: content
        });
        
      } catch (err) {
        console.error(`Failed to load ${chapter.title}:`, err);
      }
    }
    
    // Clean up
    iframe.remove();
    if (progressEl) progressEl.style.display = 'none';
    
    // Create combined print document
    createCombinedPrintDocument(printPages, options);
  };

  // Load page in iframe
  const loadPageInIframe = (iframe, href) => {
    return new Promise((resolve, reject) => {
      const timeout = setTimeout(() => {
        reject(new Error('Page load timeout'));
      }, 10000);
      
      iframe.onload = () => {
        clearTimeout(timeout);
        // Wait a bit for JS to run
        setTimeout(() => resolve(iframe.contentDocument), 500);
      };
      
      iframe.src = href;
    });
  };

  // Expand content in a document
  const expandAllContentInDocument = (doc) => {
    // Quarto callout blocks
    doc.querySelectorAll('.callout.collapse').forEach(callout => {
      callout.classList.add('show');
    });

    // Details elements
    doc.querySelectorAll('details').forEach(details => {
      details.setAttribute('open', '');
    });

    // Bootstrap collapse
    doc.querySelectorAll('.collapse').forEach(collapse => {
      collapse.classList.add('show');
    });
  };

  // Create combined document for printing - FIXED version
  const createCombinedPrintDocument = (pages, options) => {
    // Create new window for printing
    const printWindow = window.open('', '_blank');
    
    // Collect all stylesheets except those that might interfere
    const stylesheets = Array.from(document.querySelectorAll('link[rel="stylesheet"]'))
      .filter(link => !link.href.includes('quarto-html'))
      .map(link => link.outerHTML).join('\n');
    
    // Build HTML
    const html = `
      <!DOCTYPE html>
      <html class="${document.documentElement.className}">
      <head>
        <meta charset="UTF-8">
        <title>MAS2901 Statistical Inference - Print</title>
        ${stylesheets}
        <style>
          /* Reset background for light mode printing */
          @media print {
            body:not(.quarto-dark) {
              background-color: white !important;
              color: black !important;
            }
            
            body:not(.quarto-dark) .content,
            body:not(.quarto-dark) .quarto-container-default,
            body:not(.quarto-dark) main,
            body:not(.quarto-dark) article {
              background-color: white !important;
              color: black !important;
            }
            
            /* Fix math rendering in dark mode */
            .quarto-dark .katex,
            .quarto-dark .MathJax,
            .quarto-dark .MathJax *,
            .quarto-dark .katex * {
              color: #e9ecef !important;
              background-color: transparent !important;
              fill: #e9ecef !important;
            }
            
            /* Ensure OJS figures fit within page */
            .ojs-cell,
            .cell-output-display,
            figure,
            .figure {
              max-width: 100% !important;
              overflow: hidden !important;
              page-break-inside: avoid;
            }
            
            .ojs-cell svg,
            figure svg,
            .cell-output-display svg {
              max-width: 100% !important;
              height: auto !important;
            }
            
            /* Scale down large images/plots */
            img, svg {
              max-width: 100% !important;
              height: auto !important;
            }
            
            /* Hide overflow indicators */
            * {
              overflow: visible !important;
            }
            
            pre {
              overflow-wrap: break-word !important;
              white-space: pre-wrap !important;
            }
            
            /* Page breaks */
            .chapter-break { 
              page-break-before: always;
              margin-top: 0 !important;
            }
            
            /* Remove section headers that duplicate */
            .sidebar-title,
            .navbar-title,
            .quarto-title-meta {
              display: none !important;
            }
            
            /* Compact layout adjustments */
            body.print-layout-compact {
              font-size: 10pt;
              line-height: 1.4;
            }
            
            body.print-layout-compact h1 { font-size: 1.4em; }
            body.print-layout-compact h2 { font-size: 1.2em; }
            body.print-layout-compact h3 { font-size: 1.1em; }
            
            /* Wide layout */
            body.print-layout-wide .content {
              max-width: 100% !important;
              margin: 0.5in !important;
            }
            
            /* Hide navigation elements */
            .quarto-title-breadcrumbs,
            .page-navigation,
            .nav-footer {
              display: none !important;
            }
          }
          
          /* Dark mode specific fixes */
          ${document.body.classList.contains('quarto-dark') ? `
          html, body {
            background-color: #1a1a1a !important;
            color: #e9ecef !important;
          }
          ` : ''}
        </style>
      </head>
      <body class="${document.body.className} printing print-layout-${options.layout} ${options.pageNumbers ? 'print-page-numbers' : ''} ${options.chapterInfo ? 'print-chapter-info' : ''}">
        ${pages.map((page, i) => `
          <div class="${i > 0 ? 'chapter-break' : ''}">
            <h1 class="chapter-title">${page.title}</h1>
            ${page.content}
          </div>
        `).join('\n')}
      </body>
      </html>
    `;
    
    printWindow.document.write(html);
    printWindow.document.close();
    
    // Wait for content to render
    printWindow.onload = () => {
      setTimeout(() => {
        // Final cleanup before printing
        const doc = printWindow.document;
        
        // Remove duplicate headers
        doc.querySelectorAll('.quarto-title, .title-block-banner').forEach((el, idx) => {
          if (idx > 0) el.remove();
        });
        
        // Scale OJS content
        doc.querySelectorAll('.ojs-cell').forEach(cell => {
          cell.style.maxWidth = '100%';
          cell.style.overflow = 'hidden';
        });
        
        printWindow.print();
        
        // Close after print dialog
        printWindow.onafterprint = () => {
          printWindow.close();
        };
      }, 1000); // Give more time for math to render
    };
  };

  // Print handler with options
  const triggerPrint = (options) => {
    let expandedElements = [];
    
    // Apply print classes based on options
    document.body.classList.add('printing');
    if (options.pageNumbers) document.body.classList.add('print-page-numbers');
    if (options.chapterInfo) document.body.classList.add('print-chapter-info');
    document.body.classList.add(`print-layout-${options.layout}`);
    
    // Store chapter/section info
    const chapterTitle = document.querySelector('h1.title')?.textContent || '';
    const courseTitle = 'MAS2901 Statistical Inference';
    document.body.setAttribute('data-chapter-title', chapterTitle);
    document.body.setAttribute('data-course-title', courseTitle);
    
    // Force dark mode styles to be applied to documentElement too
    if (document.body.classList.contains('quarto-dark')) {
      document.documentElement.classList.add('printing-dark');
    }
    
    // Expand content if requested
    if (options.expandAll) {
      expandedElements = expandAllContent();
    }
    
    // Small delay to ensure DOM updates
    setTimeout(() => {
      window.print();
      
      // Clean up after print dialog closes
      window.addEventListener('afterprint', function cleanup() {
        document.body.classList.remove('printing', 'print-page-numbers', 
          'print-chapter-info', `print-layout-${options.layout}`);
        document.documentElement.classList.remove('printing-dark');
        
        // Restore collapsed state
        if (expandedElements.length > 0) {
          restoreCollapsedContent(expandedElements);
        }
        
        window.removeEventListener('afterprint', cleanup);
      });
    }, 100);
  };

  // Click handler - show options dialog
  printBtn.addEventListener('click', () => {
    showPrintDialog();
  });
  
  // Direct print shortcut (Ctrl+Shift+P) - use default options
  document.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'p' && 
        !/input|textarea|select/i.test(e.target.tagName)) {
      e.preventDefault();
      showPrintDialog();
    }
  });
});
</script>

<style>
/* Button styling to match other header buttons */
.btn-print-pdf {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.375rem;
  margin: 0 0.25rem;
  border-radius: 0.25rem;
  color: var(--bs-navbar-color, #333);
  transition: opacity 0.15s ease-in-out;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.btn-print-pdf:hover {
  opacity: 0.7;
}

.btn-print-pdf svg {
  width: 1.2rem;
  height: 1.2rem;
}

/* Print options dialog */
.print-dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.print-dialog {
  background: var(--bs-body-bg, white);
  color: var(--bs-body-color, black);
  padding: 2rem;
  border-radius: 0.5rem;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

.print-dialog h3 {
  margin: 0 0 1.5rem 0;
  font-size: 1.25rem;
}

.print-option {
  margin-bottom: 1rem;
}

.print-option label {
  display: flex;
  align-items: center;
  cursor: pointer;
  user-select: none;
}

.print-option input[type="checkbox"] {
  margin-right: 0.5rem;
}

.print-option select {
  margin-left: 0.5rem;
  padding: 0.25rem 0.5rem;
  border: 1px solid var(--bs-border-color, #ddd);
  border-radius: 0.25rem;
  background: var(--bs-body-bg, white);
  color: var(--bs-body-color, black);
}

/* Chapter selection list */
.chapter-list {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid var(--bs-border-color, #ddd);
  border-radius: 0.25rem;
  padding: 0.5rem;
  margin-top: 0.5rem;
}

.chapter-item {
  display: block;
  padding: 0.25rem 0;
  margin: 0;
}

.chapter-item input {
  margin-right: 0.5rem;
}

/* Progress bar */
.print-progress {
  margin-top: 1rem;
}

.progress-bar {
  height: 20px;
  background: var(--bs-gray-200, #e9ecef);
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 0.5rem;
}

.progress-fill {
  height: 100%;
  background: var(--bs-primary, #007bff);
  width: 0%;
  transition: width 0.3s ease;
}

.progress-text {
  text-align: center;
  font-size: 0.875rem;
  color: var(--bs-secondary, #6c757d);
}

.print-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.5rem;
  margin-top: 1.5rem;
}

.print-actions button {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 0.25rem;
  cursor: pointer;
  font-size: 0.9rem;
}

.btn-print-confirm {
  background: var(--bs-primary, #007bff);
  color: white;
}

.btn-print-cancel {
  background: var(--bs-secondary, #6c757d);
  color: white;
}

.print-actions button:hover {
  opacity: 0.9;
}

/* Dark mode support */
.quarto-dark .btn-print-pdf {
  color: var(--bs-navbar-dark-color, #fff);
}

  /* Print-specific styles */
@media print {
  /* Hide UI elements */
  #quarto-header,
  #quarto-sidebar,
  .quarto-navbar,
  .btn-print-pdf,
  .btn-zoom-toggle,
  .quarto-color-scheme-toggle,
  .print-dialog-overlay,
  .ink-tool-container,
  #ink-canvas-container,
  #inkpad-canvas,
  .inkpad-toolbar {
    display: none !important;
  }
  
  /* Force background colors and proper color adjustments */
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color-adjust: exact !important;
  }
  
  /* Light mode: force pure white background */
  body:not(.quarto-dark),
  body:not(.quarto-dark) .content,
  body:not(.quarto-dark) .quarto-container-default,
  body:not(.quarto-dark) main,
  body:not(.quarto-dark) article,
  body:not(.quarto-dark) pre,
  body:not(.quarto-dark) code {
    background-color: white !important;
    background: white !important;
  }
  
  /* Apply dark mode to both html and body for first page fix */
  html.printing-dark,
  html.printing-dark body,
  .quarto-dark,
  .quarto-dark body {
    background-color: #1a1a1a !important;
    color: #e9ecef !important;
  }
  
  /* Ensure the root and all containers have dark background */
  html.printing-dark *,
  .quarto-dark * {
    background-color: inherit;
    color: inherit;
  }
  
  /* Specific dark mode overrides */
  html.printing-dark .content,
  html.printing-dark .quarto-container-default,
  html.printing-dark main,
  html.printing-dark article,
  .quarto-dark .content,
  .quarto-dark .quarto-container-default,
  .quarto-dark main,
  .quarto-dark article {
    background-color: #1a1a1a !important;
    color: #e9ecef !important;
  }
  
  /* Dark mode code blocks */
  html.printing-dark pre,
  html.printing-dark code,
  .quarto-dark pre,
  .quarto-dark code {
    background-color: #2d2d2d !important;
    color: #e9ecef !important;
    border-color: #444 !important;
  }
  
  /* Fix math rendering - remove backgrounds */
  .katex,
  .MathJax,
  .katex *,
  .MathJax *,
  .MathJax_Display,
  .MathJax_Preview,
  mjx-container,
  mjx-container *,
  .katex-display,
  .katex-html {
    background-color: transparent !important;
    background: transparent !important;
  }
  
  /* Dark mode math text color */
  .quarto-dark .katex,
  .quarto-dark .MathJax,
  .quarto-dark mjx-container,
  html.printing-dark .katex,
  html.printing-dark .MathJax,
  html.printing-dark mjx-container {
    color: #e9ecef !important;
  }
  
  /* OJS and figure scaling */
  .ojs-cell,
  .cell-output-display,
  .cell-output,
  .figure,
  figure {
    max-width: 100% !important;
    width: auto !important;
    overflow: visible !important;
    page-break-inside: avoid;
  }
  
  .ojs-cell > *,
  .cell-output-display > * {
    max-width: 100% !important;
  }
  
  /* Scale SVGs and images */
  svg, img {
    max-width: 100% !important;
    height: auto !important;
    width: auto !important;
    display: block;
  }
  
  /* Handle wide tables */
  table {
    font-size: 0.9em;
    max-width: 100% !important;
  }
  
  .table-responsive {
    overflow: visible !important;
  }
  
  /* Code blocks shouldn't overflow */
  pre {
    max-width: 100% !important;
    overflow-wrap: break-word !important;
    white-space: pre-wrap !important;
    word-break: break-word !important;
  }
  
  /* Dark mode callouts */
  html.printing-dark .callout,
  .quarto-dark .callout {
    background-color: #2d2d2d !important;
    border: 1px solid #444 !important;
    color: #e9ecef !important;
  }
  
  html.printing-dark .callout-title,
  .quarto-dark .callout-title {
    color: #e9ecef !important;
  }
  
  /* Dark mode tables */
  html.printing-dark table,
  .quarto-dark table {
    background-color: transparent !important;
    color: #e9ecef !important;
  }
  
  html.printing-dark th,
  .quarto-dark th {
    background-color: #2d2d2d !important;
    border-color: #444 !important;
  }
  
  html.printing-dark td,
  .quarto-dark td {
    background-color: transparent !important;
    border-color: #444 !important;
  }
  
  /* Dark mode links */
  html.printing-dark a,
  .quarto-dark a {
    color: #66b3ff !important;
  }
  
  /* Page setup with dark background */
  @page {
    margin: 0.75in;
    size: letter;
    
    @bottom-right {
      content: counter(page);
    }
  }
  
  /* First page specific fix */
  @page :first {
    margin-top: 0.5in;
  }
  
  /* Default layout */
  .quarto-container-default {
    max-width: 100% !important;
    padding: 0 !important;
  }
  
  /* Compact layout */
  body.print-layout-compact {
    font-size: 10pt;
  }
  
  body.print-layout-compact .content {
    margin: 0.5in !important;
  }
  
  /* Wide layout */
  body.print-layout-wide .content {
    margin: 0.25in !important;
  }
  
  /* Force expanded content to show as expanded */
  .printing-expanded.callout.collapse,
  .printing-expanded.collapse {
    display: block !important;
  }
  
  /* Tab content - show with headers */
  body.printing .tab-pane.printing-expanded {
    display: block !important;
    border-top: 1px solid #ddd;
    padding-top: 1rem;
    margin-top: 1rem;
  }
  
  html.printing-dark .tab-pane.printing-expanded,
  .quarto-dark.printing .tab-pane.printing-expanded {
    border-top-color: #444 !important;
  }
  
  body.printing .tab-pane.printing-expanded::before {
    content: attr(aria-labelledby);
    font-weight: bold;
    display: block;
    margin-bottom: 0.5rem;
  }
  
  /* Page numbers */
  body.print-page-numbers {
    counter-reset: page;
  }
  
  /* Chapter info header */
  body.print-chapter-info::before {
    content: attr(data-course-title) " - " attr(data-chapter-title);
    position: fixed;
    top: 0;
    right: 0;
    font-size: 10pt;
    color: #666;
    padding: 0.5rem;
    z-index: 10000;
    background-color: transparent !important;
  }
  
  html.printing-dark .print-chapter-info::before,
  .quarto-dark.print-chapter-info::before {
    color: #aaa !important;
  }
  
  /* Page breaks */
  .chapter, h1, h2 {
    page-break-before: auto;
    page-break-after: avoid;
  }
  
  /* Avoid breaks inside elements */
  pre, blockquote, figure, .callout, table {
    page-break-inside: avoid;
  }
  
  /* Ensure callout styling prints well */
  .callout {
    border: 1px solid #ddd !important;
    padding: 0.5rem !important;
  }
  
  /* Mathematics in dark mode */
  html.printing-dark .katex,
  html.printing-dark .MathJax,
  .quarto-dark .katex,
  .quarto-dark .MathJax {
    color: #e9ecef !important;
  }
  
  /* Images and figures */
  html.printing-dark img,
  .quarto-dark img {
    opacity: 0.9;
  }
  
  /* Blockquotes */
  html.printing-dark blockquote,
  .quarto-dark blockquote {
    border-left-color: #444 !important;
    color: #adb5bd !important;
    background-color: transparent !important;
  }
}
</style>
<style>


  .inkpad-toolbar:not(.open){ display:none !important; }
  .inkpad-toolbar.open{ display:flex; }

  /* Ensure toolbar always clickable (and fast on touch) */
  .inkpad-toolbar{ pointer-events:auto; }
  .inkpad-btn{ touch-action:manipulation; user-select:none; }

  /* Nice visual cue when drawing */
  #inkpad-canvas.drawing { cursor: crosshair !important; }
  #quarto-content > #inkpad-canvas { padding-top: 0 !important; }

/* And make sure the canvas itself never has padding/margins */
  #inkpad-canvas { padding: 0 !important; margin: 0; display: block; box-sizing: content-box; }

  /* Floating toolbar */
  .inkpad-toolbar {
    position: fixed; z-index: 9999; right: 10px; bottom: 10px;
    gap: 4px; background: transparent;
    padding: 2px; border-radius: 8px;
  }
  .inkpad-btn {
    border: 0; border-radius: 10px; padding: 8px 10px; color: var(--brand-fg); cursor: pointer;
    background: var(--surface); font: 600 12px/1.1;
  }
  .inkpad-btn.active { background: var(--brand-teal); color: var(--brand-bg) }

  /* Icon sizing + swapping */
.inkpad-btn .inkpad-icon { width: 18px; height: 18px; display: block; }

/* Micro-interaction polish (respects currentColor / theme) */
.inkpad-btn .icon-pen { transition: transform .15s ease; }
.inkpad-btn:hover .icon-pen { transform: translateY(-1px) rotate(-8deg); }
@media (prefers-reduced-motion: reduce) {
  .inkpad-btn .icon-pen { transition: none; }
}

  /* Canvas overlay (document-sized, scrolls with page) */
#inkpad-canvas {
  position: fixed; 
  top: 0; 
  left: 0;
  z-index: 9998;
  touch-action: none;
  padding: 0 !important; 
  margin: 0; 
  display: block; 
  box-sizing: content-box;
  pointer-events: none; /* You're already toggling this in JS */
}

/*  Hide during print */
@media print {
  #inkpad-canvas {
    display: none !important;
    position: absolute !important; /* fallback */
    width: 0 !important;
    height: 0 !important;
  }
}


/* ----- Popover ----- */
.inkpad-popover {
  position: fixed;
  right: 10px;
  bottom: 56px;                /* sits just above the toolbar */
  z-index: 10000;
  display: none;
  padding: 10px;
  background: var(--surface);
  color: var(--brand-fg);
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,.22);
  width: 240px;
}

/* little arrow pointing to the toolbar */
.inkpad-popover::after {
  content: "";
  position: absolute;
  right: 18px;
  bottom: -8px;
  width: 14px; height: 14px;
  background: var(--surface);
  transform: rotate(45deg);
  box-shadow: 3px 3px 10px rgba(0,0,0,.12);
}

.inkpad-popover.open { display: block; }

.inkpad-field {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 10px;
}
.inkpad-field:last-child { margin-bottom: 0; }

.inkpad-field label {
  font: 600 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  color: var(--brand-fg);
}
.inkpad-out {
  font-weight: 700;
  color: var(--brand-teal);
}

/* ----- Color input (tidy circular swatch) ----- */
#inkpad-color {
  appearance: none;
  -webkit-appearance: none;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  padding: 0;
  border: 2px solid rgba(0,0,0,.15);
  background: transparent;
  cursor: pointer;
  overflow: hidden;
}
#inkpad-color::-webkit-color-swatch-wrapper { padding: 0; }
#inkpad-color::-webkit-color-swatch {
  border: none;
  border-radius: 50%;
}
#inkpad-color::-moz-color-swatch {
  border: none;
  border-radius: 50%;
}

/* ----- Range sliders (brand-styled, accessible) ----- */
#inkpad-size,
#inkpad-eraser-size {
  width: 100%;
  height: 28px;                 /* easier to grab on touch */
  background: transparent;
  cursor: pointer;
}

/* WebKit */
#inkpad-size::-webkit-slider-runnable-track,
#inkpad-eraser-size::-webkit-slider-runnable-track {
  height: 6px;
  background: linear-gradient(90deg, var(--brand-teal), var(--brand-teal)) 0/var(--_fill,0%) 100% no-repeat,
              color-mix(in oklab, var(--brand-fg) 10%, transparent);
  border-radius: 999px;
}
#inkpad-size::-webkit-slider-thumb,
#inkpad-eraser-size::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--brand-bg);
  border: 2px solid var(--brand-teal);
  margin-top: -6px;            /* centers thumb on 6px track */
}

/* Firefox */
#inkpad-size::-moz-range-track,
#inkpad-eraser-size::-moz-range-track {
  height: 6px;
  background: color-mix(in oklab, var(--brand-fg) 10%, transparent);
  border-radius: 999px;
}
#inkpad-size::-moz-range-progress,
#inkpad-eraser-size::-moz-range-progress {
  height: 6px;
  background: var(--brand-teal);
  border-radius: 999px;
}
#inkpad-size::-moz-range-thumb,
#inkpad-eraser-size::-moz-range-thumb {
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--brand-bg);
  border: 2px solid var(--brand-teal);
}

/* Improve focus ring for a11y */
#inkpad-color:focus-visible,
#inkpad-size:focus-visible,
#inkpad-eraser-size:focus-visible,
#inkpad-options:focus-visible {
  outline: 2px solid var(--brand-teal);
  outline-offset: 2px;
}


/* visually hidden helper */
.sr-only {
  position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden;
  clip:rect(0,0,0,0); white-space:nowrap; border:0;
}

/* icons inherit theme via currentColor */
.inkpad-icon { width: 18px; height: 18px; display: block; }

/* show/hide by state */
/* --- Toggle: icon swapping --- */
.inkpad-toggle .icon-pen { display: inline-block; }
.inkpad-toggle .icon-stop { display: none; }
.inkpad-toggle[aria-pressed="true"] .icon-pen { display: none; }
.inkpad-toggle[aria-pressed="true"] .icon-stop { display: inline-block; }

/* --- Toggle: visuals --- */
.inkpad-toggle {
  --ink-accent: var(--brand-red); /* customize if you like */
  --ink-off-border: color-mix(in oklab, var(--brand-fg) 28%, transparent);

  background: var(--brand-bg);
  color: var(--brand-fg);
  border: 1.5px solid var(--ink-off-border);
  padding: 6px 10px;
}

/* hover/focus when OFF */
.inkpad-toggle:hover {
  border-color: var(--brand-fg);
  background: color-mix(in oklab, var(--brand-bg) 90%, var(--brand-red));
}
.inkpad-toggle:focus-visible {
  outline: 2px solid var(--ink-accent);
  outline-offset: 2px;
}

/* ON state = â€œsolidâ€ */
.inkpad-toggle[aria-pressed="true"] {
  background: var(--ink-accent);
  border-color: var(--ink-accent);
  color: var(--brand-bg); /* makes icon stroke flip to readable */
}

/* Icon sizing + color via currentColor */
.inkpad-toggle .inkpad-icon {
  width: 16px; height: 16px;
  stroke: currentColor; /* override any inline stroke */
}

/* Subtle pen tilt only when OFF; never rotate the stop square */
.inkpad-toggle[aria-pressed="false"] .icon-pen {
  transform: rotate(-8deg) translateY(-1px);
}
.inkpad-toggle .icon-stop { transform: none !important; }




/* Mobile: turn the popover into a bottom sheet */
@media (max-width: 560px) {
  .inkpad-popover {
    right: 10px; left: 10px;
    bottom: 60px;
    width: auto;
  }
  .inkpad-popover::after { right: 24px; }
}

.inkpad-btn.active .inkpad-icon { transform: rotate(30deg); transition: transform .15s ease; }
.inkpad-btn .icon-stop { transform: none !important; }


/* Buttons: press/focus feedback + disabled state */
.inkpad-btn {
  transition: transform 120ms ease, box-shadow 160ms ease, background 160ms ease, opacity 120ms ease;
}
.inkpad-btn:active:not([disabled]) { transform: translateY(1px) scale(0.98); }
.inkpad-btn:focus-visible { outline: 2px solid var(--brand-red); outline-offset: 2px; }
.inkpad-btn[disabled] { opacity: .5; cursor: not-allowed; }

/* Quick flash ring when action fires */
.inkpad-btn.flash { box-shadow: 0 0 0 3px color-mix(in oklab, var(--brand-teal) 35%, transparent) inset; }
@media (prefers-reduced-motion: reduce) {
  .inkpad-btn { transition: none; }
}

/* Toast next to the toolbar */
.inkpad-toast {
  position: fixed; right: 12px; bottom: 56px; z-index: 10001;
  background: var(--surface); color: var(--brand-fg); border-radius: 10px;
  padding: 8px 10px; font: 600 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  box-shadow: 0 8px 24px rgba(0,0,0,.18);
  opacity: 0; transform: translateY(6px); pointer-events: none;
  transition: opacity 160ms ease, transform 160ms ease;
}
.inkpad-toast.show { opacity: 1; transform: translateY(0); }


/* --- Toggle icon swapping (put these LAST) --- */
#inkpad-toggle .inkpad-icon { display: none; }                /* hide both */
#inkpad-toggle[aria-pressed="false"] .icon-pen  { display: inline-block; }
#inkpad-toggle[aria-pressed="true"]  .icon-stop { display: inline-block; }




</style>

<div class="inkpad-toolbar" id="inkpad-toolbar" aria-label="Ink toolbar" aria-hidden="true">
<button class="inkpad-btn inkpad-toggle" id="inkpad-toggle" type="button" aria-pressed="false" title="Draw (D)" aria-label="Draw (D)">
  <span class="sr-only">Toggle ink</span>

  <!-- Start (Pen) -->
  <svg class="inkpad-icon icon-pen" viewbox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true">
    <path d="M3 21l3.5-1 9.9-9.9a2.8 2.8 0 0 0 0-4L15 3.7a2.8 2.8 0 0 0-4 0L1 13.7 0 18.5 3 21z"></path>
    <circle cx="12" cy="8.5" r="1"></circle>
    <path d="M13 20h8"></path>
  </svg>

  <!-- Stop (Square) -->
  <svg class="inkpad-icon icon-stop" viewbox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" aria-hidden="true">
    <rect x="6" y="6" width="12" height="12" rx="2"></rect>
  </svg>
</button>

  <button class="inkpad-btn active" id="inkpad-pen" type="button" title="Pen (P)">Pen</button>
  <button class="inkpad-btn" id="inkpad-eraser" type="button" title="Eraser (E)">Eraser</button>
  <button class="inkpad-btn" id="inkpad-undo" type="button" title="Undo (Z)">Undo</button>
  <button class="inkpad-btn" id="inkpad-clear" type="button" title="Clear">Clear</button>
  <button class="inkpad-btn" id="inkpad-save" type="button" title="Save PNG">Save</button>
  <button class="inkpad-btn" id="inkpad-options" type="button" title="Pen/Eraser options" aria-expanded="false">
    <svg class="inkpad-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <!-- Feather "settings" glyph -->
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33
                1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51
                1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06
                a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09
                a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06
                a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9
                A1.65 1.65 0 0 0 10 3.09V3a2 2 0 1 1 4 0v.09
                a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06
                a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9
                c0 .66.39 1.27 1 1.51.16.06.33.09.51.09H21a2 2 0 1 1 0 4h-.09
                a1.65 1.65 0 0 0-1.51 1z"></path>
    </svg>
  </button>
</div>
<div id="inkpad-toast" class="inkpad-toast" role="status" aria-live="polite" aria-atomic="true"></div>


<!-- Popover container -->
<div id="inkpad-popover" class="inkpad-popover" aria-hidden="true">
  <div class="inkpad-field">
    <label for="inkpad-color">Pen colour</label>
    <input id="inkpad-color" type="color" value="#ff0055">
  </div>

  <div class="inkpad-field">
    <label for="inkpad-size">
      Pen size <span class="inkpad-out" id="inkpad-size-out">3</span>px
    </label>
    <input id="inkpad-size" type="range" min="1" max="30" step="0.2" value="3">
  </div>

  <div class="inkpad-field">
    <label for="inkpad-eraser-size">
      Eraser size <span class="inkpad-out" id="inkpad-eraser-size-out">12</span>px
    </label>
    <input id="inkpad-eraser-size" type="range" min="5" max="100" step="1" value="24">
  </div>
</div>

<canvas id="inkpad-canvas" aria-hidden="true"></canvas>

<script>
(() => {
  const canvas = document.getElementById('inkpad-canvas');
  const tb = (id) => document.getElementById(id);
  const toolbar = document.getElementById('inkpad-toolbar');
  const key = 'ink:' + location.pathname; // per-page storage key
  const ctx = canvas.getContext('2d');
  let drawingEnabled = false;
  let tool = 'pen'; // 'pen' | 'eraser'
  let penColor   = '#ff0055';
  let penSize    = 3;
  let eraserSize = 12;  // in CSS px
  let strokes = []; // array of {tool, color, size, points:[{x,y,p}]}
  let current = null;
  const baseSize = 3; // base pen size in CSS px


const toastEl = document.getElementById('inkpad-toast');
const undoBtn  = tb('inkpad-undo');
const clearBtn = tb('inkpad-clear');
const saveBtn  = tb('inkpad-save');

function flash(el) {
  if (!el) return;
  el.classList.add('flash');
  setTimeout(() => el.classList.remove('flash'), 180);
}

function showToast(msg, ms = 900) {
  if (!toastEl) return;
  toastEl.textContent = msg;
  toastEl.classList.add('show');
  clearTimeout(showToast._t);
  showToast._t = setTimeout(() => toastEl.classList.remove('show'), ms);
}

// enable/disable actions based on whether there is anything to operate on
function hasInk() {
  return strokes.length > 0 || (current && current.points && current.points.length);
}
function updateActionStates() {
  const enabled = !!hasInk();
  if (undoBtn)  undoBtn.disabled  = !enabled;
  if (clearBtn) clearBtn.disabled = !enabled;
  if (saveBtn)  saveBtn.disabled  = !enabled;
}


  function onButton(id, fn){
    const el = tb(id);
    if(!el) return;
    el.addEventListener('click', (e)=>{
      e.preventDefault();
      e.stopPropagation();
      fn(e);
    }, {passive:false});
  }

// Popover toggle (pure toggle â€” no outside-click close)
const optionsBtn = document.getElementById('inkpad-options');
const popover    = document.getElementById('inkpad-popover');

if (optionsBtn && popover) {
  const setPopover = (open) => {
    popover.classList.toggle('open', open);
    popover.setAttribute('aria-hidden', String(!open));
    optionsBtn.setAttribute('aria-expanded', String(open));
    optionsBtn.classList.toggle('active', open);
  };

  optionsBtn.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    setPopover(!popover.classList.contains('open'));
  });

  // Optional: keep clicks inside from bubbling (not required, but harmless)
  popover.addEventListener('click', (e) => e.stopPropagation());
}

function setPopover(open) {
  popover.classList.toggle('open', open);
  popover.setAttribute('aria-hidden', String(!open));
  optionsBtn.setAttribute('aria-expanded', String(open));
  optionsBtn.classList.toggle('active', open);
}

popover.addEventListener('click', (e) => e.stopPropagation());


  // read a CSS var once (for ring color); fallback if missing
  const brandTeal = (getComputedStyle(document.documentElement)
    .getPropertyValue('--brand-teal') || '').trim() || '#00c8ff';

   // live eraser preview in PAGE coords (CSS px)
  let hoverPage = null;  // {x, y} or null

  function drawEraserPreview() {
    if (!drawingEnabled || tool !== 'eraser' || !hoverPage) return;

    const r = eraserSize / 2;
    ctx.save();
    // we're already in page space (you set a -scroll transform in redraw)
    ctx.globalCompositeOperation = 'source-over';
    ctx.lineWidth = 1;
    // subtle fill + ring; alpha keeps it unobtrusive
    ctx.fillStyle   = 'rgba(0,0,0,0.06)';                // soft shadow fill
    ctx.strokeStyle = brandTeal;                         // themed ring
    ctx.beginPath();
    ctx.arc(hoverPage.x, hoverPage.y, r, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();
    ctx.restore();
  }

  const colorInput  = document.getElementById('inkpad-color');
  const sizeInput   = document.getElementById('inkpad-size');
  const eraserInput = document.getElementById('inkpad-eraser-size');

  if (colorInput) {
    colorInput.addEventListener('input', e => { penColor = e.target.value; });
  }
  if (sizeInput) {
    sizeInput.addEventListener('input', e => { penSize = +e.target.value; });
  }
  if (eraserInput) {
    eraserInput.addEventListener('input', e => { eraserSize = +e.target.value; });
  }

  // --- slider outputs + track fill ---
  const sizeOut    = document.getElementById('inkpad-size-out');
  const eraserOut  = document.getElementById('inkpad-eraser-size-out');

  function setRangeFill(el) {
    const min = +el.min || 0, max = +el.max || 100, val = +el.value || 0;
    const pct = Math.max(0, Math.min(100, ((val - min) / (max - min)) * 100));
    el.style.setProperty('--_fill', pct + '%');   // used by your CSS gradient
  }

  // initial sync
  if (sizeOut)   sizeOut.textContent   = String(penSize);
  if (eraserOut) eraserOut.textContent = String(eraserSize);
  if (sizeInput)   setRangeFill(sizeInput);
  if (eraserInput) setRangeFill(eraserInput);

  // live updates
  if (sizeInput) {
    sizeInput.addEventListener('input', e => {
        penSize = +e.target.value;
        if (sizeOut) sizeOut.textContent = String(penSize);
        setRangeFill(sizeInput);
    });
  }
  if (eraserInput) {
    eraserInput.addEventListener('input', e => {
        eraserSize = +e.target.value;
        if (eraserOut) eraserOut.textContent = String(eraserSize);
        setRangeFill(eraserInput);
    });
  }

  // Size canvas to the full scrollable document (not just the viewport)
  function docSize() {
    const d = document.documentElement, b = document.body;
    const w = Math.max(d.scrollWidth,  b ? b.scrollWidth  : 0, d.clientWidth);
    const h = Math.max(d.scrollHeight, b ? b.scrollHeight : 0, d.clientHeight);
    return {w: Math.ceil(w), h: Math.ceil(h)};
  }

  function fitCanvas() {
    const dpr = currentDpr();
    const w = window.innerWidth;
    const h = window.innerHeight;

    canvas.width  = Math.ceil(w * dpr);
    canvas.height = Math.ceil(h * dpr);
    canvas.style.width  = w + 'px';
    canvas.style.height = h + 'px';

    // Set transform in redraw().
    scheduleRedraw();
  }

  // Re-measure shortly after load to catch late reflows (math/images)
  setTimeout(fitCanvas, 500);


  // save only serializable fields
  function save(){
    try {
        const lean = strokes.map(({anchorId, tool, color, size, points}) => ({anchorId, tool, color, size, points}));
        localStorage.setItem(key, JSON.stringify(lean));
    } catch {}
  }

  function load(){
    try {
        const s = localStorage.getItem(key);
        strokes = s ? (JSON.parse(s) || []) : [];
        for (const st of strokes) recomputeMeta(st);
    } catch { strokes = []; }
  }

function redraw(){
  const dpr = currentDpr();
  const sx = window.scrollX, sy = window.scrollY;

  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.setTransform(dpr, 0, 0, dpr, -sx * dpr, -sy * dpr);

  const vx0 = sx, vy0 = sy, vx1 = sx + window.innerWidth, vy1 = sy + window.innerHeight;

  // cache anchor offsets this frame
  const anchorCache = new Map();
  const infoFor = (id) => {
    if (!anchorCache.has(id)) anchorCache.set(id, anchorInfo(id));
    return anchorCache.get(id);
  };

  for (const s of strokes) {
    const info = infoFor(s.anchorId || 'global');
    if (!info.visible) continue;
    const B = s.localBBox;
    const absBox = { x0: B.x0 + info.left, y0: B.y0 + info.top, x1: B.x1 + info.left, y1: B.y1 + info.top };
    if (intersects(absBox, vx0, vy0, vx1, vy1)) drawStrokeAnchored(s, info);
  }
  if (current) {
    const info = infoFor(current.anchorId || 'global');
    if (info.visible) drawStrokeAnchored(current, info);
  }

  // draw the eraser halo on top
  drawEraserPreview();
}


  function styleFor(stroke){
    if (stroke.tool === 'eraser') {
        ctx.globalCompositeOperation = 'destination-out';
        ctx.strokeStyle = '#000';
        ctx.lineWidth = stroke.size; // â† eraserSize already baked in
    } else if (stroke.tool === 'highlight') {
        ctx.globalCompositeOperation = 'multiply';
        ctx.strokeStyle = (stroke.color || '#ff0') + '33';
        ctx.lineWidth = stroke.size * 2;
    } else {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = stroke.color || penColor;
        ctx.lineWidth = stroke.size;
    }
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
  }

function drawStrokeAnchored(stroke, info){
  ctx.save();
  styleFor(stroke);
  ctx.translate(info.left, info.top);

  if (stroke._isDot) {
    // Draw like the live case so sizes match
    const r = (stroke.size || 3) / 2;
    const p = stroke.points[0];
    ctx.beginPath();
    ctx.arc(p.x, p.y, Math.max(1, r), 0, Math.PI*2);
    ctx.fillStyle = (stroke.tool === 'eraser') ? '#000' : ctx.strokeStyle;
    ctx.fill();
  } else if (stroke._localPath) {
    ctx.stroke(stroke._localPath);
  } else {
    // (your existing multi-point fallback)
    const pts = stroke.points || [];
    if (!pts.length) { ctx.restore(); return; }
    if (pts.length === 1) {
      const r = ctx.lineWidth/2;
      ctx.beginPath(); ctx.arc(pts[0].x, pts[0].y, Math.max(1,r), 0, Math.PI*2);
      ctx.fillStyle = (stroke.tool==='eraser') ? '#000' : ctx.strokeStyle;
      ctx.fill();
    } else {
      ctx.beginPath();
      ctx.moveTo(pts[0].x, pts[0].y);
      for (let i=1;i<pts.length-1;i++){
        const c=pts[i], n=pts[i+1];
        ctx.quadraticCurveTo(c.x, c.y, (c.x+n.x)/2, (c.y+n.y)/2);
      }
      const last = pts[pts.length-1];
      ctx.lineTo(last.x, last.y);
      ctx.stroke();
    }
  }

  ctx.restore();
}



function setDrawing(enabled){
  drawingEnabled = enabled;
  canvas.style.pointerEvents = enabled ? 'auto' : 'none';
  canvas.classList.toggle('drawing', enabled);

  const drawBtn = tb('inkpad-toggle');
  drawBtn.classList.toggle('active', enabled);
  drawBtn.setAttribute('aria-pressed', String(enabled));

  const label = enabled ? 'Stop drawing (D)' : 'Draw (D)';
  drawBtn.setAttribute('title', label);
  drawBtn.setAttribute('aria-label', label);

  if (!enabled) hoverPage = null;          
  scheduleRedraw();
}

  function setTool(t){
    tool = t;
    tb('inkpad-pen').classList.toggle('active', t==='pen');
    tb('inkpad-eraser').classList.toggle('active', t==='eraser');
  }

  // performance: cap dpr to avoid excessive sizes on high-dpi screens
  const DPR_CAP = 1.5;                           // tune if you like
  function currentDpr(){ return Math.min(window.devicePixelRatio || 1, DPR_CAP); }

  // Throttle redraws to once per frame
  let raf = 0;
  function scheduleRedraw(){
    if (raf) return;
    raf = requestAnimationFrame(() => { raf = 0; redraw(); });
  }

  function buildPath2DLocal(stroke){
    const pts = stroke.points || [];
    const path = new Path2D();
    if (!pts.length) return path;
    if (pts.length === 1) {
        const size = stroke.size || 3;
        path.arc(pts[0].x, pts[0].y, Math.max(1, size/2), 0, Math.PI*2);
        return path;
    }
    path.moveTo(pts[0].x, pts[0].y);
    for (let i=1; i<pts.length-1; i++){
        const c = pts[i], n = pts[i+1];
        path.quadraticCurveTo(c.x, c.y, (c.x+n.x)/2, (c.y+n.y)/2);
    }
    const last = pts[pts.length-1];
    path.lineTo(last.x, last.y);
    return path;
  }


function recomputeMeta(s){
  if (!s.points?.length) return;

  let b = {x0:s.points[0].x,y0:s.points[0].y,x1:s.points[0].x,y1:s.points[0].y};
  for (const p of s.points){ if (p.x<b.x0) b.x0=p.x; if (p.y<b.y0) b.y0=p.y; if (p.x>b.x1) b.x1=p.x; if (p.y>b.y1) b.y1=p.y; }

  // mark single-point strokes as dots and expand bbox by radius
  if (s.points.length === 1) {
    s._isDot = true;                      // non-serializable flag is fine
    const pad = (s.size || 3) / 2;
    b.x0 -= pad; b.y0 -= pad; b.x1 += pad; b.y1 += pad;
  } else {
    s._isDot = false;
  }

  s.localBBox = b;

  // cache path only for multi-point strokes
  if (!s._isDot) {
    Object.defineProperty(s, '_localPath', { value: buildPath2DLocal(s), enumerable: false, writable: true });
  } else {
    Object.defineProperty(s, '_localPath', { value: null, enumerable: false, writable: true });
  }
}


  function pushPointDecimated(arr, p, minDist=0.75){ // CSS px
    const last = arr[arr.length-1];
    if (!last) { arr.push(p); return true; }
    const dx = p.x - last.x, dy = p.y - last.y;
    if (dx*dx + dy*dy < minDist*minDist) return false;
    arr.push(p); return true;
  }
  function expandBBox(b, p){
    b.x0 = Math.min(b.x0, p.x); b.y0 = Math.min(b.y0, p.y);
    b.x1 = Math.max(b.x1, p.x); b.y1 = Math.max(b.y1, p.y);
  }
  function newBBox(p){ return {x0:p.x, y0:p.y, x1:p.x, y1:p.y}; }
  function intersects(b, x0,y0,x1,y1){ return !(b.x1 < x0 || b.x0 > x1 || b.y1 < y0 || b.y0 > y1); }


  function getAnchorAtPoint(clientX, clientY) {
    // Temporarily let the page receive the hit
    const prev = canvas.style.pointerEvents;
    canvas.style.pointerEvents = 'none';
    const hit = document.elementFromPoint(clientX, clientY);
    canvas.style.pointerEvents = prev || (drawingEnabled ? 'auto' : 'none');

    const el = hit?.closest('details, .collapse, .callout, [data-ink-surface]');
    if (!el) return { id: 'global', el: null };
    if (!el.id) el.id = 'ink-surface-' + Math.random().toString(36).slice(2,9);
    return { id: el.id, el };
  }


  function anchorInfo(anchorId) {
    if (anchorId === 'global') return { left: 0, top: 0, visible: true };
    const el = document.getElementById(anchorId);
    if (!el) return { left: 0, top: 0, visible: false };

    const cs = getComputedStyle(el);
    const visible = cs.display !== 'none' && cs.visibility !== 'hidden';
    const expanded =
        (el.tagName.toLowerCase() !== 'details' || el.open) &&
        (!el.classList.contains('collapse') || el.classList.contains('show'));
    if (!visible || !expanded) return { left: 0, top: 0, visible: false };

    const r = el.getBoundingClientRect();
    return { left: r.left + window.scrollX, top: r.top + window.scrollY, visible: true };
  }

    // pointer in LOCAL anchor coords
  function pointerPosLocal(e, anchorEl) {
    if (!anchorEl) return { x: e.pageX, y: e.pageY, p: e.pressure>0?e.pressure:0.5 };
    const r = anchorEl.getBoundingClientRect();
    return { x: e.clientX - r.left, y: e.clientY - r.top, p: e.pressure>0?e.pressure:0.5 };
  }



  function pointerPos(e){  // page space (CSS px)
    return { x: e.pageX, y: e.pageY, p: (e.pressure>0 ? e.pressure : 0.5) };
  }


  let currentAnchor = { id: 'global', el: null };

  canvas.addEventListener('pointerdown', (e)=>{
    if (!drawingEnabled) return;
    try { canvas.setPointerCapture?.(e.pointerId); } catch {}
    currentAnchor = getAnchorAtPoint(e.clientX, e.clientY);

    const p = pointerPosLocal(e, currentAnchor.el);
    current = {
        anchorId: currentAnchor.id,
        tool,
        color: penColor,
        size: tool === 'eraser' ? eraserSize : penSize,
        points: [p],
        localBBox: {x0:p.x,y0:p.y,x1:p.x,y1:p.y}
    };
    e.preventDefault();
    scheduleRedraw();
  }, {passive:false});

  canvas.addEventListener('pointermove', (e)=>{
    if (!current) return;
    const p = pointerPosLocal(e, currentAnchor.el);
    if (pushPointDecimated(current.points, p)) {
        current.localBBox.x0 = Math.min(current.localBBox.x0, p.x);
        current.localBBox.y0 = Math.min(current.localBBox.y0, p.y);
        current.localBBox.x1 = Math.max(current.localBBox.x1, p.x);
        current.localBBox.y1 = Math.max(current.localBBox.y1, p.y);
    }
    e.preventDefault();
    scheduleRedraw();
  }, {passive:false});

// update hover position always while ink is enabled
canvas.addEventListener('pointermove', (e) => {
  if (!drawingEnabled) return;
  hoverPage = { x: e.pageX, y: e.pageY };
}, { passive: true });

canvas.addEventListener('pointerleave', () => {
  hoverPage = null;
  scheduleRedraw();
});



  function endStroke(e){
    if (!current) return;
    const p = pointerPosLocal(e, currentAnchor.el);
    if (pushPointDecimated(current.points, p)) {
        current.localBBox.x0 = Math.min(current.localBBox.x0, p.x);
        current.localBBox.y0 = Math.min(current.localBBox.y0, p.y);
        current.localBBox.x1 = Math.max(current.localBBox.x1, p.x);
        current.localBBox.y1 = Math.max(current.localBBox.y1, p.y);
    }
    recomputeMeta(current);                      // builds _localPath
    strokes.push(current);
    current = null;
    try { canvas.releasePointerCapture?.(e.pointerId); } catch {}
    save();
    scheduleRedraw();
    updateActionStates(); 

  }


  canvas.addEventListener('pointerup', endStroke);
  canvas.addEventListener('pointercancel', endStroke);
  canvas.addEventListener('pointerleave', endStroke);

  // --- hook up the toolbar buttons so clicks always â€œregisterâ€ ---
  onButton('inkpad-toggle', () => setDrawing(!drawingEnabled));
  onButton('inkpad-pen',    () => setTool('pen'));
  onButton('inkpad-eraser', () => setTool('eraser'));

onButton('inkpad-undo', () => {
  if (!strokes.length) { flash(undoBtn); showToast('Nothing to undo'); return; }
  strokes.pop(); save(); redraw();
  flash(undoBtn); showToast('Undid last stroke');
  updateActionStates();
});

onButton('inkpad-clear', () => {
  if (!strokes.length) { flash(clearBtn); showToast('Nothing to clear'); return; }
  if (confirm('Clear all ink on this page?')) {
    strokes = []; save(); redraw();
    flash(clearBtn); showToast('Cleared');
    updateActionStates();
  }
});

onButton('inkpad-save', () => {
  if (!hasInk()) { flash(saveBtn); showToast('Nothing to save'); return; }
  const url = canvas.toDataURL('image/png');
  const a = document.createElement('a');
  a.download = (document.title || 'notes') + '.png';
  a.href = url; a.click();
  flash(saveBtn); showToast('Saved PNG');
});


  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    // Only when toolbar is visible
    if (!toolbar.classList.contains('open')) return;

    // Donâ€™t hijack typing in inputs
    if (e.target && /input|textarea|select|button/i.test(e.target.tagName)) return;
    if (e.target?.isContentEditable) return;

    const k = e.key.toLowerCase();
    if (k === 'd') { setDrawing(!drawingEnabled); e.preventDefault(); }
    else if (k === 'p') { setTool('pen'); e.preventDefault(); }
    else if (k === 'e') { setTool('eraser'); e.preventDefault(); }
    else if (k === 'z' && (e.ctrlKey || e.metaKey)) { strokes.pop(); save(); redraw(); e.preventDefault(); }
  });

  window.addEventListener('resize', fitCanvas, {passive:true});

  // redraw when viewport scrolls
  window.addEventListener('scroll', scheduleRedraw, { passive: true });

  // redraw for nested scrollable containers (capture phase catches them)
  document.addEventListener('scroll', scheduleRedraw, { passive: true, capture: true });

  // stay smooth during touch scrolling
  window.addEventListener('touchmove', scheduleRedraw, { passive: true });

  // handle rotation and tab visibility
  window.addEventListener('orientationchange', scheduleRedraw, { passive: true });
  document.addEventListener('visibilitychange', () => {
    if (!document.hidden) scheduleRedraw();
  }, { passive: true });

  // respond to DPR changes (pinch-zoom)
  if (window.matchMedia) {
    const dppx = Math.round((window.devicePixelRatio || 1) * 10) / 10;
    const mq = matchMedia(`(resolution: ${dppx}dppx)`);
    mq.addEventListener?.('change', () => { fitCanvas(); }); // Safari/iOS
  }

  document.addEventListener('toggle', (e) => {
    if (e.target.tagName?.toLowerCase() === 'details') requestAnimationFrame(scheduleRedraw);
  }, true);
  document.addEventListener('show.bs.collapse', () => scheduleRedraw());
  document.addEventListener('hide.bs.collapse', () => scheduleRedraw());

  // If a details/collapse uses CSS height transitions, redraw after it ends.
  document.addEventListener('transitionend', (e) => {
    const t = e.target;
    if (!t) return;
    // common containers that change height
    if (t.matches?.('details, .collapse, .callout, [data-ink-surface]')) {
        scheduleRedraw();
    }
  }, { passive: true, capture: true });

  // Bootstrapâ€™s final state events 
  document.addEventListener('shown.bs.collapse',  () => scheduleRedraw());
  document.addEventListener('hidden.bs.collapse', () => scheduleRedraw());


  // --- initialise ---
  load(); fitCanvas();
  setDrawing(false);   // ensures initial visual state is consistent
  setTool('pen');
  updateActionStates();

  const m = new MutationObserver(() => {
    const open = toolbar.classList.contains('open');
    toolbar.setAttribute('aria-hidden', open ? 'false' : 'true');
  });
  m.observe(toolbar, {attributes:true, attributeFilter:['class']});

  // keep canvas sized if the document grows (e.g., lazy images)
  const ro = new ResizeObserver(()=> fitCanvas());
  ro.observe(document.documentElement);
})();
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const tools = document.querySelector('#quarto-header .quarto-navbar-tools');
  if (!tools) return;

  // Avoid duplicates if hot-reloading / re-running
  if (document.getElementById('inkpad-header-toggle')) return;

  // Create the Ink button
  const inkBtn = document.createElement('button');
  inkBtn.id = 'inkpad-header-toggle';
  inkBtn.className = 'btn-ink-tool';
  inkBtn.type = 'button';
  inkBtn.setAttribute('aria-label', 'Ink controls');
  inkBtn.setAttribute('title', 'Ink controls (I)');
  inkBtn.setAttribute('aria-controls', 'inkpad-toolbar');
  inkBtn.setAttribute('aria-expanded', 'false');

  // Pen icon
  inkBtn.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round" width="20" height="20" aria-hidden="true">
        <path d="M12 19l7-7 3 3-7 7-3-3z"/>
        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
        <path d="M2 2l7.586 7.586"/>
        <circle cx="11" cy="11" r="2"/>
      </svg>
  `;

  // Place it after the zoom toggle, else after colour toggle, else append
  const zoomToggle  = tools.querySelector('#lecture-zoom-header-toggle');
  const colorToggle = tools.querySelector('.quarto-color-scheme-toggle');
  if (zoomToggle && zoomToggle.parentNode) {
    zoomToggle.parentNode.insertBefore(inkBtn, zoomToggle.nextSibling);
  } else if (colorToggle && colorToggle.parentNode) {
    colorToggle.parentNode.insertBefore(inkBtn, colorToggle.nextSibling);
  } else {
    tools.appendChild(inkBtn);
  }

  // Toggle behaviour: show/hide the floating ink toolbar
  const toolbar = document.getElementById('inkpad-toolbar'); // your existing floating toolbar
  const setOpen = (open) => {
    if (!toolbar) return;
    toolbar.classList.toggle('open', open);
    inkBtn.classList.toggle('active', open);
    inkBtn.setAttribute('aria-expanded', String(open));
  };

  inkBtn.addEventListener('click', () => {
    if (!toolbar) return;
    setOpen(!toolbar.classList.contains('open'));
  });

  // Keyboard: "I" toggles; "Esc" closes
  document.addEventListener('keydown', (e) => {
    if (/input|textarea|select/i.test(e.target.tagName)) return;
    if (e.key.toLowerCase() === 'i' && !e.metaKey && !e.ctrlKey && !e.altKey) {
      if (!toolbar) return;
      setOpen(!toolbar.classList.contains('open'));
    }
    if (e.key === 'Escape') setOpen(false);
  });
});
</script>

<style>
/* Header ink button look & feel */
#quarto-header .btn-ink-tool {
  background: none; border: 0;
  padding: .375rem; margin: 0 .25rem;
  border-radius: .375rem; cursor: pointer;
  color: var(--bs-navbar-color, currentColor);
  display: inline-flex; align-items: center; justify-content: center;
  transition: background .15s ease, opacity .15s ease;
}
#quarto-header .btn-ink-tool:hover { opacity: .8; color: var(--brand-teal-hover); background: rgba(255,255,255,0.08);}
#quarto-header .btn-ink-tool.active {
  background: color-mix(in srgb, var(--brand-teal) 30%, transparent);
  /* border: 1px solid var(--brand-teal);  */
  /* border-radius: .375rem;              */
}
.quarto-dark #quarto-header .btn-ink-tool { color: var(--bs-navbar-dark-color, #fff); }


</style>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIEdsb2JhbCBoZWxwZXJzIChubyB0aGVtZSBsb2dpYyBuZWVkZWQpXG5BQ0NFTlQgID0gXCJ2YXIoLS1icmFuZC10ZWFsKVwiXG5BQ0NFTlQyID0gXCJ2YXIoLS1icmFuZC1yZWQpXCJcbkdSSUQgICAgPSBcInZhcigtLWJvcmRlcilcIlxuXG4vLyBOdW1lcmljYWwgaGVscGVyc1xubGluc3BhY2UgPSAoYSwgYiwgbj00MDEpID0+IEFycmF5LmZyb20oe2xlbmd0aDpufSwgKF8saSk9PiBhICsgKGItYSkqKGkvKG4tMSkpKVxuXG4vLyBMb2ctR2FtbWEgKExhbmN6b3MpIGFuZCBmcmllbmRzIChmb3Igc3RhYmxlIFBNRnMvUERGcylcbmZ1bmN0aW9uIGxvZ0dhbW1hKHope1xuICBjb25zdCBnID0gNztcbiAgY29uc3QgcCA9IFtcbiAgICAwLjk5OTk5OTk5OTk5OTgwOTkzLCA2NzYuNTIwMzY4MTIxODg1MSwgLTEyNTkuMTM5MjE2NzIyNDAyOCxcbiAgICA3NzEuMzIzNDI4Nzc3NjUzMTMsIC0xNzYuNjE1MDI5MTYyMTQwNTksIDEyLjUwNzM0MzI3ODY4NjkwNSxcbiAgICAtMC4xMzg1NzEwOTUyNjU3MjAxMiwgOS45ODQzNjk1NzgwMTk1NzE2ZS02LCAxLjUwNTYzMjczNTE0OTMxMTZlLTdcbiAgXTtcbiAgaWYoeiA8IDAuNSl7XG4gICAgcmV0dXJuIE1hdGgubG9nKE1hdGguUEkpIC0gTWF0aC5sb2coTWF0aC5zaW4oTWF0aC5QSSp6KSkgLSBsb2dHYW1tYSgxIC0geik7XG4gIH1cbiAgeiAtPSAxO1xuICBsZXQgeCA9IHBbMF07XG4gIGZvcihsZXQgaT0xOyBpPHAubGVuZ3RoOyBpKyspIHggKz0gcFtpXSAvICh6ICsgaSk7XG4gIGNvbnN0IHQgPSB6ICsgZyArIDAuNTtcbiAgcmV0dXJuIDAuNSpNYXRoLmxvZygyKk1hdGguUEkpICsgKHorMC41KSpNYXRoLmxvZyh0KSAtIHQgKyBNYXRoLmxvZyh4KTtcbn1cblxubG9nQ2hvb3NlID0gKG4saykgPT4gbG9nR2FtbWEobisxKSAtIGxvZ0dhbW1hKGsrMSkgLSBsb2dHYW1tYShuLWsrMSlcblxuLy8gRGlzY3JldGUgUE1GcyAoc3RhYmxlIGluIGxvZy1kb21haW4pXG5iaW5vbVBNRiA9IChuLHAsaykgPT4gTWF0aC5leHAobG9nQ2hvb3NlKG4saykgKyBrKk1hdGgubG9nKHApICsgKG4taykqTWF0aC5sb2coMS1wKSlcbnBvaXNQTUYgID0gKGxhbWJkYSxrKSA9PiBNYXRoLmV4cChrKk1hdGgubG9nKGxhbWJkYSkgLSBsYW1iZGEgLSBsb2dHYW1tYShrKzEpKVxuZ2VvbVBNRjEgPSAocCxrKSA9PiBwICogTWF0aC5wb3coMS1wLCBrLTEpIC8vIHN1cHBvcnQgezEsMiwuLi59XG5uZWdiaW5QTUYgPSAocixwLHgpID0+IHtcbiAgaWYoeCA8IHIpIHJldHVybiAwO1xuICByZXR1cm4gTWF0aC5leHAobG9nQ2hvb3NlKHgtMSwgci0xKSArIHIqTWF0aC5sb2cocCkgKyAoeC1yKSpNYXRoLmxvZygxLXApKTtcbn1cblxuLy8gQ29udGludW91cyBQREZzXG5ub3JtUERGID0gKHgsbXUsc2lnKSA9PiBNYXRoLmV4cCgtMC41KigoeC1tdSkvc2lnKSoqMikvKHNpZypNYXRoLnNxcnQoMipNYXRoLlBJKSlcbmxvZ25vcm1QREYgPSAoeCxtdSxzaWcpID0+IHg8PTAgPyAwIDogTWF0aC5leHAoLSgoTWF0aC5sb2coeCktbXUpKioyKS8oMipzaWcqc2lnKSkgLyAoeCpzaWcqTWF0aC5zcXJ0KDIqTWF0aC5QSSkpXG51bmlmUERGID0gKHgsYSxiKSA9PiAoeD5hICYmIHg8YikgPyAxLyhiLWEpIDogMFxuZXhwUERGID0gKHgsbGFtYmRhKSA9PiB4PjAgPyBsYW1iZGEqTWF0aC5leHAoLWxhbWJkYSp4KSA6IDBcbmdhbW1hUERGID0gKHgsYSxiKSA9PiB7IC8vIHNoYXBlIGEsIHJhdGUgYlxuICBpZih4PD0wKSByZXR1cm4gMDtcbiAgcmV0dXJuIE1hdGguZXhwKGEqTWF0aC5sb2coYikgLSBsb2dHYW1tYShhKSArIChhLTEpKk1hdGgubG9nKHgpIC0gYip4KVxufVxuYmV0YVBERiA9ICh4LGEsYikgPT4ge1xuICBpZih4PD0wIHx8IHg+PTEpIHJldHVybiAwO1xuICBjb25zdCBsb2dCID0gbG9nR2FtbWEoYSkrbG9nR2FtbWEoYiktbG9nR2FtbWEoYStiKTtcbiAgcmV0dXJuIE1hdGguZXhwKChhLTEpKk1hdGgubG9nKHgpICsgKGItMSkqTWF0aC5sb2coMS14KSAtIGxvZ0IpXG59XG5jaGlzcVBERiA9ICh4LG51KSA9PiBnYW1tYVBERih4LCBudS8yLCAxLzIpXG50UERGID0gKHgsbnUpID0+IHtcbiAgY29uc3QgbG9nQyA9IGxvZ0dhbW1hKChudSsxKS8yKSAtICgwLjUqTWF0aC5sb2cobnUqTWF0aC5QSSkgKyBsb2dHYW1tYShudS8yKSk7XG4gIHJldHVybiBNYXRoLmV4cChsb2dDIC0gKChudSsxKS8yKSpNYXRoLmxvZygxICsgKHgqeCkvbnUpKTtcbn1cbmZQREYgPSAoeCxkMSxkMikgPT4ge1xuICBpZih4PD0wKSByZXR1cm4gMDtcbiAgY29uc3QgbG9nQyA9IGxvZ0dhbW1hKChkMStkMikvMikgLSAobG9nR2FtbWEoZDEvMikrbG9nR2FtbWEoZDIvMikpICsgKGQxLzIpKk1hdGgubG9nKGQxL2QyKTtcbiAgcmV0dXJuIE1hdGguZXhwKGxvZ0MgKyAoZDEvMiAtIDEpKk1hdGgubG9nKHgpIC0gKChkMStkMikvMikqTWF0aC5sb2coMSArIChkMS9kMikqeCkpXG59XG5cbi8vIENvbnZlbmllbnQgZG9tYWluIGhldXJpc3RpY3NcbmRvbWFpbk5vcm1hbCA9IChtdSxzaWcpID0+IFttdSAtIDQqc2lnLCBtdSArIDQqc2lnXVxuZG9tYWluR2FtbWEgID0gKGEsYikgPT4gWzAsIE1hdGgubWF4KDUsIGEvYiArIDYqTWF0aC5zcXJ0KGEpL2IpXVxuZG9tYWluRXhwICAgID0gKGxhbWJkYSkgPT4gWzAsIE1hdGgubWF4KDUsIDYvbGFtYmRhKV1cbmRvbWFpbkJldGEgICA9IFswLDFdXG5kb21haW5Qb3MgICAgPSBbMCwgMTBdXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbntcbiAgY29uc3QgbiA9IGJpbm9tX24sIHAgPSBiaW5vbV9wO1xuICBjb25zdCBkYXRhID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogbiArIDEgfSwgKF8sIGspID0+ICh7IHg6IGssIHk6IGJpbm9tUE1GKG4sIHAsIGspIH0pKTtcbiAgY29uc3QgeERvbWFpbiA9IEFycmF5LmZyb20oeyBsZW5ndGg6IG4gKyAxIH0sIChfLCBrKSA9PiBrKTsgIC8vIDwtLSAwLi5uIGNhdGVnb3JpZXNcblxuICBjb25zdCBzdGF0cyA9IG1kYCoqTWVhbioqICR7dGV4YD0gblxccmhvYH0gPSAkeyhuICogcCkudG9GaXhlZCgyKX07IFxuICAqKlZhcmlhbmNlKiogJHt0ZXhgPSBuXFxyaG8oMS1cXHJobylgfSA9ICR7KG4gKiBwICogKDEgLSBwKSkudG9GaXhlZCgyKX0uYDtcblxuICBjb25zdCBwbG90ID0gUGxvdC5wbG90KHtcbiAgICAgICAgd2lkdGgsIGhlaWdodDogMjYwLFxuICAgIHN0eWxlOiB7XG4gICAgYmFja2dyb3VuZDogXCJ2YXIoLS1wbG90LXBhbmVsLWJnKVwiLFxuICAgIGNvbG9yOiBcInZhcigtLWJyYW5kLWZnKVwiICAgICAgICAgICAvLyBkcml2ZXMgJ2N1cnJlbnRDb2xvcidcbiAgICB9LFxuICAgIHk6IHsgbGFiZWw6IFwiUE1GXCIgfSxcbiAgICB4OiB7IGxhYmVsOiBcInhcIiwgdHlwZTogXCJiYW5kXCIsIGRvbWFpbjogeERvbWFpbiwgcGFkZGluZzogMC4wNSB9LCAgLy8gPC0tIGJhbmQgc2NhbGVcbiAgICBtYXJrczogW1xuICAgICAgUGxvdC5iYXJZKGRhdGEsIHsgeDogXCJ4XCIsIHk6IFwieVwiLCBmaWxsOiBBQ0NFTlQgfSksXG4gICAgICBQbG90LnJ1bGVZKFswXSwgeyBzdHJva2U6IEdSSUQsIHN0cm9rZU9wYWNpdHk6IDAuNiB9KVxuICAgIF1cbiAgfSk7XG5cbiAgcmV0dXJuIGh0bWxgPGRpdiBjbGFzcz1cImRpc3QtcGFuZWxcIj48ZGl2IGNsYXNzPVwic3RhdHNcIj4ke3N0YXRzfTwvZGl2PiR7cGxvdH08L2Rpdj5gO1xufVxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgYmlub21fbiA9IElucHV0cy5yYW5nZShbMSwgMjAwXSwgeyB2YWx1ZTogMjAsIHN0ZXA6IDEsICBsYWJlbDogbWRgJHt0ZXhgbmB9YCB9KVxudmlld29mIGJpbm9tX3AgPSBJbnB1dHMucmFuZ2UoWzAuMDEsIDAuOTldLCB7IHZhbHVlOiAwLjMsIHN0ZXA6IDAuMDEsIGxhYmVsOiBtZGAke3RleGBcXHJob2B9YCB9KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG57XG4gIC8vIGNvbXB1dGUgbG9jYWxseSAobm8gZXhwb3J0ZWQgbmFtZXMpXG4gIGNvbnN0IEwgICAgID0gcG9pc19sYW1iZGE7XG4gIGNvbnN0IGttYXggID0gTWF0aC5tYXgoMTUsIE1hdGguY2VpbChMICsgNipNYXRoLnNxcnQoTCkpKTtcbiAgY29uc3QgcG9pc19kYXRhID0gQXJyYXkuZnJvbSh7bGVuZ3RoOiBrbWF4ICsgMX0sIChfLCBrKSA9PiAoeyB4OiBrLCB5OiBwb2lzUE1GKEwsIGspIH0pKTtcblxuICAvLyBidWlsZCB0aGUgVUkgYml0c1xuICBjb25zdCBzdGF0cyA9IG1kYCoqTWVhbioqICR7dGV4YD0gXFxsYW1iZGFgfSA9ICR7TC50b0ZpeGVkKDIpfTsgXG4gICoqVmFyaWFuY2UqKiAke3RleGA9IFxcbGFtYmRhYH0gPSAke0wudG9GaXhlZCgyKX0uYDtcblxuICBjb25zdCBwbG90ID0gUGxvdC5wbG90KHtcbiAgICAgICAgd2lkdGgsIGhlaWdodDogMjYwLFxuICAgIHN0eWxlOiB7XG4gICAgYmFja2dyb3VuZDogXCJ2YXIoLS1wbG90LXBhbmVsLWJnKVwiLFxuICAgIGNvbG9yOiBcInZhcigtLWJyYW5kLWZnKVwiICAgICAgICAgICAvLyBkcml2ZXMgJ2N1cnJlbnRDb2xvcidcbiAgICB9LFxuXG4gICAgeTogeyBsYWJlbDogXCJQTUZcIiB9LFxuICAgIHg6IHsgbGFiZWw6IFwieFwiIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIFBsb3QuYmFyWShwb2lzX2RhdGEsIHsgeDogXCJ4XCIsIHk6IFwieVwiLCBmaWxsOiBcInZhcigtLWJyYW5kLXRlYWwpXCIgfSksXG4gICAgICBQbG90LnJ1bGVZKFswXSwgeyBzdHJva2U6IFwidmFyKC0tYm9yZGVyKVwiLCBzdHJva2VPcGFjaXR5OiAwLjYgfSlcbiAgICBdXG4gIH0pO1xuXG4gIC8vIHJldHVybiBib3RoIGluIGEgc2luZ2xlIHdyYXBwZXJcbiAgcmV0dXJuIGh0bWxgPGRpdiBjbGFzcz1cImRpc3QtcGFuZWxcIj5cbiAgICA8ZGl2IGNsYXNzPVwic3RhdHNcIj4ke3N0YXRzfTwvZGl2PlxuICAgICR7cGxvdH1cbiAgPC9kaXY+YDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBwb2lzX2xhbWJkYSA9IElucHV0cy5yYW5nZShbMC4yLCAzMF0sIHtcbiAgdmFsdWU6IDYsIHN0ZXA6IDAuMiwgbGFiZWw6IG1kYCR7dGV4YFxcbGFtYmRhYH1gXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG57XG4gIGNvbnN0IGEgPSB1bmlmX2EsIGIgPSB1bmlmX2I7XG4gIGNvbnN0IGRhdGEgPSBsaW5zcGFjZShhIC0gMSwgYiArIDEsIDQwMSkubWFwKHggPT4gKHsgeCwgeTogdW5pZlBERih4LCBhLCBiKSB9KSk7XG5cbiAgY29uc3Qgc3RhdHMgPSBtZGAqKk1lYW4qKiAke3RleGA9IChhK2IpLzJgfSA9ICR7KCgoYStiKS8yKSkudG9GaXhlZCgyKX07IFxuICAqKlZhcmlhbmNlKiogJHt0ZXhgPSAoYi1hKV4yLzEyYH0gPSAkeygoKGItYSkqKjIpLzEyKS50b0ZpeGVkKDMpfS5gO1xuXG4gIGNvbnN0IHBsb3QgPSBQbG90LnBsb3Qoe1xuICAgICAgICB3aWR0aCwgaGVpZ2h0OiAyNjAsXG4gICAgc3R5bGU6IHtcbiAgICBiYWNrZ3JvdW5kOiBcInZhcigtLXBsb3QtcGFuZWwtYmcpXCIsXG4gICAgY29sb3I6IFwidmFyKC0tYnJhbmQtZmcpXCIgICAgICAgICAgIC8vIGRyaXZlcyAnY3VycmVudENvbG9yJ1xuICAgIH0sXG4geTogeyBsYWJlbDogXCJQREZcIiB9LCB4OiB7IGxhYmVsOiBcInhcIiB9LFxuICAgIG1hcmtzOiBbXG4gICAgICBQbG90LmxpbmVZKGRhdGEsIHsgeDogXCJ4XCIsIHk6IFwieVwiLCBzdHJva2U6IEFDQ0VOVCwgc3Ryb2tlV2lkdGg6IDIgfSksXG4gICAgICBQbG90LmFyZWFZKGRhdGEsIHsgeDogXCJ4XCIsIHk6IFwieVwiLCBmaWxsOiBBQ0NFTlQsIGZpbGxPcGFjaXR5OiAwLjE4IH0pLFxuICAgICAgUGxvdC5ydWxlWShbMF0sIHsgc3Ryb2tlOiBHUklELCBzdHJva2VPcGFjaXR5OiAwLjYgfSlcbiAgICBdXG4gIH0pO1xuXG4gIHJldHVybiBodG1sYDxkaXYgY2xhc3M9XCJkaXN0LXBhbmVsXCI+PGRpdiBjbGFzcz1cInN0YXRzXCI+JHtzdGF0c308L2Rpdj4ke3Bsb3R9PC9kaXY+YDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiB1bmlmX2EgPSBJbnB1dHMucmFuZ2UoWy01LCA1XSwge3ZhbHVlOiAtMiwgc3RlcDogMC4xLCBsYWJlbDogbWRgJHt0ZXhgYWB9YH0pXG52aWV3b2YgdW5pZl9iID0gSW5wdXRzLnJhbmdlKFt1bmlmX2EgKyAwLjIsIHVuaWZfYSArIDEwXSwge3ZhbHVlOiAzLCBzdGVwOiAwLjEsIGxhYmVsOiBtZGAke3RleGBiYH1gfSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgzrwgPSBub3JtX211LCDPgyA9IG5vcm1fc2lnO1xuICBjb25zdCBbbG8sIGhpXSA9IGRvbWFpbk5vcm1hbCjOvCwgz4MpO1xuICBjb25zdCBkYXRhID0gbGluc3BhY2UobG8sIGhpKS5tYXAoeCA9PiAoeyB4LCB5OiBub3JtUERGKHgsIM68LCDPgykgfSkpO1xuXG4gIGNvbnN0IHN0YXRzID0gbWRgKipNZWFuKiogJHt0ZXhgPSBcXG11YH0gPSAke868LnRvRml4ZWQoMil9OyBcbiAgKipWYXJpYW5jZSoqICR7dGV4YD0gXFxzaWdtYV4yYH0gPSAkeyjPgyoqMikudG9GaXhlZCgyKX0uYDtcblxuICBjb25zdCBwbG90ID0gUGxvdC5wbG90KHtcbiAgICB3aWR0aCwgaGVpZ2h0OiAyNjAsXG4gICAgc3R5bGU6IHsgYmFja2dyb3VuZDogXCJ2YXIoLS1wbG90LXBhbmVsLWJnKVwiLCBjb2xvcjogXCJ2YXIoLS1icmFuZC1mZylcIiB9LFxuICAgIHg6IHsgbGFiZWw6IFwieFwiIH0sIHk6IHsgbGFiZWw6IFwiUERGXCIgfSxcbiAgICBtYXJrczogW1xuICAgICAgLy8gc2hhZGVkIGFyZWEgdW5kZXIgdGhlIFBERjpcbiAgICAgIFBsb3QuYXJlYVkoZGF0YSwgeyB4OiBcInhcIiwgeTogXCJ5XCIsIGZpbGw6IEFDQ0VOVCwgZmlsbE9wYWNpdHk6IDAuMTggfSksXG5cbiAgICAgIC8vIFBERiBvdXRsaW5lOlxuICAgICAgUGxvdC5saW5lWShkYXRhLCB7IHg6IFwieFwiLCB5OiBcInlcIiwgc3Ryb2tlOiBBQ0NFTlQsIHN0cm9rZVdpZHRoOiAyIH0pLFxuXG4gICAgICBQbG90LnJ1bGVZKFswXSwgeyBzdHJva2U6IEdSSUQsIHN0cm9rZU9wYWNpdHk6IDAuNiB9KVxuICAgIF1cbiAgfSk7XG5cbiAgcmV0dXJuIGh0bWxgPGRpdiBjbGFzcz1cImRpc3QtcGFuZWxcIj48ZGl2IGNsYXNzPVwic3RhdHNcIj4ke3N0YXRzfTwvZGl2PiR7cGxvdH08L2Rpdj5gO1xufVxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2Ygbm9ybV9tdSAgPSBJbnB1dHMucmFuZ2UoWy0zLCAzXSwge3ZhbHVlOiAwLCBzdGVwOiAwLjA1LCBsYWJlbDogbWRgJHt0ZXhgXFxtdWB9YH0pXG52aWV3b2Ygbm9ybV9zaWcgPSBJbnB1dHMucmFuZ2UoWzAuMDUsIDNdLCB7dmFsdWU6IDEsIHN0ZXA6IDAuMDUsIGxhYmVsOiBtZGAke3RleGBcXHNpZ21hYH1gfSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnYmlub21fbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdiaW5vbV9wJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3BvaXNfbGFtYmRhJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3VuaWZfYScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd1bmlmX2InKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbm9ybV9tdScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdub3JtX3NpZycpIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../content/main";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../index.html" class="pagination-link" aria-label="Preface">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../content/main/2-machine-learning-models.html" class="pagination-link" aria-label="Machine Learning Models">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Machine Learning Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>