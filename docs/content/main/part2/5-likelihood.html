<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Likelihood – MAS2901: Statistical Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../content/main/part2/6-bayes-inference.html" rel="next">
<link href="../../../content/main/part2/4-freq-point-estimation.html" rel="prev">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-b651517ce65839d647a86e2780455cfb.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-eee127bcbcf69f6d1c4f39497eef8043.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-ca592282aabca1dce090d3def4fc59bb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-eee127bcbcf69f6d1c4f39497eef8043.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "F"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<script>
  (function () {
    // Compute book root for both environments
    function computeRoots() {
      const onPages = /github\.io$/i.test(location.hostname);
      // >>>> CHANGE THIS to your repo name <<
      const repoBase = '/NCL-MAS2901/';

      if (onPages) {
        // GitHub Pages: use fixed base path
        return { 
          rootPath: repoBase,
          abs: location.origin + repoBase
        };
      } else {
        // Local preview: find the book root by looking for index.html
        // This works by going up the directory tree until we find the root
        let pathSegments = location.pathname.split('/').filter(s => s);
        
        // Remove the current file if it exists
        if (pathSegments.length > 0 && pathSegments[pathSegments.length - 1].includes('.')) {
          pathSegments.pop();
        }
        
        // For local development, we need to find the actual root
        // Quarto typically serves from the root, so we can use '/'
        // If your local setup is different, adjust accordingly
        const rootPath = '/';
        const abs = location.origin + rootPath;
        
        return { rootPath, abs };
      }
    }

    function appendOrReplace(selector, makeEl) {
      const existing = document.querySelector(selector);
      if (existing) existing.remove();
      document.head.appendChild(makeEl());
    }

    const roots = computeRoots();

    // Helper function to build absolute URLs
    function buildUrl(path) {
      // Ensure path doesn't start with /
      const cleanPath = path.replace(/^\//, '');
      // Ensure roots.abs ends with /
      const base = roots.abs.endsWith('/') ? roots.abs : roots.abs + '/';
      return base + cleanPath;
    }

    // Inject links ASAP (don't wait for load)
    appendOrReplace('link[rel="manifest"]', () => {
      const l = document.createElement('link');
      l.rel = 'manifest';
      l.href = buildUrl('pwa/manifest.webmanifest');
      return l;
    });

    // Favicons (tab icons)
    appendOrReplace('link[rel="icon"][sizes="16x16"]', () => {
      const l = document.createElement('link');
      l.rel = 'icon'; 
      l.type = 'image/png'; 
      l.sizes = '16x16';
      l.href = buildUrl('pwa/icons/icon-16.png');
      return l;
    });
    
    appendOrReplace('link[rel="icon"][sizes="32x32"]', () => {
      const l = document.createElement('link');
      l.rel = 'icon'; 
      l.type = 'image/png'; 
      l.sizes = '32x32';
      l.href = buildUrl('pwa/icons/icon-32.png');
      return l;
    });
    
    // Legacy ICO (optional)
    appendOrReplace('link[rel="icon"][type="image/x-icon"]', () => {
      const l = document.createElement('link');
      l.rel = 'icon'; 
      l.type = 'image/x-icon';
      l.href = buildUrl('pwa/icons/favicon.ico');
      return l;
    });

    // Apple touch icon
    appendOrReplace('link[rel="apple-touch-icon"]', () => {
      const l = document.createElement('link');
      l.rel = 'apple-touch-icon';
      l.href = buildUrl('pwa/icons/icon-180.png');
      return l;
    });

    // Register SW (use absolute URL)
    if ('serviceWorker' in navigator) {
      const swUrl = buildUrl('service-worker.js');
      const scope = roots.rootPath.endsWith('/') ? roots.rootPath : roots.rootPath + '/';
      
      navigator.serviceWorker.register(swUrl, { scope: scope })
        .then(reg => console.log('SW registered for scope:', scope))
        .catch(err => console.error('SW registration failed:', err));
    }
  })();
</script>
<script type="module" src="../../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/math-scroll.css">
<link rel="stylesheet" href="../../../theming/callout-style.css">
<link rel="stylesheet" href="../../../theming/floating-code.css">
<link rel="stylesheet" href="../../../theming/font.css">
<link rel="stylesheet" href="../../../theming/no-xref-suffix.css">
<link rel="stylesheet" href="../../../theming/scrollbar.css">
<link rel="stylesheet" href="../../../theming/nav-tabs.css">
<link rel="stylesheet" href="../../../theming/header.css">
<link rel="stylesheet" href="../../../theming/question-bank.css">
<link rel="stylesheet" href="../../../theming/sidebar.css">
<link rel="stylesheet" href="../../../theming/lecture-zoom.css">
<link rel="stylesheet" href="../../../theming/visualisation-controls.css">
<link rel="stylesheet" href="../../../theming/tables.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../images/ncl_logo_light.png" alt="" class="navbar-logo light-content">
    <img src="../../../images/ncl_logo_light.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">MAS2901: Statistical Inference</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../content/main/part2/4-freq-point-estimation.html">Part II — Point Estimation</a></li><li class="breadcrumb-item"><a href="../../../content/main/part2/5-likelihood.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Likelihood</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../../index.html" class="sidebar-logo-link">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I — Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/main/part1/1-prob-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Probability Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/main/part1/2-what-is-stats-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">What is Statistical Inference?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/main/part1/3-types-of-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Types of Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II — Point Estimation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/main/part2/4-freq-point-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Frequentist Point Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/main/part2/5-likelihood.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Likelihood</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/main/part2/6-bayes-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bayesian Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III - Interval Estimation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/main/part3/7-freq-interval-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Frequentist Interval Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/main/part3/8-bayes-interval-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Bayesian Intervals</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV — Hypothesis Testing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/main/part4/9-freq-hypothesis-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Frequentist Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/main/part4/10-bayes-hypothesis-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Bayesian Hypothesis Testing</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Additional Material</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/appendix/formula-sheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Formula Sheet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/appendix/revision-sheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Revision Sheet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/appendix/distribution-explorer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distribution Explorer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/appendix/question-bank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Question Bank</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../content/ide/python-ide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python IDE</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#likelihoods-under-independence-and-dependence" id="toc-likelihoods-under-independence-and-dependence" class="nav-link active" data-scroll-target="#likelihoods-under-independence-and-dependence"><span class="header-section-number">5.1</span> Likelihoods Under Independence and Dependence</a></li>
  <li><a href="#likelihood-function" id="toc-likelihood-function" class="nav-link" data-scroll-target="#likelihood-function"><span class="header-section-number">5.2</span> Likelihood Function</a>
  <ul class="collapse">
  <li><a href="#illustration-likelihood-with-a-coin" id="toc-illustration-likelihood-with-a-coin" class="nav-link" data-scroll-target="#illustration-likelihood-with-a-coin"><span class="header-section-number">5.2.1</span> Illustration (Likelihood with a coin)</a></li>
  <li><a href="#computing-likelihood-functions" id="toc-computing-likelihood-functions" class="nav-link" data-scroll-target="#computing-likelihood-functions"><span class="header-section-number">5.2.2</span> Computing Likelihood Functions</a></li>
  <li><a href="#sec-sufficiency" id="toc-sec-sufficiency" class="nav-link" data-scroll-target="#sec-sufficiency"><span class="header-section-number">5.2.3</span> Data Reduction and Sufficient Statistics</a></li>
  </ul></li>
  <li><a href="#maximum-likelihood-estimation" id="toc-maximum-likelihood-estimation" class="nav-link" data-scroll-target="#maximum-likelihood-estimation"><span class="header-section-number">5.3</span> Maximum Likelihood Estimation</a>
  <ul class="collapse">
  <li><a href="#computing-univariate-mles" id="toc-computing-univariate-mles" class="nav-link" data-scroll-target="#computing-univariate-mles"><span class="header-section-number">5.3.1</span> Computing Univariate MLEs</a></li>
  <li><a href="#computing-multivariate-mles" id="toc-computing-multivariate-mles" class="nav-link" data-scroll-target="#computing-multivariate-mles"><span class="header-section-number">5.3.2</span> Computing Multivariate MLEs</a></li>
  </ul></li>
  <li><a href="#information-and-efficiency-of-estimators" id="toc-information-and-efficiency-of-estimators" class="nav-link" data-scroll-target="#information-and-efficiency-of-estimators"><span class="header-section-number">5.4</span> Information and Efficiency of Estimators</a>
  <ul class="collapse">
  <li><a href="#score-and-fisher-information" id="toc-score-and-fisher-information" class="nav-link" data-scroll-target="#score-and-fisher-information"><span class="header-section-number">5.4.1</span> Score and Fisher Information</a></li>
  <li><a href="#cramérrao-lower-bound-and-efficiency" id="toc-cramérrao-lower-bound-and-efficiency" class="nav-link" data-scroll-target="#cramérrao-lower-bound-and-efficiency"><span class="header-section-number">5.4.2</span> Cramér–Rao Lower Bound and Efficiency</a></li>
  </ul></li>
  <li><a href="#the-asymptotic-distribution-of-the-mle" id="toc-the-asymptotic-distribution-of-the-mle" class="nav-link" data-scroll-target="#the-asymptotic-distribution-of-the-mle"><span class="header-section-number">5.5</span> The Asymptotic Distribution of the MLE</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../content/main/part2/4-freq-point-estimation.html">Part II — Point Estimation</a></li><li class="breadcrumb-item"><a href="../../../content/main/part2/5-likelihood.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Likelihood</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-likelihood" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Likelihood</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="10" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 9;"><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>gap <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>containerW <span class="op">=</span> width</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>plotW <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">240</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">600</span><span class="op">,</span> (containerW <span class="op">-</span> gap) <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">15</span>)))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>plotH <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(plotW <span class="op">*</span> <span class="fl">0.8</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>marginTop <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>marginRight <span class="op">=</span> <span class="dv">35</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>marginBottom <span class="op">=</span> <span class="dv">35</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>marginLeft <span class="op">=</span> <span class="dv">35</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>innerW <span class="op">=</span> plotW <span class="op">-</span> marginLeft <span class="op">-</span> marginRight</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>innerH <span class="op">=</span> plotH <span class="op">-</span> marginTop <span class="op">-</span> marginBottom</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>bodyFont <span class="op">=</span> <span class="fu">getComputedStyle</span>(<span class="bu">document</span><span class="op">.</span><span class="at">body</span>)<span class="op">.</span><span class="at">fontFamily</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-11" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<p>The <strong>likelihood</strong> is simply the <strong>joint density (or probability mass function)</strong> of the observed data:</p>
<p><span class="math display">
f(\underline{x} \mid \theta),
\quad \underline{x} = (x_1, \dots, x_n).
</span></p>
<p>It plays a central role in both <strong>frequentist</strong> and <strong>Bayesian</strong> statistics.</p>
<div id="imp-notation-freq-vs-bayes" class="callout callout-style-simple callout-important callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important&nbsp;5.1: Notation Convention
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p>When <strong>specifying the distribution of the data</strong> in the frequentist setting, we write</p>
<p><span class="math display">
X_i \sim \mathrm{Distribution}(\theta),
</span></p>
<p>to emphasise that <span class="math inline">\theta</span> is fixed (but unknown).</p></li>
<li><p>When writing <strong>densities</strong>, we will always use</p>
<p><span class="math display">
f(\underline{x}\mid\theta).
</span></p>
<ul>
<li>In the <strong>frequentist</strong> context: read this as <em>“the <strong><em>joint density</em></strong> of the data when the parameter takes the value <span class="math inline">\theta</span>.”</em></li>
<li>In the <strong>Bayesian</strong> context: it is literally the <strong>conditional density</strong> of the data given the <strong>random</strong> parameter <span class="math inline">\theta</span>.</li>
</ul></li>
<li><p>Later, in the <strong>Bayesian</strong> parts of the course, we will also use</p>
<p><span class="math display">
X_i \mid \theta \sim \mathrm{Distribution}(\theta),
</span></p>
<p>where the bar <span class="math inline">\mid \theta</span> reflects its probabilistic meaning: <em>conditioning on random parameters</em>.</p></li>
</ul>
</div>
</div>
</div>
<section id="likelihoods-under-independence-and-dependence" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="likelihoods-under-independence-and-dependence"><span class="header-section-number">5.1</span> Likelihoods Under Independence and Dependence</h2>
<p>The form of the likelihood depends crucially on whether our observations are independent and identically distributed (<span title="Independent and Identically Distributed">i.i.d.</span>), merely independent, or dependent. These three cases look similar but lead to different joint densities.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href=""><span title="Independent and Identically Distributed">i.i.d.</span> data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Independent (not identical) data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Dependent data</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><strong>This is the default case in most of this course.</strong></p>
<p>Suppose <span class="math inline">X_1, \ldots, X_n</span> are <strong>independent and identically distributed (<span title="Independent and Identically Distributed">i.i.d.</span>)</strong> random variables:</p>
<p><span class="math display">
X_i \overset{\text{i.i.d.}}{\sim} \mathrm{Distribution}(\theta),
\quad i = 1, \ldots, n.
</span></p>
<p>Each <span class="math inline">X_i</span> has density (or PMF)</p>
<p><span class="math display">
f(x \mid \theta).
</span></p>
<p>Then the <strong>joint density</strong> of the full sample is</p>
<p><span class="math display">
f(x_1, \ldots, x_n \mid \theta)
= \prod_{i=1}^n f(x_i \mid \theta).
</span></p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>If instead the samples are <strong>independent but not identically distributed</strong>:</p>
<p><span class="math display">
X_i \sim \mathrm{Distribution}_i(\theta),
</span></p>
<p>with individual densities <span class="math inline">f_{X_i}(x_i \mid \theta)</span>, then the joint density becomes</p>
<p><span class="math display">
f(x_1, \ldots, x_n \mid \theta)
= \prod_{i=1}^n f_{X_i}(x_i \mid \theta).
</span></p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>In many real-world situations, data are <strong>dependent</strong>.</p>
<p><strong>Example:</strong> Suppose our data are daily temperatures in Newcastle upon Tyne. Yesterday’s temperature will influence today’s temperature, and today’s temperature will influence tomorrow’s.</p>
<p>In such cases, we must model the dependencies explicitly. For instance,</p>
<p><span class="math display">
X_{t+1} \mid X_t = x_t  \sim \mathcal{N}(x_t, \sigma^2).
</span></p>
<p>The likelihood is still the <strong>joint distribution</strong>, but expressed as a product of <strong>conditional densities</strong>:</p>
<p><span class="math display">
f(x_1,\ldots,x_n \mid \sigma^2)
= \prod_{t=1}^n f(x_t \mid x_{t-1}, \sigma^2).
</span></p>
<p>The example above assumed a Markov property (each observation only depends on the previous one). In general, observations may depend on the entire history, in which case the joint density factorises via the <span class="xref-no-num"><a href="../part1/1-prob-theory.html#prp-chain-rule" class="quarto-xref">chain rule&nbsp;<span>1.2</span></a></span>: <span class="math display">
f(x_1,\ldots,x_n \mid \theta) = f(x_1\mid\theta)\prod_{t=2}^n f(x_t \mid x_1,\ldots,x_{t-1},\theta)
</span></p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Non-Examinable Content
</div>
</div>
<div class="callout-body-container callout-body">
<p>This course focuses only on the <strong>i.i.d.</strong> or <strong>independent</strong> case.</p>
<p>Dependent data will be covered in later modules and is <strong>not examinable</strong>.</p>
</div>
</div>
</div>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 48%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>Case</th>
<th>Assumption</th>
<th>Factorisation of Joint Density</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><span title="Independent and Identically Distributed">i.i.d.</span> data</strong></td>
<td>Independent and identically distributed; each with density <span class="math inline">f(x\mid\theta)</span></td>
<td><span class="math inline">f(\underline{x}\mid\theta) = \prod_{i=1}^n f(x_i\mid\theta)</span></td>
</tr>
<tr class="even">
<td><strong>Independent (not identical) data</strong></td>
<td>Independent; each <span class="math inline">X_i</span> may have its own density <span class="math inline">f_{X_i}(x_i\mid\theta)</span></td>
<td><span class="math inline">f(\underline{x}\mid\theta) = \prod_{i=1}^n f_{X_i}(x_i\mid\theta)</span></td>
</tr>
<tr class="odd">
<td><strong>Dependent data (general)</strong></td>
<td>Dependent; factorise using the <span class="xref-no-num"><a href="../part1/1-prob-theory.html#prp-chain-rule" class="quarto-xref">chain rule&nbsp;<span>1.2</span></a></span></td>
<td><span class="math inline">f(\underline{x}\mid\theta) = f(x_1\mid\theta)\prod_{t=2}^n f(x_t \mid x_1,\ldots,x_{t-1},\theta)</span></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Reminder: Non-Examinable Content
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>dependent case</strong> in the above table is shown for completeness.</p>
<p>This course focuses only on the <strong>i.i.d.</strong> or <strong>independent</strong> case, and the dependent case is <strong>not examinable</strong>.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Remark (Why products?)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="rem-products" class="proof remark">
<p><span class="proof-title"><em>Remark 5.1</em> (Why products?). </span></p>
<ul>
<li>Independence means joint probabilities factorise: <span class="math display">
\mathrm{Pr}(A \cap B) = \mathrm{Pr}(A) \mathrm{Pr}(B).
</span></li>
<li>By the same <span class="xref-no-num"><a href="../part1/1-prob-theory.html#def-independence-rv" class="quarto-xref">rule&nbsp;<span>1.8</span></a></span>, the joint density of independent random variables is the product of their individual densities.</li>
<li>This is a common <strong>misconception</strong>: without independence, you <strong>cannot</strong> just multiply.</li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="likelihood-function" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="likelihood-function"><span class="header-section-number">5.2</span> Likelihood Function</h2>
<p>So far we have described the likelihood informally as “the joint density of the data given the parameter.”</p>
<p>We now give a <strong>formal definition</strong> of the <em>likelihood function</em> and introduce the notation we will use in the <strong>frequentist parts</strong> of the course.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-likelihood" class="definition theorem">
<p><span class="theorem-title"><strong>Definition 5.1</strong></span> <strong>Likelihood Function.</strong> For fixed observed data <span class="math inline">\underline{x}</span>, the <strong>likelihood function</strong> is defined as</p>
<p><span class="math display">
L(\theta ; \underline{x}) \coloneqq f(\,\underline{x} \mid \theta).
</span></p>
<p>Here we treat <span class="math inline">\theta</span> as the <strong>variable</strong>, and the data <span class="math inline">\underline{x}</span> as fixed.</p>
</div>
</div>
</div>
</div>
<section id="illustration-likelihood-with-a-coin" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="illustration-likelihood-with-a-coin"><span class="header-section-number">5.2.1</span> Illustration (Likelihood with a coin)</h3>
<p>Suppose we toss a possibly biased coin twice, where</p>
<p><span class="math display">
\Pr(\text{Head})=\theta,
\qquad
\Pr(\text{Tail})=1-\theta.
</span></p>
<p>Let <span class="math inline">X</span> be the number of heads in two tosses. Then, since this is a <span class="xref-no-num"><a href="../../appendix/formula-sheet.html#sec-binom" class="quarto-xref">Binomial&nbsp;<span>1.2</span></a></span> observation:</p>
<p><span class="math display">
f(x\mid\theta)=\Pr(X=x\mid\theta)
=\binom{2}{x}\theta^x(1-\theta)^{2-x},
\qquad x=0,1,2.
</span></p>
<p>There are <em>two</em> interpretations of this:</p>
<ol type="1">
<li><p><strong>Probability view (before observing data).</strong><br>
For fixed <span class="math inline">\theta</span>, this is a <em>probability mass function</em> (PMF) in <span class="math inline">x</span>. It satisfies <span class="math display">
  f(x=0 \mid \theta) + f(x=1 \mid \theta) + f(x = 2 \mid \theta) = 1.
  </span> It tells us how likely different data values <span class="math inline">x</span> are under parameter <span class="math inline">\theta</span>.</p></li>
<li><p><strong>Likelihood view (after observing data).</strong><br>
Now suppose we observe <span class="math inline">x=2</span>. Now, since <span class="math inline">x=2</span> is fixed, the same formula becomes <span class="math display">
  L(\theta; x=2) = f(2\mid\theta) = \theta^2.
  </span> This function tells us how plausible different values of <span class="math inline">\theta</span> are, given the observed data.</p></li>
</ol>
<hr>
<details>
<summary><strong>Show Visualisation</strong></summary>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="236" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 235;"><span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a><span class="co">// Add custom CSS for the slider styling (without the details.controls-root requirement)</span></span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;style&gt;</span></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a><span class="vs">/* Style all range sliders in the document */</span></span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a><span class="vs">input[type="range"] {</span></span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Reset browser defaults */</span></span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a><span class="vs">  -webkit-appearance: none;</span></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a><span class="vs">  appearance: none;</span></span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Layout */</span></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a><span class="vs">  width: 100%;</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a><span class="vs">  height: 18px;</span></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: transparent;</span></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a><span class="vs">  vertical-align: middle;</span></span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Brand theming */</span></span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a><span class="vs">  accent-color: var(--ctrl-brand);</span></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a><span class="vs">/* Hide the number input box that appears with Inputs.range */</span></span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a><span class="vs">form:has(input[type="range"]) input[type="number"] {</span></span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a><span class="vs">  display: none !important;</span></span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a><span class="vs">/* Center the slider container */</span></span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a><span class="vs">form:has(input[type="range"]) {</span></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a><span class="vs">  margin: 0 auto;</span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a><span class="vs">  max-width: 600px; /* Adjust as needed */</span></span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 10px 0;</span></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a><span class="vs">/* Slider track - WebKit */</span></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a><span class="vs">input[type="range"]::-webkit-slider-runnable-track {</span></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a><span class="vs">  height: 4px;</span></span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 999px;</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: color-mix(in srgb, var(--ctrl-brand, #667eea) 35%, transparent);</span></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a><span class="vs">/* Slider thumb - WebKit */</span></span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a><span class="vs">input[type="range"]::-webkit-slider-thumb {</span></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a><span class="vs">  -webkit-appearance: none;</span></span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a><span class="vs">  appearance: none;</span></span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a><span class="vs">  width: 12px;</span></span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a><span class="vs">  height: 12px;</span></span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 50%;</span></span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a><span class="vs">  border: 0;</span></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: var(--ctrl-brand, #667eea);</span></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Center thumb over 4px track */</span></span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a><span class="vs">  margin-top: -4px;</span></span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a><span class="vs">/* Slider track - Firefox */</span></span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a><span class="vs">input[type="range"]::-moz-range-track {</span></span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a><span class="vs">  height: 4px;</span></span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 999px;</span></span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: color-mix(in srgb, var(--ctrl-brand, #667eea) 35%, transparent);</span></span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a><span class="vs">/* Slider thumb - Firefox */</span></span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a><span class="vs">input[type="range"]::-moz-range-thumb {</span></span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a><span class="vs">  width: 12px;</span></span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a><span class="vs">  height: 12px;</span></span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 50%;</span></span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a><span class="vs">  border: 0;</span></span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: var(--ctrl-brand, #667eea);</span></span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a><span class="vs">/* Firefox progress styling */</span></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a><span class="vs">input[type="range"]::-moz-range-progress {</span></span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a><span class="vs">  height: 4px;</span></span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 999px;</span></span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: color-mix(in srgb, var(--ctrl-brand, #667eea) 35%, transparent);</span></span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/style&gt;`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="314" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 313;"><span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a><span class="co">// Text readout: Pr(X = 2 | θ) = θ^2</span></span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a>probabilityText <span class="op">=</span> {</span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> fmt <span class="op">=</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".3f"</span>)<span class="op">;</span></span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> val <span class="op">=</span> theta <span class="op">**</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\P</span><span class="vs">r(X=2 </span><span class="sc">\m</span><span class="vs">id </span><span class="sc">\t</span><span class="vs">heta=</span><span class="sc">${</span><span class="fu">fmt</span>(theta)<span class="sc">}</span><span class="vs">) = </span><span class="sc">${</span><span class="fu">fmt</span>(val)<span class="sc">}</span><span class="vs">`</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="323" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 322;"><span id="cb4-323"><a href="#cb4-323" aria-hidden="true" tabindex="-1"></a><span class="co">// Probability view: PMF of X ~ Binomial(n=2, θ)</span></span>
<span id="cb4-324"><a href="#cb4-324" aria-hidden="true" tabindex="-1"></a>pmfPlot <span class="op">=</span> {</span>
<span id="cb4-325"><a href="#cb4-325" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Data: x ∈ {0,1,2}, P(X=x | θ) = C(2,x) θ^x (1-θ)^{2-x}</span></span>
<span id="cb4-326"><a href="#cb4-326" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pmf <span class="op">=</span> [</span>
<span id="cb4-327"><a href="#cb4-327" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">x</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> (<span class="dv">1</span> <span class="op">-</span> theta) <span class="op">**</span> <span class="dv">2</span>}<span class="op">,</span></span>
<span id="cb4-328"><a href="#cb4-328" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">x</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="dv">2</span> <span class="op">*</span> theta <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> theta)}<span class="op">,</span></span>
<span id="cb4-329"><a href="#cb4-329" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">x</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> theta <span class="op">**</span> <span class="dv">2</span>}</span>
<span id="cb4-330"><a href="#cb4-330" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb4-331"><a href="#cb4-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-332"><a href="#cb4-332" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb4-333"><a href="#cb4-333" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> dynamicPlotW<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> plotH<span class="op">,</span></span>
<span id="cb4-334"><a href="#cb4-334" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> marginLeft<span class="op">,</span></span>
<span id="cb4-335"><a href="#cb4-335" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginBottom</span><span class="op">:</span> marginBottom<span class="op">,</span></span>
<span id="cb4-336"><a href="#cb4-336" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb4-337"><a href="#cb4-337" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontFamily</span><span class="op">:</span> bodyFont<span class="op">,</span> </span>
<span id="cb4-338"><a href="#cb4-338" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> <span class="fl">14.</span><span class="op">,</span></span>
<span id="cb4-339"><a href="#cb4-339" aria-hidden="true" tabindex="-1"></a>        <span class="dt">background</span><span class="op">:</span> <span class="st">"var(--brand-bg)"</span><span class="op">,</span></span>
<span id="cb4-340"><a href="#cb4-340" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> </span>
<span id="cb4-341"><a href="#cb4-341" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb4-342"><a href="#cb4-342" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"x (number of heads)"</span><span class="op">,</span> </span>
<span id="cb4-343"><a href="#cb4-343" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="fl">0.5</span><span class="op">,</span> <span class="fl">2.5</span>]<span class="op">,</span> </span>
<span id="cb4-344"><a href="#cb4-344" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span></span>
<span id="cb4-345"><a href="#cb4-345" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)</span>
<span id="cb4-346"><a href="#cb4-346" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb4-347"><a href="#cb4-347" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb4-348"><a href="#cb4-348" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Probability"</span><span class="op">,</span> </span>
<span id="cb4-349"><a href="#cb4-349" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb4-350"><a href="#cb4-350" aria-hidden="true" tabindex="-1"></a>      <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb4-351"><a href="#cb4-351" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb4-352"><a href="#cb4-352" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb4-353"><a href="#cb4-353" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>])<span class="op">,</span></span>
<span id="cb4-354"><a href="#cb4-354" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">rectY</span>(pmf<span class="op">,</span> {</span>
<span id="cb4-355"><a href="#cb4-355" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> </span>
<span id="cb4-356"><a href="#cb4-356" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"p"</span><span class="op">,</span> </span>
<span id="cb4-357"><a href="#cb4-357" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span> <span class="op">-</span> <span class="fl">0.4</span><span class="op">,</span></span>
<span id="cb4-358"><a href="#cb4-358" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> <span class="fl">0.4</span><span class="op">,</span></span>
<span id="cb4-359"><a href="#cb4-359" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"var(--brand-teal)"</span><span class="op">,</span></span>
<span id="cb4-360"><a href="#cb4-360" aria-hidden="true" tabindex="-1"></a>        <span class="dt">inset</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb4-361"><a href="#cb4-361" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb4-362"><a href="#cb4-362" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">dot</span>(pmf<span class="op">,</span> {</span>
<span id="cb4-363"><a href="#cb4-363" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> </span>
<span id="cb4-364"><a href="#cb4-364" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"p"</span><span class="op">,</span> </span>
<span id="cb4-365"><a href="#cb4-365" aria-hidden="true" tabindex="-1"></a>        <span class="dt">r</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> </span>
<span id="cb4-366"><a href="#cb4-366" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"var(--fg-muted)"</span><span class="op">,</span></span>
<span id="cb4-367"><a href="#cb4-367" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.</span></span>
<span id="cb4-368"><a href="#cb4-368" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb4-369"><a href="#cb4-369" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>(pmf<span class="op">,</span> {</span>
<span id="cb4-370"><a href="#cb4-370" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb4-371"><a href="#cb4-371" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"p"</span><span class="op">,</span></span>
<span id="cb4-372"><a href="#cb4-372" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".3f"</span>)(d<span class="op">.</span><span class="at">p</span>)<span class="op">,</span></span>
<span id="cb4-373"><a href="#cb4-373" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb4-374"><a href="#cb4-374" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">11</span></span>
<span id="cb4-375"><a href="#cb4-375" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb4-376"><a href="#cb4-376" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb4-377"><a href="#cb4-377" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb4-378"><a href="#cb4-378" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="382" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 381;"><span id="cb5-382"><a href="#cb5-382" aria-hidden="true" tabindex="-1"></a><span class="co">// Likelihood view: L(θ; x=2) = θ^2 for θ ∈ [0,1]</span></span>
<span id="cb5-383"><a href="#cb5-383" aria-hidden="true" tabindex="-1"></a>likelihoodPlot <span class="op">=</span> {</span>
<span id="cb5-384"><a href="#cb5-384" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Curve samples</span></span>
<span id="cb5-385"><a href="#cb5-385" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> T <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">1.001</span><span class="op">,</span> <span class="fl">0.005</span>)<span class="op">.</span><span class="fu">map</span>(t <span class="kw">=&gt;</span> ({<span class="dt">theta</span><span class="op">:</span> t<span class="op">,</span> <span class="dt">L</span><span class="op">:</span> t <span class="op">**</span> <span class="dv">2</span>}))<span class="op">;</span></span>
<span id="cb5-386"><a href="#cb5-386" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> point <span class="op">=</span> {<span class="dt">theta</span><span class="op">:</span> theta<span class="op">,</span> <span class="dt">L</span><span class="op">:</span> theta <span class="op">**</span> <span class="dv">2</span>}<span class="op">;</span></span>
<span id="cb5-387"><a href="#cb5-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-388"><a href="#cb5-388" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb5-389"><a href="#cb5-389" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> dynamicPlotW<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> plotH<span class="op">,</span></span>
<span id="cb5-390"><a href="#cb5-390" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> marginLeft<span class="op">,</span></span>
<span id="cb5-391"><a href="#cb5-391" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginBottom</span><span class="op">:</span> marginBottom<span class="op">,</span></span>
<span id="cb5-392"><a href="#cb5-392" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb5-393"><a href="#cb5-393" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontFamily</span><span class="op">:</span> bodyFont<span class="op">,</span> </span>
<span id="cb5-394"><a href="#cb5-394" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> <span class="fl">14.</span><span class="op">,</span></span>
<span id="cb5-395"><a href="#cb5-395" aria-hidden="true" tabindex="-1"></a>        <span class="dt">background</span><span class="op">:</span> <span class="st">"var(--brand-bg)"</span><span class="op">,</span></span>
<span id="cb5-396"><a href="#cb5-396" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> </span>
<span id="cb5-397"><a href="#cb5-397" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb5-398"><a href="#cb5-398" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"θ"</span><span class="op">,</span> </span>
<span id="cb5-399"><a href="#cb5-399" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb5-400"><a href="#cb5-400" aria-hidden="true" tabindex="-1"></a>      <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb5-401"><a href="#cb5-401" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb5-402"><a href="#cb5-402" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb5-403"><a href="#cb5-403" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Likelihood"</span><span class="op">,</span> </span>
<span id="cb5-404"><a href="#cb5-404" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb5-405"><a href="#cb5-405" aria-hidden="true" tabindex="-1"></a>      <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb5-406"><a href="#cb5-406" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb5-407"><a href="#cb5-407" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb5-408"><a href="#cb5-408" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">line</span>(T<span class="op">,</span> {</span>
<span id="cb5-409"><a href="#cb5-409" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"theta"</span><span class="op">,</span> </span>
<span id="cb5-410"><a href="#cb5-410" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"L"</span><span class="op">,</span></span>
<span id="cb5-411"><a href="#cb5-411" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"var(--brand-red)"</span><span class="op">,</span></span>
<span id="cb5-412"><a href="#cb5-412" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span></span>
<span id="cb5-413"><a href="#cb5-413" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb5-414"><a href="#cb5-414" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>])<span class="op">,</span></span>
<span id="cb5-415"><a href="#cb5-415" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleX</span>([theta]<span class="op">,</span> {</span>
<span id="cb5-416"><a href="#cb5-416" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"var(--fg-muted)"</span><span class="op">,</span></span>
<span id="cb5-417"><a href="#cb5-417" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="st">"4 2"</span></span>
<span id="cb5-418"><a href="#cb5-418" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb5-419"><a href="#cb5-419" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">dot</span>([point]<span class="op">,</span> {</span>
<span id="cb5-420"><a href="#cb5-420" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"theta"</span><span class="op">,</span> </span>
<span id="cb5-421"><a href="#cb5-421" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"L"</span><span class="op">,</span></span>
<span id="cb5-422"><a href="#cb5-422" aria-hidden="true" tabindex="-1"></a>        <span class="dt">r</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb5-423"><a href="#cb5-423" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"var(--brand-red)"</span></span>
<span id="cb5-424"><a href="#cb5-424" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb5-425"><a href="#cb5-425" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">text</span>([point]<span class="op">,</span> {</span>
<span id="cb5-426"><a href="#cb5-426" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"theta"</span><span class="op">,</span></span>
<span id="cb5-427"><a href="#cb5-427" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> <span class="st">"L"</span><span class="op">,</span></span>
<span id="cb5-428"><a href="#cb5-428" aria-hidden="true" tabindex="-1"></a>        <span class="dt">text</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="vs">`(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".2f"</span>)(d<span class="op">.</span><span class="at">theta</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".3f"</span>)(d<span class="op">.</span><span class="at">L</span>)<span class="sc">}</span><span class="vs">)`</span><span class="op">,</span></span>
<span id="cb5-429"><a href="#cb5-429" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb5-430"><a href="#cb5-430" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">11</span><span class="op">,</span></span>
<span id="cb5-431"><a href="#cb5-431" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="st">"var(--brand-fg)"</span></span>
<span id="cb5-432"><a href="#cb5-432" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb5-433"><a href="#cb5-433" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb5-434"><a href="#cb5-434" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-435"><a href="#cb5-435" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="439" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 438;"><span id="cb6-439"><a href="#cb6-439" aria-hidden="true" tabindex="-1"></a>dynamicPlotW <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">400</span><span class="op">,</span> width <span class="op">*</span> <span class="fl">0.45</span>)  <span class="co">// Each plot takes ~45% of available width</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="444" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 443;"><span id="cb7-444"><a href="#cb7-444" aria-hidden="true" tabindex="-1"></a><span class="co">// Combined side-by-side view - responsive, with titles</span></span>
<span id="cb7-445"><a href="#cb7-445" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div style="width:100%; box-sizing:border-box;"&gt;</span></span>
<span id="cb7-446"><a href="#cb7-446" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;div style="display:flex; gap:</span><span class="sc">${</span>gap<span class="sc">}</span><span class="vs">px; align-items:flex-start; flex-wrap:wrap; justify-content:center;"&gt;</span></span>
<span id="cb7-447"><a href="#cb7-447" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb7-448"><a href="#cb7-448" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="flex:0 1 </span><span class="sc">${</span>dynamicPlotW<span class="sc">}</span><span class="vs">px; min-width:300px; text-align:center;"&gt;</span></span>
<span id="cb7-449"><a href="#cb7-449" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="margin-bottom:6px; font-weight:600; font-size:15px;"&gt;Binomial PMF&lt;/div&gt;</span></span>
<span id="cb7-450"><a href="#cb7-450" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span>pmfPlot<span class="sc">}</span></span>
<span id="cb7-451"><a href="#cb7-451" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb7-452"><a href="#cb7-452" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb7-453"><a href="#cb7-453" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="flex:0 1 </span><span class="sc">${</span>dynamicPlotW<span class="sc">}</span><span class="vs">px; min-width:300px; text-align:center;"&gt;</span></span>
<span id="cb7-454"><a href="#cb7-454" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style="margin-bottom:6px; font-weight:600; font-size:15px;"&gt;Likelihood Function&lt;/div&gt;</span></span>
<span id="cb7-455"><a href="#cb7-455" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span>likelihoodPlot<span class="sc">}</span></span>
<span id="cb7-456"><a href="#cb7-456" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb7-457"><a href="#cb7-457" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb7-458"><a href="#cb7-458" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/div&gt;</span></span>
<span id="cb7-459"><a href="#cb7-459" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;div style="margin-top:15px; text-align:center; font-size:14px;"&gt;</span></span>
<span id="cb7-460"><a href="#cb7-460" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>probabilityText<span class="sc">}</span></span>
<span id="cb7-461"><a href="#cb7-461" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/div&gt;</span></span>
<span id="cb7-462"><a href="#cb7-462" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/div&gt;`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="467" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 466;"><span id="cb8-467"><a href="#cb8-467" aria-hidden="true" tabindex="-1"></a><span class="co">// Simple slider with tex label, no input box</span></span>
<span id="cb8-468"><a href="#cb8-468" aria-hidden="true" tabindex="-1"></a>viewof theta <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb8-469"><a href="#cb8-469" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb8-470"><a href="#cb8-470" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span></span>
<span id="cb8-471"><a href="#cb8-471" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
</details>
<hr>
<p><strong>Interpretation</strong></p>
<p>Consider two <strong>competing</strong> values of <span class="math inline">\theta</span> for observing <span class="math inline">x=2</span> heads in <span class="math inline">n=2</span> tosses:</p>
<ol type="1">
<li><p>If <strong><span class="math inline">\theta=0.01</span></strong>, the probability of observing <span class="math inline">X=2</span> is <span class="math display">
  L(0.01;2)=0.0001.
  </span> For such a coin, two heads would be highly unusual.</p></li>
<li><p>If <strong><span class="math inline">\theta=0.99</span></strong>, the probability of observing <span class="math inline">X=2</span> is <span class="math display">
  L(0.99;2)=0.9801 \approx 0.98.
  </span> For such a coin, observing <span class="math inline">X=2</span> is exactly what we’d expect.</p></li>
</ol>
<p>Given <span class="math inline">x=2</span>, values of <span class="math inline">\theta</span> close to <span class="math inline">1</span> are much more plausible than values near <span class="math inline">0</span>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Remark (Likelihood vs.&nbsp;Probability)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="rem-lik-vs-prob" class="proof remark">
<p><span class="proof-title"><em>Remark 5.2</em> (Likelihood vs.&nbsp;Probability). </span>It is important to distinguish between the <strong>joint density</strong> of the data and the <strong>likelihood function</strong>:</p>
<ul>
<li><p><strong>Joint density (PDF/PMF).</strong> <span class="math inline">f(\underline{x}\mid \theta)</span> is viewed as a function of the <em>data</em> <span class="math inline">\underline{x}</span>, with the parameter <span class="math inline">\theta</span> fixed. This describes the probability distribution of the sample under <span class="math inline">\theta</span>.</p></li>
<li><p><strong>Likelihood function.</strong> The same expression, written as</p>
<p><span class="math display">
L(\theta;\underline{x}) = f(\underline{x}\mid\theta),
</span></p>
<p>is instead viewed as a function of the <em>parameter</em> <span class="math inline">\theta</span>, with the observed data <span class="math inline">\underline{x}</span> held fixed. This is the function we use to make inferences about <span class="math inline">\theta</span>.</p></li>
</ul>
<hr>
<p>In short:</p>
<ul>
<li><strong>Joint density</strong>: given <span class="math inline">\theta</span>, how <em>likely</em> are different data values <span class="math inline">\underline{x}</span>?</li>
<li><strong>Likelihood</strong>: given observed <span class="math inline">\underline{x}</span>, how <em>plausible</em> are different values of <span class="math inline">\theta</span>?</li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="computing-likelihood-functions" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="computing-likelihood-functions"><span class="header-section-number">5.2.2</span> Computing Likelihood Functions</h3>
<p>This is a <strong>very important skill</strong> in the course: you will use it often in the <em>frequentist</em> parts, and it is <strong>essential</strong> for the <em>Bayesian</em> part.</p>
<hr>
<details>
<summary><strong>Guide to Computing Likelihood Functions</strong></summary>
<p>The general strategy is:</p>
<ol type="1">
<li><p><strong>Check the model carefully.</strong> Look for:</p>
<ul>
<li>Are the data <strong><span title="Independent and Identically Distributed">i.i.d.</span></strong> or just <strong>independent</strong>?</li>
<li>How many <strong>data points</strong> are observed?</li>
<li>What notation is used for the data (<span class="math inline">X_i</span>, <span class="math inline">Y_i</span>, <span class="math inline">Z_i</span>, …)?</li>
<li>What notation is used for the parameters (<span class="math inline">\mu</span>, <span class="math inline">\alpha</span>, <span class="math inline">\gamma</span>, <span class="math inline">\theta</span>, …)?</li>
</ul>
<p><em>(In the examples below we assume <span class="math inline">n</span> independent data points <span class="math inline">X_1,\dots,X_n</span> with parameter <span class="math inline">\theta</span>. If there is only one data point, the likelihood is just its PDF/PMF.)</em></p></li>
<li><p><strong>Write down the PDF/PMF of one observation.</strong></p>
<p><span class="math display">
f_{X_i}(x_i \mid \theta)
</span></p></li>
<li><p><strong>Multiply to form the joint density</strong>, i.e.&nbsp;the likelihood:</p>
<p><span class="math display">
L(\theta ; \underline{x})
= f(\underline{x} \mid \theta)
= \prod_{i=1}^n f_{X_i}(x_i \mid \theta).
</span></p></li>
</ol>
<section id="common-mistakes" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="common-mistakes">Common Mistakes</h4>
<p>It is <strong>very easy</strong> to slip up when multiplying terms. Watch out for:</p>
<ol type="1">
<li><p><strong>Forgetting the index.</strong> Always use <span class="math inline">x_i</span> inside the product.</p>
<p>Example (Exponential model): If <span class="math inline">X_i \sim \mathrm{Exponential}(\theta)</span> with density</p>
<p><span class="math display">
f(x_i \mid \theta) = \theta e^{-\theta x_i}, \quad x_i &gt; 0,
</span></p>
<p>then the likelihood is</p>
<p><span class="math display">
f(\underline{x} \mid \theta)
= \prod_{i=1}^n \theta e^{-\theta x_i}
= \theta^n \exp\!\left(-\theta \sum_{i=1}^n x_i\right).
</span></p>
<p>A common mistake is to write</p>
<p><span class="math display">
\prod_{i=1}^n \theta e^{-\theta x} = \theta^n e^{-\theta n x} \quad \text{(wrong!)}
</span></p>
<p>which ignores the index on <span class="math inline">x_i</span>.</p></li>
<li><p><strong>Oversimplifying.</strong> Many likelihoods look messy — that is normal!</p>
<p>Example (Gamma model): If <span class="math inline">X_i \sim \mathrm{Gamma}(\alpha, \theta)</span> with density</p>
<p><span class="math display">
f(x_i \mid \alpha, \theta)
= \frac{1}{\Gamma(\alpha)\theta^\alpha}\, x_i^{\alpha - 1} e^{-x_i/\theta},
\quad x_i &gt; 0,
</span></p>
<p>then the likelihood is</p>
<p><span class="math display">
f(\underline{x} \mid \alpha, \theta)
= \left(\frac{1}{\Gamma(\alpha)\theta^\alpha}\right)^n
  \left(\prod_{i=1}^n x_i^{\alpha - 1}\right)
  \exp\!\left(-\frac{1}{\theta}\sum_{i=1}^n x_i\right).
</span></p>
<p>Notice how the product</p>
<p><span class="math display">
\prod_{i=1}^n x_i^{\alpha - 1}
</span></p>
<p>cannot be simplified further (unless you introduce the geometric mean<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>).</p></li>
</ol>
</section>
<section id="a-safe-strategy" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="a-safe-strategy">A Safe Strategy</h4>
<p>When starting out, it is helpful to <strong>expand the product term by term</strong>:</p>
<p><span class="math display">
f(\underline{x} \mid \theta)
= f(x_1 \mid \theta)
\times f(x_2 \mid \theta)
\times \cdots
\times f(x_n \mid \theta).
</span></p>
<p>Then simplify step by step.</p>
<p>This is slower, but it reduces errors. With practice, you’ll be able to simplify likelihoods much more quickly.</p>
</section></details>
<hr>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-bern-likelihood" class="example theorem">
<p><span class="theorem-title"><strong>Example 5.1 (Bernoulli Likelihood)</strong></span> Suppose we have <span class="math inline">n</span> <span title="Independent and Identically Distributed">i.i.d.</span> data distributed according to the <span class="xref-no-num"><a href="../../appendix/formula-sheet.html#sec-bern" class="quarto-xref">Bernoulli distribution&nbsp;<span>1.1</span></a></span>:</p>
<p><span class="math display">
  Y_i \sim \textrm{Bernoulli}(p).
</span> Derive the <strong>likelihood function</strong>.</p>
<details>
  <summary><strong> Solution </strong></summary>
<p>Because the <span class="math inline">Y_i</span> are <span title="Independent and Identically Distributed">i.i.d.</span>, the joint PMF factorises:</p>
<p><span class="math display">
L(p;\underline{y}) = f(\underline{y}\mid p) = \prod_{i=1}^n f(y_i \mid p).
</span></p>
<p>For the Bernoulli distribution,</p>
<p><span class="math display">
f(y_i \mid p) = p^{y_i}(1-p)^{1-y_i}.
</span></p>
<p>Hence,</p>
<p><span class="math display">\begin{align*}
L(p; \underline{y}) &amp;= \prod_{i=1}^n p^{y_i}(1 - p)^{1-y_i} \\
&amp;= p^{y_1} (1-p)^{1-y_1} \times p^{y_2} (1-p)^{1-y_2} \times \ldots \times p^{y_n} (1-p)^{1-y_n} \\
&amp;= p^{y_1 + \ldots + y_n} (1 - p)^{(1-y_1) + \ldots + (1-y_n)} \\
&amp;= p^{\sum_{i=1}^n y_i} (1-p)^{\sum_{i=1}^n 1 - y_i}.
\end{align*}</span></p>
<p>Writing <span class="math inline">\sum_{i=1}^n y_i = n\bar{y}</span> gives</p>
<p><span class="math display">
L(p;\underline{y}) = p^{n\bar{y}}(1-p)^{n(1-\bar{y})}.
</span></p>
</details>
</div>
</div>
</div>
</div>
<p>In practice, and in <strong>assessed questions</strong> in this course, it is important to be comfortable with computing likelihood functions for actual observed data. The next example does this:</p>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-bern-likelihood-data" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.2 (Bernoulli Likelihood with Data)</strong></span> Suppose <span class="math inline">n=5</span> <span title="Independent and Identically Distributed">i.i.d.</span> observations <span class="math inline">X_i \sim \mathrm{Bernoulli}(p)</span> are observed as <span class="math display">
\underline{x} = (1,0,1,1,0).
</span> Derive the <strong>likelihood function</strong> and evaluate it for a few values of <span class="math inline">p</span>.</p>
<details>
  <summary><strong> Solution </strong></summary>
<p>Since <span class="math inline">\underline{x}  = (1,0,1,1,0)</span>, we have <span class="math inline">\sum_i x_i = 3</span>. Therefore: <span class="math display">
L(p ; \underline{x}) = p^3 (1-p)^2.
</span></p>
<ul>
<li>If <span class="math inline">p=0.5</span>, <span class="math inline">L(0.5) = 0.5^3 \cdot 0.5^2 = 0.03125</span>.</li>
<li>If <span class="math inline">p=0.7</span>, <span class="math inline">L(0.7) = 0.7^3 \cdot 0.3^2 \approx 0.0309</span>.</li>
<li>If <span class="math inline">p=0.8</span>, <span class="math inline">L(0.8) = 0.8^3 \cdot 0.2^2 = 0.0205</span>.</li>
</ul>
<p>So the data are slightly more likely under <span class="math inline">p=0.5</span> than <span class="math inline">p=0.8</span>.</p>
</details>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-normal-likelihood" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.3 (Normal Likelihood)</strong></span> Suppose we have <span class="math inline">n</span> <span title="Independent and Identically Distributed">i.i.d.</span> data distributed according to the <span class="xref-no-num"><a href="../../appendix/formula-sheet.html#sec-normal" class="quarto-xref">Normal distribution&nbsp;<span>2.5</span></a></span>:</p>
<p><span class="math display">
  T_i \sim \mathcal{N}(\mu, \gamma).
</span></p>
<p>Derive the <strong>likelihood function</strong>.</p>
<details>
  <summary><strong> Solution </strong></summary>
<p>Because the <span class="math inline">T_i</span> are <span title="Independent and Identically Distributed">i.i.d.</span>, the joint PDF factorises:</p>
<p><span class="math display">
L(\mu, \gamma ;\underline{t}) = f(\underline{t}\mid \mu, \gamma) = \prod_{i=1}^n f(t_i \mid \mu, \gamma).
</span></p>
<p>For the Normal distribution (with variance <span class="math inline">\gamma = \sigma^2</span>),</p>
<p><span class="math display">
f(t_i \mid \mu, \gamma) = \frac{1}{\sqrt{2\pi \gamma}} \exp\left\{ -\frac{1}{2\gamma} (t_i - \mu)^2 \right\}.
</span></p>
<p>Hence,</p>
<p><span class="math display">\begin{align*}
L(\mu, \gamma ;\underline{t}) &amp;= \prod_{i=1}^n \frac{1}{\sqrt{2\pi \gamma}} \exp\left\{ -\frac{1}{2\gamma} (t_i - \mu)^2 \right\} \\
&amp;= (2\pi \gamma)^{-\tfrac{n}{2}} \exp\left\{ \sum_{i=1}^n -\frac{1}{2\gamma} (t_i - \mu)^2 \right\}.
\end{align*}</span></p>
<p>Therefore,</p>
<p><span class="math display">
L(\mu, \gamma ;\underline{t}) = (2\pi \gamma)^{-\tfrac{n}{2}} \exp\left\{ -\frac{1}{2\gamma} \sum_{i=1}^n  (t_i - \mu)^2 \right\}.
</span></p>
</details>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-poisson-likelihood" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.4 (Poisson Likelihood)</strong></span> Suppose we have <span class="math inline">n</span> <span title="Independent and Identically Distributed">i.i.d.</span> data distributed according to the <span class="xref-no-num"><a href="../../appendix/formula-sheet.html#sec-pois" class="quarto-xref">Poisson distribution&nbsp;<span>1.4</span></a></span>:</p>
<p><span class="math display">
  V_i \sim \mathrm{Poisson}(\alpha)
</span></p>
<p>Derive the <strong>likelihood function</strong>.</p>
<details>
  <summary><strong> Solution </strong></summary>
<p>Because the <span class="math inline">V_i</span> are <span title="Independent and Identically Distributed">i.i.d.</span>, the joint PMF factorises:</p>
<p><span class="math display">
L(\alpha ;\underline{v}) = f(\underline{v}\mid \alpha) = \prod_{i=1}^n f(v_i \mid \alpha).
</span></p>
<p>For the Poisson distribution</p>
<p><span class="math display">
f(v_i \mid \alpha) = \frac{\alpha^{v_i} e^{-\alpha}}{v_i!}
</span></p>
<p>Hence,</p>
<p><span class="math display">\begin{align*}
L(\alpha ;\underline{v}) &amp;= \prod_{i=1}^n  \frac{\alpha^{v_i} e^{-\alpha}}{v_i!} \\
&amp;= \alpha^{n\bar{v}} e^{-n\alpha} \prod_{i=1}^n \frac{1}{v_i!}
\end{align*}</span></p>
<p>Therefore,</p>
<p><span class="math display">
L(\alpha ;\underline{v}) = \alpha^{n\bar{v}} e^{-n\alpha} \prod_{i=1}^n \frac{1}{v_i!}.
</span></p>
</details>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sec-sufficiency" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="sec-sufficiency"><span class="header-section-number">5.2.3</span> Data Reduction and Sufficient Statistics</h3>
<p>When we write down a likelihood, the parameter often only depended on the sample through a few summaries (e.g.&nbsp;a sum or a mean).</p>
<p><strong>Sufficiency</strong> formalises when such a summary contains <em>all the information in the sample about</em> the parameter <span class="math inline">\theta</span>.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-sufficient" class="definition theorem">
<p><span class="theorem-title"><strong>Definition 5.2 (Sufficient Statistic)</strong></span> Let <span class="math inline">\underline{X}=(X_1,\ldots,X_n)</span> have joint PDF/PMF <span class="math inline">f(\underline{x}\mid \theta)</span>.</p>
<p>A statistic <span class="math inline">T(\underline{X})</span> is <strong>sufficient</strong> for <span class="math inline">\theta</span> if the conditional distribution of the data given the statistic does <strong>not</strong> depend on <span class="math inline">\theta</span>, i.e. <span class="math display">
f(\underline{x}\mid T(\underline{x})=t,\ \theta)\ \text{does not depend on } \theta.
</span></p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-factorisation" class="theorem">
<p><span class="theorem-title"><strong>Theorem 5.1 (Neyman–Fisher Factorisation)</strong></span> <span class="math inline">T(\underline{X})</span> is sufficient for <span class="math inline">\theta</span> <strong>if and only if</strong> there exist functions <span class="math inline">g(\theta, T(\underline{x}))</span> and <span class="math inline">h(\underline{x})</span> such that <span class="math display">
f_{\underline{X}}(\underline{x}\mid \theta)=g \big(\theta, T(\underline{x})\big)\,h(\underline{x}).
</span></p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-sufficient-bin-bern" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.5 (Sufficiency: Bernoulli model)</strong></span> If <span class="math inline">X_i \sim \mathrm{Bern}(p)</span> i.i.d. and <span class="math inline">y=\sum_{i=1}^n x_i</span>, then <span class="math display">
L(p;\underline{x})=f_{\underline{X}}(\underline{x}\mid p)
=\prod_{i=1}^n p^{x_i}(1-p)^{1-x_i}
=p^{\sum x_i}(1-p)^{n-\sum x_i}
=\underbrace{p^{y}(1-p)^{n-y}}_{g(p,\,y)}\ \underbrace{1}_{h(\underline{x})}.
</span> By factorisation, <span class="math inline">T(\underline{X})=\sum_{i=1}^n X_i</span> is sufficient for <span class="math inline">p</span>.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-sufficient-pois" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.6 (Sufficiency: Poisson model)</strong></span> If <span class="math inline">X_i \sim \mathrm{Poisson}(\lambda)</span> i.i.d. and <span class="math inline">y=\sum_{i=1}^n x_i</span>, then <span class="math display">
L(\lambda;\underline{x})=f_{\underline{X}}(\underline{x}\mid \lambda)
=\prod_{i=1}^n \frac{e^{-\lambda}\lambda^{x_i}}{x_i!}
=\underbrace{e^{-n\lambda}\lambda^{\sum x_i}}_{g(\lambda,\,y)}
\ \underbrace{\prod_{i=1}^n \frac{1}{x_i!}}_{h(\underline{x})},
</span> so <span class="math inline">T(\underline{X})=\sum_{i=1}^n X_i</span> is sufficient for <span class="math inline">\lambda</span>.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-sufficient-norm" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.7 (Sufficiency: Normal model)</strong></span> If <span class="math inline">X_i \sim \mathcal N(\mu,\sigma^2)</span> i.i.d.:</p>
<ul>
<li><p><strong>Known <span class="math inline">\sigma^2</span>.</strong> With <span class="math inline">\bar{x}=\frac{1}{n}\sum x_i</span>, <span class="math display">
f_{\underline{X}}(\underline{x}\mid \mu)
=(2\pi\sigma^2)^{-n/2}
\exp\!\left[-\frac{1}{2\sigma^2}\sum_{i=1}^n(x_i-\mu)^2\right]
=(2\pi\sigma^2)^{-n/2}\,
\underbrace{\exp\!\left[-\frac{1}{2\sigma^2}\sum_{i=1}^n(x_i-\bar{x})^2\right]}_{h(\underline{x})}\,
\underbrace{\exp\!\left[-\frac{n}{2\sigma^2}(\bar{x}-\mu)^2\right]}_{g(\mu,\,\bar{x})}.
</span> Hence <span class="math inline">T(\underline{X})=\bar{X}</span> is sufficient for <span class="math inline">\mu</span>.</p></li>
<li><p><strong>Unknown <span class="math inline">\sigma^2</span>.</strong> Write <span class="math inline">S^2=\frac{1}{n-1}\sum_{i=1}^n (X_i-\bar{X})^2</span>. Then <span class="math display">
f_{\underline{X}}(\underline{x}\mid \mu,\sigma^2)
=(2\pi\sigma^2)^{-n/2}
\exp\!\left[-\frac{1}{2\sigma^2}\Big\{\underbrace{\sum_{i=1}^n(x_i-\bar{x})^2}_{(n-1)s^2}
+n(\bar{x}-\mu)^2\Big\}\right]
=\underbrace{(2\pi)^{-n/2}\exp(0)}_{h(\underline{x})}\,
\underbrace{(\sigma^2)^{-n/2}\exp\!\left[-\frac{(n-1)s^2+n(\bar{x}-\mu)^2}{2\sigma^2}\right]}_{g\big((\mu,\sigma^2),\,(\bar{x},s^2)\big)}.
</span> Thus <span class="math inline">T(\underline{X})=(\bar{X},S^2)</span> is jointly sufficient for <span class="math inline">(\mu,\sigma^2)</span>.</p></li>
</ul>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Common misconceptions
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Sufficiency is <strong>model-dependent</strong>: change the sampling model, and what’s sufficient may change.<br>
</li>
<li><em>Sufficient</em> ≠ <em>efficient</em>: it tells us what data features matter for <span class="math inline">\theta</span>, not how variable an estimator is.<br>
</li>
<li>Although not explicitly mentioned, we will <strong>reuse</strong> these <span class="math inline">T</span> when we derive MLEs and, later in the Bayesian chapter, when posteriors update via the same statistics.</li>
</ul>
</div>
</div>
</section>

<section id="maximum-likelihood-estimation" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="maximum-likelihood-estimation"><span class="header-section-number">5.3</span> Maximum Likelihood Estimation</h2>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-mle" class="definition theorem">
<p><span class="theorem-title"><strong>Definition 5.3 (Maximum Likelihood Estimator (MLE))</strong></span> The <strong>maximum likelihood estimator (MLE)</strong> is the parameter value that makes the observed data most likely:</p>
<p><span class="math display">
\hat{\theta}_{\text{MLE}} = \argmax_{\theta \in \Theta} \, L(\theta ; \underline{X}),
</span></p>
<p>where <span class="math inline">L(\theta ; \underline{X})</span> is the likelihood function.</p>
</div>
</div>
</div>
</div>
<div id="imp-term-argmax-max" class="callout callout-style-simple callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important&nbsp;5.2: Terminology: <span class="math inline">\argmax</span> vs.&nbsp;<span class="math inline">\max</span>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>The <span class="math inline">\max</span> gives the <strong>largest value</strong> attained by a function. <span class="math display">
\max_{\theta \in \Theta} L(\theta ; \underline{X})
</span> means “the maximum likelihood value.”</p>
<p>The <span class="math inline">\argmax</span> gives the <strong>argument (input)</strong> where the maximum occurs. <span class="math display">
\argmax_{\theta \in \Theta} L(\theta ; \underline{X})
</span> means “the parameter value that maximises the likelihood.”</p>
<p>So: <span class="math inline">\max</span> is the <strong>height</strong>, <span class="math inline">\argmax</span> is the <strong>location</strong>.</p>
<details>
  <summary><strong> Show Visualisation </strong></summary>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="962" data-source-offset="-106"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 961;"><span id="cb9-962"><a href="#cb9-962" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> θ <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>(θ<span class="op">**</span><span class="dv">4</span> <span class="op">-</span> θ<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">*</span>θ))</span>
<span id="cb9-963"><a href="#cb9-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-964"><a href="#cb9-964" aria-hidden="true" tabindex="-1"></a><span class="co">// Sample the function on a grid</span></span>
<span id="cb9-965"><a href="#cb9-965" aria-hidden="true" tabindex="-1"></a>θmin <span class="op">=</span> <span class="op">-</span><span class="fl">2.2</span></span>
<span id="cb9-966"><a href="#cb9-966" aria-hidden="true" tabindex="-1"></a>θmax <span class="op">=</span>  <span class="fl">2.2</span></span>
<span id="cb9-967"><a href="#cb9-967" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">801</span></span>
<span id="cb9-968"><a href="#cb9-968" aria-hidden="true" tabindex="-1"></a>Θ <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> N}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> θmin <span class="op">+</span> i<span class="op">*</span>(θmax <span class="op">-</span> θmin)<span class="op">/</span>(N <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="cb9-969"><a href="#cb9-969" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> Θ<span class="op">.</span><span class="fu">map</span>(L)</span>
<span id="cb9-970"><a href="#cb9-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-971"><a href="#cb9-971" aria-hidden="true" tabindex="-1"></a><span class="co">// Find max (height) and argmax (location)</span></span>
<span id="cb9-972"><a href="#cb9-972" aria-hidden="true" tabindex="-1"></a>imax <span class="op">=</span> Y<span class="op">.</span><span class="fu">reduce</span>((best<span class="op">,</span> y<span class="op">,</span> i) <span class="kw">=&gt;</span> (y <span class="op">&gt;</span> Y[best] <span class="op">?</span> i <span class="op">:</span> best)<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb9-973"><a href="#cb9-973" aria-hidden="true" tabindex="-1"></a>θhat <span class="op">=</span> Θ[imax]</span>
<span id="cb9-974"><a href="#cb9-974" aria-hidden="true" tabindex="-1"></a>Lmax <span class="op">=</span> Y[imax]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-9-9" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb10" data-startfrom="977" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 976;"><span id="cb10-977"><a href="#cb10-977" aria-hidden="true" tabindex="-1"></a><span class="co">// Create the base plot without LaTeX labels</span></span>
<span id="cb10-978"><a href="#cb10-978" aria-hidden="true" tabindex="-1"></a>argmaxPlot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb10-979"><a href="#cb10-979" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">720</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">380</span><span class="op">,</span> width <span class="op">-</span> <span class="dv">40</span>))<span class="op">,</span></span>
<span id="cb10-980"><a href="#cb10-980" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> <span class="dv">340</span><span class="op">,</span></span>
<span id="cb10-981"><a href="#cb10-981" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb10-982"><a href="#cb10-982" aria-hidden="true" tabindex="-1"></a>    <span class="dt">background</span><span class="op">:</span> <span class="st">"var(--brand-bg)"</span><span class="op">,</span></span>
<span id="cb10-983"><a href="#cb10-983" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"var(--brand-fg)"</span><span class="op">,</span></span>
<span id="cb10-984"><a href="#cb10-984" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fontFamily</span><span class="op">:</span> bodyFont<span class="op">,</span></span>
<span id="cb10-985"><a href="#cb10-985" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">14</span></span>
<span id="cb10-986"><a href="#cb10-986" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb10-987"><a href="#cb10-987" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">65</span><span class="op">,</span></span>
<span id="cb10-988"><a href="#cb10-988" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb10-989"><a href="#cb10-989" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginTop</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb10-990"><a href="#cb10-990" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb10-991"><a href="#cb10-991" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">""</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [θmin<span class="op">,</span> θmax]}<span class="op">,</span>  </span>
<span id="cb10-992"><a href="#cb10-992" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">""</span><span class="op">,</span> <span class="dt">nice</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span>       </span>
<span id="cb10-993"><a href="#cb10-993" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb10-994"><a href="#cb10-994" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Likelihood curve</span></span>
<span id="cb10-995"><a href="#cb10-995" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">line</span>(</span>
<span id="cb10-996"><a href="#cb10-996" aria-hidden="true" tabindex="-1"></a>      Θ<span class="op">.</span><span class="fu">map</span>((t<span class="op">,</span>i) <span class="kw">=&gt;</span> ({<span class="dt">θ</span><span class="op">:</span> t<span class="op">,</span> <span class="dt">L</span><span class="op">:</span> Y[i]}))<span class="op">,</span> </span>
<span id="cb10-997"><a href="#cb10-997" aria-hidden="true" tabindex="-1"></a>      {<span class="dt">x</span><span class="op">:</span> <span class="st">"θ"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"L"</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"var(--brand-red)"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span>}</span>
<span id="cb10-998"><a href="#cb10-998" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb10-999"><a href="#cb10-999" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-1000"><a href="#cb10-1000" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Vertical line at argmax (location)</span></span>
<span id="cb10-1001"><a href="#cb10-1001" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>([θhat]<span class="op">,</span> {<span class="dt">strokeDasharray</span><span class="op">:</span> <span class="st">"4,3"</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"var(--brand-fg)"</span><span class="op">,</span> <span class="dt">ariaLabel</span><span class="op">:</span> <span class="st">"argmax"</span><span class="op">,</span> <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.8</span>})<span class="op">,</span></span>
<span id="cb10-1002"><a href="#cb10-1002" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-1003"><a href="#cb10-1003" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Horizontal line at max (height)</span></span>
<span id="cb10-1004"><a href="#cb10-1004" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>([Lmax]<span class="op">,</span> {<span class="dt">strokeDasharray</span><span class="op">:</span> <span class="st">"4,3"</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"var(--brand-fg)"</span><span class="op">,</span> <span class="dt">ariaLabel</span><span class="op">:</span> <span class="st">"max"</span><span class="op">,</span> <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.8</span>})<span class="op">,</span></span>
<span id="cb10-1005"><a href="#cb10-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1006"><a href="#cb10-1006" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Axes at baseline</span></span>
<span id="cb10-1007"><a href="#cb10-1007" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>([θmin]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"var(--brand-fg)"</span>})<span class="op">,</span></span>
<span id="cb10-1008"><a href="#cb10-1008" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"var(--brand-fg)"</span>})<span class="op">,</span></span>
<span id="cb10-1009"><a href="#cb10-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1010"><a href="#cb10-1010" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Point at the maximiser</span></span>
<span id="cb10-1011"><a href="#cb10-1011" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(</span>
<span id="cb10-1012"><a href="#cb10-1012" aria-hidden="true" tabindex="-1"></a>      [{<span class="dt">θ</span><span class="op">:</span> θhat<span class="op">,</span> <span class="dt">L</span><span class="op">:</span> Lmax}]<span class="op">,</span> </span>
<span id="cb10-1013"><a href="#cb10-1013" aria-hidden="true" tabindex="-1"></a>      {<span class="dt">x</span><span class="op">:</span> <span class="st">"θ"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"L"</span><span class="op">,</span> <span class="dt">r</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"var(--brand-teal)"</span>}</span>
<span id="cb10-1014"><a href="#cb10-1014" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-1015"><a href="#cb10-1015" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb10-1016"><a href="#cb10-1016" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb11" data-startfrom="1022" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1021;"><span id="cb11-1022"><a href="#cb11-1022" aria-hidden="true" tabindex="-1"></a><span class="co">// Add LaTeX overlays after plot renders</span></span>
<span id="cb11-1023"><a href="#cb11-1023" aria-hidden="true" tabindex="-1"></a>plotWithLatex <span class="op">=</span> {</span>
<span id="cb11-1024"><a href="#cb11-1024" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create container</span></span>
<span id="cb11-1025"><a href="#cb11-1025" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div style="position: relative; display: inline-block;"&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb11-1026"><a href="#cb11-1026" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1027"><a href="#cb11-1027" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add the plot</span></span>
<span id="cb11-1028"><a href="#cb11-1028" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">append</span>(argmaxPlot)<span class="op">;</span></span>
<span id="cb11-1029"><a href="#cb11-1029" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1030"><a href="#cb11-1030" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Function to add labels after render</span></span>
<span id="cb11-1031"><a href="#cb11-1031" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> addLabels <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb11-1032"><a href="#cb11-1032" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the SVG element</span></span>
<span id="cb11-1033"><a href="#cb11-1033" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"svg"</span>)<span class="op">;</span></span>
<span id="cb11-1034"><a href="#cb11-1034" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>svg) {</span>
<span id="cb11-1035"><a href="#cb11-1035" aria-hidden="true" tabindex="-1"></a>      <span class="fu">requestAnimationFrame</span>(addLabels)<span class="op">;</span></span>
<span id="cb11-1036"><a href="#cb11-1036" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb11-1037"><a href="#cb11-1037" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-1038"><a href="#cb11-1038" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-1039"><a href="#cb11-1039" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get dimensions from the SVG</span></span>
<span id="cb11-1040"><a href="#cb11-1040" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svgRect <span class="op">=</span> svg<span class="op">.</span><span class="fu">getBoundingClientRect</span>()<span class="op">;</span></span>
<span id="cb11-1041"><a href="#cb11-1041" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> plotWidth <span class="op">=</span> svgRect<span class="op">.</span><span class="at">width</span><span class="op">;</span></span>
<span id="cb11-1042"><a href="#cb11-1042" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> plotHeight <span class="op">=</span> svgRect<span class="op">.</span><span class="at">height</span><span class="op">;</span></span>
<span id="cb11-1043"><a href="#cb11-1043" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-1044"><a href="#cb11-1044" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Approximate margins from plot config</span></span>
<span id="cb11-1045"><a href="#cb11-1045" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginLeft <span class="op">=</span> <span class="dv">74</span><span class="op">;</span></span>
<span id="cb11-1046"><a href="#cb11-1046" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginBottom <span class="op">=</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb11-1047"><a href="#cb11-1047" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginTop <span class="op">=</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb11-1048"><a href="#cb11-1048" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> marginRight <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb11-1049"><a href="#cb11-1049" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-1050"><a href="#cb11-1050" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate plot area dimensions</span></span>
<span id="cb11-1051"><a href="#cb11-1051" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> plotAreaWidth <span class="op">=</span> plotWidth <span class="op">-</span> marginLeft <span class="op">-</span> marginRight<span class="op">;</span></span>
<span id="cb11-1052"><a href="#cb11-1052" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> plotAreaHeight <span class="op">=</span> plotHeight <span class="op">-</span> marginTop <span class="op">-</span> marginBottom<span class="op">;</span></span>
<span id="cb11-1053"><a href="#cb11-1053" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-1054"><a href="#cb11-1054" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Linear mapping functions for data to pixel coordinates</span></span>
<span id="cb11-1055"><a href="#cb11-1055" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xToPixel <span class="op">=</span> (x) <span class="kw">=&gt;</span> marginLeft <span class="op">+</span> ((x <span class="op">-</span> θmin) <span class="op">/</span> (θmax <span class="op">-</span> θmin)) <span class="op">*</span> plotAreaWidth<span class="op">;</span></span>
<span id="cb11-1056"><a href="#cb11-1056" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yToPixel <span class="op">=</span> (y) <span class="kw">=&gt;</span> marginTop <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> (y <span class="op">/</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>Y) <span class="op">*</span> <span class="fl">1.05</span>))) <span class="op">*</span> plotAreaHeight<span class="op">;</span></span>
<span id="cb11-1057"><a href="#cb11-1057" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-1058"><a href="#cb11-1058" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate positions</span></span>
<span id="cb11-1059"><a href="#cb11-1059" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> θhatPixel <span class="op">=</span> <span class="fu">xToPixel</span>(θhat)<span class="op">;</span></span>
<span id="cb11-1060"><a href="#cb11-1060" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> LmaxPixel <span class="op">=</span> <span class="fu">yToPixel</span>(Lmax)<span class="op">;</span></span>
<span id="cb11-1061"><a href="#cb11-1061" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-1062"><a href="#cb11-1062" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create and add LaTeX labels with boxes</span></span>
<span id="cb11-1063"><a href="#cb11-1063" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> labels <span class="op">=</span> [</span>
<span id="cb11-1064"><a href="#cb11-1064" aria-hidden="true" tabindex="-1"></a>      <span class="co">// X-axis label</span></span>
<span id="cb11-1065"><a href="#cb11-1065" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb11-1066"><a href="#cb11-1066" aria-hidden="true" tabindex="-1"></a>        <span class="dt">element</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\t</span><span class="vs">heta`</span><span class="op">,</span></span>
<span id="cb11-1067"><a href="#cb11-1067" aria-hidden="true" tabindex="-1"></a>        <span class="dt">style</span><span class="op">:</span> <span class="vs">`</span></span>
<span id="cb11-1068"><a href="#cb11-1068" aria-hidden="true" tabindex="-1"></a><span class="vs">          position: absolute;</span></span>
<span id="cb11-1069"><a href="#cb11-1069" aria-hidden="true" tabindex="-1"></a><span class="vs">          bottom: 8px;</span></span>
<span id="cb11-1070"><a href="#cb11-1070" aria-hidden="true" tabindex="-1"></a><span class="vs">          left: </span><span class="sc">${</span>plotWidth <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">px;</span></span>
<span id="cb11-1071"><a href="#cb11-1071" aria-hidden="true" tabindex="-1"></a><span class="vs">          transform: translateX(-50%);</span></span>
<span id="cb11-1072"><a href="#cb11-1072" aria-hidden="true" tabindex="-1"></a><span class="vs">          pointer-events: none;</span></span>
<span id="cb11-1073"><a href="#cb11-1073" aria-hidden="true" tabindex="-1"></a><span class="vs">        `</span></span>
<span id="cb11-1074"><a href="#cb11-1074" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb11-1075"><a href="#cb11-1075" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Y-axis label  </span></span>
<span id="cb11-1076"><a href="#cb11-1076" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb11-1077"><a href="#cb11-1077" aria-hidden="true" tabindex="-1"></a>        <span class="dt">element</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`L(</span><span class="sc">\t</span><span class="vs">heta;</span><span class="sc">\,</span><span class="er">\u</span><span class="vs">nderline{x})`</span><span class="op">,</span></span>
<span id="cb11-1078"><a href="#cb11-1078" aria-hidden="true" tabindex="-1"></a>        <span class="dt">style</span><span class="op">:</span> <span class="vs">`</span></span>
<span id="cb11-1079"><a href="#cb11-1079" aria-hidden="true" tabindex="-1"></a><span class="vs">          position: absolute;</span></span>
<span id="cb11-1080"><a href="#cb11-1080" aria-hidden="true" tabindex="-1"></a><span class="vs">          left: 8px;</span></span>
<span id="cb11-1081"><a href="#cb11-1081" aria-hidden="true" tabindex="-1"></a><span class="vs">          top: </span><span class="sc">${</span>(plotHeight <span class="op">-</span> marginBottom) <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">px;</span></span>
<span id="cb11-1082"><a href="#cb11-1082" aria-hidden="true" tabindex="-1"></a><span class="vs">          transform: rotate(-90deg) translateY(5px);</span></span>
<span id="cb11-1083"><a href="#cb11-1083" aria-hidden="true" tabindex="-1"></a><span class="vs">          transform-origin: left center;</span></span>
<span id="cb11-1084"><a href="#cb11-1084" aria-hidden="true" tabindex="-1"></a><span class="vs">          pointer-events: none;</span></span>
<span id="cb11-1085"><a href="#cb11-1085" aria-hidden="true" tabindex="-1"></a><span class="vs">        `</span></span>
<span id="cb11-1086"><a href="#cb11-1086" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb11-1087"><a href="#cb11-1087" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Argmax label at bottom - positioned on x-axis</span></span>
<span id="cb11-1088"><a href="#cb11-1088" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb11-1089"><a href="#cb11-1089" aria-hidden="true" tabindex="-1"></a>        <span class="dt">element</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\a</span><span class="vs">rg</span><span class="sc">\m</span><span class="vs">ax</span><span class="sc">\,</span><span class="vs"> L(</span><span class="sc">\t</span><span class="vs">heta;</span><span class="sc">\,</span><span class="er">\u</span><span class="vs">nderline{x})`</span><span class="op">,</span></span>
<span id="cb11-1090"><a href="#cb11-1090" aria-hidden="true" tabindex="-1"></a>        <span class="dt">style</span><span class="op">:</span> <span class="vs">`</span></span>
<span id="cb11-1091"><a href="#cb11-1091" aria-hidden="true" tabindex="-1"></a><span class="vs">          position: absolute;</span></span>
<span id="cb11-1092"><a href="#cb11-1092" aria-hidden="true" tabindex="-1"></a><span class="vs">          top: </span><span class="sc">${</span>plotHeight <span class="op">-</span> marginBottom<span class="sc">}</span><span class="vs">px;</span></span>
<span id="cb11-1093"><a href="#cb11-1093" aria-hidden="true" tabindex="-1"></a><span class="vs">          left: </span><span class="sc">${</span>θhatPixel<span class="sc">}</span><span class="vs">px;</span></span>
<span id="cb11-1094"><a href="#cb11-1094" aria-hidden="true" tabindex="-1"></a><span class="vs">          transform: translate(-50%, -50%);</span></span>
<span id="cb11-1095"><a href="#cb11-1095" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-size: 13px;</span></span>
<span id="cb11-1096"><a href="#cb11-1096" aria-hidden="true" tabindex="-1"></a><span class="vs">          pointer-events: none;</span></span>
<span id="cb11-1097"><a href="#cb11-1097" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: var(--brand-fg);</span></span>
<span id="cb11-1098"><a href="#cb11-1098" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: var(--plot-panel-bg, white);</span></span>
<span id="cb11-1099"><a href="#cb11-1099" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 3px 6px;</span></span>
<span id="cb11-1100"><a href="#cb11-1100" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: 1px solid var(--border, #ddd);</span></span>
<span id="cb11-1101"><a href="#cb11-1101" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 4px;</span></span>
<span id="cb11-1102"><a href="#cb11-1102" aria-hidden="true" tabindex="-1"></a><span class="vs">          box-shadow: 0 1px 3px rgba(0,0,0,0.1);</span></span>
<span id="cb11-1103"><a href="#cb11-1103" aria-hidden="true" tabindex="-1"></a><span class="vs">        `</span></span>
<span id="cb11-1104"><a href="#cb11-1104" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb11-1105"><a href="#cb11-1105" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Max value label on left - positioned on y-axis</span></span>
<span id="cb11-1106"><a href="#cb11-1106" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb11-1107"><a href="#cb11-1107" aria-hidden="true" tabindex="-1"></a>        <span class="dt">element</span><span class="op">:</span> <span class="fu">tex</span><span class="vs">`</span><span class="sc">\m</span><span class="vs">ax</span><span class="sc">\,</span><span class="vs"> L(</span><span class="sc">\t</span><span class="vs">heta;</span><span class="sc">\,</span><span class="er">\u</span><span class="vs">nderline{x})`</span><span class="op">,</span></span>
<span id="cb11-1108"><a href="#cb11-1108" aria-hidden="true" tabindex="-1"></a>        <span class="dt">style</span><span class="op">:</span> <span class="vs">`</span></span>
<span id="cb11-1109"><a href="#cb11-1109" aria-hidden="true" tabindex="-1"></a><span class="vs">          position: absolute;</span></span>
<span id="cb11-1110"><a href="#cb11-1110" aria-hidden="true" tabindex="-1"></a><span class="vs">          top: </span><span class="sc">${</span>LmaxPixel<span class="sc">}</span><span class="vs">px;</span></span>
<span id="cb11-1111"><a href="#cb11-1111" aria-hidden="true" tabindex="-1"></a><span class="vs">          left: </span><span class="sc">${</span>marginLeft<span class="sc">}</span><span class="vs">px;</span></span>
<span id="cb11-1112"><a href="#cb11-1112" aria-hidden="true" tabindex="-1"></a><span class="vs">          transform: translate(-50%, -50%);</span></span>
<span id="cb11-1113"><a href="#cb11-1113" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-size: 13px;</span></span>
<span id="cb11-1114"><a href="#cb11-1114" aria-hidden="true" tabindex="-1"></a><span class="vs">          pointer-events: none;</span></span>
<span id="cb11-1115"><a href="#cb11-1115" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: var(--brand-fg);</span></span>
<span id="cb11-1116"><a href="#cb11-1116" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: var(--plot-panel-bg, white);</span></span>
<span id="cb11-1117"><a href="#cb11-1117" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 3px 6px;</span></span>
<span id="cb11-1118"><a href="#cb11-1118" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: 1px solid var(--border, #ddd);</span></span>
<span id="cb11-1119"><a href="#cb11-1119" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 4px;</span></span>
<span id="cb11-1120"><a href="#cb11-1120" aria-hidden="true" tabindex="-1"></a><span class="vs">          box-shadow: 0 1px 3px rgba(0,0,0,0.1);</span></span>
<span id="cb11-1121"><a href="#cb11-1121" aria-hidden="true" tabindex="-1"></a><span class="vs">        `</span></span>
<span id="cb11-1122"><a href="#cb11-1122" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-1123"><a href="#cb11-1123" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb11-1124"><a href="#cb11-1124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-1125"><a href="#cb11-1125" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add each label to the container</span></span>
<span id="cb11-1126"><a href="#cb11-1126" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">.</span><span class="fu">forEach</span>(({element<span class="op">,</span> style}) <span class="kw">=&gt;</span> {</span>
<span id="cb11-1127"><a href="#cb11-1127" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> div <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div style="</span><span class="sc">${</span>style<span class="sc">}</span><span class="vs">"&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb11-1128"><a href="#cb11-1128" aria-hidden="true" tabindex="-1"></a>      div<span class="op">.</span><span class="fu">append</span>(element)<span class="op">;</span></span>
<span id="cb11-1129"><a href="#cb11-1129" aria-hidden="true" tabindex="-1"></a>      container<span class="op">.</span><span class="fu">append</span>(div)<span class="op">;</span></span>
<span id="cb11-1130"><a href="#cb11-1130" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb11-1131"><a href="#cb11-1131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-1132"><a href="#cb11-1132" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Hide the original axis labels</span></span>
<span id="cb11-1133"><a href="#cb11-1133" aria-hidden="true" tabindex="-1"></a>    <span class="co">// X-axis label</span></span>
<span id="cb11-1134"><a href="#cb11-1134" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xAxisLabel <span class="op">=</span> svg<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'g[aria-label="x-axis label"]'</span>)<span class="op">;</span></span>
<span id="cb11-1135"><a href="#cb11-1135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (xAxisLabel) xAxisLabel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span></span>
<span id="cb11-1136"><a href="#cb11-1136" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-1137"><a href="#cb11-1137" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Y-axis label</span></span>
<span id="cb11-1138"><a href="#cb11-1138" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> yAxisLabel <span class="op">=</span> svg<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'g[aria-label="y-axis label"]'</span>)<span class="op">;</span></span>
<span id="cb11-1139"><a href="#cb11-1139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (yAxisLabel) yAxisLabel<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span></span>
<span id="cb11-1140"><a href="#cb11-1140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-1141"><a href="#cb11-1141" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Alternative: hide any text elements that contain θ or L(θ</span></span>
<span id="cb11-1142"><a href="#cb11-1142" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">'text'</span>)<span class="op">.</span><span class="fu">forEach</span>(text <span class="kw">=&gt;</span> {</span>
<span id="cb11-1143"><a href="#cb11-1143" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (text<span class="op">.</span><span class="at">textContent</span> <span class="op">===</span> <span class="st">'θ'</span> <span class="op">||</span> text<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">'L(θ'</span>)) {</span>
<span id="cb11-1144"><a href="#cb11-1144" aria-hidden="true" tabindex="-1"></a>        text<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">'none'</span><span class="op">;</span></span>
<span id="cb11-1145"><a href="#cb11-1145" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-1146"><a href="#cb11-1146" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb11-1147"><a href="#cb11-1147" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb11-1148"><a href="#cb11-1148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1149"><a href="#cb11-1149" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Schedule label addition</span></span>
<span id="cb11-1150"><a href="#cb11-1150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">requestAnimationFrame</span>(addLabels)<span class="op">;</span></span>
<span id="cb11-1151"><a href="#cb11-1151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-1152"><a href="#cb11-1152" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">;</span></span>
<span id="cb11-1153"><a href="#cb11-1153" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fig-ojs-cell-11" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ojs-cell-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ojs-cell-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.1: Illustration of the difference between <span class="math inline">\argmax</span> and <span class="math inline">\max</span>. The red curve shows a likelihood function <span class="math inline">L(\theta;\underline{x})</span>. The vertical dashed line marks the <span class="math inline">\argmax</span> (the parameter value <span class="math inline">\hat\theta</span> where the maximum occurs), while the horizontal dashed line marks the <span class="math inline">\max</span> (the maximum likelihood value itself).
</figcaption>
</figure>
</div>
</div>
</details>
</div>
</div>
</div>
<p>Because the logarithm is a <strong>monotonically increasing function</strong>, the value of <span class="math inline">\theta</span> that maximises the likelihood will also maximise the <strong>log-likelihood</strong>.</p>
<p>In practice, we almost always work with the log-likelihood because it is <strong>simpler to handle mathematically</strong>: it turns products into sums, and derivatives are easier to compute.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-log-likelihood" class="definition theorem">
<p><span class="theorem-title"><strong>Definition 5.4 (Log-Likelihood)</strong></span> The <strong>log-likelihood</strong> is defined as</p>
<p><span class="math display">
\ell(\theta ; \underline{x}) = \log L(\theta ; \underline{x}).
</span></p>
<ul>
<li>This is literally just the logarithm of the likelihood.<br>
</li>
<li>Because <span class="math inline">\log</span> is increasing, maximising <span class="math inline">\ell(\theta;\underline{x})</span> gives the same <span class="math inline">\hat{\theta}</span> as maximising <span class="math inline">L(\theta;\underline{x})</span>.</li>
</ul>
</div>
</div>
</div>
</div>
<hr>
<details>
  <summary><strong> Show Visualisation </strong></summary>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb12" data-startfrom="1199" data-source-offset="-25"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1198;"><span id="cb12-1199"><a href="#cb12-1199" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;style&gt;</span></span>
<span id="cb12-1200"><a href="#cb12-1200" aria-hidden="true" tabindex="-1"></a><span class="vs">.plot--large-axis .x-axis .label,</span></span>
<span id="cb12-1201"><a href="#cb12-1201" aria-hidden="true" tabindex="-1"></a><span class="vs">.plot--large-axis .y-axis .label {</span></span>
<span id="cb12-1202"><a href="#cb12-1202" aria-hidden="true" tabindex="-1"></a><span class="vs">font-size: 24px; font-weight: 600;</span></span>
<span id="cb12-1203"><a href="#cb12-1203" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb12-1204"><a href="#cb12-1204" aria-hidden="true" tabindex="-1"></a><span class="vs">.plot--large-axis .x-axis text,</span></span>
<span id="cb12-1205"><a href="#cb12-1205" aria-hidden="true" tabindex="-1"></a><span class="vs">.plot--large-axis .y-axis text {</span></span>
<span id="cb12-1206"><a href="#cb12-1206" aria-hidden="true" tabindex="-1"></a><span class="vs">font-size: 12px; /* tick labels (optional) */</span></span>
<span id="cb12-1207"><a href="#cb12-1207" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb12-1208"><a href="#cb12-1208" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/style&gt;`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb13" data-startfrom="1211" data-source-offset="-342"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1210;"><span id="cb13-1211"><a href="#cb13-1211" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> {</span>
<span id="cb13-1212"><a href="#cb13-1212" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Trigger on: resim button, n, trueMu, or trueSigma changes</span></span>
<span id="cb13-1213"><a href="#cb13-1213" aria-hidden="true" tabindex="-1"></a>  resim<span class="op">;</span> n<span class="op">;</span> trueMu<span class="op">;</span> trueSigma<span class="op">;</span></span>
<span id="cb13-1214"><a href="#cb13-1214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-1215"><a href="#cb13-1215" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> m <span class="op">=</span> trueMu<span class="op">,</span> s <span class="op">=</span> trueSigma<span class="op">;</span></span>
<span id="cb13-1216"><a href="#cb13-1216" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> out <span class="op">=</span> <span class="kw">new</span> <span class="bu">Array</span>(n)<span class="op">;</span></span>
<span id="cb13-1217"><a href="#cb13-1217" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i <span class="op">+=</span> <span class="dv">2</span>) {</span>
<span id="cb13-1218"><a href="#cb13-1218" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> u <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">,</span> v <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">;</span></span>
<span id="cb13-1219"><a href="#cb13-1219" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> R <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="op">-</span><span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(u))<span class="op">,</span> T <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> v<span class="op">;</span></span>
<span id="cb13-1220"><a href="#cb13-1220" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> z0 <span class="op">=</span> R <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(T)<span class="op">,</span> z1 <span class="op">=</span> R <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(T)<span class="op">;</span></span>
<span id="cb13-1221"><a href="#cb13-1221" aria-hidden="true" tabindex="-1"></a>    out[i] <span class="op">=</span> m <span class="op">+</span> s <span class="op">*</span> z0<span class="op">;</span></span>
<span id="cb13-1222"><a href="#cb13-1222" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="op">+</span> <span class="dv">1</span> <span class="op">&lt;</span> n) out[i <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> m <span class="op">+</span> s <span class="op">*</span> z1<span class="op">;</span></span>
<span id="cb13-1223"><a href="#cb13-1223" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-1224"><a href="#cb13-1224" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb13-1225"><a href="#cb13-1225" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb13-1226"><a href="#cb13-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1227"><a href="#cb13-1227" aria-hidden="true" tabindex="-1"></a>xbar <span class="op">=</span> d3<span class="op">.</span><span class="fu">mean</span>(X)<span class="op">;</span></span>
<span id="cb13-1228"><a href="#cb13-1228" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(X<span class="op">,</span> x <span class="kw">=&gt;</span> (x <span class="op">-</span> xbar) <span class="op">**</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb13-1229"><a href="#cb13-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1230"><a href="#cb13-1230" aria-hidden="true" tabindex="-1"></a>logLik <span class="op">=</span> (mu<span class="op">,</span> sigma2) <span class="kw">=&gt;</span> {</span>
<span id="cb13-1231"><a href="#cb13-1231" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ss <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(X<span class="op">,</span> x <span class="kw">=&gt;</span> (x <span class="op">-</span> mu) <span class="op">**</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb13-1232"><a href="#cb13-1232" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> n <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> sigma2) <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> ss <span class="op">/</span> sigma2<span class="op">;</span></span>
<span id="cb13-1233"><a href="#cb13-1233" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb13-1234"><a href="#cb13-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1235"><a href="#cb13-1235" aria-hidden="true" tabindex="-1"></a>muhat <span class="op">=</span> xbar<span class="op">;</span></span>
<span id="cb13-1236"><a href="#cb13-1236" aria-hidden="true" tabindex="-1"></a>sigma2hat <span class="op">=</span> S <span class="op">/</span> n<span class="op">;</span></span>
<span id="cb13-1237"><a href="#cb13-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1238"><a href="#cb13-1238" aria-hidden="true" tabindex="-1"></a><span class="co">// --- Grid for contours (axes ticks) ---</span></span>
<span id="cb13-1239"><a href="#cb13-1239" aria-hidden="true" tabindex="-1"></a><span class="co">// These only need to update when display parameters change</span></span>
<span id="cb13-1240"><a href="#cb13-1240" aria-hidden="true" tabindex="-1"></a>muGrid <span class="op">=</span> d3<span class="op">.</span><span class="fu">ticks</span>(muhat <span class="op">-</span> muHalfWidth<span class="op">,</span> muhat <span class="op">+</span> muHalfWidth<span class="op">,</span> gridN)</span>
<span id="cb13-1241"><a href="#cb13-1241" aria-hidden="true" tabindex="-1"></a>sig2Grid <span class="op">=</span> d3<span class="op">.</span><span class="fu">ticks</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="fl">0.05</span><span class="op">,</span> sigma2hat <span class="op">/</span> <span class="dv">20</span>)<span class="op">,</span> sig2Max<span class="op">,</span> gridN)<span class="op">.</span><span class="fu">filter</span>(s <span class="kw">=&gt;</span> s <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb13-1242"><a href="#cb13-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1243"><a href="#cb13-1243" aria-hidden="true" tabindex="-1"></a><span class="co">// --- Build a row-major grid for Plot.raster / Plot.contour ---</span></span>
<span id="cb13-1244"><a href="#cb13-1244" aria-hidden="true" tabindex="-1"></a>nx <span class="op">=</span> muGrid<span class="op">.</span><span class="at">length</span></span>
<span id="cb13-1245"><a href="#cb13-1245" aria-hidden="true" tabindex="-1"></a>ny <span class="op">=</span> sig2Grid<span class="op">.</span><span class="at">length</span></span>
<span id="cb13-1246"><a href="#cb13-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1247"><a href="#cb13-1247" aria-hidden="true" tabindex="-1"></a><span class="co">// Memoize the expensive log-likelihood computation</span></span>
<span id="cb13-1248"><a href="#cb13-1248" aria-hidden="true" tabindex="-1"></a>llValues <span class="op">=</span> {</span>
<span id="cb13-1249"><a href="#cb13-1249" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> z <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float64Array</span>(nx <span class="op">*</span> ny)<span class="op">;</span></span>
<span id="cb13-1250"><a href="#cb13-1250" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> ny<span class="op">;</span> <span class="op">++</span>j) {</span>
<span id="cb13-1251"><a href="#cb13-1251" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> nx<span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="cb13-1252"><a href="#cb13-1252" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> s2 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="fl">1e-6</span><span class="op">,</span> sig2Grid[j])<span class="op">;</span></span>
<span id="cb13-1253"><a href="#cb13-1253" aria-hidden="true" tabindex="-1"></a>      z[j <span class="op">*</span> nx <span class="op">+</span> i] <span class="op">=</span> <span class="fu">logLik</span>(muGrid[i]<span class="op">,</span> s2)<span class="op">;</span></span>
<span id="cb13-1254"><a href="#cb13-1254" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-1255"><a href="#cb13-1255" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-1256"><a href="#cb13-1256" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> z<span class="op">;</span></span>
<span id="cb13-1257"><a href="#cb13-1257" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-1258"><a href="#cb13-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1259"><a href="#cb13-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1260"><a href="#cb13-1260" aria-hidden="true" tabindex="-1"></a><span class="co">// ---- Geometry / domains (responsive) ----</span></span>
<span id="cb13-1261"><a href="#cb13-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1262"><a href="#cb13-1262" aria-hidden="true" tabindex="-1"></a>muDomain <span class="op">=</span> [muGrid[<span class="dv">0</span>]<span class="op">,</span> muGrid[muGrid<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>]]</span>
<span id="cb13-1263"><a href="#cb13-1263" aria-hidden="true" tabindex="-1"></a>sig2Domain <span class="op">=</span> [sig2Grid[<span class="dv">0</span>]<span class="op">,</span> sig2Grid[sig2Grid<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>]]</span>
<span id="cb13-1264"><a href="#cb13-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1265"><a href="#cb13-1265" aria-hidden="true" tabindex="-1"></a><span class="co">// ---- Colour scaling (robust &amp; reactive) ----</span></span>
<span id="cb13-1266"><a href="#cb13-1266" aria-hidden="true" tabindex="-1"></a>llMax <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(llValues)</span>
<span id="cb13-1267"><a href="#cb13-1267" aria-hidden="true" tabindex="-1"></a>llRel <span class="op">=</span> <span class="bu">Float64Array</span><span class="op">.</span><span class="fu">from</span>(llValues<span class="op">,</span> v <span class="kw">=&gt;</span> v <span class="op">-</span> llMax)</span>
<span id="cb13-1268"><a href="#cb13-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1269"><a href="#cb13-1269" aria-hidden="true" tabindex="-1"></a><span class="co">// Use more efficient quantile computation</span></span>
<span id="cb13-1270"><a href="#cb13-1270" aria-hidden="true" tabindex="-1"></a>llRelFinite <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(llRel)<span class="op">.</span><span class="fu">filter</span>(<span class="bu">Number</span><span class="op">.</span><span class="at">isFinite</span>)</span>
<span id="cb13-1271"><a href="#cb13-1271" aria-hidden="true" tabindex="-1"></a>llRelSorted <span class="op">=</span> llRelFinite<span class="op">.</span><span class="fu">slice</span>()<span class="op">.</span><span class="fu">sort</span>(d3<span class="op">.</span><span class="at">ascending</span>)</span>
<span id="cb13-1272"><a href="#cb13-1272" aria-hidden="true" tabindex="-1"></a>q05 <span class="op">=</span> d3<span class="op">.</span><span class="fu">quantileSorted</span>(llRelSorted<span class="op">,</span> <span class="fl">0.05</span>) <span class="op">??</span> d3<span class="op">.</span><span class="fu">min</span>(llRelFinite)</span>
<span id="cb13-1273"><a href="#cb13-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1274"><a href="#cb13-1274" aria-hidden="true" tabindex="-1"></a>colorDomain <span class="op">=</span> [q05<span class="op">,</span> <span class="dv">0</span>]</span>
<span id="cb13-1275"><a href="#cb13-1275" aria-hidden="true" tabindex="-1"></a>llRelClipped <span class="op">=</span> <span class="bu">Float64Array</span><span class="op">.</span><span class="fu">from</span>(llRel<span class="op">,</span> v <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(q05<span class="op">,</span> v))</span>
<span id="cb13-1276"><a href="#cb13-1276" aria-hidden="true" tabindex="-1"></a>contourThresholds <span class="op">=</span> d3<span class="op">.</span><span class="fu">ticks</span>(q05<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb13-1277"><a href="#cb13-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1278"><a href="#cb13-1278" aria-hidden="true" tabindex="-1"></a><span class="co">// ---- Left panel: raster (clipped) + contour (same grid) ----</span></span>
<span id="cb13-1279"><a href="#cb13-1279" aria-hidden="true" tabindex="-1"></a>viewof leftPanel <span class="op">=</span> {</span>
<span id="cb13-1280"><a href="#cb13-1280" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrap <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div style="</span></span>
<span id="cb13-1281"><a href="#cb13-1281" aria-hidden="true" tabindex="-1"></a><span class="vs">    position: relative;</span></span>
<span id="cb13-1282"><a href="#cb13-1282" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: </span><span class="sc">${</span>plotW<span class="sc">}</span><span class="vs">px;</span></span>
<span id="cb13-1283"><a href="#cb13-1283" aria-hidden="true" tabindex="-1"></a><span class="vs">    height: </span><span class="sc">${</span>plotH<span class="sc">}</span><span class="vs">px;</span></span>
<span id="cb13-1284"><a href="#cb13-1284" aria-hidden="true" tabindex="-1"></a><span class="vs">    flex: 0 0 </span><span class="sc">${</span>plotW<span class="sc">}</span><span class="vs">px;</span></span>
<span id="cb13-1285"><a href="#cb13-1285" aria-hidden="true" tabindex="-1"></a><span class="vs">    line-height: 0;</span></span>
<span id="cb13-1286"><a href="#cb13-1286" aria-hidden="true" tabindex="-1"></a><span class="vs">  "&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb13-1287"><a href="#cb13-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1288"><a href="#cb13-1288" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> base <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb13-1289"><a href="#cb13-1289" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> plotW<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> plotH<span class="op">,</span></span>
<span id="cb13-1290"><a href="#cb13-1290" aria-hidden="true" tabindex="-1"></a>    marginLeft<span class="op">,</span> marginRight<span class="op">,</span> marginTop<span class="op">,</span> marginBottom<span class="op">,</span></span>
<span id="cb13-1291"><a href="#cb13-1291" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb13-1292"><a href="#cb13-1292" aria-hidden="true" tabindex="-1"></a>      <span class="dt">background</span><span class="op">:</span> <span class="st">"var(--brand-bg)"</span><span class="op">,</span></span>
<span id="cb13-1293"><a href="#cb13-1293" aria-hidden="true" tabindex="-1"></a>      <span class="dt">color</span><span class="op">:</span> <span class="st">"var(--brand-fg)"</span><span class="op">,</span></span>
<span id="cb13-1294"><a href="#cb13-1294" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> bodyFont<span class="op">,</span> </span>
<span id="cb13-1295"><a href="#cb13-1295" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">14</span></span>
<span id="cb13-1296"><a href="#cb13-1296" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb13-1297"><a href="#cb13-1297" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"μ"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> muDomain }<span class="op">,</span></span>
<span id="cb13-1298"><a href="#cb13-1298" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"σ²"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> sig2Domain }<span class="op">,</span></span>
<span id="cb13-1299"><a href="#cb13-1299" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb13-1300"><a href="#cb13-1300" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"symlog"</span><span class="op">,</span></span>
<span id="cb13-1301"><a href="#cb13-1301" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> colorDomain<span class="op">,</span></span>
<span id="cb13-1302"><a href="#cb13-1302" aria-hidden="true" tabindex="-1"></a>      <span class="dt">clamp</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb13-1303"><a href="#cb13-1303" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scheme</span><span class="op">:</span> <span class="st">"turbo"</span><span class="op">,</span></span>
<span id="cb13-1304"><a href="#cb13-1304" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb13-1305"><a href="#cb13-1305" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb13-1306"><a href="#cb13-1306" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb13-1307"><a href="#cb13-1307" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">raster</span>(llRelClipped<span class="op">,</span> {</span>
<span id="cb13-1308"><a href="#cb13-1308" aria-hidden="true" tabindex="-1"></a>        <span class="dt">width</span><span class="op">:</span> nx<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> ny<span class="op">,</span></span>
<span id="cb13-1309"><a href="#cb13-1309" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> muDomain[<span class="dv">0</span>]<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> muDomain[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb13-1310"><a href="#cb13-1310" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> sig2Domain[<span class="dv">0</span>]<span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> sig2Domain[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb13-1311"><a href="#cb13-1311" aria-hidden="true" tabindex="-1"></a>        <span class="dt">interpolate</span><span class="op">:</span> <span class="st">"nearest"</span></span>
<span id="cb13-1312"><a href="#cb13-1312" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb13-1313"><a href="#cb13-1313" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">dot</span>([{ <span class="dt">mu</span><span class="op">:</span> muhat<span class="op">,</span> <span class="dt">sig2</span><span class="op">:</span> sigma2hat }]<span class="op">,</span> {</span>
<span id="cb13-1314"><a href="#cb13-1314" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"mu"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"sig2"</span><span class="op">,</span> <span class="dt">r</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"currentColor"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"var(--brand-bg)"</span></span>
<span id="cb13-1315"><a href="#cb13-1315" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb13-1316"><a href="#cb13-1316" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb13-1317"><a href="#cb13-1317" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-1318"><a href="#cb13-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1319"><a href="#cb13-1319" aria-hidden="true" tabindex="-1"></a>  base<span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">add</span>(<span class="st">"plot--large-axis"</span>)<span class="op">;</span></span>
<span id="cb13-1320"><a href="#cb13-1320" aria-hidden="true" tabindex="-1"></a>  base<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">"block"</span><span class="op">;</span></span>
<span id="cb13-1321"><a href="#cb13-1321" aria-hidden="true" tabindex="-1"></a>  wrap<span class="op">.</span><span class="fu">append</span>(base)<span class="op">;</span></span>
<span id="cb13-1322"><a href="#cb13-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1323"><a href="#cb13-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1324"><a href="#cb13-1324" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Crosshair overlay fills wrapper</span></span>
<span id="cb13-1325"><a href="#cb13-1325" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb13-1326"><a href="#cb13-1326" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> plotW)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> plotH)</span>
<span id="cb13-1327"><a href="#cb13-1327" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"position"</span><span class="op">,</span> <span class="st">"absolute"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="st">"0"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="st">"0"</span>)</span>
<span id="cb13-1328"><a href="#cb13-1328" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb13-1329"><a href="#cb13-1329" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb13-1330"><a href="#cb13-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1331"><a href="#cb13-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1332"><a href="#cb13-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1333"><a href="#cb13-1333" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>(muDomain)<span class="op">.</span><span class="fu">range</span>([marginLeft<span class="op">,</span> marginLeft <span class="op">+</span> innerW])<span class="op">;</span></span>
<span id="cb13-1334"><a href="#cb13-1334" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>(sig2Domain)<span class="op">.</span><span class="fu">range</span>([marginTop <span class="op">+</span> innerH<span class="op">,</span> marginTop])<span class="op">;</span></span>
<span id="cb13-1335"><a href="#cb13-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1336"><a href="#cb13-1336" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vline <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb13-1337"><a href="#cb13-1337" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="fu">xScale</span>(muhat))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="fu">xScale</span>(muhat))</span>
<span id="cb13-1338"><a href="#cb13-1338" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> marginTop)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> marginTop <span class="op">+</span> innerH)</span>
<span id="cb13-1339"><a href="#cb13-1339" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"currentColor"</span>)<span class="op">;</span></span>
<span id="cb13-1340"><a href="#cb13-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1341"><a href="#cb13-1341" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hline <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb13-1342"><a href="#cb13-1342" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> marginLeft)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> marginLeft <span class="op">+</span> innerW)</span>
<span id="cb13-1343"><a href="#cb13-1343" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="fu">yScale</span>(sigma2hat))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fu">yScale</span>(sigma2hat))</span>
<span id="cb13-1344"><a href="#cb13-1344" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"currentColor"</span>)<span class="op">;</span></span>
<span id="cb13-1345"><a href="#cb13-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1346"><a href="#cb13-1346" aria-hidden="true" tabindex="-1"></a>  wrap<span class="op">.</span><span class="fu">append</span>(svg<span class="op">.</span><span class="fu">node</span>())<span class="op">;</span></span>
<span id="cb13-1347"><a href="#cb13-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1348"><a href="#cb13-1348" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hitbox fills wrapper; subtract margins in code</span></span>
<span id="cb13-1349"><a href="#cb13-1349" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hit <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div style="</span></span>
<span id="cb13-1350"><a href="#cb13-1350" aria-hidden="true" tabindex="-1"></a><span class="vs">    position:absolute; left:0; top:0; width:100%; height:100%;</span></span>
<span id="cb13-1351"><a href="#cb13-1351" aria-hidden="true" tabindex="-1"></a><span class="vs">    cursor:crosshair; background:transparent; touch-action:none;</span></span>
<span id="cb13-1352"><a href="#cb13-1352" aria-hidden="true" tabindex="-1"></a><span class="vs">  "&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb13-1353"><a href="#cb13-1353" aria-hidden="true" tabindex="-1"></a>  wrap<span class="op">.</span><span class="fu">append</span>(hit)<span class="op">;</span></span>
<span id="cb13-1354"><a href="#cb13-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1355"><a href="#cb13-1355" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> state <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> muhat<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> sigma2hat<span class="op">,</span> <span class="dt">dragging</span><span class="op">:</span> <span class="kw">false</span> }<span class="op">;</span></span>
<span id="cb13-1356"><a href="#cb13-1356" aria-hidden="true" tabindex="-1"></a>  wrap<span class="op">.</span><span class="at">value</span> <span class="op">=</span> { <span class="op">...</span>state }<span class="op">;</span>            <span class="co">// &lt;-- expose full state via the view's value</span></span>
<span id="cb13-1357"><a href="#cb13-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1358"><a href="#cb13-1358" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">emit</span>() {</span>
<span id="cb13-1359"><a href="#cb13-1359" aria-hidden="true" tabindex="-1"></a>    wrap<span class="op">.</span><span class="at">value</span> <span class="op">=</span> { <span class="op">...</span>state }<span class="op">;</span>          <span class="co">// &lt;-- assign a fresh object so equality changes</span></span>
<span id="cb13-1360"><a href="#cb13-1360" aria-hidden="true" tabindex="-1"></a>    wrap<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb13-1361"><a href="#cb13-1361" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-1362"><a href="#cb13-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1363"><a href="#cb13-1363" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">setFromEvent</span>(evt) {</span>
<span id="cb13-1364"><a href="#cb13-1364" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> r <span class="op">=</span> hit<span class="op">.</span><span class="fu">getBoundingClientRect</span>()<span class="op">;</span></span>
<span id="cb13-1365"><a href="#cb13-1365" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> px <span class="op">=</span> evt<span class="op">.</span><span class="at">clientX</span> <span class="op">-</span> r<span class="op">.</span><span class="at">left</span><span class="op">,</span> py <span class="op">=</span> evt<span class="op">.</span><span class="at">clientY</span> <span class="op">-</span> r<span class="op">.</span><span class="at">top</span><span class="op">;</span></span>
<span id="cb13-1366"><a href="#cb13-1366" aria-hidden="true" tabindex="-1"></a>    px <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> px <span class="op">-</span> marginLeft)<span class="op">,</span> innerW)<span class="op">;</span></span>
<span id="cb13-1367"><a href="#cb13-1367" aria-hidden="true" tabindex="-1"></a>    py <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> py <span class="op">-</span> marginTop)<span class="op">,</span> innerH)<span class="op">;</span></span>
<span id="cb13-1368"><a href="#cb13-1368" aria-hidden="true" tabindex="-1"></a>    state<span class="op">.</span><span class="at">x</span> <span class="op">=</span> muDomain[<span class="dv">0</span>] <span class="op">+</span> (px <span class="op">/</span> innerW) <span class="op">*</span> (muDomain[<span class="dv">1</span>] <span class="op">-</span> muDomain[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb13-1369"><a href="#cb13-1369" aria-hidden="true" tabindex="-1"></a>    state<span class="op">.</span><span class="at">y</span> <span class="op">=</span> sig2Domain[<span class="dv">1</span>] <span class="op">-</span> (py <span class="op">/</span> innerH) <span class="op">*</span> (sig2Domain[<span class="dv">1</span>] <span class="op">-</span> sig2Domain[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb13-1370"><a href="#cb13-1370" aria-hidden="true" tabindex="-1"></a>    vline<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="fu">xScale</span>(state<span class="op">.</span><span class="at">x</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="fu">xScale</span>(state<span class="op">.</span><span class="at">x</span>))<span class="op">;</span></span>
<span id="cb13-1371"><a href="#cb13-1371" aria-hidden="true" tabindex="-1"></a>    hline<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="fu">yScale</span>(state<span class="op">.</span><span class="at">y</span>))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fu">yScale</span>(state<span class="op">.</span><span class="at">y</span>))<span class="op">;</span></span>
<span id="cb13-1372"><a href="#cb13-1372" aria-hidden="true" tabindex="-1"></a>    <span class="fu">emit</span>()<span class="op">;</span>                              <span class="co">// &lt;-- notify dependents</span></span>
<span id="cb13-1373"><a href="#cb13-1373" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-1374"><a href="#cb13-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1375"><a href="#cb13-1375" aria-hidden="true" tabindex="-1"></a>  <span class="co">// RAF throttle for move</span></span>
<span id="cb13-1376"><a href="#cb13-1376" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> raf <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-1377"><a href="#cb13-1377" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">scheduleUpdate</span>(e) {</span>
<span id="cb13-1378"><a href="#cb13-1378" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (raf) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb13-1379"><a href="#cb13-1379" aria-hidden="true" tabindex="-1"></a>    raf <span class="op">=</span> <span class="fu">requestAnimationFrame</span>(() <span class="kw">=&gt;</span> { raf <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="fu">setFromEvent</span>(e)<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb13-1380"><a href="#cb13-1380" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-1381"><a href="#cb13-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1382"><a href="#cb13-1382" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">setDragging</span>(on) {</span>
<span id="cb13-1383"><a href="#cb13-1383" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (state<span class="op">.</span><span class="at">dragging</span> <span class="op">===</span> on) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb13-1384"><a href="#cb13-1384" aria-hidden="true" tabindex="-1"></a>    state<span class="op">.</span><span class="at">dragging</span> <span class="op">=</span> on<span class="op">;</span></span>
<span id="cb13-1385"><a href="#cb13-1385" aria-hidden="true" tabindex="-1"></a>    <span class="fu">emit</span>()<span class="op">;</span>                              <span class="co">// &lt;-- notify on drag state changes too</span></span>
<span id="cb13-1386"><a href="#cb13-1386" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-1387"><a href="#cb13-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1388"><a href="#cb13-1388" aria-hidden="true" tabindex="-1"></a>  hit<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"pointerdown"</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb13-1389"><a href="#cb13-1389" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setDragging</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb13-1390"><a href="#cb13-1390" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setFromEvent</span>(e)<span class="op">;</span></span>
<span id="cb13-1391"><a href="#cb13-1391" aria-hidden="true" tabindex="-1"></a>    hit<span class="op">.</span><span class="fu">setPointerCapture</span>(e<span class="op">.</span><span class="at">pointerId</span>)<span class="op">;</span></span>
<span id="cb13-1392"><a href="#cb13-1392" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-1393"><a href="#cb13-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1394"><a href="#cb13-1394" aria-hidden="true" tabindex="-1"></a>  hit<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"pointermove"</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb13-1395"><a href="#cb13-1395" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (state<span class="op">.</span><span class="at">dragging</span>) <span class="fu">scheduleUpdate</span>(e)<span class="op">;</span></span>
<span id="cb13-1396"><a href="#cb13-1396" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-1397"><a href="#cb13-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1398"><a href="#cb13-1398" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> endDrag <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">setDragging</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb13-1399"><a href="#cb13-1399" aria-hidden="true" tabindex="-1"></a>  hit<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"pointerup"</span><span class="op">,</span> endDrag)<span class="op">;</span></span>
<span id="cb13-1400"><a href="#cb13-1400" aria-hidden="true" tabindex="-1"></a>  hit<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"pointercancel"</span><span class="op">,</span> endDrag)<span class="op">;</span></span>
<span id="cb13-1401"><a href="#cb13-1401" aria-hidden="true" tabindex="-1"></a>  hit<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"pointerleave"</span><span class="op">,</span> endDrag)<span class="op">;</span></span>
<span id="cb13-1402"><a href="#cb13-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1403"><a href="#cb13-1403" aria-hidden="true" tabindex="-1"></a>  <span class="co">// initial notify</span></span>
<span id="cb13-1404"><a href="#cb13-1404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">queueMicrotask</span>(emit)<span class="op">;</span></span>
<span id="cb13-1405"><a href="#cb13-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1406"><a href="#cb13-1406" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrap<span class="op">;</span>                           <span class="co">// &lt;-- the view element</span></span>
<span id="cb13-1407"><a href="#cb13-1407" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-1408"><a href="#cb13-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1409"><a href="#cb13-1409" aria-hidden="true" tabindex="-1"></a><span class="co">// leftPanel is now { x, y, dragging }</span></span>
<span id="cb13-1410"><a href="#cb13-1410" aria-hidden="true" tabindex="-1"></a>isDragging <span class="op">=</span> leftPanel<span class="op">.</span><span class="at">dragging</span></span>
<span id="cb13-1411"><a href="#cb13-1411" aria-hidden="true" tabindex="-1"></a>numPts     <span class="op">=</span> isDragging <span class="op">?</span> <span class="dv">100</span> <span class="op">:</span> <span class="dv">200</span></span>
<span id="cb13-1412"><a href="#cb13-1412" aria-hidden="true" tabindex="-1"></a>pdfStroke  <span class="op">=</span> isDragging <span class="op">?</span> <span class="dv">1</span>   <span class="op">:</span> <span class="dv">2</span></span>
<span id="cb13-1413"><a href="#cb13-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1414"><a href="#cb13-1414" aria-hidden="true" tabindex="-1"></a><span class="co">// if you want the probe to follow the crosshair:</span></span>
<span id="cb13-1415"><a href="#cb13-1415" aria-hidden="true" tabindex="-1"></a>probeMu   <span class="op">=</span> leftPanel<span class="op">.</span><span class="at">x</span></span>
<span id="cb13-1416"><a href="#cb13-1416" aria-hidden="true" tabindex="-1"></a>probeSig2 <span class="op">=</span> leftPanel<span class="op">.</span><span class="at">y</span></span>
<span id="cb13-1417"><a href="#cb13-1417" aria-hidden="true" tabindex="-1"></a>probeLL <span class="op">=</span> <span class="fu">logLik</span>(probeMu<span class="op">,</span> probeSig2)<span class="op">;</span></span>
<span id="cb13-1418"><a href="#cb13-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1419"><a href="#cb13-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1420"><a href="#cb13-1420" aria-hidden="true" tabindex="-1"></a><span class="co">// --- Right panel ---</span></span>
<span id="cb13-1421"><a href="#cb13-1421" aria-hidden="true" tabindex="-1"></a>normalPdf <span class="op">=</span> (x<span class="op">,</span> mu<span class="op">,</span> sig2) <span class="kw">=&gt;</span> (<span class="dv">1</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> sig2)) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span>((x <span class="op">-</span> mu) <span class="op">**</span> <span class="dv">2</span>) <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> sig2))</span>
<span id="cb13-1422"><a href="#cb13-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1423"><a href="#cb13-1423" aria-hidden="true" tabindex="-1"></a>xExtent <span class="op">=</span> d3<span class="op">.</span><span class="fu">extent</span>(X)</span>
<span id="cb13-1424"><a href="#cb13-1424" aria-hidden="true" tabindex="-1"></a>xPad <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(probeSig2)</span>
<span id="cb13-1425"><a href="#cb13-1425" aria-hidden="true" tabindex="-1"></a>xMin <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(xExtent[<span class="dv">0</span>]<span class="op">,</span> probeMu <span class="op">-</span> xPad)</span>
<span id="cb13-1426"><a href="#cb13-1426" aria-hidden="true" tabindex="-1"></a>xMax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(xExtent[<span class="dv">1</span>]<span class="op">,</span> probeMu <span class="op">+</span> xPad)</span>
<span id="cb13-1427"><a href="#cb13-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1428"><a href="#cb13-1428" aria-hidden="true" tabindex="-1"></a><span class="co">// PDF curve</span></span>
<span id="cb13-1429"><a href="#cb13-1429" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(numPts)<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> xMin <span class="op">+</span> (i <span class="op">/</span> (numPts <span class="op">-</span> <span class="dv">1</span>)) <span class="op">*</span> (xMax <span class="op">-</span> xMin))</span>
<span id="cb13-1430"><a href="#cb13-1430" aria-hidden="true" tabindex="-1"></a>pdfYs <span class="op">=</span> xs<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> <span class="fu">normalPdf</span>(x<span class="op">,</span> probeMu<span class="op">,</span> probeSig2))</span>
<span id="cb13-1431"><a href="#cb13-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1432"><a href="#cb13-1432" aria-hidden="true" tabindex="-1"></a><span class="co">// Density reducer</span></span>
<span id="cb13-1433"><a href="#cb13-1433" aria-hidden="true" tabindex="-1"></a>densityReducer <span class="op">=</span> (values<span class="op">,</span> extent) <span class="kw">=&gt;</span> values<span class="op">.</span><span class="at">length</span> <span class="op">/</span> n <span class="op">/</span> (extent<span class="op">.</span><span class="at">x2</span> <span class="op">-</span> extent<span class="op">.</span><span class="at">x1</span>)</span>
<span id="cb13-1434"><a href="#cb13-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1435"><a href="#cb13-1435" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute yMax</span></span>
<span id="cb13-1436"><a href="#cb13-1436" aria-hidden="true" tabindex="-1"></a>bins_ <span class="op">=</span> d3<span class="op">.</span><span class="fu">bin</span>()<span class="op">.</span><span class="fu">domain</span>([xMin<span class="op">,</span> xMax])<span class="op">.</span><span class="fu">thresholds</span>(bins)(X)<span class="op">;</span></span>
<span id="cb13-1437"><a href="#cb13-1437" aria-hidden="true" tabindex="-1"></a>densities <span class="op">=</span> bins_<span class="op">.</span><span class="fu">map</span>(b <span class="kw">=&gt;</span></span>
<span id="cb13-1438"><a href="#cb13-1438" aria-hidden="true" tabindex="-1"></a>  (b<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> n)) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="fl">1e-9</span><span class="op">,</span> (b<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> b<span class="op">.</span><span class="at">x0</span>))</span>
<span id="cb13-1439"><a href="#cb13-1439" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb13-1440"><a href="#cb13-1440" aria-hidden="true" tabindex="-1"></a>yMax <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(densities)<span class="op">;</span></span>
<span id="cb13-1441"><a href="#cb13-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1442"><a href="#cb13-1442" aria-hidden="true" tabindex="-1"></a>rightPanel <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb13-1443"><a href="#cb13-1443" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> plotW<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> plotH<span class="op">,</span></span>
<span id="cb13-1444"><a href="#cb13-1444" aria-hidden="true" tabindex="-1"></a>  marginLeft<span class="op">,</span> marginBottom<span class="op">,</span></span>
<span id="cb13-1445"><a href="#cb13-1445" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Data"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [xMin<span class="op">,</span> xMax] }<span class="op">,</span></span>
<span id="cb13-1446"><a href="#cb13-1446" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Density"</span> }<span class="op">,</span></span>
<span id="cb13-1447"><a href="#cb13-1447" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb13-1448"><a href="#cb13-1448" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> bodyFont<span class="op">,</span> </span>
<span id="cb13-1449"><a href="#cb13-1449" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="fl">14.</span></span>
<span id="cb13-1450"><a href="#cb13-1450" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> </span>
<span id="cb13-1451"><a href="#cb13-1451" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb13-1452"><a href="#cb13-1452" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rectY</span>(</span>
<span id="cb13-1453"><a href="#cb13-1453" aria-hidden="true" tabindex="-1"></a>      X<span class="op">,</span></span>
<span id="cb13-1454"><a href="#cb13-1454" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">binX</span>(</span>
<span id="cb13-1455"><a href="#cb13-1455" aria-hidden="true" tabindex="-1"></a>        { <span class="dt">y</span><span class="op">:</span> densityReducer }<span class="op">,</span></span>
<span id="cb13-1456"><a href="#cb13-1456" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb13-1457"><a href="#cb13-1457" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">,</span></span>
<span id="cb13-1458"><a href="#cb13-1458" aria-hidden="true" tabindex="-1"></a>          <span class="dt">thresholds</span><span class="op">:</span> bins<span class="op">,</span></span>
<span id="cb13-1459"><a href="#cb13-1459" aria-hidden="true" tabindex="-1"></a>          <span class="dt">inset</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb13-1460"><a href="#cb13-1460" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="st">"var(--brand-red)"</span><span class="op">,</span></span>
<span id="cb13-1461"><a href="#cb13-1461" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span></span>
<span id="cb13-1462"><a href="#cb13-1462" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-1463"><a href="#cb13-1463" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-1464"><a href="#cb13-1464" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb13-1465"><a href="#cb13-1465" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">line</span>(xs<span class="op">.</span><span class="fu">map</span>((x<span class="op">,</span> i) <span class="kw">=&gt;</span> ({ x<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> pdfYs[i] }))<span class="op">,</span> {</span>
<span id="cb13-1466"><a href="#cb13-1466" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb13-1467"><a href="#cb13-1467" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"var(--brand-red)"</span><span class="op">,</span></span>
<span id="cb13-1468"><a href="#cb13-1468" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> pdfStroke</span>
<span id="cb13-1469"><a href="#cb13-1469" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb13-1470"><a href="#cb13-1470" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(X<span class="op">,</span> {</span>
<span id="cb13-1471"><a href="#cb13-1471" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb13-1472"><a href="#cb13-1472" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> yMax <span class="op">*</span> <span class="fl">0.05</span><span class="op">,</span></span>
<span id="cb13-1473"><a href="#cb13-1473" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"var(--brand-red)"</span><span class="op">,</span></span>
<span id="cb13-1474"><a href="#cb13-1474" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb13-1475"><a href="#cb13-1475" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.8</span></span>
<span id="cb13-1476"><a href="#cb13-1476" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb13-1477"><a href="#cb13-1477" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>])<span class="op">,</span></span>
<span id="cb13-1478"><a href="#cb13-1478" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>([probeMu]<span class="op">,</span> { <span class="dt">stroke</span><span class="op">:</span> <span class="st">"currentColor"</span><span class="op">,</span> <span class="dt">strokeDasharray</span><span class="op">:</span> <span class="st">"4,3"</span> })</span>
<span id="cb13-1479"><a href="#cb13-1479" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb13-1480"><a href="#cb13-1480" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb13-1481"><a href="#cb13-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1482"><a href="#cb13-1482" aria-hidden="true" tabindex="-1"></a>probeInfo <span class="op">=</span> <span class="fu">md</span><span class="vs">`**Probe:** </span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\m</span><span class="vs">u=</span><span class="sc">${</span>probeMu<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">\ \s</span><span class="vs">igma^2=</span><span class="sc">${</span>probeSig2<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="sc">}\ \R</span><span class="vs">ightarrow</span><span class="sc">\ \l</span><span class="vs">og f(</span><span class="er">\u</span><span class="vs">nderline{x} </span><span class="sc">\m</span><span class="vs">id </span><span class="sc">\m</span><span class="vs">u, </span><span class="sc">\s</span><span class="vs">igma^2)=</span><span class="sc">${</span>probeLL<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">`</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb13-1483"><a href="#cb13-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1484"><a href="#cb13-1484" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div style="max-width:100%;"&gt;</span></span>
<span id="cb13-1485"><a href="#cb13-1485" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div style="display:flex; gap:</span><span class="sc">${</span>gap<span class="sc">}</span><span class="vs">px; align-items:flex-start; flex-wrap:nowrap; overflow-x:auto;"&gt;</span></span>
<span id="cb13-1486"><a href="#cb13-1486" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div style="flex:0 0 </span><span class="sc">${</span>plotW<span class="sc">}</span><span class="vs">px;"&gt;</span><span class="sc">${</span>viewof leftPanel<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb13-1487"><a href="#cb13-1487" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div style="flex:0 0 </span><span class="sc">${</span>plotW<span class="sc">}</span><span class="vs">px;"&gt;</span><span class="sc">${</span>rightPanel<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb13-1488"><a href="#cb13-1488" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/div&gt;</span></span>
<span id="cb13-1489"><a href="#cb13-1489" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;div style="margin-top:10px; margin-bottom:-10px"&gt;</span><span class="sc">${</span>probeInfo<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb13-1490"><a href="#cb13-1490" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/div&gt;`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-29" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-30" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-31" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-32" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-33" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-34" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-35" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-36" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-37" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-38" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-39" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-40" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-41" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-42" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-43" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb14" data-startfrom="1497" data-source-offset="-66"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1496;"><span id="cb14-1497"><a href="#cb14-1497" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;style&gt;</span></span>
<span id="cb14-1498"><a href="#cb14-1498" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* ---------- Scope all styles to this controls box ---------- */</span></span>
<span id="cb14-1499"><a href="#cb14-1499" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root { </span></span>
<span id="cb14-1500"><a href="#cb14-1500" aria-hidden="true" tabindex="-1"></a><span class="vs">    --ctrl-font: 12px;</span></span>
<span id="cb14-1501"><a href="#cb14-1501" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-size: var(--ctrl-font);</span></span>
<span id="cb14-1502"><a href="#cb14-1502" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1503"><a href="#cb14-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1504"><a href="#cb14-1504" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Dropdown header */</span></span>
<span id="cb14-1505"><a href="#cb14-1505" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root &gt; summary {</span></span>
<span id="cb14-1506"><a href="#cb14-1506" aria-hidden="true" tabindex="-1"></a><span class="vs">    list-style: none; cursor: pointer; user-select: none;</span></span>
<span id="cb14-1507"><a href="#cb14-1507" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: var(--surface, #f1f5f9);</span></span>
<span id="cb14-1508"><a href="#cb14-1508" aria-hidden="true" tabindex="-1"></a><span class="vs">    border: 1px solid var(--border, #e5e7eb);</span></span>
<span id="cb14-1509"><a href="#cb14-1509" aria-hidden="true" tabindex="-1"></a><span class="vs">    border-radius: 10px;</span></span>
<span id="cb14-1510"><a href="#cb14-1510" aria-hidden="true" tabindex="-1"></a><span class="vs">    padding: 8px 10px;</span></span>
<span id="cb14-1511"><a href="#cb14-1511" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-weight: 600; font-size: calc(var(--ctrl-font) + 1px);</span></span>
<span id="cb14-1512"><a href="#cb14-1512" aria-hidden="true" tabindex="-1"></a><span class="vs">    color: var(--fg-strong, #334155);</span></span>
<span id="cb14-1513"><a href="#cb14-1513" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex; align-items: center; gap: 8px;</span></span>
<span id="cb14-1514"><a href="#cb14-1514" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1515"><a href="#cb14-1515" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root &gt; summary::-webkit-details-marker { display: none; }</span></span>
<span id="cb14-1516"><a href="#cb14-1516" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root[open] &gt; summary { border-bottom-left-radius: 0; border-bottom-right-radius: 0; }</span></span>
<span id="cb14-1517"><a href="#cb14-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1518"><a href="#cb14-1518" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Two-column grid (side-by-side) */</span></span>
<span id="cb14-1519"><a href="#cb14-1519" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-grid {</span></span>
<span id="cb14-1520"><a href="#cb14-1520" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: grid;</span></span>
<span id="cb14-1521"><a href="#cb14-1521" aria-hidden="true" tabindex="-1"></a><span class="vs">    grid-template-columns: minmax(260px, 1fr) minmax(260px, 1fr);</span></span>
<span id="cb14-1522"><a href="#cb14-1522" aria-hidden="true" tabindex="-1"></a><span class="vs">    gap: 12px;</span></span>
<span id="cb14-1523"><a href="#cb14-1523" aria-hidden="true" tabindex="-1"></a><span class="vs">    border: 1px solid var(--border, #e5e7eb); border-top: none;</span></span>
<span id="cb14-1524"><a href="#cb14-1524" aria-hidden="true" tabindex="-1"></a><span class="vs">    border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;</span></span>
<span id="cb14-1525"><a href="#cb14-1525" aria-hidden="true" tabindex="-1"></a><span class="vs">    padding: 10px;</span></span>
<span id="cb14-1526"><a href="#cb14-1526" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: var(--surface-weak, #fafafa);</span></span>
<span id="cb14-1527"><a href="#cb14-1527" aria-hidden="true" tabindex="-1"></a><span class="vs">    overflow-x: auto;</span></span>
<span id="cb14-1528"><a href="#cb14-1528" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1529"><a href="#cb14-1529" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col { min-width: 260px; }</span></span>
<span id="cb14-1530"><a href="#cb14-1530" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col h4 {</span></span>
<span id="cb14-1531"><a href="#cb14-1531" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin: 0 0 6px 0;</span></span>
<span id="cb14-1532"><a href="#cb14-1532" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-size: var(--ctrl-font); font-weight: 700;</span></span>
<span id="cb14-1533"><a href="#cb14-1533" aria-hidden="true" tabindex="-1"></a><span class="vs">    color: var(--fg-muted, #475569);</span></span>
<span id="cb14-1534"><a href="#cb14-1534" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1535"><a href="#cb14-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1536"><a href="#cb14-1536" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* ---- Align label &amp; slider (form-level grid) ---- */</span></span>
<span id="cb14-1537"><a href="#cb14-1537" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col form {</span></span>
<span id="cb14-1538"><a href="#cb14-1538" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: grid !important;</span></span>
<span id="cb14-1539"><a href="#cb14-1539" aria-hidden="true" tabindex="-1"></a><span class="vs">    grid-template-columns: minmax(150px, auto) 1fr; /* label | inputs */</span></span>
<span id="cb14-1540"><a href="#cb14-1540" aria-hidden="true" tabindex="-1"></a><span class="vs">    align-items: center;         /* vertical centring */</span></span>
<span id="cb14-1541"><a href="#cb14-1541" aria-hidden="true" tabindex="-1"></a><span class="vs">    column-gap: 10px;</span></span>
<span id="cb14-1542"><a href="#cb14-1542" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-size: var(--ctrl-font) !important;</span></span>
<span id="cb14-1543"><a href="#cb14-1543" aria-hidden="true" tabindex="-1"></a><span class="vs">    line-height: 1.25;</span></span>
<span id="cb14-1544"><a href="#cb14-1544" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin: 6px 0;</span></span>
<span id="cb14-1545"><a href="#cb14-1545" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1546"><a href="#cb14-1546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1547"><a href="#cb14-1547" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Label: kill default &lt;p&gt; margin; align KaTeX + text */</span></span>
<span id="cb14-1548"><a href="#cb14-1548" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col form &gt; label {</span></span>
<span id="cb14-1549"><a href="#cb14-1549" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin: 0 !important;</span></span>
<span id="cb14-1550"><a href="#cb14-1550" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex; align-items: center; gap: 8px;</span></span>
<span id="cb14-1551"><a href="#cb14-1551" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-size: var(--ctrl-font) !important;</span></span>
<span id="cb14-1552"><a href="#cb14-1552" aria-hidden="true" tabindex="-1"></a><span class="vs">    color: var(--fg-muted, #475569);</span></span>
<span id="cb14-1553"><a href="#cb14-1553" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-weight: 600;</span></span>
<span id="cb14-1554"><a href="#cb14-1554" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1555"><a href="#cb14-1555" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col form &gt; label p { margin: 0 !important; }</span></span>
<span id="cb14-1556"><a href="#cb14-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1557"><a href="#cb14-1557" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Inputs wrapper (auto-generated, e.g. .oi-*-input): align number + slider */</span></span>
<span id="cb14-1558"><a href="#cb14-1558" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col form &gt; [class$="-input"],</span></span>
<span id="cb14-1559"><a href="#cb14-1559" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col form &gt; [class*="-input"] {</span></span>
<span id="cb14-1560"><a href="#cb14-1560" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex; align-items: center; gap: 8px;</span></span>
<span id="cb14-1561"><a href="#cb14-1561" aria-hidden="true" tabindex="-1"></a><span class="vs">    min-height: 22px;</span></span>
<span id="cb14-1562"><a href="#cb14-1562" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1563"><a href="#cb14-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1564"><a href="#cb14-1564" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Number input normalisation */</span></span>
<span id="cb14-1565"><a href="#cb14-1565" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col input[type="number"] {</span></span>
<span id="cb14-1566"><a href="#cb14-1566" aria-hidden="true" tabindex="-1"></a><span class="vs">    height: 24px; padding: 2px 6px;</span></span>
<span id="cb14-1567"><a href="#cb14-1567" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-size: var(--ctrl-font);</span></span>
<span id="cb14-1568"><a href="#cb14-1568" aria-hidden="true" tabindex="-1"></a><span class="vs">    border: 1px solid var(--border, #e5e7eb); border-radius: 6px;</span></span>
<span id="cb14-1569"><a href="#cb14-1569" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: var(--surface, #f1f5f9); color: var(--fg-strong, #334155);</span></span>
<span id="cb14-1570"><a href="#cb14-1570" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1571"><a href="#cb14-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1572"><a href="#cb14-1572" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Slider styling */</span></span>
<span id="cb14-1573"><a href="#cb14-1573" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col input[type="range"] {</span></span>
<span id="cb14-1574"><a href="#cb14-1574" aria-hidden="true" tabindex="-1"></a><span class="vs">    -webkit-appearance: none; appearance: none;</span></span>
<span id="cb14-1575"><a href="#cb14-1575" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: 100%; height: 18px; background: transparent;</span></span>
<span id="cb14-1576"><a href="#cb14-1576" aria-hidden="true" tabindex="-1"></a><span class="vs">    vertical-align: middle;</span></span>
<span id="cb14-1577"><a href="#cb14-1577" aria-hidden="true" tabindex="-1"></a><span class="vs">    accent-color: var(--brand-teal, #55C3CB);</span></span>
<span id="cb14-1578"><a href="#cb14-1578" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1579"><a href="#cb14-1579" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col input[type="range"]::-webkit-slider-runnable-track {</span></span>
<span id="cb14-1580"><a href="#cb14-1580" aria-hidden="true" tabindex="-1"></a><span class="vs">    height: 4px; border-radius: 999px;</span></span>
<span id="cb14-1581"><a href="#cb14-1581" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: color-mix(in srgb, var(--brand-teal, #55C3CB) 35%, transparent);</span></span>
<span id="cb14-1582"><a href="#cb14-1582" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1583"><a href="#cb14-1583" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col input[type="range"]::-webkit-slider-thumb {</span></span>
<span id="cb14-1584"><a href="#cb14-1584" aria-hidden="true" tabindex="-1"></a><span class="vs">    -webkit-appearance: none; appearance: none;</span></span>
<span id="cb14-1585"><a href="#cb14-1585" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: 12px; height: 12px; border-radius: 50%;</span></span>
<span id="cb14-1586"><a href="#cb14-1586" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: var(--brand-teal, #55C3CB); border: 0; margin-top: -4px; /* centre thumb over 4px track */</span></span>
<span id="cb14-1587"><a href="#cb14-1587" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1588"><a href="#cb14-1588" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col input[type="range"]::-moz-range-track {</span></span>
<span id="cb14-1589"><a href="#cb14-1589" aria-hidden="true" tabindex="-1"></a><span class="vs">    height: 4px; border-radius: 999px;</span></span>
<span id="cb14-1590"><a href="#cb14-1590" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: color-mix(in srgb, var(--brand-teal, #55C3CB) 35%, transparent);</span></span>
<span id="cb14-1591"><a href="#cb14-1591" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1592"><a href="#cb14-1592" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .controls-col input[type="range"]::-moz-range-thumb {</span></span>
<span id="cb14-1593"><a href="#cb14-1593" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: 12px; height: 12px; border-radius: 50%;</span></span>
<span id="cb14-1594"><a href="#cb14-1594" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: var(--brand-teal, #55C3CB); border: 0;</span></span>
<span id="cb14-1595"><a href="#cb14-1595" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1596"><a href="#cb14-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1597"><a href="#cb14-1597" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Button */</span></span>
<span id="cb14-1598"><a href="#cb14-1598" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .btn-resim button {</span></span>
<span id="cb14-1599"><a href="#cb14-1599" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: var(--brand-teal, #55C3CB); color: #fff;</span></span>
<span id="cb14-1600"><a href="#cb14-1600" aria-hidden="true" tabindex="-1"></a><span class="vs">    border: none; border-radius: 6px; padding: 6px 12px;</span></span>
<span id="cb14-1601"><a href="#cb14-1601" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-weight: 600; font-size: var(--ctrl-font); cursor: pointer;</span></span>
<span id="cb14-1602"><a href="#cb14-1602" aria-hidden="true" tabindex="-1"></a><span class="vs">    transition: filter 120ms ease, background-color 120ms ease;</span></span>
<span id="cb14-1603"><a href="#cb14-1603" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1604"><a href="#cb14-1604" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root .btn-resim button:hover {</span></span>
<span id="cb14-1605"><a href="#cb14-1605" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: color-mix(in srgb, var(--brand-teal, #55C3CB) 88%, black);</span></span>
<span id="cb14-1606"><a href="#cb14-1606" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1607"><a href="#cb14-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1608"><a href="#cb14-1608" aria-hidden="true" tabindex="-1"></a><span class="vs">  /* Chevron */</span></span>
<span id="cb14-1609"><a href="#cb14-1609" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root &gt; summary::before {</span></span>
<span id="cb14-1610"><a href="#cb14-1610" aria-hidden="true" tabindex="-1"></a><span class="vs">    content: ""; display: inline-block; margin-right: 8px; width: 0; height: 0;</span></span>
<span id="cb14-1611"><a href="#cb14-1611" aria-hidden="true" tabindex="-1"></a><span class="vs">    border-style: solid; border-width: 3px 0 3px 6px;</span></span>
<span id="cb14-1612"><a href="#cb14-1612" aria-hidden="true" tabindex="-1"></a><span class="vs">    border-color: transparent transparent transparent var(--fg-strong);</span></span>
<span id="cb14-1613"><a href="#cb14-1613" aria-hidden="true" tabindex="-1"></a><span class="vs">    transform: rotate(0deg); transform-origin: 3px 50%; transition: transform 50ms ease;</span></span>
<span id="cb14-1614"><a href="#cb14-1614" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-1615"><a href="#cb14-1615" aria-hidden="true" tabindex="-1"></a><span class="vs">  details.controls-root[open] &gt; summary::before { transform: rotate(90deg); }</span></span>
<span id="cb14-1616"><a href="#cb14-1616" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb15" data-startfrom="1619" data-source-offset="-4898"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1618;"><span id="cb15-1619"><a href="#cb15-1619" aria-hidden="true" tabindex="-1"></a>viewof controls <span class="op">=</span> {</span>
<span id="cb15-1620"><a href="#cb15-1620" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> resimBtn <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"Resimulate data"</span>)<span class="op">;</span></span>
<span id="cb15-1621"><a href="#cb15-1621" aria-hidden="true" tabindex="-1"></a>  resimBtn<span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">add</span>(<span class="st">"btn-resim"</span>)<span class="op">;</span></span>
<span id="cb15-1622"><a href="#cb15-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1623"><a href="#cb15-1623" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> leftForm <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb15-1624"><a href="#cb15-1624" aria-hidden="true" tabindex="-1"></a>    <span class="dt">n</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">400</span>]<span class="op">,</span> { <span class="dt">value</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`n`</span><span class="sc">}</span><span class="vs">`</span> })<span class="op">,</span></span>
<span id="cb15-1625"><a href="#cb15-1625" aria-hidden="true" tabindex="-1"></a>    <span class="dt">trueMu</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">3</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">,</span> { <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.05</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\m</span><span class="vs">u_{</span><span class="sc">\t</span><span class="vs">ext{true}}`</span><span class="sc">}</span><span class="vs">`</span> })<span class="op">,</span></span>
<span id="cb15-1626"><a href="#cb15-1626" aria-hidden="true" tabindex="-1"></a>    <span class="dt">trueSigma</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.3</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">,</span> { <span class="dt">value</span><span class="op">:</span> <span class="fl">1.2</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.05</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\s</span><span class="vs">igma_{</span><span class="sc">\t</span><span class="vs">ext{true}}`</span><span class="sc">}</span><span class="vs">`</span> })</span>
<span id="cb15-1627"><a href="#cb15-1627" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> { <span class="dt">submit</span><span class="op">:</span> <span class="kw">false</span> })<span class="op">;</span></span>
<span id="cb15-1628"><a href="#cb15-1628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1629"><a href="#cb15-1629" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> rightForm <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>({</span>
<span id="cb15-1630"><a href="#cb15-1630" aria-hidden="true" tabindex="-1"></a>    <span class="dt">muHalfWidth</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">5</span>]<span class="op">,</span> { <span class="dt">value</span><span class="op">:</span> <span class="fl">2.5</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.05</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\m</span><span class="vs">u</span><span class="sc">\t</span><span class="vs">ext{-range}`</span><span class="sc">}</span><span class="vs">`</span> })<span class="op">,</span></span>
<span id="cb15-1631"><a href="#cb15-1631" aria-hidden="true" tabindex="-1"></a>    <span class="dt">sig2Max</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.2</span><span class="op">,</span> <span class="dv">6</span>]<span class="op">,</span> { <span class="dt">value</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.05</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\s</span><span class="vs">igma^2</span><span class="sc">\t</span><span class="vs">ext{ max}`</span><span class="sc">}</span><span class="vs">`</span> })<span class="op">,</span></span>
<span id="cb15-1632"><a href="#cb15-1632" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gridN</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">25</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span> { <span class="dt">value</span><span class="op">:</span> <span class="dv">81</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Grid size"</span> })<span class="op">,</span></span>
<span id="cb15-1633"><a href="#cb15-1633" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bins</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">10</span><span class="op">,</span> <span class="dv">60</span>]<span class="op">,</span> { <span class="dt">value</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Histogram bins"</span> })</span>
<span id="cb15-1634"><a href="#cb15-1634" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> { <span class="dt">submit</span><span class="op">:</span> <span class="kw">false</span> })<span class="op">;</span></span>
<span id="cb15-1635"><a href="#cb15-1635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1636"><a href="#cb15-1636" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> <span class="bu">root</span> <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;details class="controls-root" open&gt;</span></span>
<span id="cb15-1637"><a href="#cb15-1637" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;summary&gt;Simulation controls&lt;/summary&gt;</span></span>
<span id="cb15-1638"><a href="#cb15-1638" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class="controls-grid"&gt;</span></span>
<span id="cb15-1639"><a href="#cb15-1639" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class="controls-col"&gt;&lt;h4&gt;Data &amp; truth&lt;/h4&gt;&lt;/div&gt;</span></span>
<span id="cb15-1640"><a href="#cb15-1640" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class="controls-col"&gt;&lt;h4&gt;Grid &amp; display&lt;/h4&gt;&lt;/div&gt;</span></span>
<span id="cb15-1641"><a href="#cb15-1641" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb15-1642"><a href="#cb15-1642" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/details&gt;`</span><span class="op">;</span></span>
<span id="cb15-1643"><a href="#cb15-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1644"><a href="#cb15-1644" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> grid <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">".controls-grid"</span>)<span class="op">;</span></span>
<span id="cb15-1645"><a href="#cb15-1645" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> leftCol <span class="op">=</span> grid<span class="op">.</span><span class="at">children</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb15-1646"><a href="#cb15-1646" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> rightCol <span class="op">=</span> grid<span class="op">.</span><span class="at">children</span>[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb15-1647"><a href="#cb15-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1648"><a href="#cb15-1648" aria-hidden="true" tabindex="-1"></a>  leftCol<span class="op">.</span><span class="fu">append</span>(leftForm)<span class="op">;</span></span>
<span id="cb15-1649"><a href="#cb15-1649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1650"><a href="#cb15-1650" aria-hidden="true" tabindex="-1"></a>  rightCol<span class="op">.</span><span class="fu">append</span>(rightForm)<span class="op">;</span></span>
<span id="cb15-1651"><a href="#cb15-1651" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> btnWrap <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div style="display:flex; justify-content:flex-start; margin-top:6px;"&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb15-1652"><a href="#cb15-1652" aria-hidden="true" tabindex="-1"></a>  btnWrap<span class="op">.</span><span class="fu">append</span>(resimBtn)<span class="op">;</span></span>
<span id="cb15-1653"><a href="#cb15-1653" aria-hidden="true" tabindex="-1"></a>  rightCol<span class="op">.</span><span class="fu">append</span>(btnWrap)<span class="op">;</span></span>
<span id="cb15-1654"><a href="#cb15-1654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1655"><a href="#cb15-1655" aria-hidden="true" tabindex="-1"></a>  <span class="co">// --- Merge values</span></span>
<span id="cb15-1656"><a href="#cb15-1656" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> getValue <span class="op">=</span> () <span class="kw">=&gt;</span> ({ <span class="op">...</span>leftForm<span class="op">.</span><span class="at">value</span><span class="op">,</span> <span class="op">...</span>rightForm<span class="op">.</span><span class="at">value</span><span class="op">,</span> <span class="dt">resim</span><span class="op">:</span> resimBtn<span class="op">.</span><span class="at">value</span> })<span class="op">;</span></span>
<span id="cb15-1657"><a href="#cb15-1657" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> update <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb15-1658"><a href="#cb15-1658" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="fu">getValue</span>()<span class="op">;</span></span>
<span id="cb15-1659"><a href="#cb15-1659" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb15-1660"><a href="#cb15-1660" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb15-1661"><a href="#cb15-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1662"><a href="#cb15-1662" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ONE listener for all children (sliders + button)</span></span>
<span id="cb15-1663"><a href="#cb15-1663" aria-hidden="true" tabindex="-1"></a>  grid<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> update)<span class="op">;</span></span>
<span id="cb15-1664"><a href="#cb15-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1665"><a href="#cb15-1665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">queueMicrotask</span>(update)<span class="op">;</span></span>
<span id="cb15-1666"><a href="#cb15-1666" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">root</span><span class="op">;</span></span>
<span id="cb15-1667"><a href="#cb15-1667" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-1668"><a href="#cb15-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1669"><a href="#cb15-1669" aria-hidden="true" tabindex="-1"></a><span class="co">// --- Expose reactive vars</span></span>
<span id="cb15-1670"><a href="#cb15-1670" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> controls<span class="op">.</span><span class="at">n</span></span>
<span id="cb15-1671"><a href="#cb15-1671" aria-hidden="true" tabindex="-1"></a>trueMu <span class="op">=</span> controls<span class="op">.</span><span class="at">trueMu</span></span>
<span id="cb15-1672"><a href="#cb15-1672" aria-hidden="true" tabindex="-1"></a>trueSigma <span class="op">=</span> controls<span class="op">.</span><span class="at">trueSigma</span></span>
<span id="cb15-1673"><a href="#cb15-1673" aria-hidden="true" tabindex="-1"></a>muHalfWidth <span class="op">=</span> controls<span class="op">.</span><span class="at">muHalfWidth</span></span>
<span id="cb15-1674"><a href="#cb15-1674" aria-hidden="true" tabindex="-1"></a>sig2Max <span class="op">=</span> controls<span class="op">.</span><span class="at">sig2Max</span></span>
<span id="cb15-1675"><a href="#cb15-1675" aria-hidden="true" tabindex="-1"></a>gridN <span class="op">=</span> controls<span class="op">.</span><span class="at">gridN</span></span>
<span id="cb15-1676"><a href="#cb15-1676" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> controls<span class="op">.</span><span class="at">bins</span></span>
<span id="cb15-1677"><a href="#cb15-1677" aria-hidden="true" tabindex="-1"></a>resim <span class="op">=</span> controls<span class="op">.</span><span class="at">resim</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-10" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</details>
<hr>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>✨ Big picture:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>The <span class="xref-no-num"><a href="#def-likelihood" class="quarto-xref">likelihood function&nbsp;<span>5.1</span></a></span> tells us how <strong>plausible</strong> each parameter value is, given the data.</li>
<li>The <span class="xref-no-num"><a href="#def-mle" class="quarto-xref">MLE&nbsp;<span>5.3</span></a></span> chooses the parameter value that makes the observed data most likely.</li>
<li>Later, in Bayesian inference, we will combine the likelihood with a <strong>prior distribution</strong> on <span class="math inline">\theta</span> to obtain a <strong>posterior distribution</strong>.</li>
</ul>
</div>
</div>
<section id="computing-univariate-mles" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="computing-univariate-mles"><span class="header-section-number">5.3.1</span> Computing Univariate MLEs</h3>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-bern-mle" class="example theorem">
<p><span class="theorem-title"><strong>Example 5.8 (Bernoulli MLE)</strong></span> From <a href="#exm-bern-likelihood" class="quarto-xref">Example&nbsp;<span>5.1</span></a>, we saw that the likelihood function for <span class="math inline">n</span> i.i.d. <span class="math inline">Y_i \sim \mathrm{Bernoulli}(p)</span> observations was</p>
<p><span class="math display">
L(p;\underline{y}) = p^{n\bar{y}}(1-p)^{n(1-\bar{y})}.
</span></p>
<p>Compute the MLE of <span class="math inline">p</span>.</p>
<details>
  <summary><strong> Solution </strong></summary>
<p>From the provided likelihood, we first compute the <strong>log-likelihood</strong>:</p>
<p><span class="math display">
\ell(p \mid \underline{x})
= \Big(\sum_i x_i \Big)\log p + \Big(n-\sum_i x_i\Big)\log(1-p).
</span> Differentiate and solve: <span class="math display">
\frac{\partial}{\partial p}\ell(p \mid \underline{x})
= \frac{\sum_i x_i}{p} - \frac{n - \sum_i x_i}{1-p} = 0.
</span> This gives <span class="math display">
\hat{p}_{\text{MLE}} = \frac{1}{n}\sum_{i=1}^n x_i,
</span></p>
<p>the <strong>sample proportion of successes</strong>.</p>
</details>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-binom-mle-single" class="example theorem">
<p><span class="theorem-title"><strong>Example 5.9 (Binomial MLE)</strong></span> Suppose we have a <strong>single</strong> <span class="xref-no-num"><a href="../../appendix/formula-sheet.html#sec-binom" class="quarto-xref">Binomial&nbsp;<span>1.2</span></a></span> observation <span class="math display">
X \sim \textrm{Bin}(n, \theta).
</span> Derive the <strong>maximum likelihood estimator</strong> of <span class="math inline">\theta</span>.</p>
<details>
  <summary><strong> Solution </strong></summary>
<p>Since we only have <strong>one</strong> observation, the likelihood function is just the distribution of the observation:</p>
<p><span class="math display">
L(\theta ; x) = f(x \mid \theta) = \binom{n}{x} \theta^x(1-\theta)^{n-x}.
</span></p>
<p>The log-likelihood is thus</p>
<p><span class="math display">
\ell(\theta; x) = \log f(x \mid \theta) = \log\left(\binom{n}{x}\right) + x\log\theta + (n-x)\log(1-\theta).
</span></p>
<p>Differentiating, we obtain</p>
<p><span class="math display">
\frac{\partial}{\partial \theta}\,\ell(\theta;x)
= \frac{x}{\theta} - \frac{n-x}{1-\theta}.
</span></p>
<p>Setting the derivative to zero and solving,</p>
<p><span class="math display">
\frac{x}{\theta} = \frac{n-x}{1-\theta}
\;\Longrightarrow\;
x(1-\theta) = (n-x)\theta
\;\Longrightarrow\;
x = n\theta
\;\Longrightarrow\;
\hat\theta = \frac{x}{n}.
</span></p>
<p>To confirm it is a maximum, the second derivative is</p>
<p><span class="math display">
\frac{\partial^2}{\partial \theta^2}\,\ell(\theta;x)
= -\frac{x}{\theta^2} - \frac{n-x}{(1-\theta)^2} &lt; 0
\quad \text{for } \theta\in(0,1),
</span></p>
<p>so <span class="math inline">\hat\theta=x/n</span> maximises the likelihood. (At the boundaries, if <span class="math inline">x=0</span> then <span class="math inline">\hat\theta=0</span>; if <span class="math inline">x=n</span> then <span class="math inline">\hat\theta=1</span>.)</p>
</details>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-binom-mle" class="example theorem">
<p><span class="theorem-title"><strong>Example 5.10 (Another Binomial MLE)</strong></span> Suppose we have <span class="math inline">n</span> <strong>independent</strong> Binomial data: <span class="math display">
X_i \sim \textrm{Bin}(k_i, \theta).
</span> Note here that each Binomial data has a different number of Bernoulli trials <span class="math inline">k_i</span>, which are known.</p>
<p>Derive the <strong>maximum likelihood estimator</strong> of <span class="math inline">\theta</span>.</p>
<details>
  <summary><strong> Solution </strong></summary>
<p>The likelihood function is the joint distribution of the <span class="math inline">n</span> observations</p>
<p><span class="math display">
f(\underline{x} \mid \theta) = \prod_{i=1}^n \binom{k_i}{x_i} \theta^{x_i}(1-\theta)^{k_i - x_i}.
</span></p>
<p>The log-likelihood is</p>
<p><span class="math display">
\ell(\theta;\underline{x})
= \sum_{i=1}^n \log\binom{k_i}{x_i}
+ \Big(\sum_{i=1}^n x_i\Big)\log\theta
+ \Big(\sum_{i=1}^n (k_i-x_i)\Big)\log(1-\theta).
</span></p>
<p>Let <span class="math inline">S=\sum_{i=1}^n x_i</span> (total successes) and <span class="math inline">K=\sum_{i=1}^n k_i</span> (total trials). Then</p>
<p><span class="math display">
\frac{\partial}{\partial\theta}\ell(\theta;\underline{x})
= \frac{S}{\theta} - \frac{K-S}{1-\theta}.
</span></p>
<p>Setting to zero and solving:</p>
<p><span class="math display">
\frac{S}{\theta} = \frac{K-S}{1-\theta}
\;\Longrightarrow\;
S(1-\theta)=(K-S)\theta
\;\Longrightarrow\;
S=K\theta
\;\Longrightarrow\;
\hat\theta = \frac{S}{K}=\frac{\sum_{i=1}^n x_i}{\sum_{i=1}^n k_i}.
</span></p>
<p>The second derivative is</p>
<p><span class="math display">
\frac{\partial^2}{\partial\theta^2}\ell(\theta;\underline{x})
= -\frac{S}{\theta^2}-\frac{K-S}{(1-\theta)^2}&lt;0
\quad \text{for } \theta\in(0,1),
</span></p>
<p>so this is a (strict) maximum. Boundary cases: if <span class="math inline">S=0</span> then <span class="math inline">\hat\theta=0</span>; if <span class="math inline">S=K</span> then <span class="math inline">\hat\theta=1</span>.</p>
</details>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-pois-mle" class="example theorem">
<p><span class="theorem-title"><strong>Example 5.11 (Poisson MLE)</strong></span> From <a href="#exm-poisson-likelihood" class="quarto-xref">Example&nbsp;<span>5.4</span></a>, we saw that the likelihood function for <span class="math inline">n</span> i.i.d. <span class="math inline">V_i \sim \mathrm{Poisson}(\alpha)</span> observations was <span class="math display">
L(\alpha ;\underline{v}) = \alpha^{n\bar{v}} e^{-n\alpha} \prod_{i=1}^n \frac{1}{v_i!}.
</span></p>
<p>Derive the <strong>maximum likelihood estimator</strong> of <span class="math inline">\alpha</span> and determine its <strong>expected value</strong> and <strong>variance</strong>.</p>
<details>
  <summary><strong> Solution </strong></summary>
<p><strong>Step 1: Computing MLE</strong></p>
<p>The log-likelihood is</p>
<p><span class="math display">
\ell(\alpha;\underline{v})
= n\bar v \log \alpha - n\alpha - \sum_{i=1}^n \log(v_i!),
\qquad \alpha \ge 0.
</span></p>
<p>Differentiate w.r.t. <span class="math inline">\alpha</span>:</p>
<p><span class="math display">
\frac{\partial}{\partial \alpha}\,\ell(\alpha;\underline{v})
= \frac{n\bar v}{\alpha} - n.
</span></p>
<p>Set to zero and solve:</p>
<p><span class="math display">
\frac{n\bar v}{\alpha} - n = 0
\;\Longrightarrow\;
\hat\alpha = \bar v = \frac{1}{n}\sum_{i=1}^n v_i.
</span></p>
<p>Second derivative:</p>
<p><span class="math display">
\frac{\partial^2}{\partial \alpha^2}\,\ell(\alpha;\underline{v})
= -\frac{n\bar v}{\alpha^2} &lt; 0 \quad (\alpha&gt;0),
</span></p>
<p>so this is a maximum. Boundary case: if all <span class="math inline">v_i=0</span> (so <span class="math inline">\bar v=0</span>), the likelihood <span class="math inline">L(\alpha)=e^{-n\alpha}</span> is maximised at <span class="math inline">\hat\alpha=0</span>.</p>
<p>Therefore, the maximum likelihood <em>estimator</em> is:</p>
<p><span class="math display">
\hat\alpha = \bar{V}
</span></p>
<hr>
<p><strong>Step 2: Mean and Variance of <span class="math inline">\hat\alpha</span></strong></p>
<p>Recall <span class="math inline">\hat\alpha=\bar V=\frac{1}{n}\sum_{i=1}^n V_i</span> with <span class="math inline">V_i \stackrel{\text{i.i.d.}}{\sim} \mathrm{Poisson}(\alpha)</span>.</p>
<p><em>Mean</em>: <span class="math display">
\mathrm{E}[\hat\alpha]
= \frac{1}{n}\sum_{i=1}^n \mathrm{E}[V_i]
= \frac{1}{n}\cdot n\alpha
= \alpha.
</span></p>
<p><em>Variance</em> (using independence): <span class="math display">
\operatorname{Var}[\hat\alpha]
= \operatorname{Var}\!\left(\frac{1}{n}\sum_{i=1}^n V_i\right)
= \frac{1}{n^2}\sum_{i=1}^n \operatorname{Var}(V_i)
= \frac{1}{n^2}\cdot n\alpha
= \frac{\alpha}{n}.
</span></p>
<p>Here we used <span class="math inline">\operatorname{Var}(V_i)=\mathrm{E}[V_i]=\alpha</span> for the <span class="math inline">\mathrm{Poisson}(\alpha)</span> distribution.</p>
</details>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-normal-mu-mle" class="example theorem">
<p><span class="theorem-title"><strong>Example 5.12 (Normal MLE for <span class="math inline">\mu</span>)</strong></span> From <a href="#exm-normal-likelihood" class="quarto-xref">Example&nbsp;<span>5.3</span></a>, we saw that the likelihood function for <span class="math inline">n</span> i.i.d. <span class="math inline">T_i \sim \mathcal{N}(\mu, \gamma)</span> observations was <span class="math display">
  L(\mu, \gamma ;\underline{t}) = (2\pi \gamma)^{-\tfrac{n}{2}} \exp\left\{ -\frac{1}{2\gamma} \sum_{i=1}^n  (t_i - \mu)^2 \right\}.
</span></p>
<p>Suppose that the variance <span class="math inline">\gamma</span> is <em>known</em>. Determine the <strong>MLE</strong> of <span class="math inline">\mu</span>.</p>
<details>
  <summary><strong> Solution </strong></summary>
<p>The log-likelihood (as a function of <span class="math inline">\mu</span>) is</p>
<p><span class="math display">
\ell(\mu;\underline{t})
= -\frac{n}{2}\log(2\pi\gamma) - \frac{1}{2\gamma}\sum_{i=1}^n (t_i-\mu)^2.
</span></p>
<p>Differentiating w.r.t. <span class="math inline">\mu</span>,</p>
<p><span class="math display">
\frac{\partial}{\partial\mu}\,\ell(\mu;\underline{t})
= -\frac{1}{2\gamma}\cdot 2\sum_{i=1}^n (t_i-\mu)(-1)
= \frac{1}{\gamma}\sum_{i=1}^n (t_i-\mu).
</span></p>
<p>Setting equal to <span class="math inline">0</span> and solve:</p>
<p><span class="math display">
\sum_{i=1}^n (t_i-\mu)=0
\;\Longrightarrow\;
n\mu=\sum_{i=1}^n t_i
\;\Longrightarrow\;
\hat\mu=\bar{t}=\frac{1}{n}\sum_{i=1}^n t_i.
</span></p>
<p>The second derivative is</p>
<p><span class="math display">
\frac{\partial^2}{\partial\mu^2}\,\ell(\mu;\underline{t})
= -\frac{n}{\gamma}&lt;0,
</span></p>
<p>so <span class="math inline">\hat\mu=\bar{t}</span> maximises the likelihood.</p>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="computing-multivariate-mles" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="computing-multivariate-mles"><span class="header-section-number">5.3.2</span> Computing Multivariate MLEs</h3>
<p>In many practical problems, the statistical model involves more than a single parameter <span class="math inline">\theta</span>. In this case, we work with a <strong>vector of parameters</strong></p>
<p><span class="math display">
\underline{\theta} = (\theta_1, \ldots, \theta_p).
</span></p>
<p>The definitions of the likelihood function and the MLE extend in a natural way. The main difference is that the optimisation problem now requires solving <strong>simultaneous equations</strong> for each parameter.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-multivar-mle" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5.5 (Multivariate MLE)</strong></span> Let <span class="math inline">L(\underline{\theta}; \underline{x})</span> and <span class="math inline">\ell(\underline{\theta}; \underline{x})</span> denote the <strong>likelihood</strong> and <strong>log-likelihood</strong> functions respectively, based on observations <span class="math inline">\underline{x} = (x_1,\ldots,x_n)</span> from a model with parameters <span class="math inline">\underline{\theta} = (\theta_1,\ldots,\theta_p)</span>.</p>
<p>The maximum likelihood estimator <span class="math inline">\hat{\underline{\theta}}</span> is obtained by solving the system</p>
<p><span class="math display">
\nabla_{\underline{\theta}} \,\ell(\underline{\theta}; \underline{x})
\;=\;
\begin{pmatrix}
\dfrac{\partial}{\partial \theta_1}\,\ell(\underline{\theta}; \underline{x}) \\
\dfrac{\partial}{\partial \theta_2}\,\ell(\underline{\theta}; \underline{x}) \\
\vdots \\
\dfrac{\partial}{\partial \theta_p}\,\ell(\underline{\theta}; \underline{x})
\end{pmatrix}
=
\begin{pmatrix}
0 \\ 0 \\ \vdots \\ 0
\end{pmatrix}.
</span></p>
</div>
</div>
</div>
</div>
<p>In general, solving this system of equations cannot be done in closed form, so in practice we usually rely on <em>numerical optimisation methods</em> to approximate the MLE. We will not cover these methods in this course. Instead, we will focus on a few important cases where the MLE can be worked out explicitly.</p>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-normal-full-mle" class="example theorem">
<p><span class="theorem-title"><strong>Example 5.13 (Normal MLE for <span class="math inline">\mu</span> and <span class="math inline">\gamma</span>)</strong></span> Suppose we have <span class="math inline">n</span> i.i.d. observations <span class="math inline">X_i \sim \mathcal{N}(\mu, \gamma)</span>.</p>
<p>Determine the <strong>maximum likelihood estimators</strong> for <span class="math inline">\mu</span> and <span class="math inline">\gamma</span>.</p>
<details>
  <summary><strong> Solution </strong></summary>
<p><strong>Step 1. Compute log-likelihood:</strong></p>
<p>The likelihood function is a relabelling of the data terms in <a href="#exm-normal-likelihood" class="quarto-xref">Example&nbsp;<span>5.3</span></a>:</p>
<p><span class="math display">\begin{align*}
L(\mu, \gamma ;\underline{x}) &amp;= \prod_{i=1}^n \frac{1}{\sqrt{2\pi \gamma}} \exp\left\{ -\frac{1}{2\gamma} (x_i - \mu)^2 \right\} \\
&amp;= (2\pi \gamma)^{-\tfrac{n}{2}} \exp\left\{ \sum_{i=1}^n -\frac{1}{2\gamma} (x_i - \mu)^2 \right\}.
\end{align*}</span></p>
<p>The log-likelihood is thus</p>
<p><span class="math display">
\ell(\mu,\sigma^2;\underline{x})
= -\frac{n}{2}\log(2\pi\sigma^2)
- \frac{1}{2\sigma^2}\sum_{i=1}^n (x_i - \mu)^2.
</span></p>
<p><strong>Step 2. Differentiate w.r.t. <span class="math inline">\mu</span>:</strong></p>
<p><span class="math display">
\frac{\partial \ell}{\partial \mu}
= \frac{1}{\sigma^2}\sum_{i=1}^n (x_i - \mu).
</span></p>
<p>Setting this equal to 0 gives</p>
<p><span class="math display">
\hat{\mu} = \bar{x}.
</span></p>
<p><strong>Step 2. Differentiate w.r.t. <span class="math inline">\sigma^2</span>:</strong></p>
<p><span class="math display">
\frac{\partial \ell}{\partial \sigma^2}
= -\frac{n}{2\sigma^2} + \frac{1}{2(\sigma^2)^2}\sum_{i=1}^n (x_i - \mu)^2.
</span></p>
<p>Setting this equal to <span class="math inline">0</span> and substituting <span class="math inline">\mu = \hat{\mu}</span> gives</p>
<p><span class="math display">
\hat{\sigma}^2 = \frac{1}{n}\sum_{i=1}^n (x_i - \bar{x})^2.
</span></p>
<p><strong>Final Answer:</strong> The MLEs are</p>
<p><span class="math display">
\hat{\mu} = \bar{X},
\qquad
\hat{\sigma}^2 = \frac{1}{n}\sum_{i=1}^n (X_i - \bar{X})^2.
</span></p>
<p><strong>Note</strong>: <span class="math inline">\hat{\sigma}^2</span> is biased (its expectation is <span class="math inline">\tfrac{n-1}{n}\sigma^2</span>), but it is the maximum likelihood estimate.</p>
</details>
</div>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="information-and-efficiency-of-estimators" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="information-and-efficiency-of-estimators"><span class="header-section-number">5.4</span> Information and Efficiency of Estimators</h2>
<p>In the previous chapter we studied two kinds of <em>properties of estimators</em>:</p>
<ul>
<li>In <span class="xref-no-num"><a href="4-freq-point-estimation.html#sec-estimator-properties" class="quarto-xref">Properties of Estimators&nbsp;<span>4.2</span></a></span>, we introduced: <span class="xref-no-num"><a href="4-freq-point-estimation.html#def-bias" class="quarto-xref">bias&nbsp;<span>4.4</span></a></span>, <span class="xref-no-num"><a href="4-freq-point-estimation.html#def-variance" class="quarto-xref">variance&nbsp;<span>4.5</span></a></span>, and <span class="xref-no-num"><a href="4-freq-point-estimation.html#def-mse" class="quarto-xref">MSE&nbsp;<span>4.8</span></a></span>.<br>
</li>
<li>In <span class="xref-no-num"><a href="4-freq-point-estimation.html#sec-estimator-asymp-properties" class="quarto-xref">Asymptotic Properties of Estimators&nbsp;<span>4.4</span></a></span>, we introduced: <span class="xref-no-num"><a href="4-freq-point-estimation.html#def-asymptotic-unbiasedness" class="quarto-xref">asymptotic unbiasedness&nbsp;<span>4.9</span></a></span> and <span class="xref-no-num"><a href="4-freq-point-estimation.html#def-consistency" class="quarto-xref">consistency&nbsp;<span>4.10</span></a></span>.</li>
</ul>
<p>Now that we have the <em>likelihood function</em>, we can go further and introduce two powerful ideas:</p>
<ul>
<li><strong>Cramér–Rao Lower Bound (<span title="Cramér–Rao Lower Bound">CRLB</span>):</strong> a universal lower bound on the variance of any unbiased estimator.</li>
<li><strong>Efficiency:</strong> whether an estimator actually attains this bound (at least asymptotically).</li>
</ul>
<div id="imp-crlb-motivation" class="callout callout-style-simple callout-important callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important&nbsp;5.3: Motivation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Our central measure of estimator quality was the <strong>mean squared error (MSE)</strong>. From the <span class="xref-no-num"><a href="4-freq-point-estimation.html#prp-mse-bias-variance" class="quarto-xref">bias-variance decomposition&nbsp;<span>4.4</span></a></span> of the MSE, we know:</p>
<p><span class="math display">
\mathrm{MSE}(\hat{\theta}) = \mathrm{Bias}(\hat{\theta})^2 + \mathrm{Var}(\hat{\theta}).
</span></p>
<p>For <strong>unbiased estimators</strong> (<span class="math inline">\mathrm{Bias}(\hat{\theta})=0</span>), this reduces to</p>
<p><span class="math display">
\mathrm{MSE}(\hat{\theta}) = \mathrm{Var}(\hat{\theta}).
</span></p>
<p>So if we restrict attention to unbiased estimators, the question of “how good” becomes:</p>
<blockquote class="blockquote">
<p><em>Which unbiased estimator has the <strong>smallest possible variance</strong>?</em></p>
</blockquote>
<p>The Cramér–Rao Lower Bound (<span title="Cramér–Rao Lower Bound">CRLB</span>) answers this: it gives a universal benchmark for how small the variance can ever be.</p>
</div>
</div>
</div>
<p>Before introducing the <span title="Cramér–Rao Lower Bound">CRLB</span> and efficiency, we first need two key definitions derived from the likelihood function.</p>
<section id="score-and-fisher-information" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="score-and-fisher-information"><span class="header-section-number">5.4.1</span> Score and Fisher Information</h3>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-score-statistic" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5.6 (Score Statistic)</strong></span> The <strong>score</strong> is the derivative of the log-likelihood with respect to the parameter:</p>
<p><span class="math display">
U(\theta;\underline{X}) \;=\; \frac{\partial}{\partial \theta}\,\ell(\theta;\underline{X})
= \frac{\partial}{\partial \theta}\,\log f(\underline{X}\mid \theta).
</span></p>
<p>It is a <strong>random quantity</strong>.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-fisher-information" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5.7 (Fisher Information)</strong></span> The <strong>Fisher Information</strong> (or <em>expected information</em>) for data <span class="math inline">\underline{X}</span> with log-likelihood <span class="math inline">\ell(\theta;\underline{X})</span> is</p>
<p><span class="math display">
\mathcal{I}(\theta;\underline{X}) \;=\; -\,\mathrm{E}\!\left[ \frac{\partial^2}{\partial \theta^2}\,\ell(\theta;\underline{X}) \right].
</span></p>
</div>
</div>
</div>
</div>
<p><strong>Intuition:</strong> Fisher information measures how much the data tell us about <span class="math inline">\theta</span>.</p>
<ul>
<li>A sharply peaked log-likelihood <span class="math inline">\Rightarrow</span> high information (data strongly constrain <span class="math inline">\theta</span>).</li>
<li>A flat log-likelihood <span class="math inline">\Rightarrow</span> low information (many <span class="math inline">\theta</span>’s are plausible). The curvature (second derivative) captures this “peakedness.”</li>
</ul>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="prp-fisher-one-obs" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 5.1 (Fisher Information for i.i.d. Data)</strong></span> Suppose we have an i.i.d. sample <span class="math inline">\underline{X}^{(n)} = (X_1,\ldots,X_n)</span> drawn from the same distribution with PDF/PMF <span class="math inline">f(x \mid \theta)</span>. Define:</p>
<ul>
<li>The Fisher information from <strong>one observation</strong>: <span class="math display">
\mathcal{I}_1(\theta) = -\mathrm{E}\left [\tfrac{\partial^2}{\partial \theta^2}\log f(X\mid \theta)\right]
</span></li>
<li>The Fisher information from the <strong>whole sample</strong> (i.e. <a href="#def-fisher-information" class="quarto-xref">Definition&nbsp;<span>5.7</span></a>): <span class="math display">
\mathcal{I}_n(\theta) = \mathcal{I}(\theta; \underline{X}^{(n)}) = -\mathrm{E}\left [\tfrac{\partial^2}{\partial \theta^2}\ell(\theta;\underline{X}^{(n)})\right]
</span></li>
</ul>
<p>Then</p>
<p><span class="math display">
\mathcal{I}_n(\theta) = n\,\mathcal{I}_1(\theta).
</span></p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Proof
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="prf-fisher-one-obs" class="proof">
<p><span class="proof-title"><em>Proof 5.1</em>. </span>For <span class="math inline">n</span> i.i.d. observations, the log-likelihood is</p>
<p><span class="math display">
\ell(\theta;\underline{X}) \;=\; \sum_{i=1}^n \log f(X_i \mid \theta).
</span></p>
<p>Differentiating twice,</p>
<p><span class="math display">
\frac{\partial^2}{\partial \theta^2}\ell(\theta;\underline{X}^{(n)})
\;=\; \sum_{i=1}^n \frac{\partial^2}{\partial \theta^2}\log f(X_i \mid \theta).
</span></p>
<p>Now take expectations:</p>
<p><span class="math display">
\mathcal{I}_n(\theta)
\;=\; -\,\mathrm{E}\!\left[ \frac{\partial^2}{\partial \theta^2}\ell(\theta;\underline{X}^{(n)}) \right]
\;=\; -\,\mathrm{E}\!\left[\sum_{i=1}^n \frac{\partial^2}{\partial \theta^2}\log f(X_i \mid \theta)\right].
</span></p>
<p>By linearity of expectation,</p>
<p><span class="math display">
\mathcal{I}_n(\theta)
\;=\; \sum_{i=1}^n \left( -\,\mathrm{E}\!\left[ \frac{\partial^2}{\partial \theta^2}\log f(X_i \mid \theta)\right]\right).
</span></p>
<p>Since the <span class="math inline">X_i</span> are IID, each term in the sum is the same:</p>
<p><span class="math display">
\mathcal{I}_n(\theta) = n\,\mathcal{I}(\theta).
</span></p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-poisson-fisher" class="example theorem">
<p><span class="theorem-title"><strong>Example 5.14 (Fisher Information for the Poisson Model)</strong></span> Suppose we have <span class="math inline">n</span> i.i.d. observations <span class="math inline">X_i\sim \mathrm{Poisson}(\alpha)</span>. From <a href="#exm-poisson-likelihood" class="quarto-xref">Example&nbsp;<span>5.4</span></a>, we saw the likelihood took the form</p>
<p><span class="math display">
L(\alpha; \underline{x}) = \frac{ e^{-\alpha n} \alpha^{n\bar{x}} }{\prod_{i=1}^n x_i!}
</span></p>
<p>Determine the <span class="xref-no-num"><a href="#prp-fisher-one-obs" class="quarto-xref">Fisher information&nbsp;<span>5.1</span></a></span> for:</p>
<ol type="a">
<li>The <strong>whole sample</strong></li>
<li>A <strong>single observation</strong></li>
</ol>
<details>
<summary><strong>Solution</strong></summary>
<p><strong>a. Whole sample</strong></p>
<p>We have</p>
<p><span class="math display">
\ell(\alpha; \underline{x}) = -n\alpha + \bigg(\sum_{i=1}^n x_i\bigg)\log \alpha - \sum_{i=1}^n \log x_i!,
\qquad \alpha&gt;0.
</span></p>
<p>Differentiate:</p>
<p><span class="math display">
\frac{\partial \ell}{\partial \alpha}
= -n + \frac{\sum_{i=1}^n x_i}{\alpha},
\qquad
\frac{\partial^2 \ell}{\partial \alpha^2}
= -\frac{\sum_{i=1}^n x_i}{\alpha^2}.
</span></p>
<p>Hence the Fisher information is</p>
<p><span class="math display">
\mathcal{I}_n(\alpha)
= -\,\mathrm{E}\!\left[\frac{\partial^2 \ell}{\partial \alpha^2}\right]
= -\,\mathrm{E}\!\left[-\frac{\sum_{i=1}^n X_i}{\alpha^2}\right]
= \frac{n\alpha}{\alpha^2}
= \frac{n}{\alpha}.
</span></p>
<hr>
<p><strong>b. Single observation</strong></p>
<p>For one <span class="math inline">X\sim\mathrm{Poisson}(\alpha)</span>,</p>
<p><span class="math display">
\ell_1(\alpha;x)=-\alpha + x\log\alpha - \log x!,
\quad
\frac{\partial^2 \ell_1}{\partial \alpha^2}
= -\frac{x}{\alpha^2}.
</span></p>
<p>Therefore</p>
<p><span class="math display">
\mathcal{I}_1(\alpha)
= -\,\mathrm{E}\!\left[\frac{\partial^2 \ell_1}{\partial \alpha^2}\right]
= -\,\mathrm{E}\!\left[-\frac{X}{\alpha^2}\right]
= \frac{\alpha}{\alpha^2}
= \frac{1}{\alpha}.
</span></p>
</details>
</div>
</div>
</div>
</div></section>
<section id="cramérrao-lower-bound-and-efficiency" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="cramérrao-lower-bound-and-efficiency"><span class="header-section-number">5.4.2</span> Cramér–Rao Lower Bound and Efficiency</h3>
<p>We can now state one of the most important results in statistical inference: the <strong>Cramér–Rao inequality</strong>. It tells us how small the variance of an unbiased estimator can ever be.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-crlb" class="theorem">
<p><span class="theorem-title"><strong>Theorem 5.2 (The Cramér–Rao Inequality and the <span title="Cramér–Rao Lower Bound">CRLB</span>)</strong></span> Let <span class="math inline">X_1,\dots,X_n</span> be <span title="Independent and Identically Distributed">i.i.d.</span> random variables with likelihood function <span class="math inline">L(\theta;\underline{x})</span>, and let <span class="math inline">\hat{\theta}</span> be an unbiased estimator of <span class="math inline">\theta</span>.</p>
<p>Then, under <em>regularity conditions</em>,</p>
<p><span class="math display">
\mathrm{Var}(\hat{\theta}) \;\geq\; \frac{1}{\mathcal{I}_n(\theta)},
</span> where <span class="math inline">\mathcal{I}_n(\theta)</span> is the <span class="xref-no-num"><a href="#prp-fisher-one-obs" class="quarto-xref">Fisher information&nbsp;<span>5.1</span></a></span> for the <strong>whole sample</strong>.</p>
<p>The quantity <span class="math inline">\tfrac{1}{\mathcal{I}_n(\theta)}</span> is called the <strong>Cramér–Rao Lower Bound (<span title="Cramér–Rao Lower Bound">CRLB</span>)</strong>. It represents the <em>smallest possible variance</em> achievable by any unbiased estimator of <span class="math inline">\theta</span>.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Proof (Not Examinable)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="prf-crlb" class="proof">
<p><span class="proof-title"><em>Proof 5.2</em> (Not Examinable). </span>The proof of the Cramér–Rao inequality follows from the <strong>covariance inequality</strong>:</p>
<p><span class="math display">
\mathrm{Cov}(X,Y)^2 \leq \mathrm{Var}(X)\,\mathrm{Var}(Y),
</span></p>
<p>applied to the score random variable <span class="math inline">X = U(\theta; \underline{X})</span> and the estimator <span class="math inline">Y = \hat{\theta}(\underline{X})</span>. Substituting these in and rearranging for the variance of <span class="math inline">\hat{\theta}</span> gives</p>
<p><span class="math display">
\mathrm{Var}(\hat{\theta}) \;\geq\; \frac{\mathrm{Cov}(\hat{\theta},U)^2}{\mathrm{Var}(U)}.
</span></p>
<p>Then, under <em>regularity conditions</em>, one can show that the variance of <span class="math inline">U</span> is the Fisher information, and the covariance term equals <span class="math inline">1</span>.</p>
<p>Thus, the proof can be broken into steps:</p>
<ol type="1">
<li><strong>Prove the Covariance Inequality</strong></li>
<li><strong>Show:</strong> <span class="math inline">\mathrm{E}[U] = 0</span></li>
<li><strong>Show:</strong> <span class="math inline">\mathrm{Var}(U) = \mathcal{I}(\theta)</span></li>
<li><strong>Show:</strong> <span class="math inline">\mathrm{Cov}(\hat{\theta}, U) = 1</span></li>
</ol>
<p>Along the way, we will present the regularity conditions.</p>
<hr>
<p><strong>Step 1 (Proving Covariance Inequality):</strong></p>
<p>The covariance inequality follows from the <a href="https://en.wikipedia.org/wiki/Cauchy%E2%80%93Schwarz_inequality">Cauchy-Schwarz inequality</a> for random variables:</p>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Cauchy-Schwarz Inequality for Random Variables
</div>
</div>
<div class="callout-body-container callout-body">
<p>For any random variables <span class="math inline">X</span> and <span class="math inline">Y</span> of finite variance, <span class="math display">
\mathrm{E}[XY]^2 \leq \mathrm{E}[X^2] \mathrm{E}[Y^2].
</span></p>
<details>
<summary>
<strong>Proof of Cauchy-Schwarz Inequality</strong>
</summary>
<p>Consider <span class="math inline">\mathrm{E}\left[ (aX+Y)^2 \right]</span>, which is clearly non-negative for real <span class="math inline">a</span>.</p>
<p>Multiplying out gives: <span class="math display">
a^2 \mathrm{E}[X^2] + 2a \mathrm{E}[XY] + \mathrm{E}[Y^2] \geq 0.
</span> Consider the left hand side as a quadratic in <span class="math inline">a</span>. Since it is always non-negative it cannot have two real roots. Using the quadratic formula the roots satisfy: <span class="math display">
a = \frac{-2\mathrm{E}[XY] \pm \sqrt{4 \mathrm{E}[XY]^2 - 4 \mathrm{E}[X^2] \mathrm{E}[Y^2]}}{2 \mathrm{E}[X^2]}
</span> For there to be zero or one real roots, the square root term must be non-positive i.e. <span class="math display">
\mathrm{E}[XY]^2 - \mathrm{E}[X^2] \mathrm{E}[Y^2] \leq 0.
</span> which gives the required result.</p>
</details>
</div>
</div>
<p>Applying Cauchy-Schwarz, to the mean-zero shifted random variables, <span class="math inline">X - \mathrm{E}[X]</span> and <span class="math inline">Y-\mathrm{E}[Y]</span>, we obtain</p>
<p><span class="math display">\begin{align*}
\mathrm{Cov}(X,Y)^2 &amp;= \mathrm{E}\left[(X-\mathrm{E}[X])(Y-\mathrm{E}[Y])\right]^2 \\
&amp;\leq \mathrm{E}\left[ (X-\mathrm{E}[X])^2 \right] \mathrm{E}\left[(Y-\mathrm{E}[Y])^2\right]  = \mathrm{Var}(X)\mathrm{Var}(Y).
\end{align*}</span></p>
<hr>
<p><strong>Aside:</strong> You may recall that the <em>correlation</em> between two random variables is defined as <span class="math display">
\mathrm{Cor}(X,Y) = \frac{\mathrm{Cov}(X,Y)}{\mathrm{Var}(X)^{1/2} \mathrm{Var}(Y)^{1/2}}
</span> and satisfies <span class="math inline">-1\leq \mathrm{Cor}(X,Y) \leq 1</span>. This inequality is derived from the <strong>covariance inequality</strong>.</p>
<hr>
<p><strong>Step 2 (Proving <span class="math inline">\mathrm{E}[U] = 0</span>):</strong></p>
<p>By the definition of the log-likelihood: <span class="math display">
\tfrac{\partial}{\partial\theta} \ell(\theta;\underline{x}) = \frac{\partial}{\partial\theta} \log f(\underline{x} \mid \theta).
</span></p>
<p>Using the chain rule, we have <span class="math display">
\frac{\partial}{\partial\theta} \ell(\theta;\underline{x}) = \frac{\partial}{\partial\theta} \log f(\underline{x} \mid \theta) = \frac{\frac{\partial}{\partial\theta} f(\underline{x}\mid \theta)}{f(\underline{x}\mid \theta)}.
</span></p>
<p>Since <span class="math inline">U(\theta; \underline{x}) = \tfrac{\partial}{\partial\theta} \ell(\theta;\underline{x})</span>, we can compute its expectation as follows</p>
<p><span class="math display">\begin{align*}
\mathrm{E}[U(\theta; \underline{X})] &amp;= \int U(\theta;\underline{x}) f(\underline{x}\mid\theta) \,\mathrm{d}\underline{x} \\
&amp;= \int \frac{\frac{\partial}{\partial\theta} f(\underline{x}\mid \theta)}{f(\underline{x}\mid \theta)} f(\underline{x}\mid\theta)\,\mathrm{d}\underline{x} \\
&amp;= \int \frac{\partial}{\partial\theta} f(\underline{x}\mid \theta) \,\mathrm{d}\underline{x} \\
&amp;= \frac{\partial}{\partial \theta} \int f(\underline{x}\mid \theta) \,\mathrm{d}\underline{x} \\
&amp;=  \frac{\partial}{\partial \theta} 1 \\
&amp;= 0.
\end{align*}</span></p>
<p>Here, we assumed the first <em>regularity condition</em>:</p>
<blockquote class="blockquote">
<p><strong>Regularity Condition 1:</strong> We assumed we can interchange the integral and derivative in the step <span class="math display">
\int \frac{\partial}{\partial \theta}  f(\underline{x}\mid \theta) \,\mathrm{d}\underline{x} = \frac{\partial}{\partial \theta} \int f(\underline{x}\mid \theta) \,\mathrm{d}\underline{x}
</span></p>
</blockquote>
<hr>
<p><strong>Step 3 (Proving <span class="math inline">\mathrm{Var}(U) = \mathcal{I}_n(\theta)</span>):</strong></p>
<p>By definition,</p>
<p><span class="math display">
\mathrm{Var}(U) = \mathrm{E}[U^2] - \big(\mathrm{E}[U]\big)^2.
</span></p>
<p>From Step 2 we know <span class="math inline">\mathrm{E}[U] = 0</span>, so</p>
<p><span class="math display">
\mathrm{Var}(U) = \mathrm{E}[U^2] = \mathrm{E}\!\left[\left(\frac{\partial}{\partial \theta}\,\ell(\theta;\underline{X})\right)^2\right].
</span></p>
<p>Recall the identity derived in Step 2: <span class="math display">
\frac{\partial}{\partial \theta} \ell(\theta ; \underline{x})
= \frac{\frac{\partial}{\partial \theta} f(\underline{x}\mid \theta) }{f(\underline{x}\mid \theta)}.
</span> Differentiating again, using the product and chain rules, yields:</p>
<p><span class="math display">
\frac{\partial^2}{\partial \theta^2} \ell(\theta ; \underline{x})
= -\frac{ \left( \frac{\partial}{\partial \theta} f(\underline{x}\mid \theta) \right)^2}{f(\underline{x}\mid \theta)^2} + \frac{\frac{\partial^2}{\partial \theta^2} f(\underline{x}\mid \theta)}{f(\underline{x}\mid \theta)} .
</span> Therefore, <span class="math display">
\frac{\partial^2}{\partial \theta^2} \ell(\theta ; \underline{x})
= -\left(\frac{\partial}{\partial \theta} \ell(\theta;\underline{x})\right)^2 + \frac{\frac{\partial^2}{\partial \theta^2} f(\underline{x}\mid \theta)}{f(\underline{x}\mid \theta)} .
</span> Rearranging for <span class="math inline">\left(\frac{\partial}{\partial \theta} \ell(\theta;\underline{x})\right)^2</span> yields: <span class="math display">
\left(\frac{\partial}{\partial \theta} \ell(\theta;\underline{x})\right)^2 = \frac{\frac{\partial^2}{\partial \theta^2} f(\underline{x}\mid \theta)}{f(\underline{x}\mid \theta)} - \frac{\partial^2}{\partial \theta^2} \ell(\theta ; \underline{x}).
</span></p>
<p>Computing the expectation, we have</p>
<p><span class="math display">\begin{align*}
\mathrm{Var}(U) &amp;= \mathrm{E}\left[\frac{\frac{\partial^2}{\partial \theta^2} f(\underline{X}\mid \theta)}{f(\underline{X}\mid \theta)} - \frac{\partial^2}{\partial \theta^2} \ell(\theta ; \underline{X})\right] \\
&amp;= \mathrm{E}\left[\frac{\frac{\partial^2}{\partial \theta^2} f(\underline{X}\mid \theta)}{f(\underline{X}\mid \theta)}\right] + \underbrace{\mathrm{E}\left[-\frac{\partial^2}{\partial \theta^2} \ell(\theta ; \underline{X})\right]}_{= \mathcal{I}_n(\theta)}.
\end{align*}</span></p>
<p>Concentrating on the remaining expectation:</p>
<p><span class="math display">\begin{align*}
\mathrm{E}\left[\frac{\frac{\partial^2}{\partial \theta^2} f(\underline{X}\mid \theta)}{f(\underline{X}\mid \theta)}\right] &amp;= \int \frac{\partial^2}{\partial \theta^2} f(\underline{x}\mid \theta) \, \mathrm{d}\underline{x} \\
&amp;= \frac{\partial^2}{\partial \theta^2} \int f(\underline{x}\mid \theta) \, \mathrm{d}\underline{x} \\
&amp;= \frac{\partial^2}{\partial \theta^2} 1 \\
&amp;= 0.
\end{align*}</span></p>
<p>Here, we assumed the second <em>regularity condition</em>:</p>
<blockquote class="blockquote">
<p><strong>Regularity Condition 2:</strong> We assumed we can interchange the integral and second derivative in the step <span class="math display">
\int \frac{\partial^2}{\partial \theta^2}  f(\underline{x}\mid \theta) \,\mathrm{d}\underline{x} = \frac{\partial^2}{\partial \theta^2} \int f(\underline{x}\mid \theta) \,\mathrm{d}\underline{x}
</span></p>
</blockquote>
<p>Therefore, we can conclude Step 3 with the final result:</p>
<p><span class="math display">
\mathrm{Var}(U) = \mathcal{I}_n(\theta).
</span></p>
<hr>
<p><strong>Step 4 (Proving <span class="math inline">\mathrm{Cov}(\hat{\theta}, U) = 1</span>):</strong></p>
<p>By definition,</p>
<p><span class="math display">
\mathrm{Cov}(\hat{\theta}, U) = \mathrm{E}\big[(\hat{\theta}-\theta)\,U\big].
</span></p>
<p>Using the same result used in steps 2 and 3: <span class="math display">
U(\theta;\underline{x}) = \frac{\partial}{\partial \theta} \log f(\underline{x}\mid \theta) = \frac{\frac{\partial}{\partial \theta} f(\underline{x}\mid \theta)}{f(\underline{x}\mid \theta)},
</span></p>
<p>we have <span class="math display">
\mathrm{E}[\hat{\theta} U]
= \int \hat{\theta}(\underline{x}) \,\frac{\partial}{\partial \theta} f(\underline{x}\mid\theta) \,\mathrm{d}\underline{x}.
</span></p>
<p>Since <span class="math inline">\hat{\theta}</span> is <em>constant</em> in <span class="math inline">\theta</span> and assuming we can interchange the derivative and integral, we arrive at:</p>
<p><span class="math display">
\mathrm{E}[\hat{\theta} U]
= \frac{\partial}{\partial \theta} \int \hat{\theta}(\underline{x}) f(\underline{x}\mid \theta)\,\mathrm{d}\underline{x}.
</span></p>
<p>This assumption forms our third regularity condition:</p>
<blockquote class="blockquote">
<p><strong>Regularity Condition 3:</strong> We assumed we can interchange the integral and derivative in the step <span class="math display">
\int \frac{\partial}{\partial \theta}\left(\hat{\theta}(\underline{x}) f(\underline{x}\mid \theta)\right)\,\mathrm{d}\underline{x} = \frac{\partial}{\partial \theta} \int \hat{\theta}(\underline{x}) f(\underline{x}\mid \theta)\,\mathrm{d}\underline{x}
</span></p>
</blockquote>
<p>Note now that <span class="math inline">\int \hat{\theta}(\underline{x}) f(\underline{x}\mid \theta)\,\mathrm{d}\underline{x} = \mathrm{E}[\hat{\theta}]</span> and, since we assumed <span class="math inline">\hat{\theta}</span> is <strong>unbiased</strong>, we have <span class="math display">
\int \hat{\theta}(\underline{x}) f(\underline{x}\mid \theta)\,\mathrm{d}\underline{x} = \mathrm{E}[\hat{\theta}] = \theta.
</span> Hence, <span class="math display">
\mathrm{E}[\hat{\theta} U] = \frac{\partial}{\partial \theta}\,\theta = 1.
</span></p>
<p>Also, from Step 2, <span class="math inline">\mathrm{E}[U]=0</span>. Therefore,</p>
<p><span class="math display">
\mathrm{Cov}(\hat{\theta}, U) = \mathrm{E}[\hat{\theta} U] - \mathrm{E}[\hat{\theta}]\,\mathrm{E}[U] = 1 - \theta \cdot 0 = 1.
</span></p>
<hr>
<p><strong>Conclusion:</strong></p>
<p>Putting Steps 1–4 together:</p>
<p><span class="math display">
\mathrm{Var}(\hat{\theta}) \;\geq\; \frac{\mathrm{Cov}(\hat{\theta},U)^2}{\mathrm{Var}(U)} \;=\; \frac{1^2}{\mathcal{I}_n(\theta)} \;=\; \frac{1}{\mathcal{I}_n(\theta)}.
</span></p>
<p>This completes the proof of the <strong>Cramér–Rao inequality</strong>.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Non-Examinable Content
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <em>regularity conditions</em> required for the <span title="Cramér–Rao Lower Bound">CRLB</span> are <strong>not examinable</strong>.</p>
<p>Informally, these conditions rule out “badly behaved” cases; for example, densities <span class="math inline">f(x\mid\theta)</span> with infinite variance, infinite expectation, or parameter-dependent support. They also justify steps such as interchanging derivatives and integrals in the proof.</p>
<p>If you are curious, see the non-examinable proof in <a href="#prf-crlb" class="quarto-xref">Proof&nbsp;<span>5.2</span></a>.</p>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-efficiency" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5.8 (Efficiency of an Estimator)</strong></span> &nbsp;</p>
<ul>
<li><p>An unbiased estimator is called <strong>efficient</strong> if its variance <em>achieves</em> the <span title="Cramér–Rao Lower Bound">CRLB</span> exactly:</p>
<p><span class="math display">
\mathrm{Var}(\hat{\theta}) = \frac{1}{\mathcal{I}_n(\theta)}.
</span></p></li>
<li><p>A sequence of estimators <span class="math inline">\hat{\theta}_n</span> is <strong>asymptotically efficient</strong> if, as the sample size grows, its variance approaches the <span title="Cramér–Rao Lower Bound">CRLB</span><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>: <span class="math display">
\lim_{n \to \infty} \frac{\mathrm{Var}(\hat{\theta}_n)}{1/\mathcal{I}_n(\theta)} \;=\; 1,
</span> where <span class="math inline">\mathcal{I}_n(\theta)</span> is the <span class="xref-no-num"><a href="#prp-fisher-one-obs" class="quarto-xref">Fisher information&nbsp;<span>5.1</span></a></span> for the <strong>whole</strong> sample of size <span class="math inline">n</span>.</p></li>
</ul>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<div id="cor-crlb-efficiency" class="theorem corollary">
<p><span class="theorem-title"><strong>Corollary 5.1</strong></span> By the CRLB and <span class="xref-no-num"><a href="#prp-fisher-one-obs" class="quarto-xref">Fisher Information for IID Data&nbsp;<span>5.1</span></a></span>, the variance of an efficient estimator decreases at rate <span class="math inline">1/n</span> as the sample size increases.</p>
</div>
</div>
</div>
</section>
</section>
<section id="the-asymptotic-distribution-of-the-mle" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="the-asymptotic-distribution-of-the-mle"><span class="header-section-number">5.5</span> The Asymptotic Distribution of the MLE</h2>
<p>Previously, we introduced <span class="xref-no-num"><a href="4-freq-point-estimation.html#imp-term-asymptotic" class="quarto-xref">asymptotic&nbsp;<span>4.2</span></a></span> properties of estimators.</p>
<p>In particular, we saw that we can determine the asymptotic <span class="xref-no-num"><a href="4-freq-point-estimation.html#def-sampling-distribution" class="quarto-xref">sampling distribution&nbsp;<span>4.3</span></a></span> of an estimator:</p>
<blockquote class="blockquote">
<p>The <span class="xref-no-num"><a href="4-freq-point-estimation.html#thm-clt" class="quarto-xref">Central Limit Theorem&nbsp;<span>4.1</span></a></span> told us that the sampling distribution of the <span class="xref-no-num"><a href="4-freq-point-estimation.html#def-sample-mean" class="quarto-xref">sample mean&nbsp;<span>4.1</span></a></span> is approximately Normal for large <span class="math inline">n</span>.</p>
</blockquote>
<p>This gave us a first example of the principle: with enough data, many estimators behave like a Normal random variable around the true parameter.</p>
<p>A much more general and powerful result is that maximum likelihood estimators also satisfy this property.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-asymp-mle" class="theorem">
<p><span class="theorem-title"><strong>Theorem 5.3 (Asymptotic Distribution of the MLE)</strong></span> Let <span class="math inline">\hat{\theta}_n</span> denote the <span class="xref-no-num"><a href="#def-mle" class="quarto-xref">maximum likelihood estimator&nbsp;<span>5.3</span></a></span> based on <span class="math inline">n</span> i.i.d. samples <span class="math inline">X_1,\ldots, X_n</span> drawn from the same distribution with PDF/PMF <span class="math inline">f(x \mid \theta)</span>.</p>
<p>Under <em>regularity conditions</em>, the MLE has the following asymptotic distribution: <span class="math display">
\sqrt{n}\,(\hat{\theta}_n - \theta) \;\xrightarrow{\,d\,}\; \mathcal{N} \big(0, \mathcal{I}_1(\theta)^{-1}\big),
</span></p>
<p>where <span class="math inline">\mathcal{I}_1(\theta) \;=\; -\,\mathrm{E}\!\left[ \frac{\partial^2}{\partial \theta^2} \log f(X \mid \theta) \right]</span> is the <span class="xref-no-num"><a href="#prp-fisher-one-obs" class="quarto-xref">Fisher Information&nbsp;<span>5.1</span></a></span> for <strong>a single observation</strong>.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Proof (Not Examinable)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="prf-asymp-mle" class="proof">
<p><span class="proof-title"><em>Proof 5.3</em> (Not Examinable). </span>The full proof uses tools such as Taylor expansions of the score function and the Central Limit Theorem for sums of random variables.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Non-Examinable Content
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <em>regularity conditions</em> required for the Asymptotic Distribution of the MLE are <strong>not examinable</strong>.</p>
</div>
</div>
<p>In this course, the main use of the <a href="#thm-asymp-mle" class="quarto-xref">Theorem&nbsp;<span>5.3</span></a> will be to approximate the MLE distribution using the normal distribution for sufficienty large <span class="math inline">n</span>:</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-asymp-mle-approx" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5.9 (Approximate Sampling Distribution of the MLE)</strong></span> From the <span class="xref-no-num"><a href="#thm-asymp-mle" class="quarto-xref">asymptotic distribution of the MLE&nbsp;<span>5.3</span></a></span>, we obtain the following approximation: <span class="math display">
\hat{\theta}_n \;\overset{\text{approx.}}{\sim}\;
\mathcal N\!\left(\theta,\; \tfrac{1}{n}\,\mathcal{I}_1(\theta)^{-1}\right),
\qquad \text{for large } n.
</span> Equivalently, using the <span class="xref-no-num"><a href="#prp-fisher-one-obs" class="quarto-xref">Fisher Information&nbsp;<span>5.1</span></a></span> for the whole sample <span class="math inline">\mathcal{I}_n(\theta)</span>, and using <span class="math inline">\mathcal{I}_n(\theta) = n\mathcal{I}_1(\theta)</span>, we have the approximation <span class="math display">
\hat{\theta}_n \;\overset{\text{approx.}}{\sim}\;
\mathcal N\!\left(\theta,\; \mathcal{I}_n(\theta)^{-1}\right),
\qquad \text{for large } n.
</span> In practice, since the true parameter <span class="math inline">\theta</span> is unknown, we replace <span class="math inline">\theta</span> by the observed MLE <span class="math inline">\hat{\theta}_{\text{obs}}</span>. This gives the practical approximation <span class="math display">
\hat{\theta}_n \;\overset{\text{approx.}}{\sim}\;
\mathcal N \left(\theta,\; \mathcal{I}_n(\hat{\theta}_{\text{obs}})^{-1}\right).
</span></p>
<p>This Normal distribution serves as an <strong>approximate sampling distribution</strong> of the MLE and underpins methods such as constructing confidence intervals and hypothesis tests.</p>
</div>
</div>
</div>
</div>
<p>The quantity <span class="math inline">\mathcal{I}_n(\hat{\theta}_{\text{obs}})</span> is called the <strong>observed Fisher information</strong>.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-observed-fisher" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5.10 (Observed Fisher Information)</strong></span> Let <span class="math inline">\hat{\theta}</span> denote the <span class="xref-no-num"><a href="#def-mle" class="quarto-xref">maximum likelihood estimator&nbsp;<span>5.3</span></a></span> based on <span class="math inline">n</span> i.i.d. samples <span class="math inline">X_1, \ldots, X_n</span> drawn from a distribution with density or mass function <span class="math inline">f(x \mid \theta)</span>.</p>
<p>The <strong>observed Fisher information</strong> is the <span class="xref-no-num"><a href="#def-fisher-information" class="quarto-xref">Fisher information&nbsp;<span>5.7</span></a></span> evaluated at the <strong>observed value</strong> of the MLE, <span class="math inline">\hat{\theta}_{\text{obs}}</span>, obtained from the observed data <span class="math inline">x_1, \ldots, x_n</span>: <span class="math display">
\mathcal{I}_n(\hat{\theta}_{\text{obs}}) = \mathcal{I}(\hat{\theta}_{\text{obs}}; \underline{X}).
</span> Similarly, the observed Fisher information for <strong>a single observation</strong> is the quantity <span class="math display">
\mathcal{I}_1(\hat{\theta}_{\text{obs}}).
</span></p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="exm-asymp-mle-pois" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.15 (Asymptotic Distribution of the Poisson MLE)</strong></span> Suppose <span class="math inline">X_1, X_2, \dots, X_n</span> is an i.i.d. random sample from a <span class="math inline">\text{Poisson}(\lambda)</span> distribution.</p>
<p>We know that the maximum likelihood estimator for <span class="math inline">\lambda</span> is</p>
<p><span class="math display">
\hat{\lambda} = \bar{X}.
</span></p>
<p>What is the asymptotic distribution of <span class="math inline">\hat{\lambda} = \bar{X}</span> as <span class="math inline">n \to \infty</span>?</p>
<details>
<summary><strong>Solution</strong></summary>
<p>In <a href="#exm-poisson-fisher" class="quarto-xref">Example&nbsp;<span>5.14</span></a>, we saw the Fisher information for one Poisson observation is</p>
<p><span class="math display">
\mathcal{I}_1(\lambda) = \frac{1}{\lambda}.
</span></p>
<p>For <span class="math inline">n</span> independent observations this scales to</p>
<p><span class="math display">
\mathcal{I}_n(\lambda) = \frac{n}{\lambda}.
</span></p>
<p>Therefore, <span class="math display">
\frac{1}{\mathcal{I}_n(\lambda)} = \frac{\lambda}{n}.
</span></p>
<p>It follows immediately from <a href="#thm-asymp-mle" class="quarto-xref">Theorem&nbsp;<span>5.3</span></a> that</p>
<p><span class="math display">
\hat{\lambda} \;\;\stackrel{\text{approx.}}{\sim}\;\; \mathcal{N}\!\left(\lambda,\; \tfrac{\lambda}{n}\right),
\quad \text{as } n \to \infty.
</span></p>
</details>
</div>
</div>
</div>
</div>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p><strong>Geometric mean.</strong> One can write <span class="math inline">\prod_{i=1}^n x_i = \bar{x}_g^n</span> where <span class="math inline">\bar{x}_g = \left(\prod_{i=1}^n x_i \right)^{1/n}</span> is the <em>geometric mean</em>. This reformulation is rarely useful in practice, so it’s usually best to leave the product as it is.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><strong>Asymptotic Equivalence.</strong> Equivalently, we could say <span class="math inline">\mathrm{Var}(\hat{\theta}_n) \sim \tfrac{1}{\mathcal{I}_n(\theta)}</span>, where “<span class="math inline">\sim</span>” here means <em>asymptotically equivalent</em>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.xref-no-num a.quarto-xref').forEach(a => {
    const nodes = Array.from(a.childNodes);
    // Find the trailing <span> (the number)
    const last = nodes[nodes.length - 1];
    const prev = nodes[nodes.length - 2];

    if (last && last.nodeType === Node.ELEMENT_NODE && last.tagName === 'SPAN') {
      // Remove the number <span>
      last.remove();
      // Strip any trailing NBSP/space left before it
      if (prev && prev.nodeType === Node.TEXT_NODE) {
        prev.nodeValue = prev.nodeValue.replace(/\u00a0\s*$/, '');
      }
    }
  });
});
</script>
<script>
(function () {
  if (window.__closeCodeFoldBound) return;
  window.__closeCodeFoldBound = true;

  const onDocClick = (e) => {
    // Close any open code-fold if the click is outside it
    document.querySelectorAll('details.code-fold[open]').forEach((d) => {
      if (!d.contains(e.target)) d.removeAttribute('open');
    });
  };

  const onKey = (e) => {
    if (e.key === 'Escape') {
      document.querySelectorAll('details.code-fold[open]').forEach((d) => {
        d.removeAttribute('open');
      });
    }
  };

  // Capture-phase click so we run reliably even with other handlers
  document.addEventListener('click', onDocClick, true);
  document.addEventListener('keydown', onKey);
})();
</script>



<script>
document.addEventListener('DOMContentLoaded', function () {
  // 1) Find the brand container and the existing logo <img>
  const brandContainer = document.querySelector('#quarto-header .navbar-brand-container');
  const img = brandContainer && brandContainer.querySelector('img.navbar-logo');
  if (!brandContainer || !img) return;

  // 2) Build an <a> like Quarto's, and inject inline SVG inside it
  const a = document.createElement('a');
  a.className = 'navbar-brand navbar-brand-logo';
  a.href = (img.closest('a') && img.closest('a').getAttribute('href')) || '/';

  a.innerHTML = `
        <svg class="navbar-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 181 52" fill="none">
            <g class="logo-text" fill="currentColor">
                <path d="M71.52 21.8003C66.9224 21.8003 63.928 18.5373 63.928 13.673C63.928 8.92948 67.1342 5.48517 71.7317 5.48517C76.1175 5.48517 78.8398 8.59713 78.8398 13.7938C78.8398 14.0053 78.8398 14.2168 78.8398 14.4283H68.4953C68.4953 17.1475 69.6749 18.5977 71.7015 18.5977C73.1231 18.5977 74.212 17.7518 74.6052 16.2713L78.749 16.6339C77.7811 19.9271 75.1496 21.8003 71.52 21.8003ZM74.3632 11.8904C74.333 9.62439 73.2743 8.44607 71.4595 8.44607C69.7657 8.44607 68.6465 9.68481 68.5558 11.8904H74.3632Z"/>
                <path d="M173.18 21.8003C168.583 21.8003 165.588 18.5373 165.588 13.673C165.588 8.92948 168.794 5.48517 173.392 5.48517C177.778 5.48517 180.5 8.59713 180.5 13.7938C180.5 14.0053 180.5 14.2168 180.5 14.4283H170.155C170.155 17.1475 171.335 18.5977 173.362 18.5977C174.783 18.5977 175.872 17.7518 176.265 16.2713L180.409 16.6339C179.441 19.9271 176.81 21.8003 173.18 21.8003ZM176.023 11.8904C175.993 9.62439 174.934 8.44607 173.12 8.44607C171.426 8.44607 170.307 9.68481 170.216 11.8904H176.023Z"/>
                <path d="M79.2632 5.9082H84.1027L86.3712 15.0024L88.5188 5.9082H92.5416L94.7799 15.1535L97.4719 5.9082H101.102L96.625 21.3774H92.5719L90.0009 11.3164L87.4601 21.3774H83.7397L79.2632 5.9082Z"/>
                <path d="M109.268 8.62735C107.302 8.62735 105.971 10.3193 105.911 13.6125C105.85 16.9058 107.211 18.6279 109.117 18.6279C110.599 18.6279 112.021 17.4798 112.263 15.4858L116.104 15.939C115.59 19.5041 112.747 21.8003 108.784 21.8003C104.187 21.8003 101.041 18.5373 101.132 13.673C101.223 8.7482 104.519 5.48517 109.419 5.48517C113.14 5.48517 115.711 7.66052 116.134 11.3465L112.142 11.7695C111.9 9.74524 110.629 8.62735 109.268 8.62735Z"/>
                <path d="M127.477 18.8696C126.479 20.7429 124.785 21.7701 122.607 21.7701C119.401 21.7701 117.465 19.8969 117.465 17.0568C117.465 13.4313 120.793 11.4976 127.386 11.4372V10.7725C127.386 9.2014 126.57 8.38564 124.936 8.38564C123.122 8.38564 122.093 9.14097 121.881 10.561L117.889 10.1078C118.584 7.05626 121.034 5.51538 125.178 5.51538C129.806 5.51538 131.621 7.32818 131.621 11.558V18.4164C131.621 19.6854 131.742 20.6824 132.044 21.4076H127.78C127.598 20.6522 127.507 19.8063 127.477 18.8696ZM122.002 16.7849C122.002 18.0539 122.819 18.8092 124.241 18.8092C126.055 18.8092 127.417 17.2986 127.417 15.2138V13.7938C123.817 13.8542 122.002 14.9419 122.002 16.7849Z"/>
                <path d="M136.914 16.5432C137.277 17.9632 138.578 18.779 140.483 18.779C142.117 18.779 143.024 18.0539 143.024 17.0871C143.024 15.7275 141.723 15.7879 139.455 15.3045C135.795 14.5491 133.95 13.3104 133.95 10.5308C133.95 7.63031 136.309 5.48517 140.181 5.48517C143.357 5.48517 145.504 6.90519 146.412 9.50353L142.964 10.1682C142.449 8.92948 141.512 8.41586 140.03 8.41586C138.608 8.41586 137.822 8.95969 137.822 9.95673C137.822 11.3163 139.304 11.2559 142.086 11.8602C145.444 12.5853 147.077 13.7938 147.077 16.4828C147.077 19.5343 144.506 21.7097 140.12 21.7097C136.581 21.7097 134.071 19.9271 133.345 17.0568L136.914 16.5432Z"/>
                <path d="M159.206 0.5H163.622V21.3774H159.206V0.5Z"/>
                <path d="M68.7374 33.9461C69.3726 32.8886 70.1287 32.0729 71.0059 31.5592C71.8831 31.0154 72.851 30.7435 73.9399 30.7435C74.8775 30.7435 75.6639 30.9247 76.2991 31.3175C76.9343 31.6801 77.4485 32.2843 77.8417 33.1001C78.2349 33.9159 78.4164 34.8223 78.4164 35.8193V42.8288C78.4164 43.3424 78.5374 43.7352 78.7794 43.9467C79.0214 44.1582 79.4146 44.279 79.959 44.279H80.9572V45.3969H73.3954V44.279H74.1213C74.7868 44.279 75.2707 44.1582 75.5127 43.9467C75.7849 43.7352 75.9059 43.4028 75.9059 42.9798V36.8466C75.9059 35.5172 75.6942 34.5201 75.301 33.8856C74.7263 32.9793 73.8794 32.4958 72.73 32.4958C71.5806 32.4958 70.6429 32.949 69.8868 33.8856C69.1306 34.8223 68.7374 36.0308 68.7374 37.5112V42.8288C68.7374 43.3424 68.8584 43.705 69.1003 43.9467C69.3423 44.1582 69.7355 44.279 70.28 44.279H71.2781V45.3969H63.5954V44.279H64.5935C65.0775 44.279 65.4707 44.1884 65.7429 43.9769C66.0151 43.7654 66.1361 43.5237 66.1361 43.2215V33.9159C66.1361 33.3116 65.9849 32.8282 65.6522 32.5261C65.3195 32.2239 64.8355 32.0426 64.2306 32.0426H63.5046V31.0154L68.6164 30.7737L68.7374 33.9461Z"/>
                <path d="M81.2292 31.0759L87.0064 30.8946V43.2518C87.0064 43.5842 87.0972 43.8259 87.2484 43.9769C87.4904 44.1884 87.7928 44.2791 88.1558 44.2791H89.7892V45.3969H81.562V44.2791H83.0743C83.528 44.2791 83.8607 44.1582 84.0725 43.9467C84.2842 43.7352 84.3749 43.4029 84.3749 42.9799V33.9159C84.3749 33.3419 84.2237 32.9189 83.891 32.6167C83.5583 32.3146 83.0743 32.1937 82.4391 32.1937H81.2595V31.0759M85.2823 25.0332C85.7361 25.0332 86.1595 25.2145 86.4922 25.5468C86.8249 25.9094 87.0064 26.3022 87.0064 26.7856C87.0064 27.2388 86.8249 27.6315 86.4922 27.9941C86.1595 28.3265 85.7361 28.5077 85.2823 28.5077C84.7984 28.5077 84.4052 28.3265 84.0725 27.9941C83.7397 27.6618 83.5583 27.2388 83.5583 26.7856C83.5583 26.3324 83.7397 25.9094 84.0725 25.577C84.4354 25.2145 84.8286 25.0332 85.2823 25.0332Z"/>
                <path d="M144.99 31.0759L150.767 30.8946V43.2518C150.767 43.5842 150.858 43.8259 151.009 43.9769C151.251 44.1884 151.554 44.2791 151.917 44.2791H153.55V45.3969H145.292V44.2791H146.805C147.259 44.2791 147.591 44.1582 147.803 43.9467C148.015 43.7352 148.105 43.4029 148.105 42.9799V33.9159C148.105 33.3419 147.954 32.9189 147.621 32.6167C147.289 32.3146 146.805 32.1937 146.17 32.1937H144.99V31.0759ZM149.043 25.0332C149.497 25.0332 149.92 25.2145 150.253 25.5468C150.616 25.9094 150.767 26.3022 150.767 26.7856C150.767 27.2388 150.586 27.6315 150.253 27.9941C149.92 28.3265 149.497 28.5077 149.043 28.5077C148.559 28.5077 148.166 28.3265 147.833 27.9941C147.5 27.6618 147.319 27.2388 147.319 26.7856C147.319 26.3324 147.5 25.9094 147.833 25.577C148.166 25.2145 148.589 25.0332 149.043 25.0332Z"/>
                <path d="M88.791 31.0154H95.8991V32.0728C94.9614 32.1031 94.3565 32.1635 94.0842 32.3146C93.812 32.4656 93.691 32.6771 93.691 32.949C93.691 33.1605 93.7515 33.4022 93.8423 33.6137L97.6534 42.1037L101.162 33.8554C101.223 33.7044 101.253 33.5835 101.253 33.4324C101.253 32.6771 100.497 32.2239 99.0145 32.0426V31.0154H105.003V32.0728C104.398 32.1333 103.915 32.2843 103.552 32.5563C103.189 32.8282 102.916 33.1605 102.705 33.6137L97.4114 45.8501H96.5645L90.9386 33.2814C90.7268 32.8282 90.4849 32.526 90.1824 32.3448C89.8799 32.1635 89.4262 32.0728 88.791 32.0728V31.0154Z"/>
                <path d="M117.677 38.2968H107.302C107.363 40.5024 107.756 42.0432 108.542 42.9496C109.419 43.9769 110.569 44.4603 111.93 44.4603C113.957 44.4603 115.59 43.3424 116.83 41.0764L117.798 41.4994C116.286 44.3999 114.138 45.8501 111.295 45.8501C109.359 45.8501 107.726 45.1552 106.425 43.7654C105.094 42.3756 104.459 40.593 104.459 38.4176C104.459 36.0912 105.094 34.1878 106.395 32.7375C107.695 31.2873 109.299 30.5622 111.204 30.5622C112.595 30.5622 113.805 30.9248 114.834 31.6499C115.832 32.375 116.618 33.4022 117.132 34.7316C117.465 35.6682 117.647 36.8768 117.677 38.2968ZM107.302 37.2393H113.654C114.017 37.2393 114.32 37.1185 114.531 36.8768C114.743 36.6351 114.834 36.2121 114.834 35.5776C114.834 34.4597 114.471 33.4929 113.745 32.7073C113.019 31.9218 112.172 31.529 111.204 31.529C110.115 31.529 109.208 32.0124 108.452 32.949C107.726 33.8857 107.332 35.3359 107.302 37.2393Z"/>
                <path d="M133.012 40.0794C133.647 41.862 134.373 43.1007 135.22 43.7654C136.037 44.4603 137.065 44.7926 138.275 44.7926C139.394 44.7926 140.272 44.5509 140.846 44.0675C141.451 43.5841 141.754 42.9496 141.754 42.1943C141.754 41.7713 141.633 41.3785 141.421 41.0462C141.209 40.7138 140.907 40.4721 140.514 40.3211C140.12 40.17 139.092 39.9283 137.459 39.6262C135.886 39.324 134.797 38.9917 134.192 38.6593C133.587 38.327 133.103 37.8436 132.77 37.2695C132.438 36.6653 132.256 36.0308 132.256 35.3359C132.256 34.2784 132.619 33.3116 133.315 32.4656C134.222 31.3779 135.493 30.8039 137.126 30.8039C138.366 30.8039 139.515 31.1967 140.604 32.0124L141.633 30.9247H142.268L142.661 36.0912H141.663C141.209 34.6108 140.604 33.5231 139.818 32.8584C139.062 32.1937 138.094 31.8614 136.975 31.8614C136.007 31.8614 135.22 32.1031 134.676 32.5865C134.131 33.0699 133.829 33.6742 133.829 34.3691C133.829 34.9733 134.071 35.4869 134.585 35.9099C135.099 36.3329 136.067 36.6653 137.549 36.8768C139.243 37.1487 140.362 37.3904 140.877 37.6019C141.723 37.904 142.359 38.3874 142.812 39.0219C143.266 39.6564 143.508 40.4419 143.508 41.3483C143.508 42.6173 142.994 43.6747 141.996 44.5509C140.997 45.4271 139.727 45.8803 138.185 45.8803C136.763 45.8803 135.432 45.3969 134.222 44.4905L133.103 45.7595H132.286L131.984 40.1096H133.012"/>
                <path d="M164.167 31.0154H171.093V32.0728H170.458C169.853 32.0728 169.43 32.1635 169.218 32.3146C169.006 32.4656 168.885 32.7073 168.885 32.9792C168.885 33.1001 168.916 33.2512 168.976 33.372L172.999 41.9828L176.024 34.8525C176.235 34.3388 176.356 33.8554 176.356 33.372C176.356 33.0095 176.205 32.7073 175.903 32.4958C175.6 32.2843 175.025 32.1635 174.118 32.1031V31.0154H180.107V32.0728C178.958 32.1937 178.201 32.6771 177.808 33.5835L172.394 45.9709C171.486 48.0859 170.549 49.5361 169.641 50.2914C168.704 51.077 167.736 51.4698 166.677 51.4698C165.921 51.4698 165.286 51.2583 164.832 50.8353C164.378 50.4123 164.136 49.8987 164.136 49.2944C164.136 48.8412 164.288 48.4484 164.56 48.1463C164.862 47.8442 165.195 47.6931 165.649 47.6931C166.042 47.6931 166.375 47.814 166.647 48.0859C166.919 48.3276 167.04 48.6297 167.04 48.9923C167.04 49.1131 167.01 49.2642 166.98 49.4455C166.949 49.5965 166.919 49.7174 166.919 49.7778C166.919 50.0195 167.07 50.1404 167.403 50.1404C167.736 50.1404 168.129 50.0195 168.553 49.7778C168.976 49.5361 169.369 49.1433 169.762 48.5995C170.125 48.0557 170.791 46.8471 171.698 44.9739L166.224 33.3116C166.012 32.9188 165.77 32.6167 165.498 32.4052C165.195 32.2239 164.772 32.0728 164.197 32.0124V31.0154"/>
                <path d="M44.0557 0.5H49.7119L57.6366 13.3709L57.6063 0.5H62.0526V21.3774H57.3341L48.4717 6.875V21.3774H44.0557V0.5Z"/>
                <path d="M41.4243 24.5195H50.8614V25.6374H49.2885C48.7441 25.6374 48.3509 25.7281 48.1089 25.9093C47.8972 26.0906 47.7762 26.3625 47.7762 26.7553V38.1759C47.7762 39.5053 47.8972 40.5326 48.1392 41.2275C48.4719 42.2547 49.1373 43.0403 50.0447 43.6445C50.9824 44.2488 52.1923 44.5509 53.6744 44.5509C55.7312 44.5509 57.304 44.0071 58.3929 42.9496C59.4818 41.8922 60.0262 40.4419 60.0262 38.6593V29.6256C60.0262 28.689 59.9657 27.9941 59.8447 27.5409C59.7238 27.0574 59.5423 26.6949 59.3003 26.423C59.0583 26.151 58.7559 25.9698 58.3929 25.8187C58.0299 25.6978 57.3947 25.6374 56.5478 25.6374V24.5195H65.1985V25.6374H64.5935C63.6256 25.6374 62.9299 25.9093 62.446 26.423C61.962 26.9366 61.7503 27.6919 61.7503 28.689V38.4478C61.7503 40.8951 61.0546 42.7683 59.6633 44.0675C58.0904 45.548 56.0034 46.2731 53.4021 46.2731C51.1336 46.2731 49.3793 45.9407 48.0787 45.3063C46.778 44.6718 45.8404 43.7352 45.2657 42.5569C44.812 41.6505 44.6003 40.5024 44.6003 39.1125V26.7553C44.6003 26.423 44.4793 26.1208 44.2373 25.9396C43.9953 25.7281 43.6323 25.6374 43.1484 25.6374H41.5151V24.5195"/>
                <path d="M157.18 18.1747C156.696 18.2654 156.242 18.3258 155.849 18.3258C154.306 18.3258 153.973 17.6309 153.973 15.8785V8.92948H157.18V5.93836H153.973V1.43658L149.497 2.25234V5.90815H147.5V8.89926H149.497V16.3317C149.497 20.1084 150.949 21.7701 154.578 21.7701C155.395 21.7701 156.272 21.6795 157.18 21.4982V18.1747Z"/>
                <path d="M163.199 39.9283C163.108 41.439 162.836 42.5267 162.352 43.1914C161.868 43.8561 161.263 44.1884 160.567 44.1884C159.992 44.1884 159.509 43.9769 159.115 43.5539C158.722 43.131 158.541 42.4965 158.541 41.6807V32.2844H163.078V31.0154H158.541V25.0332H157.482C157.391 27.0575 156.907 28.6286 156 29.7465C155.395 30.532 154.487 31.0154 153.308 31.1967V32.2542H155.879V42.1037C155.879 43.1914 156.212 44.0374 156.907 44.702C157.603 45.3667 158.541 45.6991 159.75 45.6991C161.051 45.6991 162.14 45.2157 162.957 44.2791C163.773 43.3424 164.227 41.8922 164.288 39.9283H163.199Z"/>
                <path d="M129.201 30.5018C126.691 30.5018 124.573 33.4325 123.696 36.7257V30.7737L118.463 31.0154V32.1333H119.704C120.248 32.1333 120.671 32.2844 120.974 32.6167C121.276 32.949 121.428 33.4325 121.428 34.1576V43.3122C121.428 43.5841 121.307 43.7956 121.065 44.0071C120.823 44.1884 120.46 44.279 119.976 44.279H118.554V45.3969H127.537V44.279H125.723C125.118 44.279 124.694 44.1884 124.452 44.0071C124.21 43.8258 124.089 43.5539 124.089 43.2216V40.5628C124.089 37.7832 125.269 33.0699 127.598 33.0699C128.233 33.0699 128.112 34.0971 129.383 34.0971C130.411 34.0971 131.137 33.3418 131.137 32.3448C131.137 31.2269 130.229 30.5018 129.201 30.5018Z"/>
            </g>
            <path d="M0.5 0.5C0.5 0.5 0.5 12.827 0.5 18.8092C0.5 36.1214 20.0093 46.122 20.0093 46.122C20.0093 46.122 39.5187 36.1819 39.5187 18.8092C39.5187 12.827 39.5187 0.5 39.5187 0.5H0.5Z" fill="#003A65"/>
            <path d="M38.3088 1.70853V18.8092C38.3088 22.5557 37.3409 26.2417 35.4353 29.8069C33.8927 32.6771 31.7149 35.4568 28.9927 38.0551C25.2421 41.6505 21.4309 43.9467 20.0396 44.7322C18.6482 43.9467 14.8673 41.6505 11.1167 38.0551C8.36422 35.4568 6.15619 32.6771 4.61359 29.8069C2.67779 26.2417 1.70988 22.5557 1.70988 18.8092C1.70988 13.9751 1.70988 4.97156 1.70988 1.70853H38.3088ZM39.5187 0.5H0.5C0.5 0.5 0.5 12.827 0.5 18.8092C0.5 36.1214 20.0093 46.122 20.0093 46.122C20.0093 46.122 39.5187 36.1819 39.5187 18.8092C39.5187 12.827 39.5187 0.5 39.5187 0.5Z" fill="white"/>
            <path d="M30.626 31.4082C30.626 30.3507 30.4747 29.3235 30.1723 28.3264C27.2686 30.2299 24.4253 30.7133 22.7013 29.686C22.792 29.5652 22.8525 29.4141 22.8525 29.2631C22.8525 28.8703 22.55 28.5682 22.1568 28.5682C22.0056 28.5682 21.8543 28.6286 21.7334 28.7192C20.705 27.0273 21.1889 24.157 23.0945 21.2565C22.0963 20.9544 21.0679 20.8033 20.0093 20.8033C18.9506 20.8033 17.9222 20.9544 16.9241 21.2565C18.8296 24.157 19.3136 26.9971 18.2852 28.7192C18.1642 28.6286 18.013 28.5682 17.8617 28.5682C17.4685 28.5682 17.1661 28.8703 17.1661 29.2631C17.1661 29.4141 17.2266 29.5652 17.3173 29.686C15.6235 30.7133 12.75 30.2299 9.84628 28.3264C9.54381 29.3235 9.39258 30.3507 9.39258 31.4082C9.39258 32.4657 9.54381 33.4929 9.84628 34.49C12.75 32.5865 15.5932 32.1031 17.3173 33.1304C17.2266 33.2512 17.1661 33.4023 17.1661 33.5533C17.1661 33.9461 17.4685 34.2483 17.8617 34.2483C18.013 34.2483 18.1642 34.1878 18.2852 34.0972C19.3136 35.7891 18.8296 38.6594 16.9241 41.5599C17.9222 41.862 18.9506 42.0131 20.0093 42.0131C21.0679 42.0131 22.0963 41.862 23.0945 41.5599C21.1889 38.6594 20.705 35.8193 21.7334 34.0972C21.8543 34.1878 22.0056 34.2483 22.1568 34.2483C22.55 34.2483 22.8525 33.9461 22.8525 33.5533C22.8525 33.4023 22.792 33.2512 22.7013 33.1304C24.3951 32.1031 27.2686 32.5865 30.1723 34.49C30.4747 33.4929 30.626 32.4657 30.626 31.4082Z" fill="white"/>
            <path d="M21.9451 31.4082C21.9451 32.4657 21.0982 33.3418 20.0093 33.3418C18.9507 33.3418 18.0735 32.4959 18.0735 31.4082C18.0735 30.3507 18.9204 29.4745 20.0093 29.4745C21.0679 29.5048 21.9451 30.3507 21.9451 31.4082Z" fill="#003A65"/>
            <path d="M38.3693 1.61792H1.61914V18.8093H38.3693V1.61792Z" fill="white"/>
            <path d="M22.9736 13.8543C23.1551 13.9751 23.0643 14.1262 22.9736 14.2169C22.8828 14.3075 21.9452 14.9118 21.3402 14.7305C20.8865 14.5794 20.8865 13.7637 20.2513 13.4917C19.7371 13.2802 19.1624 13.673 19.1624 13.673C20.0699 13.6428 20.3421 14.942 20.3421 14.942C18.9507 13.8543 17.6803 14.6096 17.5896 15.3045C18.7995 14.5794 19.7371 15.5764 19.7371 15.5764C19.3137 15.6369 18.3458 16.3318 19.0717 17.4497C19.1927 16.1505 20.4933 15.939 20.4933 15.939C20.3723 16.5433 20.9168 17.7518 21.9452 17.5101C21.2192 17.0267 21.3402 16.5433 21.3402 16.2109C21.3402 16.0296 21.552 15.9088 21.7939 15.8786C23.2155 15.7275 23.2155 16.8152 23.2155 16.8152C23.6088 16.785 24.6674 15.365 24.6069 14.6398C25.0001 15.2441 26.0588 15.5764 26.8149 15.0326C25.847 14.8815 25.4236 13.9147 25.3631 13.7334C25.3026 13.5522 25.0606 12.3738 24.6069 11.9206C23.9717 11.2862 22.9433 11.7696 22.4291 12.2832C22.2476 12.4343 21.7637 13.3105 22.3686 13.5824C22.7921 13.7032 22.8828 13.7939 22.9736 13.8543Z" fill="#D70929"/>
            <path d="M7.51742 11.0143C6.03532 11.0143 4.37173 8.02315 4.2205 7.78144C5.06741 7.72102 5.03717 7.29803 4.94643 7.02611C4.64396 6.02907 2.73839 6.96568 2.58716 7.14696C2.64765 6.18014 3.7063 5.78737 4.34149 5.90822C4.2205 4.42777 2.85938 4.33713 2.85938 4.33713C4.03902 3.46094 4.79519 4.57884 5.03717 5.42481C6.2168 4.54862 5.09766 3.37031 4.88593 3.24945C4.88593 3.24945 5.82359 3.15881 6.2168 4.12564C6.57976 5.03203 6.12606 5.57587 6.12606 5.57587C6.12606 5.57587 6.42853 5.57587 6.61001 5.42481C7.27545 4.97161 7.2452 4.36734 7.21495 4.24649C7.21495 4.24649 7.6989 4.54862 7.63841 5.12267C7.60816 5.51545 7.21495 5.81758 7.03347 6.02907C6.88224 6.24057 6.48902 6.69376 6.97298 8.144C7.21495 8.83891 7.57792 9.38275 7.85014 9.5036C7.66866 9.77552 7.39643 10.1381 7.51742 11.0143Z" fill="#D70929"/>
            <path d="M4.25067 13.1897C3.31301 13.2501 1.67967 13.6429 2.52659 15.3348C2.55684 14.1867 4.09944 14.0658 4.40191 14.1565C3.64573 15.4254 4.52289 16.634 5.21858 16.5735C4.52289 16.0297 5.15808 15.2139 5.21858 14.942C5.27907 14.7305 5.52105 14.6097 5.79327 14.7003C6.64019 14.942 6.03525 15.6671 6.03525 15.6671C7.91056 16.5131 8.75748 15.788 9.12044 15.365C9.12044 15.365 9.69513 15.9089 9.12044 16.3318C9.42291 16.5131 11.2075 16.5735 11.8729 15.7578C12.0846 16.4225 14.2019 16.4225 14.5347 16.1203C14.5347 16.1203 14.1112 15.8786 14.1112 15.5765C14.1112 15.0629 14.6859 14.6399 15.4118 14.3378C16.2587 13.9752 17.6199 13.7939 19.0112 13.1594C21.552 11.9509 24.6977 9.71513 25.6958 11.1049C26.21 11.8301 26.089 12.525 26.6032 13.0084C27.1174 13.4918 27.9341 13.2803 28.4483 13.2199C29.6884 13.0688 31.473 12.8875 32.5619 12.8271C33.6508 12.7667 33.9532 13.5522 33.9532 13.6429C34.044 13.8846 33.923 14.0356 33.7718 14.0054C33.4088 13.9752 32.7434 13.8241 32.3502 14.0356C31.8057 14.3378 31.9569 15.0931 31.9569 15.0931C32.4106 14.3075 33.681 14.4284 34.1347 14.4888C33.7113 14.8514 32.9248 16.2714 34.044 16.9059C33.7415 15.8182 34.7699 15.0629 34.7699 15.0629C34.8607 15.365 35.5261 15.9995 37.0082 15.9089C35.4656 15.4254 35.7076 14.6399 35.7076 14.6399C36.2218 14.8514 37.3107 14.7003 37.8249 13.5824C36.0705 14.6701 35.5866 13.6429 35.5261 13.522C35.2236 12.9782 36.0705 12.8573 36.0705 12.8573C35.8891 12.4948 33.4693 10.9841 34.6792 10.5309C34.2557 10.2892 33.2576 10.3798 32.3804 11.0445C32.4106 10.833 32.3804 10.259 32.1082 10.0173C32.1082 10.0173 30.6563 11.0143 29.5069 10.833C28.3575 10.6517 28.8113 8.92959 28.8113 8.92959C28.8113 8.92959 31.7452 9.29215 32.8341 8.77852C33.923 8.26489 33.923 7.50956 34.8304 7.02615C35.5563 6.63338 36.4335 6.96572 36.4335 6.96572C36.3125 6.21039 34.8607 5.60613 33.7718 6.78444C33.7718 6.78444 33.681 4.6393 31.0798 4.91122C29.4464 5.06229 28.2366 5.72698 26.5427 6.02911C24.9094 6.33124 23.3668 6.60316 22.3384 6.60316C21.31 6.60316 19.8279 6.33124 19.7069 5.18314C19.6464 4.51845 20.1606 4.21632 20.6748 4.21632C21.4612 4.21632 22.5501 4.66952 23.4273 4.97165C24.0625 5.18314 24.6674 5.18314 25.0304 5.18314C25.968 5.18314 27.1174 4.72994 27.6921 4.48824C28.2668 4.24653 28.7508 4.12568 29.8699 4.21632C29.5069 3.76312 27.0267 2.67544 25.3328 2.76608C23.7298 2.85672 23.6088 3.61205 22.0359 3.52141C20.4631 3.46098 19.0717 3.70269 19.0112 4.91122C18.981 6.08954 20.0094 7.3585 22.6106 7.17722C23.6693 7.11679 27.6014 6.4521 28.3878 6.21039C29.4162 5.87805 33.3483 5.12271 32.5921 7.05636C32.4409 7.47935 31.9569 7.90234 30.8076 7.90234C29.6582 7.90234 28.2063 7.56999 27.8131 7.50956C27.4199 7.44914 26.3915 7.32828 25.3933 7.47935C24.4557 7.6002 17.9828 8.53681 16.8032 8.68788C16.8032 9.08065 16.5612 10.3194 17.6803 11.0143C17.1964 11.256 16.2285 11.7394 15.2908 11.3466C15.2303 11.6488 15.5933 12.2228 16.0168 12.7062C15.6538 12.8271 14.2624 13.4918 13.5365 13.0084C13.234 13.522 12.3871 14.8212 10.2698 14.3982C10.3908 14.3075 10.3303 13.6731 9.84637 13.4616C9.33217 13.522 9.27168 13.8241 7.21488 13.5824C6.60994 13.522 6.09574 13.3105 5.91426 12.9177C5.73277 12.4948 5.97475 11.9207 5.85376 11.5884C5.58154 10.8934 4.55314 10.9841 4.55314 10.9841C5.46055 11.679 4.85561 12.6458 4.85561 12.6458C4.0087 11.7998 2.67783 10.9539 2.22412 12.4645C3.58524 11.9207 4.25067 13.1897 4.25067 13.1897Z" fill="#D70929"/>
            <path d="M17.4988 5.57586C16.9846 4.57882 15.8352 5.30394 15.8352 5.30394C16.1376 4.94138 15.8654 3.82349 15.4722 3.58178C15.4722 4.15583 14.9883 4.33711 14.6253 4.24647C14.1716 4.12562 14.3531 3.49114 14.4741 3.21922C14.1111 3.18901 13.3852 3.15879 12.871 3.88391C12.75 2.97751 11.9031 2.58474 11.0561 2.82645C11.9636 3.88391 9.9975 5.0018 9.30182 4.66946C8.9691 5.33415 10.058 6.11969 10.2092 5.9082C9.63454 6.75417 8.69688 6.57289 8.15243 6.39161C8.12219 6.75417 8.54565 7.53972 9.30182 7.53972C8.90861 8.14398 8.03145 8.20441 7.78947 8.08356C7.66848 8.65761 8.63639 9.20145 8.87836 9.23166C8.09194 10.4704 8.36416 12.0113 8.78762 12.6155L9.09009 13.1292C9.72528 11.8602 11.2074 12.3436 10.9654 13.5824C12.3568 13.7334 13.0222 12.5249 13.3247 11.7998C13.8086 12.3134 14.3833 12.3738 14.716 12.3134C14.2623 11.4674 14.4741 10.6215 14.6555 10.2891C15.1395 10.7423 15.8049 10.833 16.1679 10.7423C15.7142 10.1381 15.7142 8.59718 15.8352 8.05334C16.1376 8.26484 16.8333 8.47633 17.166 7.721C16.5914 7.53972 16.4704 5.54564 17.4988 5.57586ZM11.2376 5.75714C11.3284 5.6665 11.5099 5.51543 11.5703 5.60607C11.7216 5.81756 11.7518 5.96863 12.0241 6.24055C12.2055 6.42183 12.508 6.51247 12.6592 6.57289C12.7197 6.87503 12.145 7.29801 11.4796 6.69375C11.1469 6.3614 11.0259 5.96863 11.2376 5.75714ZM12.75 9.89635C12.0241 10.8934 11.3284 10.4402 11.3284 10.4402C11.3284 10.4402 10.5117 10.1381 10.9049 8.95974C10.3907 8.59718 10.5722 8.11377 10.7234 8.02313C10.7839 8.1742 10.8444 8.47633 11.2981 8.71804C11.7518 8.95974 11.9333 8.80868 11.9636 8.71804C12.0543 8.53676 11.8426 8.35548 11.6611 8.20441C11.5099 8.02313 11.4796 7.75121 11.5703 7.63036C11.7216 7.44908 11.9636 7.47929 12.0845 7.56993C11.5401 7.66057 12.266 8.11377 12.4173 8.20441C12.5987 8.29505 13.3852 8.59718 13.1432 8.11377C13.2642 8.14398 13.4154 8.35548 13.3852 8.56697C13.3549 8.71804 13.1129 8.8691 12.871 8.83889C12.629 8.80868 12.3568 8.74825 12.266 8.92953C12.2055 9.02017 12.266 9.29209 12.7197 9.50358C13.1734 9.74529 13.3549 9.59422 13.5667 9.53379C13.6271 9.68486 13.3549 10.1078 12.75 9.89635ZM15.0488 7.66057C14.9883 7.9627 14.6253 8.08356 14.2018 7.99292C13.3247 7.81164 13.3247 7.14695 13.5969 7.02609C13.7179 7.11673 13.9599 7.29801 14.2018 7.32823C14.5648 7.38865 14.716 7.32823 14.958 7.32823C15.079 7.32823 15.079 7.53972 15.0488 7.66057Z" fill="#D70929"/>
        </svg>
  `;

  // 3) Swap: remove the old <a><img/></a>, insert the new <a><svg/></a>
  const oldAnchor = img.closest('a.navbar-brand-logo') || img;
  brandContainer.replaceChild(a, oldAnchor);
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Only target IMPORTANT callouts; add more types if needed.
  const sel = '.callout.callout-important .callout-title-container';

  document.querySelectorAll(sel).forEach(el => {
    // Prefer operating on the first text node
    const first = el.firstChild;
    const re = /^\s*(?:Important)\s*(?:&nbsp;|\u00A0|\s)?\d+(?:\.\d+)*\s*:\s*/i;

    if (first && first.nodeType === Node.TEXT_NODE) {
      first.textContent = first.textContent.replace(re, '');
    } else {
      // Fallback: operate on HTML if the first child isn't a text node
      el.innerHTML = el.innerHTML.replace(re, '');
    }
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const tools = document.querySelector('#quarto-header .quarto-navbar-tools');
  if (!tools) return;

  // Create the button
  const btn = document.createElement('button');
  btn.id = 'lecture-zoom-header-toggle';
  btn.className = 'btn-zoom-toggle';
  btn.type = 'button';
  btn.setAttribute('aria-pressed', 'false');
  btn.setAttribute('aria-label', 'Lecture zoom');
  btn.setAttribute('title', 'Lecture zoom (X)');

  // svg icon
  btn.innerHTML = `
    <!-- ENTER: four corners -->
    <svg class="icon-enter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M3 9V3h6"/>
        <path d="M21 9V3h-6"/>
        <path d="M3 15v6h6"/>
        <path d="M21 15v6h-6"/>
    </svg>

    <!-- EXIT: corners-in (contract) -->
    <svg class="icon-exit" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M9 3v6H3"/>
        <path d="M15 3v6h6"/>
        <path d="M3 15h6v6"/>
        <path d="M21 15h-6v6"/>
    </svg>
  `;

  // Place it next to the colour-scheme toggle (after it, if present)
  const colorToggle = tools.querySelector('.quarto-color-scheme-toggle');
  if (colorToggle && colorToggle.parentNode) {
    colorToggle.parentNode.insertBefore(btn, colorToggle.nextSibling);
  } else {
    tools.appendChild(btn);
  }

  // Toggle logic
  const KEY = 'lecture-zoom-enabled';
  
  // Helper: are we in lecture zoom?
  const isLectureZoom = () =>
    document.body.classList.contains('lecture-zoom') ||
    document.documentElement.classList.contains('lecture-zoom');

  // Define closeLectureSearch early (forward declaration)
  let closeLectureSearch;

  const apply = (on) => {
    document.body.classList.toggle('lecture-zoom', on);
    document.documentElement.classList.toggle('lecture-zoom', on);
    btn.setAttribute('aria-pressed', on ? 'true' : 'false');
    
    // Close search overlay when exiting lecture zoom
    if (!on && closeLectureSearch) {
      closeLectureSearch();
    }
    
    // Nudge charts/layouts to recompute
    window.dispatchEvent(new Event('resize'));
    sessionStorage.setItem(KEY, on ? '1' : '0');
  };

  // Restore per-tab state
  apply(sessionStorage.getItem(KEY) === '1');

  // Click handler
  btn.addEventListener('click', () => apply(!isLectureZoom()));
  
  // Keyboard shortcut (Z)
  document.addEventListener('keydown', (e) => {
    if (e.key.toLowerCase() === 'x' && !/input|textarea|select/i.test(e.target.tagName)) {
      apply(!isLectureZoom());
    }
  });

  let acAnchor = null;          // where the autocomplete root came from
  let panelObserver = null;     // to catch newly created panels

  function ensureLectureOverlay() {
    let overlay = document.getElementById('lecture-search-overlay');
    if (!overlay) {
      overlay = document.createElement('div');
      overlay.id = 'lecture-search-overlay';
      overlay.innerHTML = '<div class="lecture-search-modal"></div>';
      document.body.appendChild(overlay);

      // Close on backdrop click
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay && closeLectureSearch) closeLectureSearch();
      });

      // Close on Esc
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && closeLectureSearch) closeLectureSearch();
      });
    }
    return overlay;
  }

  function findAutocomplete() {
    const root =
      document.querySelector('.aa-Autocomplete') ||
      document.querySelector('.quarto-search .aa-Autocomplete') ||
      document.querySelector('.quarto-search-panel .aa-Autocomplete');

    const input = root?.querySelector('input.aa-Input');
    return { root, input };
  }

  // Move the results panel (if any) into the modal and normalize its positioning
  function reparentPanel(modal) {
    const panel = document.querySelector('.aa-Panel');
    if (!panel || modal.contains(panel)) return;
    modal.appendChild(panel);
    // Let CSS control layout/width; clear inline positioning from Algolia
    panel.style.left = '';
    panel.style.top = '';
    panel.style.width = '';
  }

  function startPanelObserver(modal) {
    if (panelObserver) return;
    panelObserver = new MutationObserver(() => reparentPanel(modal));
    // Listen on body, since Algolia often inserts the panel there
    panelObserver.observe(document.body, { childList: true, subtree: true });
  }

  function stopPanelObserver() {
    panelObserver?.disconnect();
    panelObserver = null;
  }

  function openLectureSearch() {
    if (!isLectureZoom()) return false;

    const { root, input } = findAutocomplete();
    if (!root || !input) return false;

    const overlay = ensureLectureOverlay();
    const modal = overlay.querySelector('.lecture-search-modal');

    // Anchor the current position of the autocomplete root (only once)
    if (!acAnchor) {
      acAnchor = document.createComment('autocomplete-anchor');
      root.parentNode.insertBefore(acAnchor, root);
    }

    // Move the autocomplete *root* into the modal
    modal.appendChild(root);

    // Ensure any results panel gets moved into the modal too
    reparentPanel(modal);
    startPanelObserver(modal);

    overlay.classList.add('open');
    document.documentElement.classList.add('search-open');

    // Focus the input after layout
    requestAnimationFrame(() => {
      input.focus();
      input.select?.();
      // In case Algolia computes sizes on resize, give it a nudge
      window.dispatchEvent(new Event('resize'));
    });

    return true;
  }

  // Now properly define closeLectureSearch
  closeLectureSearch = function() {
    const overlay = document.getElementById('lecture-search-overlay');
    if (!overlay || !overlay.classList.contains('open')) return;

    stopPanelObserver();

    const { root } = findAutocomplete();

    // Move panel (if currently inside modal) back to body to let Algolia clean up normally
    const modal = overlay.querySelector('.lecture-search-modal');
    const panel = modal?.querySelector('.aa-Panel');
    if (panel) document.body.appendChild(panel);

    // Put the autocomplete root back where it came from
    if (root && acAnchor && acAnchor.parentNode) {
      acAnchor.parentNode.insertBefore(root, acAnchor.nextSibling);
    }

    overlay.classList.remove('open');
    document.documentElement.classList.remove('search-open');
  };

  // Existing hotkeys:
  document.addEventListener('keydown', (e) => {
    const tag = e.target.tagName.toLowerCase();
    const typing = tag === 'input' || tag === 'textarea' || tag === 'select' || e.isComposing;
    if (typing) return;

    if (e.key === 'F' && e.shiftKey) {
      if (openLectureSearch()) {
        e.preventDefault();
        e.stopPropagation();
      }
    }
    if (e.key === 'Escape') {
      closeLectureSearch();
    }
  });

});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const tools = document.querySelector('#quarto-header .quarto-navbar-tools');
  if (!tools) return;

  // Create the print/save button
  const printBtn = document.createElement('button');
  printBtn.id = 'print-pdf-header-toggle';
  printBtn.className = 'btn-print-pdf';
  printBtn.type = 'button';
  printBtn.setAttribute('aria-label', 'Print or save as PDF');
  printBtn.setAttribute('title', 'Print/Save PDF (Ctrl+P)');

  // SVG icon (printer icon without control dot)
  printBtn.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <!-- Paper/document -->
      <path d="M6 9V2h12v7"/>
      <!-- Printer body -->
      <path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/>
      <!-- Output paper -->
      <rect x="6" y="14" width="12" height="8" rx="1"/>
    </svg>
  `;

  // Place it after the zoom button (if present) or color toggle
  const zoomToggle = tools.querySelector('#lecture-zoom-header-toggle');
  const colorToggle = tools.querySelector('.quarto-color-scheme-toggle');
  
  if (zoomToggle && zoomToggle.parentNode) {
    zoomToggle.parentNode.insertBefore(printBtn, zoomToggle.nextSibling);
  } else if (colorToggle && colorToggle.parentNode) {
    colorToggle.parentNode.insertBefore(printBtn, colorToggle.nextSibling);
  } else {
    tools.appendChild(printBtn);
  }

  // Helper function to expand all collapsible content
  const expandAllContent = () => {
    const expandedElements = [];

    // Quarto callout blocks with collapse
    document.querySelectorAll('.callout.collapse').forEach(callout => {
      if (!callout.classList.contains('show')) {
        callout.classList.add('show', 'printing-expanded');
        expandedElements.push(callout);
      }
    });

    // Details/summary elements
    document.querySelectorAll('details:not([open])').forEach(details => {
      details.setAttribute('open', '');
      details.classList.add('printing-expanded');
      expandedElements.push(details);
    });

    // Bootstrap collapse elements
    document.querySelectorAll('.collapse:not(.show)').forEach(collapse => {
      collapse.classList.add('show', 'printing-expanded');
      expandedElements.push(collapse);
    });

    // Quarto tabsets - show all tab content
    document.querySelectorAll('.tab-pane:not(.active)').forEach(tab => {
      tab.classList.add('active', 'show', 'printing-expanded');
      expandedElements.push(tab);
    });

    return expandedElements;
  };

  // Helper function to restore collapsed state
  const restoreCollapsedContent = (elements) => {
    elements.forEach(el => {
      if (el.classList.contains('printing-expanded')) {
        if (el.tagName === 'DETAILS') {
          el.removeAttribute('open');
        } else if (el.classList.contains('callout')) {
          el.classList.remove('show');
        } else if (el.classList.contains('collapse')) {
          el.classList.remove('show');
        } else if (el.classList.contains('tab-pane')) {
          el.classList.remove('active', 'show');
        }
        el.classList.remove('printing-expanded');
      }
    });
  };

  // Show print options dialog
  const showPrintDialog = () => {
    // Remove any existing dialog
    const existingDialog = document.getElementById('print-options-dialog');
    if (existingDialog) existingDialog.remove();

    // Get chapter list from sidebar
    const chapters = getChapterList();
    const currentChapter = getCurrentChapterInfo();

    const dialog = document.createElement('div');
    dialog.id = 'print-options-dialog';
    dialog.className = 'print-dialog-overlay';
    dialog.innerHTML = `
      <div class="print-dialog">
        <h3>Print Options</h3>
        
        <div class="print-option">
          <label>
            Print scope:
            <select id="print-scope">
              <option value="current">Current page only</option>
              <option value="chapter">Current chapter (${currentChapter.name})</option>
              <option value="part">Current part (${currentChapter.partName})</option>
              <option value="selected">Selected chapters...</option>
              <option value="all">Entire book</option>
            </select>
          </label>
        </div>

        <div class="print-option" id="chapter-selection" style="display: none;">
          <label>Select chapters to print:</label>
          <div class="chapter-list">
            ${chapters.map(ch => `
              <label class="chapter-item">
                <input type="checkbox" value="${ch.href}" data-title="${ch.title}">
                ${ch.part ? `<strong>${ch.part}</strong>` : ''} ${ch.title}
              </label>
            `).join('')}
          </div>
        </div>
        
        <div class="print-option">
          <label>
            <input type="checkbox" id="print-expand-all" checked>
            Expand all collapsed content
          </label>
        </div>
        
        <div class="print-option">
          <label>
            <input type="checkbox" id="print-page-numbers" checked>
            Add page numbers
          </label>
        </div>
        
        <div class="print-option">
          <label>
            <input type="checkbox" id="print-chapter-info" checked>
            Include chapter/section headers
          </label>
        </div>

        <div class="print-option">
          <label>
            Layout:
            <select id="print-layout">
              <option value="default">Default</option>
              <option value="compact">Compact (smaller margins)</option>
              <option value="wide">Wide (full width)</option>
            </select>
          </label>
        </div>
        
        <div class="print-progress" id="print-progress" style="display: none;">
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
          <div class="progress-text">Preparing pages...</div>
        </div>
        
        <div class="print-actions">
          <button class="btn-print-cancel">Cancel</button>
          <button class="btn-print-confirm">Print</button>
        </div>
      </div>
    `;

    document.body.appendChild(dialog);

    // Handle scope change
    const scopeSelect = dialog.querySelector('#print-scope');
    const chapterSelection = dialog.querySelector('#chapter-selection');
    
    scopeSelect.addEventListener('change', () => {
      chapterSelection.style.display = scopeSelect.value === 'selected' ? 'block' : 'none';
    });

    // Handle dialog actions
    const confirmBtn = dialog.querySelector('.btn-print-confirm');
    const cancelBtn = dialog.querySelector('.btn-print-cancel');

    confirmBtn.addEventListener('click', () => {
      const scope = dialog.querySelector('#print-scope').value;
      const options = {
        expandAll: dialog.querySelector('#print-expand-all').checked,
        pageNumbers: dialog.querySelector('#print-page-numbers').checked,
        chapterInfo: dialog.querySelector('#print-chapter-info').checked,
        layout: dialog.querySelector('#print-layout').value,
        scope: scope
      };
      
      // Get selected chapters if scope is 'selected'
      if (scope === 'selected') {
        options.chapters = Array.from(dialog.querySelectorAll('.chapter-item input:checked'))
          .map(cb => ({ href: cb.value, title: cb.dataset.title }));
      }
      
      dialog.remove();
      
      // Handle different scopes
      if (scope === 'current') {
        triggerPrint(options);
      } else {
        triggerMultiPagePrint(options);
      }
    });

    cancelBtn.addEventListener('click', () => {
      dialog.remove();
    });

    // Close on backdrop click
    dialog.addEventListener('click', (e) => {
      if (e.target === dialog) dialog.remove();
    });

    // Close on Escape
    const escHandler = (e) => {
      if (e.key === 'Escape') {
        dialog.remove();
        document.removeEventListener('keydown', escHandler);
      }
    };
    document.addEventListener('keydown', escHandler);
  };

  // Get chapter list from sidebar
  const getChapterList = () => {
    const chapters = [];
    const sidebar = document.querySelector('.sidebar-navigation');
    if (!sidebar) return chapters;
    
    let currentPart = '';
    sidebar.querySelectorAll('.sidebar-item').forEach(item => {
      if (item.querySelector('.sidebar-item-text')?.classList.contains('sidebar-part')) {
        currentPart = item.textContent.trim();
      } else if (item.querySelector('a')) {
        const link = item.querySelector('a');
        chapters.push({
          href: link.getAttribute('href'),
          title: link.textContent.trim(),
          part: currentPart,
          element: item
        });
      }
    });
    
    return chapters;
  };

  // Get current chapter info - FIXED version
  const getCurrentChapterInfo = () => {
    // Try to find the active sidebar item
    let active = document.querySelector('.sidebar-item.active a');
    if (!active) {
      // Fallback: check if we're on a chapter page
      const chapterTitle = document.querySelector('h1.chapter-title, .title')?.textContent?.trim();
      return { name: chapterTitle || 'Current Page', partName: 'No part' };
    }
    
    const title = active.textContent.trim();
    
    // Find part name by traversing up from the active item
    let partName = '';
    let currentEl = active.closest('.sidebar-item');
    
    // Go up through previous siblings until we find a part
    while (currentEl) {
      currentEl = currentEl.previousElementSibling;
      if (currentEl && currentEl.querySelector('.sidebar-part, .chapter-part')) {
        partName = currentEl.textContent.trim();
        break;
      }
    }
    
    // If not found, check parent sections
    if (!partName) {
      const parentSection = active.closest('.chapter-section');
      if (parentSection) {
        const partEl = parentSection.querySelector('.sidebar-part, .chapter-part');
        if (partEl) partName = partEl.textContent.trim();
      }
    }
    
    return { name: title, partName: partName || 'Main Content' };
  };

  // Get chapters for current part
  const getChaptersInPart = (partName) => {
    const chapters = getChapterList();
    const inPart = [];
    let foundPart = false;
    
    for (const ch of chapters) {
      if (ch.part === partName) {
        foundPart = true;
        inPart.push(ch);
      } else if (foundPart && ch.part !== partName) {
        break; // Moved to next part
      }
    }
    
    return inPart;
  };

  // Multi-page print handler
  const triggerMultiPagePrint = async (options) => {
    const progressEl = document.getElementById('print-progress');
    const progressBar = progressEl?.querySelector('.progress-fill');
    const progressText = progressEl?.querySelector('.progress-text');
    
    if (progressEl) progressEl.style.display = 'block';
    
    // Determine which chapters to print
    let chaptersToPrint = [];
    
    switch (options.scope) {
      case 'all':
        chaptersToPrint = getChapterList();
        break;
      case 'part':
        const currentInfo = getCurrentChapterInfo();
        chaptersToPrint = getChaptersInPart(currentInfo.partName);
        break;
      case 'chapter':
        // For current chapter, just use single page print
        triggerPrint(options);
        return;
      case 'selected':
        chaptersToPrint = options.chapters || [];
        break;
    }
    
    if (chaptersToPrint.length === 0) {
      alert('No chapters selected for printing');
      return;
    }
    
    // Create iframe for loading pages
    const iframe = document.createElement('iframe');
    iframe.style.position = 'absolute';
    iframe.style.left = '-9999px';
    iframe.style.width = '1000px';
    iframe.style.height = '1000px';
    document.body.appendChild(iframe);
    
    // Collect all pages
    const printPages = [];
    
    for (let i = 0; i < chaptersToPrint.length; i++) {
      const chapter = chaptersToPrint[i];
      const progress = ((i + 1) / chaptersToPrint.length) * 100;
      
      if (progressBar) progressBar.style.width = progress + '%';
      if (progressText) progressText.textContent = `Loading ${chapter.title}...`;
      
      try {
        // Load page in iframe
        const pageContent = await loadPageInIframe(iframe, chapter.href);
        
        // Process the page
        if (options.expandAll) {
          expandAllContentInDocument(iframe.contentDocument);
        }
        
        // Extract and store the content
        const content = iframe.contentDocument.querySelector('.content, main, article')?.innerHTML || '';
        printPages.push({
          title: chapter.title,
          content: content
        });
        
      } catch (err) {
        console.error(`Failed to load ${chapter.title}:`, err);
      }
    }
    
    // Clean up
    iframe.remove();
    if (progressEl) progressEl.style.display = 'none';
    
    // Create combined print document
    createCombinedPrintDocument(printPages, options);
  };

  // Load page in iframe
  const loadPageInIframe = (iframe, href) => {
    return new Promise((resolve, reject) => {
      const timeout = setTimeout(() => {
        reject(new Error('Page load timeout'));
      }, 10000);
      
      iframe.onload = () => {
        clearTimeout(timeout);
        // Wait a bit for JS to run
        setTimeout(() => resolve(iframe.contentDocument), 500);
      };
      
      iframe.src = href;
    });
  };

  // Expand content in a document
  const expandAllContentInDocument = (doc) => {
    // Quarto callout blocks
    doc.querySelectorAll('.callout.collapse').forEach(callout => {
      callout.classList.add('show');
    });

    // Details elements
    doc.querySelectorAll('details').forEach(details => {
      details.setAttribute('open', '');
    });

    // Bootstrap collapse
    doc.querySelectorAll('.collapse').forEach(collapse => {
      collapse.classList.add('show');
    });
  };

  // Create combined document for printing - FIXED version
  const createCombinedPrintDocument = (pages, options) => {
    // Create new window for printing
    const printWindow = window.open('', '_blank');
    
    // Collect all stylesheets except those that might interfere
    const stylesheets = Array.from(document.querySelectorAll('link[rel="stylesheet"]'))
      .filter(link => !link.href.includes('quarto-html'))
      .map(link => link.outerHTML).join('\n');
    
    // Build HTML
    const html = `
      <!DOCTYPE html>
      <html class="${document.documentElement.className}">
      <head>
        <meta charset="UTF-8">
        <title>MAS2901 Statistical Inference - Print</title>
        ${stylesheets}
        <style>
          /* Reset background for light mode printing */
          @media print {
            body:not(.quarto-dark) {
              background-color: white !important;
              color: black !important;
            }
            
            body:not(.quarto-dark) .content,
            body:not(.quarto-dark) .quarto-container-default,
            body:not(.quarto-dark) main,
            body:not(.quarto-dark) article {
              background-color: white !important;
              color: black !important;
            }
            
            /* Fix math rendering in dark mode */
            .quarto-dark .katex,
            .quarto-dark .MathJax,
            .quarto-dark .MathJax *,
            .quarto-dark .katex * {
              color: #e9ecef !important;
              background-color: transparent !important;
              fill: #e9ecef !important;
            }
            
            /* Ensure OJS figures fit within page */
            .ojs-cell,
            .cell-output-display,
            figure,
            .figure {
              max-width: 100% !important;
              overflow: hidden !important;
              page-break-inside: avoid;
            }
            
            .ojs-cell svg,
            figure svg,
            .cell-output-display svg {
              max-width: 100% !important;
              height: auto !important;
            }
            
            /* Scale down large images/plots */
            img, svg {
              max-width: 100% !important;
              height: auto !important;
            }
            
            /* Hide overflow indicators */
            * {
              overflow: visible !important;
            }
            
            pre {
              overflow-wrap: break-word !important;
              white-space: pre-wrap !important;
            }
            
            /* Page breaks */
            .chapter-break { 
              page-break-before: always;
              margin-top: 0 !important;
            }
            
            /* Remove section headers that duplicate */
            .sidebar-title,
            .navbar-title,
            .quarto-title-meta {
              display: none !important;
            }
            
            /* Compact layout adjustments */
            body.print-layout-compact {
              font-size: 10pt;
              line-height: 1.4;
            }
            
            body.print-layout-compact h1 { font-size: 1.4em; }
            body.print-layout-compact h2 { font-size: 1.2em; }
            body.print-layout-compact h3 { font-size: 1.1em; }
            
            /* Wide layout */
            body.print-layout-wide .content {
              max-width: 100% !important;
              margin: 0.5in !important;
            }
            
            /* Hide navigation elements */
            .quarto-title-breadcrumbs,
            .page-navigation,
            .nav-footer {
              display: none !important;
            }
          }
          
          /* Dark mode specific fixes */
          ${document.body.classList.contains('quarto-dark') ? `
          html, body {
            background-color: #1a1a1a !important;
            color: #e9ecef !important;
          }
          ` : ''}
        </style>
      </head>
      <body class="${document.body.className} printing print-layout-${options.layout} ${options.pageNumbers ? 'print-page-numbers' : ''} ${options.chapterInfo ? 'print-chapter-info' : ''}">
        ${pages.map((page, i) => `
          <div class="${i > 0 ? 'chapter-break' : ''}">
            <h1 class="chapter-title">${page.title}</h1>
            ${page.content}
          </div>
        `).join('\n')}
      </body>
      </html>
    `;
    
    printWindow.document.write(html);
    printWindow.document.close();
    
    // Wait for content to render
    printWindow.onload = () => {
      setTimeout(() => {
        // Final cleanup before printing
        const doc = printWindow.document;
        
        // Remove duplicate headers
        doc.querySelectorAll('.quarto-title, .title-block-banner').forEach((el, idx) => {
          if (idx > 0) el.remove();
        });
        
        // Scale OJS content
        doc.querySelectorAll('.ojs-cell').forEach(cell => {
          cell.style.maxWidth = '100%';
          cell.style.overflow = 'hidden';
        });
        
        printWindow.print();
        
        // Close after print dialog
        printWindow.onafterprint = () => {
          printWindow.close();
        };
      }, 1000); // Give more time for math to render
    };
  };

  // Print handler with options
  const triggerPrint = (options) => {
    let expandedElements = [];
    
    // Apply print classes based on options
    document.body.classList.add('printing');
    if (options.pageNumbers) document.body.classList.add('print-page-numbers');
    if (options.chapterInfo) document.body.classList.add('print-chapter-info');
    document.body.classList.add(`print-layout-${options.layout}`);
    
    // Store chapter/section info
    const chapterTitle = document.querySelector('h1.title')?.textContent || '';
    const courseTitle = 'MAS2901 Statistical Inference';
    document.body.setAttribute('data-chapter-title', chapterTitle);
    document.body.setAttribute('data-course-title', courseTitle);
    
    // Force dark mode styles to be applied to documentElement too
    if (document.body.classList.contains('quarto-dark')) {
      document.documentElement.classList.add('printing-dark');
    }
    
    // Expand content if requested
    if (options.expandAll) {
      expandedElements = expandAllContent();
    }
    
    // Small delay to ensure DOM updates
    setTimeout(() => {
      window.print();
      
      // Clean up after print dialog closes
      window.addEventListener('afterprint', function cleanup() {
        document.body.classList.remove('printing', 'print-page-numbers', 
          'print-chapter-info', `print-layout-${options.layout}`);
        document.documentElement.classList.remove('printing-dark');
        
        // Restore collapsed state
        if (expandedElements.length > 0) {
          restoreCollapsedContent(expandedElements);
        }
        
        window.removeEventListener('afterprint', cleanup);
      });
    }, 100);
  };

  // Click handler - show options dialog
  printBtn.addEventListener('click', () => {
    showPrintDialog();
  });
  
  // Direct print shortcut (Ctrl+Shift+P) - use default options
  document.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'p' && 
        !/input|textarea|select/i.test(e.target.tagName)) {
      e.preventDefault();
      showPrintDialog();
    }
  });
});
</script>

<style>
/* Button styling to match other header buttons */
.btn-print-pdf {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.375rem;
  margin: 0 0.25rem;
  border-radius: 0.25rem;
  color: var(--bs-navbar-color, #333);
  transition: opacity 0.15s ease-in-out;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.btn-print-pdf:hover {
  opacity: 0.7;
}

.btn-print-pdf svg {
  width: 1.2rem;
  height: 1.2rem;
}

/* Print options dialog */
.print-dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.print-dialog {
  background: var(--bs-body-bg, white);
  color: var(--bs-body-color, black);
  padding: 2rem;
  border-radius: 0.5rem;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

.print-dialog h3 {
  margin: 0 0 1.5rem 0;
  font-size: 1.25rem;
}

.print-option {
  margin-bottom: 1rem;
}

.print-option label {
  display: flex;
  align-items: center;
  cursor: pointer;
  user-select: none;
}

.print-option input[type="checkbox"] {
  margin-right: 0.5rem;
}

.print-option select {
  margin-left: 0.5rem;
  padding: 0.25rem 0.5rem;
  border: 1px solid var(--bs-border-color, #ddd);
  border-radius: 0.25rem;
  background: var(--bs-body-bg, white);
  color: var(--bs-body-color, black);
}

/* Chapter selection list */
.chapter-list {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid var(--bs-border-color, #ddd);
  border-radius: 0.25rem;
  padding: 0.5rem;
  margin-top: 0.5rem;
}

.chapter-item {
  display: block;
  padding: 0.25rem 0;
  margin: 0;
}

.chapter-item input {
  margin-right: 0.5rem;
}

/* Progress bar */
.print-progress {
  margin-top: 1rem;
}

.progress-bar {
  height: 20px;
  background: var(--bs-gray-200, #e9ecef);
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 0.5rem;
}

.progress-fill {
  height: 100%;
  background: var(--bs-primary, #007bff);
  width: 0%;
  transition: width 0.3s ease;
}

.progress-text {
  text-align: center;
  font-size: 0.875rem;
  color: var(--bs-secondary, #6c757d);
}

.print-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.5rem;
  margin-top: 1.5rem;
}

.print-actions button {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 0.25rem;
  cursor: pointer;
  font-size: 0.9rem;
}

.btn-print-confirm {
  background: var(--bs-primary, #007bff);
  color: white;
}

.btn-print-cancel {
  background: var(--bs-secondary, #6c757d);
  color: white;
}

.print-actions button:hover {
  opacity: 0.9;
}

/* Dark mode support */
.quarto-dark .btn-print-pdf {
  color: var(--bs-navbar-dark-color, #fff);
}

  /* Print-specific styles */
@media print {
  /* Hide UI elements */
  #quarto-header,
  #quarto-sidebar,
  .quarto-navbar,
  .btn-print-pdf,
  .btn-zoom-toggle,
  .quarto-color-scheme-toggle,
  .print-dialog-overlay,
  .ink-tool-container,
  #ink-canvas-container,
  #inkpad-canvas,
  .inkpad-toolbar {
    display: none !important;
  }
  
  /* Force background colors and proper color adjustments */
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color-adjust: exact !important;
  }
  
  /* Light mode: force pure white background */
  body:not(.quarto-dark),
  body:not(.quarto-dark) .content,
  body:not(.quarto-dark) .quarto-container-default,
  body:not(.quarto-dark) main,
  body:not(.quarto-dark) article,
  body:not(.quarto-dark) pre,
  body:not(.quarto-dark) code {
    background-color: white !important;
    background: white !important;
  }
  
  /* Apply dark mode to both html and body for first page fix */
  html.printing-dark,
  html.printing-dark body,
  .quarto-dark,
  .quarto-dark body {
    background-color: #1a1a1a !important;
    color: #e9ecef !important;
  }
  
  /* Ensure the root and all containers have dark background */
  html.printing-dark *,
  .quarto-dark * {
    background-color: inherit;
    color: inherit;
  }
  
  /* Specific dark mode overrides */
  html.printing-dark .content,
  html.printing-dark .quarto-container-default,
  html.printing-dark main,
  html.printing-dark article,
  .quarto-dark .content,
  .quarto-dark .quarto-container-default,
  .quarto-dark main,
  .quarto-dark article {
    background-color: #1a1a1a !important;
    color: #e9ecef !important;
  }
  
  /* Dark mode code blocks */
  html.printing-dark pre,
  html.printing-dark code,
  .quarto-dark pre,
  .quarto-dark code {
    background-color: #2d2d2d !important;
    color: #e9ecef !important;
    border-color: #444 !important;
  }
  
  /* Fix math rendering - remove backgrounds */
  .katex,
  .MathJax,
  .katex *,
  .MathJax *,
  .MathJax_Display,
  .MathJax_Preview,
  mjx-container,
  mjx-container *,
  .katex-display,
  .katex-html {
    background-color: transparent !important;
    background: transparent !important;
  }
  
  /* Dark mode math text color */
  .quarto-dark .katex,
  .quarto-dark .MathJax,
  .quarto-dark mjx-container,
  html.printing-dark .katex,
  html.printing-dark .MathJax,
  html.printing-dark mjx-container {
    color: #e9ecef !important;
  }
  
  /* OJS and figure scaling */
  .ojs-cell,
  .cell-output-display,
  .cell-output,
  .figure,
  figure {
    max-width: 100% !important;
    width: auto !important;
    overflow: visible !important;
    page-break-inside: avoid;
  }
  
  .ojs-cell > *,
  .cell-output-display > * {
    max-width: 100% !important;
  }
  
  /* Scale SVGs and images */
  svg, img {
    max-width: 100% !important;
    height: auto !important;
    width: auto !important;
    display: block;
  }
  
  /* Handle wide tables */
  table {
    font-size: 0.9em;
    max-width: 100% !important;
  }
  
  .table-responsive {
    overflow: visible !important;
  }
  
  /* Code blocks shouldn't overflow */
  pre {
    max-width: 100% !important;
    overflow-wrap: break-word !important;
    white-space: pre-wrap !important;
    word-break: break-word !important;
  }
  
  /* Dark mode callouts */
  html.printing-dark .callout,
  .quarto-dark .callout {
    background-color: #2d2d2d !important;
    border: 1px solid #444 !important;
    color: #e9ecef !important;
  }
  
  html.printing-dark .callout-title,
  .quarto-dark .callout-title {
    color: #e9ecef !important;
  }
  
  /* Dark mode tables */
  html.printing-dark table,
  .quarto-dark table {
    background-color: transparent !important;
    color: #e9ecef !important;
  }
  
  html.printing-dark th,
  .quarto-dark th {
    background-color: #2d2d2d !important;
    border-color: #444 !important;
  }
  
  html.printing-dark td,
  .quarto-dark td {
    background-color: transparent !important;
    border-color: #444 !important;
  }
  
  /* Dark mode links */
  html.printing-dark a,
  .quarto-dark a {
    color: #66b3ff !important;
  }
  
  /* Page setup with dark background */
  @page {
    margin: 0.75in;
    size: letter;
    
    @bottom-right {
      content: counter(page);
    }
  }
  
  /* First page specific fix */
  @page :first {
    margin-top: 0.5in;
  }
  
  /* Default layout */
  .quarto-container-default {
    max-width: 100% !important;
    padding: 0 !important;
  }
  
  /* Compact layout */
  body.print-layout-compact {
    font-size: 10pt;
  }
  
  body.print-layout-compact .content {
    margin: 0.5in !important;
  }
  
  /* Wide layout */
  body.print-layout-wide .content {
    margin: 0.25in !important;
  }
  
  /* Force expanded content to show as expanded */
  .printing-expanded.callout.collapse,
  .printing-expanded.collapse {
    display: block !important;
  }
  
  /* Tab content - show with headers */
  body.printing .tab-pane.printing-expanded {
    display: block !important;
    border-top: 1px solid #ddd;
    padding-top: 1rem;
    margin-top: 1rem;
  }
  
  html.printing-dark .tab-pane.printing-expanded,
  .quarto-dark.printing .tab-pane.printing-expanded {
    border-top-color: #444 !important;
  }
  
  body.printing .tab-pane.printing-expanded::before {
    content: attr(aria-labelledby);
    font-weight: bold;
    display: block;
    margin-bottom: 0.5rem;
  }
  
  /* Page numbers */
  body.print-page-numbers {
    counter-reset: page;
  }
  
  /* Chapter info header */
  body.print-chapter-info::before {
    content: attr(data-course-title) " - " attr(data-chapter-title);
    position: fixed;
    top: 0;
    right: 0;
    font-size: 10pt;
    color: #666;
    padding: 0.5rem;
    z-index: 10000;
    background-color: transparent !important;
  }
  
  html.printing-dark .print-chapter-info::before,
  .quarto-dark.print-chapter-info::before {
    color: #aaa !important;
  }
  
  /* Page breaks */
  .chapter, h1, h2 {
    page-break-before: auto;
    page-break-after: avoid;
  }
  
  /* Avoid breaks inside elements */
  pre, blockquote, figure, .callout, table {
    page-break-inside: avoid;
  }
  
  /* Ensure callout styling prints well */
  .callout {
    border: 1px solid #ddd !important;
    padding: 0.5rem !important;
  }
  
  /* Mathematics in dark mode */
  html.printing-dark .katex,
  html.printing-dark .MathJax,
  .quarto-dark .katex,
  .quarto-dark .MathJax {
    color: #e9ecef !important;
  }
  
  /* Images and figures */
  html.printing-dark img,
  .quarto-dark img {
    opacity: 0.9;
  }
  
  /* Blockquotes */
  html.printing-dark blockquote,
  .quarto-dark blockquote {
    border-left-color: #444 !important;
    color: #adb5bd !important;
    background-color: transparent !important;
  }
}
</style>
<style>


  .inkpad-toolbar:not(.open){ display:none !important; }
  .inkpad-toolbar.open{ display:flex; }

  /* Ensure toolbar always clickable (and fast on touch) */
  .inkpad-toolbar{ pointer-events:auto; }
  .inkpad-btn{ touch-action:manipulation; user-select:none; }

  /* Nice visual cue when drawing */
  #inkpad-canvas.drawing { cursor: crosshair !important; }
  #quarto-content > #inkpad-canvas { padding-top: 0 !important; }

/* And make sure the canvas itself never has padding/margins */
  #inkpad-canvas { padding: 0 !important; margin: 0; display: block; box-sizing: content-box; }

  /* Floating toolbar */
  .inkpad-toolbar {
    position: fixed; z-index: 9999; right: 10px; bottom: 10px;
    gap: 4px; background: transparent;
    padding: 2px; border-radius: 8px;
  }
  .inkpad-btn {
    border: 0; border-radius: 10px; padding: 8px 10px; color: var(--brand-fg); cursor: pointer;
    background: var(--surface); font: 600 12px/1.1;
  }
  .inkpad-btn.active { background: var(--brand-teal); color: var(--brand-bg) }

  /* Icon sizing + swapping */
.inkpad-btn .inkpad-icon { width: 18px; height: 18px; display: block; }

/* Micro-interaction polish (respects currentColor / theme) */
.inkpad-btn .icon-pen { transition: transform .15s ease; }
.inkpad-btn:hover .icon-pen { transform: translateY(-1px) rotate(-8deg); }
@media (prefers-reduced-motion: reduce) {
  .inkpad-btn .icon-pen { transition: none; }
}

  /* Canvas overlay (document-sized, scrolls with page) */
#inkpad-canvas {
  position: fixed; 
  top: 0; 
  left: 0;
  z-index: 9998;
  touch-action: none;
  padding: 0 !important; 
  margin: 0; 
  display: block; 
  box-sizing: content-box;
  pointer-events: none; /* You're already toggling this in JS */
}

/*  Hide during print */
@media print {
  #inkpad-canvas {
    display: none !important;
    position: absolute !important; /* fallback */
    width: 0 !important;
    height: 0 !important;
  }
}


/* ----- Popover ----- */
.inkpad-popover {
  position: fixed;
  right: 10px;
  bottom: 56px;                /* sits just above the toolbar */
  z-index: 10000;
  display: none;
  padding: 10px;
  background: var(--surface);
  color: var(--brand-fg);
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,.22);
  width: 240px;
}

/* little arrow pointing to the toolbar */
.inkpad-popover::after {
  content: "";
  position: absolute;
  right: 18px;
  bottom: -8px;
  width: 14px; height: 14px;
  background: var(--surface);
  transform: rotate(45deg);
  box-shadow: 3px 3px 10px rgba(0,0,0,.12);
}

.inkpad-popover.open { display: block; }

.inkpad-field {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 10px;
}
.inkpad-field:last-child { margin-bottom: 0; }

.inkpad-field label {
  font: 600 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  color: var(--brand-fg);
}
.inkpad-out {
  font-weight: 700;
  color: var(--brand-teal);
}

/* ----- Color input (tidy circular swatch) ----- */
#inkpad-color {
  appearance: none;
  -webkit-appearance: none;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  padding: 0;
  border: 2px solid rgba(0,0,0,.15);
  background: transparent;
  cursor: pointer;
  overflow: hidden;
}
#inkpad-color::-webkit-color-swatch-wrapper { padding: 0; }
#inkpad-color::-webkit-color-swatch {
  border: none;
  border-radius: 50%;
}
#inkpad-color::-moz-color-swatch {
  border: none;
  border-radius: 50%;
}

/* ----- Range sliders (brand-styled, accessible) ----- */
#inkpad-size,
#inkpad-eraser-size {
  width: 100%;
  height: 28px;                 /* easier to grab on touch */
  background: transparent;
  cursor: pointer;
}

/* WebKit */
#inkpad-size::-webkit-slider-runnable-track,
#inkpad-eraser-size::-webkit-slider-runnable-track {
  height: 6px;
  background: linear-gradient(90deg, var(--brand-teal), var(--brand-teal)) 0/var(--_fill,0%) 100% no-repeat,
              color-mix(in oklab, var(--brand-fg) 10%, transparent);
  border-radius: 999px;
}
#inkpad-size::-webkit-slider-thumb,
#inkpad-eraser-size::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--brand-bg);
  border: 2px solid var(--brand-teal);
  margin-top: -6px;            /* centers thumb on 6px track */
}

/* Firefox */
#inkpad-size::-moz-range-track,
#inkpad-eraser-size::-moz-range-track {
  height: 6px;
  background: color-mix(in oklab, var(--brand-fg) 10%, transparent);
  border-radius: 999px;
}
#inkpad-size::-moz-range-progress,
#inkpad-eraser-size::-moz-range-progress {
  height: 6px;
  background: var(--brand-teal);
  border-radius: 999px;
}
#inkpad-size::-moz-range-thumb,
#inkpad-eraser-size::-moz-range-thumb {
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--brand-bg);
  border: 2px solid var(--brand-teal);
}

/* Improve focus ring for a11y */
#inkpad-color:focus-visible,
#inkpad-size:focus-visible,
#inkpad-eraser-size:focus-visible,
#inkpad-options:focus-visible {
  outline: 2px solid var(--brand-teal);
  outline-offset: 2px;
}


/* visually hidden helper */
.sr-only {
  position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden;
  clip:rect(0,0,0,0); white-space:nowrap; border:0;
}

/* icons inherit theme via currentColor */
.inkpad-icon { width: 18px; height: 18px; display: block; }

/* show/hide by state */
/* --- Toggle: icon swapping --- */
.inkpad-toggle .icon-pen { display: inline-block; }
.inkpad-toggle .icon-stop { display: none; }
.inkpad-toggle[aria-pressed="true"] .icon-pen { display: none; }
.inkpad-toggle[aria-pressed="true"] .icon-stop { display: inline-block; }

/* --- Toggle: visuals --- */
.inkpad-toggle {
  --ink-accent: var(--brand-red); /* customize if you like */
  --ink-off-border: color-mix(in oklab, var(--brand-fg) 28%, transparent);

  background: var(--brand-bg);
  color: var(--brand-fg);
  border: 1.5px solid var(--ink-off-border);
  padding: 6px 10px;
}

/* hover/focus when OFF */
.inkpad-toggle:hover {
  border-color: var(--brand-fg);
  background: color-mix(in oklab, var(--brand-bg) 90%, var(--brand-red));
}
.inkpad-toggle:focus-visible {
  outline: 2px solid var(--ink-accent);
  outline-offset: 2px;
}

/* ON state = “solid” */
.inkpad-toggle[aria-pressed="true"] {
  background: var(--ink-accent);
  border-color: var(--ink-accent);
  color: var(--brand-bg); /* makes icon stroke flip to readable */
}

/* Icon sizing + color via currentColor */
.inkpad-toggle .inkpad-icon {
  width: 16px; height: 16px;
  stroke: currentColor; /* override any inline stroke */
}

/* Subtle pen tilt only when OFF; never rotate the stop square */
.inkpad-toggle[aria-pressed="false"] .icon-pen {
  transform: rotate(-8deg) translateY(-1px);
}
.inkpad-toggle .icon-stop { transform: none !important; }




/* Mobile: turn the popover into a bottom sheet */
@media (max-width: 560px) {
  .inkpad-popover {
    right: 10px; left: 10px;
    bottom: 60px;
    width: auto;
  }
  .inkpad-popover::after { right: 24px; }
}

.inkpad-btn.active .inkpad-icon { transform: rotate(30deg); transition: transform .15s ease; }
.inkpad-btn .icon-stop { transform: none !important; }


/* Buttons: press/focus feedback + disabled state */
.inkpad-btn {
  transition: transform 120ms ease, box-shadow 160ms ease, background 160ms ease, opacity 120ms ease;
}
.inkpad-btn:active:not([disabled]) { transform: translateY(1px) scale(0.98); }
.inkpad-btn:focus-visible { outline: 2px solid var(--brand-red); outline-offset: 2px; }
.inkpad-btn[disabled] { opacity: .5; cursor: not-allowed; }

/* Quick flash ring when action fires */
.inkpad-btn.flash { box-shadow: 0 0 0 3px color-mix(in oklab, var(--brand-teal) 35%, transparent) inset; }
@media (prefers-reduced-motion: reduce) {
  .inkpad-btn { transition: none; }
}

/* Toast next to the toolbar */
.inkpad-toast {
  position: fixed; right: 12px; bottom: 56px; z-index: 10001;
  background: var(--surface); color: var(--brand-fg); border-radius: 10px;
  padding: 8px 10px; font: 600 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  box-shadow: 0 8px 24px rgba(0,0,0,.18);
  opacity: 0; transform: translateY(6px); pointer-events: none;
  transition: opacity 160ms ease, transform 160ms ease;
}
.inkpad-toast.show { opacity: 1; transform: translateY(0); }


/* --- Toggle icon swapping (put these LAST) --- */
#inkpad-toggle .inkpad-icon { display: none; }                /* hide both */
#inkpad-toggle[aria-pressed="false"] .icon-pen  { display: inline-block; }
#inkpad-toggle[aria-pressed="true"]  .icon-stop { display: inline-block; }




</style>

<div class="inkpad-toolbar" id="inkpad-toolbar" aria-label="Ink toolbar" aria-hidden="true">
<button class="inkpad-btn inkpad-toggle" id="inkpad-toggle" type="button" aria-pressed="false" title="Draw (D)" aria-label="Draw (D)">
  <span class="sr-only">Toggle ink</span>

  <!-- Start (Pen) -->
  <svg class="inkpad-icon icon-pen" viewbox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true">
    <path d="M3 21l3.5-1 9.9-9.9a2.8 2.8 0 0 0 0-4L15 3.7a2.8 2.8 0 0 0-4 0L1 13.7 0 18.5 3 21z"></path>
    <circle cx="12" cy="8.5" r="1"></circle>
    <path d="M13 20h8"></path>
  </svg>

  <!-- Stop (Square) -->
  <svg class="inkpad-icon icon-stop" viewbox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" aria-hidden="true">
    <rect x="6" y="6" width="12" height="12" rx="2"></rect>
  </svg>
</button>

  <button class="inkpad-btn active" id="inkpad-pen" type="button" title="Pen (P)">Pen</button>
  <button class="inkpad-btn" id="inkpad-eraser" type="button" title="Eraser (E)">Eraser</button>
  <button class="inkpad-btn" id="inkpad-undo" type="button" title="Undo (Z)">Undo</button>
  <button class="inkpad-btn" id="inkpad-clear" type="button" title="Clear">Clear</button>
  <button class="inkpad-btn" id="inkpad-save" type="button" title="Save PNG">Save</button>
  <button class="inkpad-btn" id="inkpad-options" type="button" title="Pen/Eraser options" aria-expanded="false">
    <svg class="inkpad-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <!-- Feather "settings" glyph -->
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33
                1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51
                1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06
                a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09
                a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06
                a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9
                A1.65 1.65 0 0 0 10 3.09V3a2 2 0 1 1 4 0v.09
                a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06
                a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9
                c0 .66.39 1.27 1 1.51.16.06.33.09.51.09H21a2 2 0 1 1 0 4h-.09
                a1.65 1.65 0 0 0-1.51 1z"></path>
    </svg>
  </button>
</div>
<div id="inkpad-toast" class="inkpad-toast" role="status" aria-live="polite" aria-atomic="true"></div>


<!-- Popover container -->
<div id="inkpad-popover" class="inkpad-popover" aria-hidden="true">
  <div class="inkpad-field">
    <label for="inkpad-color">Pen colour</label>
    <input id="inkpad-color" type="color" value="#ff0055">
  </div>

  <div class="inkpad-field">
    <label for="inkpad-size">
      Pen size <span class="inkpad-out" id="inkpad-size-out">3</span>px
    </label>
    <input id="inkpad-size" type="range" min="1" max="30" step="0.2" value="3">
  </div>

  <div class="inkpad-field">
    <label for="inkpad-eraser-size">
      Eraser size <span class="inkpad-out" id="inkpad-eraser-size-out">12</span>px
    </label>
    <input id="inkpad-eraser-size" type="range" min="5" max="100" step="1" value="24">
  </div>
</div>

<canvas id="inkpad-canvas" aria-hidden="true"></canvas>

<script>
(() => {
  const canvas = document.getElementById('inkpad-canvas');
  const tb = (id) => document.getElementById(id);
  const toolbar = document.getElementById('inkpad-toolbar');
  const key = 'ink:' + location.pathname; // per-page storage key
  const ctx = canvas.getContext('2d');
  let drawingEnabled = false;
  let tool = 'pen'; // 'pen' | 'eraser'
  let penColor   = '#ff0055';
  let penSize    = 3;
  let eraserSize = 12;  // in CSS px
  let strokes = []; // array of {tool, color, size, points:[{x,y,p}]}
  let current = null;
  const baseSize = 3; // base pen size in CSS px


const toastEl = document.getElementById('inkpad-toast');
const undoBtn  = tb('inkpad-undo');
const clearBtn = tb('inkpad-clear');
const saveBtn  = tb('inkpad-save');

function flash(el) {
  if (!el) return;
  el.classList.add('flash');
  setTimeout(() => el.classList.remove('flash'), 180);
}

function showToast(msg, ms = 900) {
  if (!toastEl) return;
  toastEl.textContent = msg;
  toastEl.classList.add('show');
  clearTimeout(showToast._t);
  showToast._t = setTimeout(() => toastEl.classList.remove('show'), ms);
}

// enable/disable actions based on whether there is anything to operate on
function hasInk() {
  return strokes.length > 0 || (current && current.points && current.points.length);
}
function updateActionStates() {
  const enabled = !!hasInk();
  if (undoBtn)  undoBtn.disabled  = !enabled;
  if (clearBtn) clearBtn.disabled = !enabled;
  if (saveBtn)  saveBtn.disabled  = !enabled;
}


  function onButton(id, fn){
    const el = tb(id);
    if(!el) return;
    el.addEventListener('click', (e)=>{
      e.preventDefault();
      e.stopPropagation();
      fn(e);
    }, {passive:false});
  }

// Popover toggle (pure toggle — no outside-click close)
const optionsBtn = document.getElementById('inkpad-options');
const popover    = document.getElementById('inkpad-popover');

if (optionsBtn && popover) {
  const setPopover = (open) => {
    popover.classList.toggle('open', open);
    popover.setAttribute('aria-hidden', String(!open));
    optionsBtn.setAttribute('aria-expanded', String(open));
    optionsBtn.classList.toggle('active', open);
  };

  optionsBtn.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    setPopover(!popover.classList.contains('open'));
  });

  // Optional: keep clicks inside from bubbling (not required, but harmless)
  popover.addEventListener('click', (e) => e.stopPropagation());
}

function setPopover(open) {
  popover.classList.toggle('open', open);
  popover.setAttribute('aria-hidden', String(!open));
  optionsBtn.setAttribute('aria-expanded', String(open));
  optionsBtn.classList.toggle('active', open);
}

popover.addEventListener('click', (e) => e.stopPropagation());


  // read a CSS var once (for ring color); fallback if missing
  const brandTeal = (getComputedStyle(document.documentElement)
    .getPropertyValue('--brand-teal') || '').trim() || '#00c8ff';

   // live eraser preview in PAGE coords (CSS px)
  let hoverPage = null;  // {x, y} or null

  function drawEraserPreview() {
    if (!drawingEnabled || tool !== 'eraser' || !hoverPage) return;

    const r = eraserSize / 2;
    ctx.save();
    // we're already in page space (you set a -scroll transform in redraw)
    ctx.globalCompositeOperation = 'source-over';
    ctx.lineWidth = 1;
    // subtle fill + ring; alpha keeps it unobtrusive
    ctx.fillStyle   = 'rgba(0,0,0,0.06)';                // soft shadow fill
    ctx.strokeStyle = brandTeal;                         // themed ring
    ctx.beginPath();
    ctx.arc(hoverPage.x, hoverPage.y, r, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();
    ctx.restore();
  }

  const colorInput  = document.getElementById('inkpad-color');
  const sizeInput   = document.getElementById('inkpad-size');
  const eraserInput = document.getElementById('inkpad-eraser-size');

  if (colorInput) {
    colorInput.addEventListener('input', e => { penColor = e.target.value; });
  }
  if (sizeInput) {
    sizeInput.addEventListener('input', e => { penSize = +e.target.value; });
  }
  if (eraserInput) {
    eraserInput.addEventListener('input', e => { eraserSize = +e.target.value; });
  }

  // --- slider outputs + track fill ---
  const sizeOut    = document.getElementById('inkpad-size-out');
  const eraserOut  = document.getElementById('inkpad-eraser-size-out');

  function setRangeFill(el) {
    const min = +el.min || 0, max = +el.max || 100, val = +el.value || 0;
    const pct = Math.max(0, Math.min(100, ((val - min) / (max - min)) * 100));
    el.style.setProperty('--_fill', pct + '%');   // used by your CSS gradient
  }

  // initial sync
  if (sizeOut)   sizeOut.textContent   = String(penSize);
  if (eraserOut) eraserOut.textContent = String(eraserSize);
  if (sizeInput)   setRangeFill(sizeInput);
  if (eraserInput) setRangeFill(eraserInput);

  // live updates
  if (sizeInput) {
    sizeInput.addEventListener('input', e => {
        penSize = +e.target.value;
        if (sizeOut) sizeOut.textContent = String(penSize);
        setRangeFill(sizeInput);
    });
  }
  if (eraserInput) {
    eraserInput.addEventListener('input', e => {
        eraserSize = +e.target.value;
        if (eraserOut) eraserOut.textContent = String(eraserSize);
        setRangeFill(eraserInput);
    });
  }

  // Size canvas to the full scrollable document (not just the viewport)
  function docSize() {
    const d = document.documentElement, b = document.body;
    const w = Math.max(d.scrollWidth,  b ? b.scrollWidth  : 0, d.clientWidth);
    const h = Math.max(d.scrollHeight, b ? b.scrollHeight : 0, d.clientHeight);
    return {w: Math.ceil(w), h: Math.ceil(h)};
  }

  function fitCanvas() {
    const dpr = currentDpr();
    const w = window.innerWidth;
    const h = window.innerHeight;

    canvas.width  = Math.ceil(w * dpr);
    canvas.height = Math.ceil(h * dpr);
    canvas.style.width  = w + 'px';
    canvas.style.height = h + 'px';

    // Set transform in redraw().
    scheduleRedraw();
  }

  // Re-measure shortly after load to catch late reflows (math/images)
  setTimeout(fitCanvas, 500);


  // save only serializable fields
  function save(){
    try {
        const lean = strokes.map(({anchorId, tool, color, size, points}) => ({anchorId, tool, color, size, points}));
        localStorage.setItem(key, JSON.stringify(lean));
    } catch {}
  }

  function load(){
    try {
        const s = localStorage.getItem(key);
        strokes = s ? (JSON.parse(s) || []) : [];
        for (const st of strokes) recomputeMeta(st);
    } catch { strokes = []; }
  }

function redraw(){
  const dpr = currentDpr();
  const sx = window.scrollX, sy = window.scrollY;

  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.setTransform(dpr, 0, 0, dpr, -sx * dpr, -sy * dpr);

  const vx0 = sx, vy0 = sy, vx1 = sx + window.innerWidth, vy1 = sy + window.innerHeight;

  // cache anchor offsets this frame
  const anchorCache = new Map();
  const infoFor = (id) => {
    if (!anchorCache.has(id)) anchorCache.set(id, anchorInfo(id));
    return anchorCache.get(id);
  };

  for (const s of strokes) {
    const info = infoFor(s.anchorId || 'global');
    if (!info.visible) continue;
    const B = s.localBBox;
    const absBox = { x0: B.x0 + info.left, y0: B.y0 + info.top, x1: B.x1 + info.left, y1: B.y1 + info.top };
    if (intersects(absBox, vx0, vy0, vx1, vy1)) drawStrokeAnchored(s, info);
  }
  if (current) {
    const info = infoFor(current.anchorId || 'global');
    if (info.visible) drawStrokeAnchored(current, info);
  }

  // draw the eraser halo on top
  drawEraserPreview();
}


  function styleFor(stroke){
    if (stroke.tool === 'eraser') {
        ctx.globalCompositeOperation = 'destination-out';
        ctx.strokeStyle = '#000';
        ctx.lineWidth = stroke.size; // ← eraserSize already baked in
    } else if (stroke.tool === 'highlight') {
        ctx.globalCompositeOperation = 'multiply';
        ctx.strokeStyle = (stroke.color || '#ff0') + '33';
        ctx.lineWidth = stroke.size * 2;
    } else {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = stroke.color || penColor;
        ctx.lineWidth = stroke.size;
    }
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
  }

function drawStrokeAnchored(stroke, info){
  ctx.save();
  styleFor(stroke);
  ctx.translate(info.left, info.top);

  if (stroke._isDot) {
    // Draw like the live case so sizes match
    const r = (stroke.size || 3) / 2;
    const p = stroke.points[0];
    ctx.beginPath();
    ctx.arc(p.x, p.y, Math.max(1, r), 0, Math.PI*2);
    ctx.fillStyle = (stroke.tool === 'eraser') ? '#000' : ctx.strokeStyle;
    ctx.fill();
  } else if (stroke._localPath) {
    ctx.stroke(stroke._localPath);
  } else {
    // (your existing multi-point fallback)
    const pts = stroke.points || [];
    if (!pts.length) { ctx.restore(); return; }
    if (pts.length === 1) {
      const r = ctx.lineWidth/2;
      ctx.beginPath(); ctx.arc(pts[0].x, pts[0].y, Math.max(1,r), 0, Math.PI*2);
      ctx.fillStyle = (stroke.tool==='eraser') ? '#000' : ctx.strokeStyle;
      ctx.fill();
    } else {
      ctx.beginPath();
      ctx.moveTo(pts[0].x, pts[0].y);
      for (let i=1;i<pts.length-1;i++){
        const c=pts[i], n=pts[i+1];
        ctx.quadraticCurveTo(c.x, c.y, (c.x+n.x)/2, (c.y+n.y)/2);
      }
      const last = pts[pts.length-1];
      ctx.lineTo(last.x, last.y);
      ctx.stroke();
    }
  }

  ctx.restore();
}



function setDrawing(enabled){
  drawingEnabled = enabled;
  canvas.style.pointerEvents = enabled ? 'auto' : 'none';
  canvas.classList.toggle('drawing', enabled);

  const drawBtn = tb('inkpad-toggle');
  drawBtn.classList.toggle('active', enabled);
  drawBtn.setAttribute('aria-pressed', String(enabled));

  const label = enabled ? 'Stop drawing (D)' : 'Draw (D)';
  drawBtn.setAttribute('title', label);
  drawBtn.setAttribute('aria-label', label);

  if (!enabled) hoverPage = null;          
  scheduleRedraw();
}

  function setTool(t){
    tool = t;
    tb('inkpad-pen').classList.toggle('active', t==='pen');
    tb('inkpad-eraser').classList.toggle('active', t==='eraser');
  }

  // performance: cap dpr to avoid excessive sizes on high-dpi screens
  const DPR_CAP = 1.5;                           // tune if you like
  function currentDpr(){ return Math.min(window.devicePixelRatio || 1, DPR_CAP); }

  // Throttle redraws to once per frame
  let raf = 0;
  function scheduleRedraw(){
    if (raf) return;
    raf = requestAnimationFrame(() => { raf = 0; redraw(); });
  }

  function buildPath2DLocal(stroke){
    const pts = stroke.points || [];
    const path = new Path2D();
    if (!pts.length) return path;
    if (pts.length === 1) {
        const size = stroke.size || 3;
        path.arc(pts[0].x, pts[0].y, Math.max(1, size/2), 0, Math.PI*2);
        return path;
    }
    path.moveTo(pts[0].x, pts[0].y);
    for (let i=1; i<pts.length-1; i++){
        const c = pts[i], n = pts[i+1];
        path.quadraticCurveTo(c.x, c.y, (c.x+n.x)/2, (c.y+n.y)/2);
    }
    const last = pts[pts.length-1];
    path.lineTo(last.x, last.y);
    return path;
  }


function recomputeMeta(s){
  if (!s.points?.length) return;

  let b = {x0:s.points[0].x,y0:s.points[0].y,x1:s.points[0].x,y1:s.points[0].y};
  for (const p of s.points){ if (p.x<b.x0) b.x0=p.x; if (p.y<b.y0) b.y0=p.y; if (p.x>b.x1) b.x1=p.x; if (p.y>b.y1) b.y1=p.y; }

  // mark single-point strokes as dots and expand bbox by radius
  if (s.points.length === 1) {
    s._isDot = true;                      // non-serializable flag is fine
    const pad = (s.size || 3) / 2;
    b.x0 -= pad; b.y0 -= pad; b.x1 += pad; b.y1 += pad;
  } else {
    s._isDot = false;
  }

  s.localBBox = b;

  // cache path only for multi-point strokes
  if (!s._isDot) {
    Object.defineProperty(s, '_localPath', { value: buildPath2DLocal(s), enumerable: false, writable: true });
  } else {
    Object.defineProperty(s, '_localPath', { value: null, enumerable: false, writable: true });
  }
}


  function pushPointDecimated(arr, p, minDist=0.75){ // CSS px
    const last = arr[arr.length-1];
    if (!last) { arr.push(p); return true; }
    const dx = p.x - last.x, dy = p.y - last.y;
    if (dx*dx + dy*dy < minDist*minDist) return false;
    arr.push(p); return true;
  }
  function expandBBox(b, p){
    b.x0 = Math.min(b.x0, p.x); b.y0 = Math.min(b.y0, p.y);
    b.x1 = Math.max(b.x1, p.x); b.y1 = Math.max(b.y1, p.y);
  }
  function newBBox(p){ return {x0:p.x, y0:p.y, x1:p.x, y1:p.y}; }
  function intersects(b, x0,y0,x1,y1){ return !(b.x1 < x0 || b.x0 > x1 || b.y1 < y0 || b.y0 > y1); }


  function getAnchorAtPoint(clientX, clientY) {
    // Temporarily let the page receive the hit
    const prev = canvas.style.pointerEvents;
    canvas.style.pointerEvents = 'none';
    const hit = document.elementFromPoint(clientX, clientY);
    canvas.style.pointerEvents = prev || (drawingEnabled ? 'auto' : 'none');

    const el = hit?.closest('details, .collapse, .callout, [data-ink-surface]');
    if (!el) return { id: 'global', el: null };
    if (!el.id) el.id = 'ink-surface-' + Math.random().toString(36).slice(2,9);
    return { id: el.id, el };
  }


  function anchorInfo(anchorId) {
    if (anchorId === 'global') return { left: 0, top: 0, visible: true };
    const el = document.getElementById(anchorId);
    if (!el) return { left: 0, top: 0, visible: false };

    const cs = getComputedStyle(el);
    const visible = cs.display !== 'none' && cs.visibility !== 'hidden';
    const expanded =
        (el.tagName.toLowerCase() !== 'details' || el.open) &&
        (!el.classList.contains('collapse') || el.classList.contains('show'));
    if (!visible || !expanded) return { left: 0, top: 0, visible: false };

    const r = el.getBoundingClientRect();
    return { left: r.left + window.scrollX, top: r.top + window.scrollY, visible: true };
  }

    // pointer in LOCAL anchor coords
  function pointerPosLocal(e, anchorEl) {
    if (!anchorEl) return { x: e.pageX, y: e.pageY, p: e.pressure>0?e.pressure:0.5 };
    const r = anchorEl.getBoundingClientRect();
    return { x: e.clientX - r.left, y: e.clientY - r.top, p: e.pressure>0?e.pressure:0.5 };
  }



  function pointerPos(e){  // page space (CSS px)
    return { x: e.pageX, y: e.pageY, p: (e.pressure>0 ? e.pressure : 0.5) };
  }


  let currentAnchor = { id: 'global', el: null };

  canvas.addEventListener('pointerdown', (e)=>{
    if (!drawingEnabled) return;
    try { canvas.setPointerCapture?.(e.pointerId); } catch {}
    currentAnchor = getAnchorAtPoint(e.clientX, e.clientY);

    const p = pointerPosLocal(e, currentAnchor.el);
    current = {
        anchorId: currentAnchor.id,
        tool,
        color: penColor,
        size: tool === 'eraser' ? eraserSize : penSize,
        points: [p],
        localBBox: {x0:p.x,y0:p.y,x1:p.x,y1:p.y}
    };
    e.preventDefault();
    scheduleRedraw();
  }, {passive:false});

  canvas.addEventListener('pointermove', (e)=>{
    if (!current) return;
    const p = pointerPosLocal(e, currentAnchor.el);
    if (pushPointDecimated(current.points, p)) {
        current.localBBox.x0 = Math.min(current.localBBox.x0, p.x);
        current.localBBox.y0 = Math.min(current.localBBox.y0, p.y);
        current.localBBox.x1 = Math.max(current.localBBox.x1, p.x);
        current.localBBox.y1 = Math.max(current.localBBox.y1, p.y);
    }
    e.preventDefault();
    scheduleRedraw();
  }, {passive:false});

// update hover position always while ink is enabled
canvas.addEventListener('pointermove', (e) => {
  if (!drawingEnabled) return;
  hoverPage = { x: e.pageX, y: e.pageY };
}, { passive: true });

canvas.addEventListener('pointerleave', () => {
  hoverPage = null;
  scheduleRedraw();
});



  function endStroke(e){
    if (!current) return;
    const p = pointerPosLocal(e, currentAnchor.el);
    if (pushPointDecimated(current.points, p)) {
        current.localBBox.x0 = Math.min(current.localBBox.x0, p.x);
        current.localBBox.y0 = Math.min(current.localBBox.y0, p.y);
        current.localBBox.x1 = Math.max(current.localBBox.x1, p.x);
        current.localBBox.y1 = Math.max(current.localBBox.y1, p.y);
    }
    recomputeMeta(current);                      // builds _localPath
    strokes.push(current);
    current = null;
    try { canvas.releasePointerCapture?.(e.pointerId); } catch {}
    save();
    scheduleRedraw();
    updateActionStates(); 

  }


  canvas.addEventListener('pointerup', endStroke);
  canvas.addEventListener('pointercancel', endStroke);
  canvas.addEventListener('pointerleave', endStroke);

  // --- hook up the toolbar buttons so clicks always “register” ---
  onButton('inkpad-toggle', () => setDrawing(!drawingEnabled));
  onButton('inkpad-pen',    () => setTool('pen'));
  onButton('inkpad-eraser', () => setTool('eraser'));

onButton('inkpad-undo', () => {
  if (!strokes.length) { flash(undoBtn); showToast('Nothing to undo'); return; }
  strokes.pop(); save(); redraw();
  flash(undoBtn); showToast('Undid last stroke');
  updateActionStates();
});

onButton('inkpad-clear', () => {
  if (!strokes.length) { flash(clearBtn); showToast('Nothing to clear'); return; }
  if (confirm('Clear all ink on this page?')) {
    strokes = []; save(); redraw();
    flash(clearBtn); showToast('Cleared');
    updateActionStates();
  }
});

onButton('inkpad-save', () => {
  if (!hasInk()) { flash(saveBtn); showToast('Nothing to save'); return; }
  const url = canvas.toDataURL('image/png');
  const a = document.createElement('a');
  a.download = (document.title || 'notes') + '.png';
  a.href = url; a.click();
  flash(saveBtn); showToast('Saved PNG');
});


  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    // Only when toolbar is visible
    if (!toolbar.classList.contains('open')) return;

    // Don’t hijack typing in inputs
    if (e.target && /input|textarea|select|button/i.test(e.target.tagName)) return;
    if (e.target?.isContentEditable) return;

    const k = e.key.toLowerCase();
    if (k === 'd') { setDrawing(!drawingEnabled); e.preventDefault(); }
    else if (k === 'p') { setTool('pen'); e.preventDefault(); }
    else if (k === 'e') { setTool('eraser'); e.preventDefault(); }
    else if (k === 'z' && (e.ctrlKey || e.metaKey)) { strokes.pop(); save(); redraw(); e.preventDefault(); }
  });

  window.addEventListener('resize', fitCanvas, {passive:true});

  // redraw when viewport scrolls
  window.addEventListener('scroll', scheduleRedraw, { passive: true });

  // redraw for nested scrollable containers (capture phase catches them)
  document.addEventListener('scroll', scheduleRedraw, { passive: true, capture: true });

  // stay smooth during touch scrolling
  window.addEventListener('touchmove', scheduleRedraw, { passive: true });

  // handle rotation and tab visibility
  window.addEventListener('orientationchange', scheduleRedraw, { passive: true });
  document.addEventListener('visibilitychange', () => {
    if (!document.hidden) scheduleRedraw();
  }, { passive: true });

  // respond to DPR changes (pinch-zoom)
  if (window.matchMedia) {
    const dppx = Math.round((window.devicePixelRatio || 1) * 10) / 10;
    const mq = matchMedia(`(resolution: ${dppx}dppx)`);
    mq.addEventListener?.('change', () => { fitCanvas(); }); // Safari/iOS
  }

  document.addEventListener('toggle', (e) => {
    if (e.target.tagName?.toLowerCase() === 'details') requestAnimationFrame(scheduleRedraw);
  }, true);
  document.addEventListener('show.bs.collapse', () => scheduleRedraw());
  document.addEventListener('hide.bs.collapse', () => scheduleRedraw());

  // If a details/collapse uses CSS height transitions, redraw after it ends.
  document.addEventListener('transitionend', (e) => {
    const t = e.target;
    if (!t) return;
    // common containers that change height
    if (t.matches?.('details, .collapse, .callout, [data-ink-surface]')) {
        scheduleRedraw();
    }
  }, { passive: true, capture: true });

  // Bootstrap’s final state events 
  document.addEventListener('shown.bs.collapse',  () => scheduleRedraw());
  document.addEventListener('hidden.bs.collapse', () => scheduleRedraw());


  // --- initialise ---
  load(); fitCanvas();
  setDrawing(false);   // ensures initial visual state is consistent
  setTool('pen');
  updateActionStates();

  const m = new MutationObserver(() => {
    const open = toolbar.classList.contains('open');
    toolbar.setAttribute('aria-hidden', open ? 'false' : 'true');
  });
  m.observe(toolbar, {attributes:true, attributeFilter:['class']});

  // keep canvas sized if the document grows (e.g., lazy images)
  const ro = new ResizeObserver(()=> fitCanvas());
  ro.observe(document.documentElement);
})();
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const tools = document.querySelector('#quarto-header .quarto-navbar-tools');
  if (!tools) return;

  // Avoid duplicates if hot-reloading / re-running
  if (document.getElementById('inkpad-header-toggle')) return;

  // Create the Ink button
  const inkBtn = document.createElement('button');
  inkBtn.id = 'inkpad-header-toggle';
  inkBtn.className = 'btn-ink-tool';
  inkBtn.type = 'button';
  inkBtn.setAttribute('aria-label', 'Ink controls');
  inkBtn.setAttribute('title', 'Ink controls (I)');
  inkBtn.setAttribute('aria-controls', 'inkpad-toolbar');
  inkBtn.setAttribute('aria-expanded', 'false');

  // Pen icon
  inkBtn.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round" width="20" height="20" aria-hidden="true">
        <path d="M12 19l7-7 3 3-7 7-3-3z"/>
        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
        <path d="M2 2l7.586 7.586"/>
        <circle cx="11" cy="11" r="2"/>
      </svg>
  `;

  // Place it after the zoom toggle, else after colour toggle, else append
  const zoomToggle  = tools.querySelector('#lecture-zoom-header-toggle');
  const colorToggle = tools.querySelector('.quarto-color-scheme-toggle');
  if (zoomToggle && zoomToggle.parentNode) {
    zoomToggle.parentNode.insertBefore(inkBtn, zoomToggle.nextSibling);
  } else if (colorToggle && colorToggle.parentNode) {
    colorToggle.parentNode.insertBefore(inkBtn, colorToggle.nextSibling);
  } else {
    tools.appendChild(inkBtn);
  }

  // Toggle behaviour: show/hide the floating ink toolbar
  const toolbar = document.getElementById('inkpad-toolbar'); // your existing floating toolbar
  const setOpen = (open) => {
    if (!toolbar) return;
    toolbar.classList.toggle('open', open);
    inkBtn.classList.toggle('active', open);
    inkBtn.setAttribute('aria-expanded', String(open));
  };

  inkBtn.addEventListener('click', () => {
    if (!toolbar) return;
    setOpen(!toolbar.classList.contains('open'));
  });

  // Keyboard: "I" toggles; "Esc" closes
  document.addEventListener('keydown', (e) => {
    if (/input|textarea|select/i.test(e.target.tagName)) return;
    if (e.key.toLowerCase() === 'i' && !e.metaKey && !e.ctrlKey && !e.altKey) {
      if (!toolbar) return;
      setOpen(!toolbar.classList.contains('open'));
    }
    if (e.key === 'Escape') setOpen(false);
  });
});
</script>

<style>
/* Header ink button look & feel */
#quarto-header .btn-ink-tool {
  background: none; border: 0;
  padding: .375rem; margin: 0 .25rem;
  border-radius: .375rem; cursor: pointer;
  color: var(--bs-navbar-color, currentColor);
  display: inline-flex; align-items: center; justify-content: center;
  transition: background .15s ease, opacity .15s ease;
}
#quarto-header .btn-ink-tool:hover { opacity: .8; color: var(--brand-teal-hover); background: rgba(255,255,255,0.08);}
#quarto-header .btn-ink-tool.active {
  background: color-mix(in srgb, var(--brand-teal) 30%, transparent);
  /* border: 1px solid var(--brand-teal);  */
  /* border-radius: .375rem;              */
}
.quarto-dark #quarto-header .btn-ink-tool { color: var(--bs-navbar-dark-color, #fff); }


</style>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImdhcCA9IDIwXG5jb250YWluZXJXID0gd2lkdGhcbnBsb3RXID0gTWF0aC5yb3VuZChNYXRoLm1heCgyNDAsIE1hdGgubWluKDYwMCwgKGNvbnRhaW5lclcgLSBnYXApIC8gMiAtIDE1KSkpXG5wbG90SCA9IE1hdGgucm91bmQocGxvdFcgKiAwLjgpXG5cbm1hcmdpblRvcCA9IDIwXG5tYXJnaW5SaWdodCA9IDM1XG5tYXJnaW5Cb3R0b20gPSAzNVxubWFyZ2luTGVmdCA9IDM1XG5pbm5lclcgPSBwbG90VyAtIG1hcmdpbkxlZnQgLSBtYXJnaW5SaWdodFxuaW5uZXJIID0gcGxvdEggLSBtYXJnaW5Ub3AgLSBtYXJnaW5Cb3R0b21cblxuYm9keUZvbnQgPSBnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmJvZHkpLmZvbnRGYW1pbHlcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gQWRkIGN1c3RvbSBDU1MgZm9yIHRoZSBzbGlkZXIgc3R5bGluZyAod2l0aG91dCB0aGUgZGV0YWlscy5jb250cm9scy1yb290IHJlcXVpcmVtZW50KVxuaHRtbGA8c3R5bGU+XG4vKiBTdHlsZSBhbGwgcmFuZ2Ugc2xpZGVycyBpbiB0aGUgZG9jdW1lbnQgKi9cbmlucHV0W3R5cGU9XCJyYW5nZVwiXSB7XG4gIC8qIFJlc2V0IGJyb3dzZXIgZGVmYXVsdHMgKi9cbiAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lO1xuICBhcHBlYXJhbmNlOiBub25lO1xuICBcbiAgLyogTGF5b3V0ICovXG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDE4cHg7XG4gIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50O1xuICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO1xuICBcbiAgLyogQnJhbmQgdGhlbWluZyAqL1xuICBhY2NlbnQtY29sb3I6IHZhcigtLWN0cmwtYnJhbmQpO1xufVxuXG4vKiBIaWRlIHRoZSBudW1iZXIgaW5wdXQgYm94IHRoYXQgYXBwZWFycyB3aXRoIElucHV0cy5yYW5nZSAqL1xuZm9ybTpoYXMoaW5wdXRbdHlwZT1cInJhbmdlXCJdKSBpbnB1dFt0eXBlPVwibnVtYmVyXCJdIHtcbiAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50O1xufVxuXG4vKiBDZW50ZXIgdGhlIHNsaWRlciBjb250YWluZXIgKi9cbmZvcm06aGFzKGlucHV0W3R5cGU9XCJyYW5nZVwiXSkge1xuICBtYXJnaW46IDAgYXV0bztcbiAgbWF4LXdpZHRoOiA2MDBweDsgLyogQWRqdXN0IGFzIG5lZWRlZCAqL1xuICBwYWRkaW5nOiAxMHB4IDA7XG59XG5cbi8qIFNsaWRlciB0cmFjayAtIFdlYktpdCAqL1xuaW5wdXRbdHlwZT1cInJhbmdlXCJdOjotd2Via2l0LXNsaWRlci1ydW5uYWJsZS10cmFjayB7XG4gIGhlaWdodDogNHB4O1xuICBib3JkZXItcmFkaXVzOiA5OTlweDtcbiAgYmFja2dyb3VuZDogY29sb3ItbWl4KGluIHNyZ2IsIHZhcigtLWN0cmwtYnJhbmQsICM2NjdlZWEpIDM1JSwgdHJhbnNwYXJlbnQpO1xufVxuXG4vKiBTbGlkZXIgdGh1bWIgLSBXZWJLaXQgKi9cbmlucHV0W3R5cGU9XCJyYW5nZVwiXTo6LXdlYmtpdC1zbGlkZXItdGh1bWIge1xuICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7XG4gIGFwcGVhcmFuY2U6IG5vbmU7XG4gIFxuICB3aWR0aDogMTJweDtcbiAgaGVpZ2h0OiAxMnB4O1xuICBib3JkZXItcmFkaXVzOiA1MCU7XG4gIGJvcmRlcjogMDtcbiAgYmFja2dyb3VuZDogdmFyKC0tY3RybC1icmFuZCwgIzY2N2VlYSk7XG4gIFxuICAvKiBDZW50ZXIgdGh1bWIgb3ZlciA0cHggdHJhY2sgKi9cbiAgbWFyZ2luLXRvcDogLTRweDtcbn1cblxuLyogU2xpZGVyIHRyYWNrIC0gRmlyZWZveCAqL1xuaW5wdXRbdHlwZT1cInJhbmdlXCJdOjotbW96LXJhbmdlLXRyYWNrIHtcbiAgaGVpZ2h0OiA0cHg7XG4gIGJvcmRlci1yYWRpdXM6IDk5OXB4O1xuICBiYWNrZ3JvdW5kOiBjb2xvci1taXgoaW4gc3JnYiwgdmFyKC0tY3RybC1icmFuZCwgIzY2N2VlYSkgMzUlLCB0cmFuc3BhcmVudCk7XG59XG5cbi8qIFNsaWRlciB0aHVtYiAtIEZpcmVmb3ggKi9cbmlucHV0W3R5cGU9XCJyYW5nZVwiXTo6LW1vei1yYW5nZS10aHVtYiB7XG4gIHdpZHRoOiAxMnB4O1xuICBoZWlnaHQ6IDEycHg7XG4gIGJvcmRlci1yYWRpdXM6IDUwJTtcbiAgYm9yZGVyOiAwO1xuICBiYWNrZ3JvdW5kOiB2YXIoLS1jdHJsLWJyYW5kLCAjNjY3ZWVhKTtcbn1cblxuLyogRmlyZWZveCBwcm9ncmVzcyBzdHlsaW5nICovXG5pbnB1dFt0eXBlPVwicmFuZ2VcIl06Oi1tb3otcmFuZ2UtcHJvZ3Jlc3Mge1xuICBoZWlnaHQ6IDRweDtcbiAgYm9yZGVyLXJhZGl1czogOTk5cHg7XG4gIGJhY2tncm91bmQ6IGNvbG9yLW1peChpbiBzcmdiLCB2YXIoLS1jdHJsLWJyYW5kLCAjNjY3ZWVhKSAzNSUsIHRyYW5zcGFyZW50KTtcbn1cbjwvc3R5bGU+YFxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gVGV4dCByZWFkb3V0OiBQcihYID0gMiB8IM64KSA9IM64XjJcbnByb2JhYmlsaXR5VGV4dCA9IHtcbiAgY29uc3QgZm10ID0gZDMuZm9ybWF0KFwiLjNmXCIpO1xuICBjb25zdCB2YWwgPSB0aGV0YSAqKiAyO1xuICByZXR1cm4gbWRgJHt0ZXhgXFxQcihYPTIgXFxtaWQgXFx0aGV0YT0ke2ZtdCh0aGV0YSl9KSA9ICR7Zm10KHZhbCl9YH1gO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gUHJvYmFiaWxpdHkgdmlldzogUE1GIG9mIFggfiBCaW5vbWlhbChuPTIsIM64KVxucG1mUGxvdCA9IHtcbiAgLy8gRGF0YTogeCDiiIggezAsMSwyfSwgUChYPXggfCDOuCkgPSBDKDIseCkgzrheeCAoMS3OuCleezIteH1cbiAgY29uc3QgcG1mID0gW1xuICAgIHt4OiAwLCBwOiAoMSAtIHRoZXRhKSAqKiAyfSxcbiAgICB7eDogMSwgcDogMiAqIHRoZXRhICogKDEgLSB0aGV0YSl9LFxuICAgIHt4OiAyLCBwOiB0aGV0YSAqKiAyfVxuICBdO1xuXG4gIHJldHVybiBQbG90LnBsb3Qoe1xuICAgIHdpZHRoOiBkeW5hbWljUGxvdFcsIGhlaWdodDogcGxvdEgsXG4gICAgbWFyZ2luTGVmdDogbWFyZ2luTGVmdCxcbiAgICBtYXJnaW5Cb3R0b206IG1hcmdpbkJvdHRvbSxcbiAgICBzdHlsZToge1xuICAgICAgICBmb250RmFtaWx5OiBib2R5Rm9udCwgXG4gICAgICAgIGZvbnRTaXplOiAxNC4sXG4gICAgICAgIGJhY2tncm91bmQ6IFwidmFyKC0tYnJhbmQtYmcpXCIsXG4gICAgfSwgXG4gICAgeDoge1xuICAgICAgbGFiZWw6IFwieCAobnVtYmVyIG9mIGhlYWRzKVwiLCBcbiAgICAgIGRvbWFpbjogWy0wLjUsIDIuNV0sIFxuICAgICAgdGlja3M6IFswLCAxLCAyXSxcbiAgICAgIHRpY2tGb3JtYXQ6IGQgPT4gZC50b0ZpeGVkKDApXG4gICAgfSxcbiAgICB5OiB7XG4gICAgICBsYWJlbDogXCJQcm9iYWJpbGl0eVwiLCBcbiAgICAgIGRvbWFpbjogWzAsIDFdLFxuICAgICAgZ3JpZDogdHJ1ZVxuICAgIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIFBsb3QucnVsZVkoWzBdKSxcbiAgICAgIFBsb3QucmVjdFkocG1mLCB7XG4gICAgICAgIHg6IFwieFwiLCBcbiAgICAgICAgeTogXCJwXCIsIFxuICAgICAgICB4MTogZCA9PiBkLnggLSAwLjQsXG4gICAgICAgIHgyOiBkID0+IGQueCArIDAuNCxcbiAgICAgICAgZmlsbDogXCJ2YXIoLS1icmFuZC10ZWFsKVwiLFxuICAgICAgICBpbnNldDogMC41XG4gICAgICB9KSxcbiAgICAgIFBsb3QuZG90KHBtZiwge1xuICAgICAgICB4OiBcInhcIiwgXG4gICAgICAgIHk6IFwicFwiLCBcbiAgICAgICAgcjogNCwgXG4gICAgICAgIGZpbGw6IFwidmFyKC0tZmctbXV0ZWQpXCIsXG4gICAgICAgIGZpbGxPcGFjaXR5OiAwLlxuICAgICAgfSksXG4gICAgICBQbG90LnRleHQocG1mLCB7XG4gICAgICAgIHg6IFwieFwiLFxuICAgICAgICB5OiBcInBcIixcbiAgICAgICAgdGV4dDogZCA9PiBkMy5mb3JtYXQoXCIuM2ZcIikoZC5wKSxcbiAgICAgICAgZHk6IC0xMCxcbiAgICAgICAgZm9udFNpemU6IDExXG4gICAgICB9KVxuICAgIF1cbiAgfSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBMaWtlbGlob29kIHZpZXc6IEwozrg7IHg9MikgPSDOuF4yIGZvciDOuCDiiIggWzAsMV1cbmxpa2VsaWhvb2RQbG90ID0ge1xuICAvLyBDdXJ2ZSBzYW1wbGVzXG4gIGNvbnN0IFQgPSBkMy5yYW5nZSgwLCAxLjAwMSwgMC4wMDUpLm1hcCh0ID0+ICh7dGhldGE6IHQsIEw6IHQgKiogMn0pKTtcbiAgY29uc3QgcG9pbnQgPSB7dGhldGE6IHRoZXRhLCBMOiB0aGV0YSAqKiAyfTtcblxuICByZXR1cm4gUGxvdC5wbG90KHtcbiAgICB3aWR0aDogZHluYW1pY1Bsb3RXLCBoZWlnaHQ6IHBsb3RILFxuICAgIG1hcmdpbkxlZnQ6IG1hcmdpbkxlZnQsXG4gICAgbWFyZ2luQm90dG9tOiBtYXJnaW5Cb3R0b20sXG4gICAgc3R5bGU6IHtcbiAgICAgICAgZm9udEZhbWlseTogYm9keUZvbnQsIFxuICAgICAgICBmb250U2l6ZTogMTQuLFxuICAgICAgICBiYWNrZ3JvdW5kOiBcInZhcigtLWJyYW5kLWJnKVwiLFxuICAgIH0sIFxuICAgIHg6IHtcbiAgICAgIGxhYmVsOiBcIs64XCIsIFxuICAgICAgZG9tYWluOiBbMCwgMV0sXG4gICAgICBncmlkOiB0cnVlXG4gICAgfSxcbiAgICB5OiB7XG4gICAgICBsYWJlbDogXCJMaWtlbGlob29kXCIsIFxuICAgICAgZG9tYWluOiBbMCwgMV0sXG4gICAgICBncmlkOiB0cnVlXG4gICAgfSxcbiAgICBtYXJrczogW1xuICAgICAgUGxvdC5saW5lKFQsIHtcbiAgICAgICAgeDogXCJ0aGV0YVwiLCBcbiAgICAgICAgeTogXCJMXCIsXG4gICAgICAgIHN0cm9rZTogXCJ2YXIoLS1icmFuZC1yZWQpXCIsXG4gICAgICAgIHN0cm9rZVdpZHRoOiAyXG4gICAgICB9KSxcbiAgICAgIFBsb3QucnVsZVkoWzBdKSxcbiAgICAgIFBsb3QucnVsZVgoW3RoZXRhXSwge1xuICAgICAgICBzdHJva2U6IFwidmFyKC0tZmctbXV0ZWQpXCIsXG4gICAgICAgIHN0cm9rZURhc2hhcnJheTogXCI0IDJcIlxuICAgICAgfSksXG4gICAgICBQbG90LmRvdChbcG9pbnRdLCB7XG4gICAgICAgIHg6IFwidGhldGFcIiwgXG4gICAgICAgIHk6IFwiTFwiLFxuICAgICAgICByOiA1LFxuICAgICAgICBmaWxsOiBcInZhcigtLWJyYW5kLXJlZClcIlxuICAgICAgfSksXG4gICAgICBQbG90LnRleHQoW3BvaW50XSwge1xuICAgICAgICB4OiBcInRoZXRhXCIsXG4gICAgICAgIHk6IFwiTFwiLFxuICAgICAgICB0ZXh0OiBkID0+IGAoJHtkMy5mb3JtYXQoXCIuMmZcIikoZC50aGV0YSl9LCAke2QzLmZvcm1hdChcIi4zZlwiKShkLkwpfSlgLFxuICAgICAgICBkeTogLTEwLFxuICAgICAgICBmb250U2l6ZTogMTEsXG4gICAgICAgIGZpbGw6IFwidmFyKC0tYnJhbmQtZmcpXCJcbiAgICAgIH0pXG4gICAgXVxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImR5bmFtaWNQbG90VyA9IE1hdGgubWluKDQwMCwgd2lkdGggKiAwLjQ1KSAgLy8gRWFjaCBwbG90IHRha2VzIH40NSUgb2YgYXZhaWxhYmxlIHdpZHRoXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBDb21iaW5lZCBzaWRlLWJ5LXNpZGUgdmlldyAtIHJlc3BvbnNpdmUsIHdpdGggdGl0bGVzXG5odG1sYDxkaXYgc3R5bGU9XCJ3aWR0aDoxMDAlOyBib3gtc2l6aW5nOmJvcmRlci1ib3g7XCI+XG4gIDxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7IGdhcDoke2dhcH1weDsgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsgZmxleC13cmFwOndyYXA7IGp1c3RpZnktY29udGVudDpjZW50ZXI7XCI+XG4gICAgXG4gICAgPGRpdiBzdHlsZT1cImZsZXg6MCAxICR7ZHluYW1pY1Bsb3RXfXB4OyBtaW4td2lkdGg6MzAwcHg7IHRleHQtYWxpZ246Y2VudGVyO1wiPlxuICAgICAgPGRpdiBzdHlsZT1cIm1hcmdpbi1ib3R0b206NnB4OyBmb250LXdlaWdodDo2MDA7IGZvbnQtc2l6ZToxNXB4O1wiPkJpbm9taWFsIFBNRjwvZGl2PlxuICAgICAgJHtwbWZQbG90fVxuICAgIDwvZGl2PlxuICAgIFxuICAgIDxkaXYgc3R5bGU9XCJmbGV4OjAgMSAke2R5bmFtaWNQbG90V31weDsgbWluLXdpZHRoOjMwMHB4OyB0ZXh0LWFsaWduOmNlbnRlcjtcIj5cbiAgICAgIDxkaXYgc3R5bGU9XCJtYXJnaW4tYm90dG9tOjZweDsgZm9udC13ZWlnaHQ6NjAwOyBmb250LXNpemU6MTVweDtcIj5MaWtlbGlob29kIEZ1bmN0aW9uPC9kaXY+XG4gICAgICAke2xpa2VsaWhvb2RQbG90fVxuICAgIDwvZGl2PlxuICAgIFxuICA8L2Rpdj5cbiAgPGRpdiBzdHlsZT1cIm1hcmdpbi10b3A6MTVweDsgdGV4dC1hbGlnbjpjZW50ZXI7IGZvbnQtc2l6ZToxNHB4O1wiPlxuICAgICR7cHJvYmFiaWxpdHlUZXh0fVxuICA8L2Rpdj5cbjwvZGl2PmBcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gU2ltcGxlIHNsaWRlciB3aXRoIHRleCBsYWJlbCwgbm8gaW5wdXQgYm94XG52aWV3b2YgdGhldGEgPSBJbnB1dHMucmFuZ2UoWzAsIDFdLCB7XG4gIHZhbHVlOiAwLjUsXG4gIHN0ZXA6IDAuMDFcbn0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyAtLS0gRGVmaW5lIGEgXCJsaWtlbGlob29kLWxpa2VcIiBmdW5jdGlvbiB3aXRoIG11bHRpcGxlIGJ1bXBzIC0tLVxuLy8gTCjOuCkgPSBleHAoIC0gKM64XjQgLSDOuF4yICsgMC4zIM64KSApXG5MID0gzrggPT4gTWF0aC5leHAoLSjOuCoqNCAtIM64KioyICsgMC4zKs64KSlcblxuLy8gU2FtcGxlIHRoZSBmdW5jdGlvbiBvbiBhIGdyaWRcbs64bWluID0gLTIuMlxuzrhtYXggPSAgMi4yXG5OID0gODAxXG7OmCA9IEFycmF5LmZyb20oe2xlbmd0aDogTn0sIChfLCBpKSA9PiDOuG1pbiArIGkqKM64bWF4IC0gzrhtaW4pLyhOIC0gMSkpXG5ZID0gzpgubWFwKEwpXG5cbi8vIEZpbmQgbWF4IChoZWlnaHQpIGFuZCBhcmdtYXggKGxvY2F0aW9uKVxuaW1heCA9IFkucmVkdWNlKChiZXN0LCB5LCBpKSA9PiAoeSA+IFlbYmVzdF0gPyBpIDogYmVzdCksIDApXG7OuGhhdCA9IM6YW2ltYXhdXG5MbWF4ID0gWVtpbWF4XVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIENyZWF0ZSB0aGUgYmFzZSBwbG90IHdpdGhvdXQgTGFUZVggbGFiZWxzXG5hcmdtYXhQbG90ID0gUGxvdC5wbG90KHtcbiAgd2lkdGg6IE1hdGgubWluKDcyMCwgTWF0aC5tYXgoMzgwLCB3aWR0aCAtIDQwKSksXG4gIGhlaWdodDogMzQwLFxuICBzdHlsZToge1xuICAgIGJhY2tncm91bmQ6IFwidmFyKC0tYnJhbmQtYmcpXCIsXG4gICAgY29sb3I6IFwidmFyKC0tYnJhbmQtZmcpXCIsXG4gICAgZm9udEZhbWlseTogYm9keUZvbnQsXG4gICAgZm9udFNpemU6IDE0XG4gIH0sXG4gIG1hcmdpbkxlZnQ6IDY1LFxuICBtYXJnaW5Cb3R0b206IDUwLFxuICBtYXJnaW5Ub3A6IDIwLFxuICBtYXJnaW5SaWdodDogMjAsXG4gIHg6IHtsYWJlbDogXCJcIiwgZG9tYWluOiBbzrhtaW4sIM64bWF4XX0sICBcbiAgeToge2xhYmVsOiBcIlwiLCBuaWNlOiB0cnVlfSwgICAgICAgXG4gIG1hcmtzOiBbXG4gICAgLy8gTGlrZWxpaG9vZCBjdXJ2ZVxuICAgIFBsb3QubGluZShcbiAgICAgIM6YLm1hcCgodCxpKSA9PiAoe864OiB0LCBMOiBZW2ldfSkpLCBcbiAgICAgIHt4OiBcIs64XCIsIHk6IFwiTFwiLCBzdHJva2U6IFwidmFyKC0tYnJhbmQtcmVkKVwiLCBzdHJva2VXaWR0aDogMn1cbiAgICApLFxuICAgIFxuICAgIC8vIFZlcnRpY2FsIGxpbmUgYXQgYXJnbWF4IChsb2NhdGlvbilcbiAgICBQbG90LnJ1bGVYKFvOuGhhdF0sIHtzdHJva2VEYXNoYXJyYXk6IFwiNCwzXCIsIHN0cm9rZTogXCJ2YXIoLS1icmFuZC1mZylcIiwgYXJpYUxhYmVsOiBcImFyZ21heFwiLCBzdHJva2VPcGFjaXR5OiAwLjh9KSxcbiAgICBcbiAgICAvLyBIb3Jpem9udGFsIGxpbmUgYXQgbWF4IChoZWlnaHQpXG4gICAgUGxvdC5ydWxlWShbTG1heF0sIHtzdHJva2VEYXNoYXJyYXk6IFwiNCwzXCIsIHN0cm9rZTogXCJ2YXIoLS1icmFuZC1mZylcIiwgYXJpYUxhYmVsOiBcIm1heFwiLCBzdHJva2VPcGFjaXR5OiAwLjh9KSxcblxuICAgIC8vIEF4ZXMgYXQgYmFzZWxpbmVcbiAgICBQbG90LnJ1bGVYKFvOuG1pbl0sIHtzdHJva2U6IFwidmFyKC0tYnJhbmQtZmcpXCJ9KSxcbiAgICBQbG90LnJ1bGVZKFswXSwge3N0cm9rZTogXCJ2YXIoLS1icmFuZC1mZylcIn0pLFxuXG4gICAgLy8gUG9pbnQgYXQgdGhlIG1heGltaXNlclxuICAgIFBsb3QuZG90KFxuICAgICAgW3vOuDogzrhoYXQsIEw6IExtYXh9XSwgXG4gICAgICB7eDogXCLOuFwiLCB5OiBcIkxcIiwgcjogNSwgZmlsbDogXCJ2YXIoLS1icmFuZC10ZWFsKVwifVxuICAgIClcbiAgXVxufSlcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuLy8gQWRkIExhVGVYIG92ZXJsYXlzIGFmdGVyIHBsb3QgcmVuZGVyc1xucGxvdFdpdGhMYXRleCA9IHtcbiAgLy8gQ3JlYXRlIGNvbnRhaW5lclxuICBjb25zdCBjb250YWluZXIgPSBodG1sYDxkaXYgc3R5bGU9XCJwb3NpdGlvbjogcmVsYXRpdmU7IGRpc3BsYXk6IGlubGluZS1ibG9jaztcIj48L2Rpdj5gO1xuICBcbiAgLy8gQWRkIHRoZSBwbG90XG4gIGNvbnRhaW5lci5hcHBlbmQoYXJnbWF4UGxvdCk7XG4gIFxuICAvLyBGdW5jdGlvbiB0byBhZGQgbGFiZWxzIGFmdGVyIHJlbmRlclxuICBjb25zdCBhZGRMYWJlbHMgPSAoKSA9PiB7XG4gICAgLy8gR2V0IHRoZSBTVkcgZWxlbWVudFxuICAgIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwic3ZnXCIpO1xuICAgIGlmICghc3ZnKSB7XG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYWRkTGFiZWxzKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgXG4gICAgLy8gR2V0IGRpbWVuc2lvbnMgZnJvbSB0aGUgU1ZHXG4gICAgY29uc3Qgc3ZnUmVjdCA9IHN2Zy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCBwbG90V2lkdGggPSBzdmdSZWN0LndpZHRoO1xuICAgIGNvbnN0IHBsb3RIZWlnaHQgPSBzdmdSZWN0LmhlaWdodDtcbiAgICBcbiAgICAvLyBBcHByb3hpbWF0ZSBtYXJnaW5zIGZyb20gcGxvdCBjb25maWdcbiAgICBjb25zdCBtYXJnaW5MZWZ0ID0gNzQ7XG4gICAgY29uc3QgbWFyZ2luQm90dG9tID0gMzA7XG4gICAgY29uc3QgbWFyZ2luVG9wID0gMzA7XG4gICAgY29uc3QgbWFyZ2luUmlnaHQgPSAyMDtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgcGxvdCBhcmVhIGRpbWVuc2lvbnNcbiAgICBjb25zdCBwbG90QXJlYVdpZHRoID0gcGxvdFdpZHRoIC0gbWFyZ2luTGVmdCAtIG1hcmdpblJpZ2h0O1xuICAgIGNvbnN0IHBsb3RBcmVhSGVpZ2h0ID0gcGxvdEhlaWdodCAtIG1hcmdpblRvcCAtIG1hcmdpbkJvdHRvbTtcbiAgICBcbiAgICAvLyBMaW5lYXIgbWFwcGluZyBmdW5jdGlvbnMgZm9yIGRhdGEgdG8gcGl4ZWwgY29vcmRpbmF0ZXNcbiAgICBjb25zdCB4VG9QaXhlbCA9ICh4KSA9PiBtYXJnaW5MZWZ0ICsgKCh4IC0gzrhtaW4pIC8gKM64bWF4IC0gzrhtaW4pKSAqIHBsb3RBcmVhV2lkdGg7XG4gICAgY29uc3QgeVRvUGl4ZWwgPSAoeSkgPT4gbWFyZ2luVG9wICsgKDEgLSAoeSAvIChNYXRoLm1heCguLi5ZKSAqIDEuMDUpKSkgKiBwbG90QXJlYUhlaWdodDtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgcG9zaXRpb25zXG4gICAgY29uc3QgzrhoYXRQaXhlbCA9IHhUb1BpeGVsKM64aGF0KTtcbiAgICBjb25zdCBMbWF4UGl4ZWwgPSB5VG9QaXhlbChMbWF4KTtcbiAgICBcbiAgICAvLyBDcmVhdGUgYW5kIGFkZCBMYVRlWCBsYWJlbHMgd2l0aCBib3hlc1xuICAgIGNvbnN0IGxhYmVscyA9IFtcbiAgICAgIC8vIFgtYXhpcyBsYWJlbFxuICAgICAge1xuICAgICAgICBlbGVtZW50OiB0ZXhgXFx0aGV0YWAsXG4gICAgICAgIHN0eWxlOiBgXG4gICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgIGJvdHRvbTogOHB4O1xuICAgICAgICAgIGxlZnQ6ICR7cGxvdFdpZHRoIC8gMn1weDtcbiAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7XG4gICAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7XG4gICAgICAgIGBcbiAgICAgIH0sXG4gICAgICAvLyBZLWF4aXMgbGFiZWwgIFxuICAgICAge1xuICAgICAgICBlbGVtZW50OiB0ZXhgTChcXHRoZXRhO1xcLFxcdW5kZXJsaW5le3h9KWAsXG4gICAgICAgIHN0eWxlOiBgXG4gICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgIGxlZnQ6IDhweDtcbiAgICAgICAgICB0b3A6ICR7KHBsb3RIZWlnaHQgLSBtYXJnaW5Cb3R0b20pIC8gMn1weDtcbiAgICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgtOTBkZWcpIHRyYW5zbGF0ZVkoNXB4KTtcbiAgICAgICAgICB0cmFuc2Zvcm0tb3JpZ2luOiBsZWZ0IGNlbnRlcjtcbiAgICAgICAgICBwb2ludGVyLWV2ZW50czogbm9uZTtcbiAgICAgICAgYFxuICAgICAgfSxcbiAgICAgIC8vIEFyZ21heCBsYWJlbCBhdCBib3R0b20gLSBwb3NpdGlvbmVkIG9uIHgtYXhpc1xuICAgICAge1xuICAgICAgICBlbGVtZW50OiB0ZXhgXFxhcmdcXG1heFxcLCBMKFxcdGhldGE7XFwsXFx1bmRlcmxpbmV7eH0pYCxcbiAgICAgICAgc3R5bGU6IGBcbiAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgICAgdG9wOiAke3Bsb3RIZWlnaHQgLSBtYXJnaW5Cb3R0b219cHg7XG4gICAgICAgICAgbGVmdDogJHvOuGhhdFBpeGVsfXB4O1xuICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpO1xuICAgICAgICAgIGZvbnQtc2l6ZTogMTNweDtcbiAgICAgICAgICBwb2ludGVyLWV2ZW50czogbm9uZTtcbiAgICAgICAgICBjb2xvcjogdmFyKC0tYnJhbmQtZmcpO1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXBsb3QtcGFuZWwtYmcsIHdoaXRlKTtcbiAgICAgICAgICBwYWRkaW5nOiAzcHggNnB4O1xuICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJvcmRlciwgI2RkZCk7XG4gICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgICAgICAgIGJveC1zaGFkb3c6IDAgMXB4IDNweCByZ2JhKDAsMCwwLDAuMSk7XG4gICAgICAgIGBcbiAgICAgIH0sXG4gICAgICAvLyBNYXggdmFsdWUgbGFiZWwgb24gbGVmdCAtIHBvc2l0aW9uZWQgb24geS1heGlzXG4gICAgICB7XG4gICAgICAgIGVsZW1lbnQ6IHRleGBcXG1heFxcLCBMKFxcdGhldGE7XFwsXFx1bmRlcmxpbmV7eH0pYCxcbiAgICAgICAgc3R5bGU6IGBcbiAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgICAgdG9wOiAke0xtYXhQaXhlbH1weDtcbiAgICAgICAgICBsZWZ0OiAke21hcmdpbkxlZnR9cHg7XG4gICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7XG4gICAgICAgICAgZm9udC1zaXplOiAxM3B4O1xuICAgICAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lO1xuICAgICAgICAgIGNvbG9yOiB2YXIoLS1icmFuZC1mZyk7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tcGxvdC1wYW5lbC1iZywgd2hpdGUpO1xuICAgICAgICAgIHBhZGRpbmc6IDNweCA2cHg7XG4gICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLCAjZGRkKTtcbiAgICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgICAgYm94LXNoYWRvdzogMCAxcHggM3B4IHJnYmEoMCwwLDAsMC4xKTtcbiAgICAgICAgYFxuICAgICAgfVxuICAgIF07XG4gICAgXG4gICAgLy8gQWRkIGVhY2ggbGFiZWwgdG8gdGhlIGNvbnRhaW5lclxuICAgIGxhYmVscy5mb3JFYWNoKCh7ZWxlbWVudCwgc3R5bGV9KSA9PiB7XG4gICAgICBjb25zdCBkaXYgPSBodG1sYDxkaXYgc3R5bGU9XCIke3N0eWxlfVwiPjwvZGl2PmA7XG4gICAgICBkaXYuYXBwZW5kKGVsZW1lbnQpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZChkaXYpO1xuICAgIH0pO1xuICAgIFxuICAgIC8vIEhpZGUgdGhlIG9yaWdpbmFsIGF4aXMgbGFiZWxzXG4gICAgLy8gWC1heGlzIGxhYmVsXG4gICAgY29uc3QgeEF4aXNMYWJlbCA9IHN2Zy5xdWVyeVNlbGVjdG9yKCdnW2FyaWEtbGFiZWw9XCJ4LWF4aXMgbGFiZWxcIl0nKTtcbiAgICBpZiAoeEF4aXNMYWJlbCkgeEF4aXNMYWJlbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgXG4gICAgLy8gWS1heGlzIGxhYmVsXG4gICAgY29uc3QgeUF4aXNMYWJlbCA9IHN2Zy5xdWVyeVNlbGVjdG9yKCdnW2FyaWEtbGFiZWw9XCJ5LWF4aXMgbGFiZWxcIl0nKTtcbiAgICBpZiAoeUF4aXNMYWJlbCkgeUF4aXNMYWJlbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgXG4gICAgLy8gQWx0ZXJuYXRpdmU6IGhpZGUgYW55IHRleHQgZWxlbWVudHMgdGhhdCBjb250YWluIM64IG9yIEwozrhcbiAgICBzdmcucXVlcnlTZWxlY3RvckFsbCgndGV4dCcpLmZvckVhY2godGV4dCA9PiB7XG4gICAgICBpZiAodGV4dC50ZXh0Q29udGVudCA9PT0gJ864JyB8fCB0ZXh0LnRleHRDb250ZW50LmluY2x1ZGVzKCdMKM64JykpIHtcbiAgICAgICAgdGV4dC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuICBcbiAgLy8gU2NoZWR1bGUgbGFiZWwgYWRkaXRpb25cbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFkZExhYmVscyk7XG4gIFxuICByZXR1cm4gY29udGFpbmVyO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIC0tLSBEYXRhICYgc3RhdHMgLS0tXG5cbmh0bWxgPHN0eWxlPlxuLnBsb3QtLWxhcmdlLWF4aXMgLngtYXhpcyAubGFiZWwsXG4ucGxvdC0tbGFyZ2UtYXhpcyAueS1heGlzIC5sYWJlbCB7XG5mb250LXNpemU6IDI0cHg7IGZvbnQtd2VpZ2h0OiA2MDA7XG59XG4ucGxvdC0tbGFyZ2UtYXhpcyAueC1heGlzIHRleHQsXG4ucGxvdC0tbGFyZ2UtYXhpcyAueS1heGlzIHRleHQge1xuZm9udC1zaXplOiAxMnB4OyAvKiB0aWNrIGxhYmVscyAob3B0aW9uYWwpICovXG59XG48L3N0eWxlPmBcblxuLy8gT25seSByZXNpbXVsYXRlIHdoZW4gcmVzaW0gYnV0dG9uIGlzIGNsaWNrZWQgb3IgZGF0YSBwYXJhbWV0ZXJzIGNoYW5nZVxuWCA9IHtcbiAgLy8gVHJpZ2dlciBvbjogcmVzaW0gYnV0dG9uLCBuLCB0cnVlTXUsIG9yIHRydWVTaWdtYSBjaGFuZ2VzXG4gIHJlc2ltOyBuOyB0cnVlTXU7IHRydWVTaWdtYTtcbiAgXG4gIGNvbnN0IG0gPSB0cnVlTXUsIHMgPSB0cnVlU2lnbWE7XG4gIGNvbnN0IG91dCA9IG5ldyBBcnJheShuKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpICs9IDIpIHtcbiAgICBjb25zdCB1ID0gTWF0aC5yYW5kb20oKSwgdiA9IE1hdGgucmFuZG9tKCk7XG4gICAgY29uc3QgUiA9IE1hdGguc3FydCgtMiAqIE1hdGgubG9nKHUpKSwgVCA9IDIgKiBNYXRoLlBJICogdjtcbiAgICBjb25zdCB6MCA9IFIgKiBNYXRoLmNvcyhUKSwgejEgPSBSICogTWF0aC5zaW4oVCk7XG4gICAgb3V0W2ldID0gbSArIHMgKiB6MDtcbiAgICBpZiAoaSArIDEgPCBuKSBvdXRbaSArIDFdID0gbSArIHMgKiB6MTtcbiAgfVxuICByZXR1cm4gb3V0O1xufTtcblxueGJhciA9IGQzLm1lYW4oWCk7XG5TID0gZDMuc3VtKFgsIHggPT4gKHggLSB4YmFyKSAqKiAyKTtcblxubG9nTGlrID0gKG11LCBzaWdtYTIpID0+IHtcbiAgY29uc3Qgc3MgPSBkMy5zdW0oWCwgeCA9PiAoeCAtIG11KSAqKiAyKTtcbiAgcmV0dXJuIC0wLjUgKiBuICogTWF0aC5sb2coMiAqIE1hdGguUEkgKiBzaWdtYTIpIC0gMC41ICogc3MgLyBzaWdtYTI7XG59O1xuXG5tdWhhdCA9IHhiYXI7XG5zaWdtYTJoYXQgPSBTIC8gbjtcblxuLy8gLS0tIEdyaWQgZm9yIGNvbnRvdXJzIChheGVzIHRpY2tzKSAtLS1cbi8vIFRoZXNlIG9ubHkgbmVlZCB0byB1cGRhdGUgd2hlbiBkaXNwbGF5IHBhcmFtZXRlcnMgY2hhbmdlXG5tdUdyaWQgPSBkMy50aWNrcyhtdWhhdCAtIG11SGFsZldpZHRoLCBtdWhhdCArIG11SGFsZldpZHRoLCBncmlkTilcbnNpZzJHcmlkID0gZDMudGlja3MoTWF0aC5tYXgoMC4wNSwgc2lnbWEyaGF0IC8gMjApLCBzaWcyTWF4LCBncmlkTikuZmlsdGVyKHMgPT4gcyA+IDApXG5cbi8vIC0tLSBCdWlsZCBhIHJvdy1tYWpvciBncmlkIGZvciBQbG90LnJhc3RlciAvIFBsb3QuY29udG91ciAtLS1cbm54ID0gbXVHcmlkLmxlbmd0aFxubnkgPSBzaWcyR3JpZC5sZW5ndGhcblxuLy8gTWVtb2l6ZSB0aGUgZXhwZW5zaXZlIGxvZy1saWtlbGlob29kIGNvbXB1dGF0aW9uXG5sbFZhbHVlcyA9IHtcbiAgY29uc3QgeiA9IG5ldyBGbG9hdDY0QXJyYXkobnggKiBueSk7XG4gIGZvciAobGV0IGogPSAwOyBqIDwgbnk7ICsraikge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbng7ICsraSkge1xuICAgICAgY29uc3QgczIgPSBNYXRoLm1heCgxZS02LCBzaWcyR3JpZFtqXSk7XG4gICAgICB6W2ogKiBueCArIGldID0gbG9nTGlrKG11R3JpZFtpXSwgczIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gejtcbn1cblxuXG4vLyAtLS0tIEdlb21ldHJ5IC8gZG9tYWlucyAocmVzcG9uc2l2ZSkgLS0tLVxuXG5tdURvbWFpbiA9IFttdUdyaWRbMF0sIG11R3JpZFttdUdyaWQubGVuZ3RoIC0gMV1dXG5zaWcyRG9tYWluID0gW3NpZzJHcmlkWzBdLCBzaWcyR3JpZFtzaWcyR3JpZC5sZW5ndGggLSAxXV1cblxuLy8gLS0tLSBDb2xvdXIgc2NhbGluZyAocm9idXN0ICYgcmVhY3RpdmUpIC0tLS1cbmxsTWF4ID0gZDMubWF4KGxsVmFsdWVzKVxubGxSZWwgPSBGbG9hdDY0QXJyYXkuZnJvbShsbFZhbHVlcywgdiA9PiB2IC0gbGxNYXgpXG5cbi8vIFVzZSBtb3JlIGVmZmljaWVudCBxdWFudGlsZSBjb21wdXRhdGlvblxubGxSZWxGaW5pdGUgPSBBcnJheS5mcm9tKGxsUmVsKS5maWx0ZXIoTnVtYmVyLmlzRmluaXRlKVxubGxSZWxTb3J0ZWQgPSBsbFJlbEZpbml0ZS5zbGljZSgpLnNvcnQoZDMuYXNjZW5kaW5nKVxucTA1ID0gZDMucXVhbnRpbGVTb3J0ZWQobGxSZWxTb3J0ZWQsIDAuMDUpID8/IGQzLm1pbihsbFJlbEZpbml0ZSlcblxuY29sb3JEb21haW4gPSBbcTA1LCAwXVxubGxSZWxDbGlwcGVkID0gRmxvYXQ2NEFycmF5LmZyb20obGxSZWwsIHYgPT4gTWF0aC5tYXgocTA1LCB2KSlcbmNvbnRvdXJUaHJlc2hvbGRzID0gZDMudGlja3MocTA1LCAwLCAxMClcblxuLy8gLS0tLSBMZWZ0IHBhbmVsOiByYXN0ZXIgKGNsaXBwZWQpICsgY29udG91ciAoc2FtZSBncmlkKSAtLS0tXG52aWV3b2YgbGVmdFBhbmVsID0ge1xuICBjb25zdCB3cmFwID0gaHRtbGA8ZGl2IHN0eWxlPVwiXG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIHdpZHRoOiAke3Bsb3RXfXB4O1xuICAgIGhlaWdodDogJHtwbG90SH1weDtcbiAgICBmbGV4OiAwIDAgJHtwbG90V31weDtcbiAgICBsaW5lLWhlaWdodDogMDtcbiAgXCI+PC9kaXY+YDtcblxuICBjb25zdCBiYXNlID0gUGxvdC5wbG90KHtcbiAgICB3aWR0aDogcGxvdFcsIGhlaWdodDogcGxvdEgsXG4gICAgbWFyZ2luTGVmdCwgbWFyZ2luUmlnaHQsIG1hcmdpblRvcCwgbWFyZ2luQm90dG9tLFxuICAgIHN0eWxlOiB7XG4gICAgICBiYWNrZ3JvdW5kOiBcInZhcigtLWJyYW5kLWJnKVwiLFxuICAgICAgY29sb3I6IFwidmFyKC0tYnJhbmQtZmcpXCIsXG4gICAgICBmb250RmFtaWx5OiBib2R5Rm9udCwgXG4gICAgICBmb250U2l6ZTogMTRcbiAgICB9LFxuICAgIHg6IHsgbGFiZWw6IFwizrxcIiwgZG9tYWluOiBtdURvbWFpbiB9LFxuICAgIHk6IHsgbGFiZWw6IFwiz4PCslwiLCBkb21haW46IHNpZzJEb21haW4gfSxcbiAgICBjb2xvcjoge1xuICAgICAgdHlwZTogXCJzeW1sb2dcIixcbiAgICAgIGRvbWFpbjogY29sb3JEb21haW4sXG4gICAgICBjbGFtcDogdHJ1ZSxcbiAgICAgIHNjaGVtZTogXCJ0dXJib1wiLFxuICAgICAgbGVnZW5kOiBmYWxzZVxuICAgIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIFBsb3QucmFzdGVyKGxsUmVsQ2xpcHBlZCwge1xuICAgICAgICB3aWR0aDogbngsIGhlaWdodDogbnksXG4gICAgICAgIHgxOiBtdURvbWFpblswXSwgeDI6IG11RG9tYWluWzFdLFxuICAgICAgICB5MTogc2lnMkRvbWFpblswXSwgeTI6IHNpZzJEb21haW5bMV0sXG4gICAgICAgIGludGVycG9sYXRlOiBcIm5lYXJlc3RcIlxuICAgICAgfSksXG4gICAgICBQbG90LmRvdChbeyBtdTogbXVoYXQsIHNpZzI6IHNpZ21hMmhhdCB9XSwge1xuICAgICAgICB4OiBcIm11XCIsIHk6IFwic2lnMlwiLCByOiA1LCBzdHJva2U6IFwiY3VycmVudENvbG9yXCIsIGZpbGw6IFwidmFyKC0tYnJhbmQtYmcpXCJcbiAgICAgIH0pXG4gICAgXVxuICB9KTtcblxuICBiYXNlLmNsYXNzTGlzdC5hZGQoXCJwbG90LS1sYXJnZS1heGlzXCIpO1xuICBiYXNlLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gIHdyYXAuYXBwZW5kKGJhc2UpO1xuXG5cbiAgLy8gQ3Jvc3NoYWlyIG92ZXJsYXkgZmlsbHMgd3JhcHBlclxuICBjb25zdCBzdmcgPSBkMy5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHBsb3RXKS5hdHRyKFwiaGVpZ2h0XCIsIHBsb3RIKVxuICAgIC5zdHlsZShcInBvc2l0aW9uXCIsIFwiYWJzb2x1dGVcIikuc3R5bGUoXCJsZWZ0XCIsIFwiMFwiKS5zdHlsZShcInRvcFwiLCBcIjBcIilcbiAgICAuc3R5bGUoXCJ3aWR0aFwiLCBcIjEwMCVcIikuc3R5bGUoXCJoZWlnaHRcIiwgXCIxMDAlXCIpXG4gICAgLnN0eWxlKFwicG9pbnRlci1ldmVudHNcIiwgXCJub25lXCIpO1xuXG5cblxuICBjb25zdCB4U2NhbGUgPSBkMy5zY2FsZUxpbmVhcigpLmRvbWFpbihtdURvbWFpbikucmFuZ2UoW21hcmdpbkxlZnQsIG1hcmdpbkxlZnQgKyBpbm5lclddKTtcbiAgY29uc3QgeVNjYWxlID0gZDMuc2NhbGVMaW5lYXIoKS5kb21haW4oc2lnMkRvbWFpbikucmFuZ2UoW21hcmdpblRvcCArIGlubmVySCwgbWFyZ2luVG9wXSk7XG5cbiAgY29uc3QgdmxpbmUgPSBzdmcuYXBwZW5kKFwibGluZVwiKVxuICAuYXR0cihcIngxXCIsIHhTY2FsZShtdWhhdCkpLmF0dHIoXCJ4MlwiLCB4U2NhbGUobXVoYXQpKVxuICAuYXR0cihcInkxXCIsIG1hcmdpblRvcCkuYXR0cihcInkyXCIsIG1hcmdpblRvcCArIGlubmVySClcbiAgLmF0dHIoXCJzdHJva2VcIiwgXCJjdXJyZW50Q29sb3JcIik7XG5cbiAgY29uc3QgaGxpbmUgPSBzdmcuYXBwZW5kKFwibGluZVwiKVxuICAuYXR0cihcIngxXCIsIG1hcmdpbkxlZnQpLmF0dHIoXCJ4MlwiLCBtYXJnaW5MZWZ0ICsgaW5uZXJXKVxuICAuYXR0cihcInkxXCIsIHlTY2FsZShzaWdtYTJoYXQpKS5hdHRyKFwieTJcIiwgeVNjYWxlKHNpZ21hMmhhdCkpXG4gIC5hdHRyKFwic3Ryb2tlXCIsIFwiY3VycmVudENvbG9yXCIpO1xuXG4gIHdyYXAuYXBwZW5kKHN2Zy5ub2RlKCkpO1xuXG4gIC8vIEhpdGJveCBmaWxscyB3cmFwcGVyOyBzdWJ0cmFjdCBtYXJnaW5zIGluIGNvZGVcbiAgY29uc3QgaGl0ID0gaHRtbGA8ZGl2IHN0eWxlPVwiXG4gICAgcG9zaXRpb246YWJzb2x1dGU7IGxlZnQ6MDsgdG9wOjA7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlO1xuICAgIGN1cnNvcjpjcm9zc2hhaXI7IGJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7IHRvdWNoLWFjdGlvbjpub25lO1xuICBcIj48L2Rpdj5gO1xuICB3cmFwLmFwcGVuZChoaXQpO1xuXG4gIGNvbnN0IHN0YXRlID0geyB4OiBtdWhhdCwgeTogc2lnbWEyaGF0LCBkcmFnZ2luZzogZmFsc2UgfTtcbiAgd3JhcC52YWx1ZSA9IHsgLi4uc3RhdGUgfTsgICAgICAgICAgICAvLyA8LS0gZXhwb3NlIGZ1bGwgc3RhdGUgdmlhIHRoZSB2aWV3J3MgdmFsdWVcblxuICBmdW5jdGlvbiBlbWl0KCkge1xuICAgIHdyYXAudmFsdWUgPSB7IC4uLnN0YXRlIH07ICAgICAgICAgIC8vIDwtLSBhc3NpZ24gYSBmcmVzaCBvYmplY3Qgc28gZXF1YWxpdHkgY2hhbmdlc1xuICAgIHdyYXAuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJpbnB1dFwiLCB7IGJ1YmJsZXM6IHRydWUgfSkpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0RnJvbUV2ZW50KGV2dCkge1xuICAgIGNvbnN0IHIgPSBoaXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgbGV0IHB4ID0gZXZ0LmNsaWVudFggLSByLmxlZnQsIHB5ID0gZXZ0LmNsaWVudFkgLSByLnRvcDtcbiAgICBweCA9IE1hdGgubWluKE1hdGgubWF4KDAsIHB4IC0gbWFyZ2luTGVmdCksIGlubmVyVyk7XG4gICAgcHkgPSBNYXRoLm1pbihNYXRoLm1heCgwLCBweSAtIG1hcmdpblRvcCksIGlubmVySCk7XG4gICAgc3RhdGUueCA9IG11RG9tYWluWzBdICsgKHB4IC8gaW5uZXJXKSAqIChtdURvbWFpblsxXSAtIG11RG9tYWluWzBdKTtcbiAgICBzdGF0ZS55ID0gc2lnMkRvbWFpblsxXSAtIChweSAvIGlubmVySCkgKiAoc2lnMkRvbWFpblsxXSAtIHNpZzJEb21haW5bMF0pO1xuICAgIHZsaW5lLmF0dHIoXCJ4MVwiLCB4U2NhbGUoc3RhdGUueCkpLmF0dHIoXCJ4MlwiLCB4U2NhbGUoc3RhdGUueCkpO1xuICAgIGhsaW5lLmF0dHIoXCJ5MVwiLCB5U2NhbGUoc3RhdGUueSkpLmF0dHIoXCJ5MlwiLCB5U2NhbGUoc3RhdGUueSkpO1xuICAgIGVtaXQoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA8LS0gbm90aWZ5IGRlcGVuZGVudHNcbiAgfVxuXG4gIC8vIFJBRiB0aHJvdHRsZSBmb3IgbW92ZVxuICBsZXQgcmFmID0gMDtcbiAgZnVuY3Rpb24gc2NoZWR1bGVVcGRhdGUoZSkge1xuICAgIGlmIChyYWYpIHJldHVybjtcbiAgICByYWYgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4geyByYWYgPSAwOyBzZXRGcm9tRXZlbnQoZSk7IH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0RHJhZ2dpbmcob24pIHtcbiAgICBpZiAoc3RhdGUuZHJhZ2dpbmcgPT09IG9uKSByZXR1cm47XG4gICAgc3RhdGUuZHJhZ2dpbmcgPSBvbjtcbiAgICBlbWl0KCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPC0tIG5vdGlmeSBvbiBkcmFnIHN0YXRlIGNoYW5nZXMgdG9vXG4gIH1cblxuICBoaXQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJkb3duXCIsIChlKSA9PiB7XG4gICAgc2V0RHJhZ2dpbmcodHJ1ZSk7XG4gICAgc2V0RnJvbUV2ZW50KGUpO1xuICAgIGhpdC5zZXRQb2ludGVyQ2FwdHVyZShlLnBvaW50ZXJJZCk7XG4gIH0pO1xuXG4gIGhpdC5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlcm1vdmVcIiwgKGUpID0+IHtcbiAgICBpZiAoc3RhdGUuZHJhZ2dpbmcpIHNjaGVkdWxlVXBkYXRlKGUpO1xuICB9KTtcblxuICBjb25zdCBlbmREcmFnID0gKCkgPT4gc2V0RHJhZ2dpbmcoZmFsc2UpO1xuICBoaXQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJ1cFwiLCBlbmREcmFnKTtcbiAgaGl0LmFkZEV2ZW50TGlzdGVuZXIoXCJwb2ludGVyY2FuY2VsXCIsIGVuZERyYWcpO1xuICBoaXQuYWRkRXZlbnRMaXN0ZW5lcihcInBvaW50ZXJsZWF2ZVwiLCBlbmREcmFnKTtcblxuICAvLyBpbml0aWFsIG5vdGlmeVxuICBxdWV1ZU1pY3JvdGFzayhlbWl0KTtcblxuICByZXR1cm4gd3JhcDsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA8LS0gdGhlIHZpZXcgZWxlbWVudFxufVxuXG4vLyBsZWZ0UGFuZWwgaXMgbm93IHsgeCwgeSwgZHJhZ2dpbmcgfVxuaXNEcmFnZ2luZyA9IGxlZnRQYW5lbC5kcmFnZ2luZ1xubnVtUHRzICAgICA9IGlzRHJhZ2dpbmcgPyAxMDAgOiAyMDBcbnBkZlN0cm9rZSAgPSBpc0RyYWdnaW5nID8gMSAgIDogMlxuXG4vLyBpZiB5b3Ugd2FudCB0aGUgcHJvYmUgdG8gZm9sbG93IHRoZSBjcm9zc2hhaXI6XG5wcm9iZU11ICAgPSBsZWZ0UGFuZWwueFxucHJvYmVTaWcyID0gbGVmdFBhbmVsLnlcbnByb2JlTEwgPSBsb2dMaWsocHJvYmVNdSwgcHJvYmVTaWcyKTtcblxuXG4vLyAtLS0gUmlnaHQgcGFuZWwgLS0tXG5ub3JtYWxQZGYgPSAoeCwgbXUsIHNpZzIpID0+ICgxIC8gTWF0aC5zcXJ0KDIgKiBNYXRoLlBJICogc2lnMikpICogTWF0aC5leHAoLSgoeCAtIG11KSAqKiAyKSAvICgyICogc2lnMikpXG5cbnhFeHRlbnQgPSBkMy5leHRlbnQoWClcbnhQYWQgPSAzICogTWF0aC5zcXJ0KHByb2JlU2lnMilcbnhNaW4gPSBNYXRoLm1pbih4RXh0ZW50WzBdLCBwcm9iZU11IC0geFBhZClcbnhNYXggPSBNYXRoLm1heCh4RXh0ZW50WzFdLCBwcm9iZU11ICsgeFBhZClcblxuLy8gUERGIGN1cnZlXG54cyA9IGQzLnJhbmdlKG51bVB0cykubWFwKGkgPT4geE1pbiArIChpIC8gKG51bVB0cyAtIDEpKSAqICh4TWF4IC0geE1pbikpXG5wZGZZcyA9IHhzLm1hcCh4ID0+IG5vcm1hbFBkZih4LCBwcm9iZU11LCBwcm9iZVNpZzIpKVxuXG4vLyBEZW5zaXR5IHJlZHVjZXJcbmRlbnNpdHlSZWR1Y2VyID0gKHZhbHVlcywgZXh0ZW50KSA9PiB2YWx1ZXMubGVuZ3RoIC8gbiAvIChleHRlbnQueDIgLSBleHRlbnQueDEpXG5cbi8vIENvbXB1dGUgeU1heFxuYmluc18gPSBkMy5iaW4oKS5kb21haW4oW3hNaW4sIHhNYXhdKS50aHJlc2hvbGRzKGJpbnMpKFgpO1xuZGVuc2l0aWVzID0gYmluc18ubWFwKGIgPT5cbiAgKGIubGVuZ3RoIC8gTWF0aC5tYXgoMSwgbikpIC8gTWF0aC5tYXgoMWUtOSwgKGIueDEgLSBiLngwKSlcbik7XG55TWF4ID0gZDMubWF4KGRlbnNpdGllcyk7XG5cbnJpZ2h0UGFuZWwgPSBQbG90LnBsb3Qoe1xuICB3aWR0aDogcGxvdFcsIGhlaWdodDogcGxvdEgsXG4gIG1hcmdpbkxlZnQsIG1hcmdpbkJvdHRvbSxcbiAgeDogeyBsYWJlbDogXCJEYXRhXCIsIGRvbWFpbjogW3hNaW4sIHhNYXhdIH0sXG4gIHk6IHsgbGFiZWw6IFwiRGVuc2l0eVwiIH0sXG4gIHN0eWxlOiB7XG4gICAgICBmb250RmFtaWx5OiBib2R5Rm9udCwgXG4gICAgICBmb250U2l6ZTogMTQuXG4gIH0sIFxuICBtYXJrczogW1xuICAgIFBsb3QucmVjdFkoXG4gICAgICBYLFxuICAgICAgUGxvdC5iaW5YKFxuICAgICAgICB7IHk6IGRlbnNpdHlSZWR1Y2VyIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB4OiBkID0+IGQsXG4gICAgICAgICAgdGhyZXNob2xkczogYmlucyxcbiAgICAgICAgICBpbnNldDogMCxcbiAgICAgICAgICBmaWxsOiBcInZhcigtLWJyYW5kLXJlZClcIixcbiAgICAgICAgICBmaWxsT3BhY2l0eTogMC4yXG4gICAgICAgIH1cbiAgICAgIClcbiAgICApLFxuICAgIFBsb3QubGluZSh4cy5tYXAoKHgsIGkpID0+ICh7IHgsIHk6IHBkZllzW2ldIH0pKSwge1xuICAgICAgeDogXCJ4XCIsIHk6IFwieVwiLFxuICAgICAgc3Ryb2tlOiBcInZhcigtLWJyYW5kLXJlZClcIixcbiAgICAgIHN0cm9rZVdpZHRoOiBwZGZTdHJva2VcbiAgICB9KSxcbiAgICBQbG90LnJ1bGVYKFgsIHtcbiAgICAgIHkxOiAwLFxuICAgICAgeTI6IHlNYXggKiAwLjA1LFxuICAgICAgc3Ryb2tlOiBcInZhcigtLWJyYW5kLXJlZClcIixcbiAgICAgIHN0cm9rZVdpZHRoOiAyLFxuICAgICAgc3Ryb2tlT3BhY2l0eTogMC44XG4gICAgfSksXG4gICAgUGxvdC5ydWxlWShbMF0pLFxuICAgIFBsb3QucnVsZVgoW3Byb2JlTXVdLCB7IHN0cm9rZTogXCJjdXJyZW50Q29sb3JcIiwgc3Ryb2tlRGFzaGFycmF5OiBcIjQsM1wiIH0pXG4gIF1cbn0pXG5cbnByb2JlSW5mbyA9IG1kYCoqUHJvYmU6KiogJHt0ZXhgXFxtdT0ke3Byb2JlTXUudG9GaXhlZCgyKX0sXFwgXFxzaWdtYV4yPSR7cHJvYmVTaWcyLnRvRml4ZWQoMyl9XFwgXFxSaWdodGFycm93XFwgXFxsb2cgZihcXHVuZGVybGluZXt4fSBcXG1pZCBcXG11LCBcXHNpZ21hXjIpPSR7cHJvYmVMTC50b0ZpeGVkKDIpfWB9YFxuXG5odG1sYDxkaXYgc3R5bGU9XCJtYXgtd2lkdGg6MTAwJTtcIj5cbjxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7IGdhcDoke2dhcH1weDsgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsgZmxleC13cmFwOm5vd3JhcDsgb3ZlcmZsb3cteDphdXRvO1wiPlxuPGRpdiBzdHlsZT1cImZsZXg6MCAwICR7cGxvdFd9cHg7XCI+JHt2aWV3b2YgbGVmdFBhbmVsfTwvZGl2PlxuPGRpdiBzdHlsZT1cImZsZXg6MCAwICR7cGxvdFd9cHg7XCI+JHtyaWdodFBhbmVsfTwvZGl2PlxuPC9kaXY+XG48ZGl2IHN0eWxlPVwibWFyZ2luLXRvcDoxMHB4OyBtYXJnaW4tYm90dG9tOi0xMHB4XCI+JHtwcm9iZUluZm99PC9kaXY+XG48L2Rpdj5gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG4vLyAtLS0gU3R5bGVzOiBjb21wYWN0LCAyLWNvbHVtbiwgY29sbGFwc2libGUsIGN1c3RvbSBidXR0b24gLS0tXG5odG1sYDxzdHlsZT5cbiAgLyogLS0tLS0tLS0tLSBTY29wZSBhbGwgc3R5bGVzIHRvIHRoaXMgY29udHJvbHMgYm94IC0tLS0tLS0tLS0gKi9cbiAgZGV0YWlscy5jb250cm9scy1yb290IHsgXG4gICAgLS1jdHJsLWZvbnQ6IDEycHg7XG4gICAgZm9udC1zaXplOiB2YXIoLS1jdHJsLWZvbnQpO1xuICB9XG5cbiAgLyogRHJvcGRvd24gaGVhZGVyICovXG4gIGRldGFpbHMuY29udHJvbHMtcm9vdCA+IHN1bW1hcnkge1xuICAgIGxpc3Qtc3R5bGU6IG5vbmU7IGN1cnNvcjogcG9pbnRlcjsgdXNlci1zZWxlY3Q6IG5vbmU7XG4gICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZSwgI2YxZjVmOSk7XG4gICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLCAjZTVlN2ViKTtcbiAgICBib3JkZXItcmFkaXVzOiAxMHB4O1xuICAgIHBhZGRpbmc6IDhweCAxMHB4O1xuICAgIGZvbnQtd2VpZ2h0OiA2MDA7IGZvbnQtc2l6ZTogY2FsYyh2YXIoLS1jdHJsLWZvbnQpICsgMXB4KTtcbiAgICBjb2xvcjogdmFyKC0tZmctc3Ryb25nLCAjMzM0MTU1KTtcbiAgICBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDhweDtcbiAgfVxuICBkZXRhaWxzLmNvbnRyb2xzLXJvb3QgPiBzdW1tYXJ5Ojotd2Via2l0LWRldGFpbHMtbWFya2VyIHsgZGlzcGxheTogbm9uZTsgfVxuICBkZXRhaWxzLmNvbnRyb2xzLXJvb3Rbb3Blbl0gPiBzdW1tYXJ5IHsgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMDsgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDA7IH1cblxuICAvKiBUd28tY29sdW1uIGdyaWQgKHNpZGUtYnktc2lkZSkgKi9cbiAgZGV0YWlscy5jb250cm9scy1yb290IC5jb250cm9scy1ncmlkIHtcbiAgICBkaXNwbGF5OiBncmlkO1xuICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogbWlubWF4KDI2MHB4LCAxZnIpIG1pbm1heCgyNjBweCwgMWZyKTtcbiAgICBnYXA6IDEycHg7XG4gICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLCAjZTVlN2ViKTsgYm9yZGVyLXRvcDogbm9uZTtcbiAgICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAxMHB4OyBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMTBweDtcbiAgICBwYWRkaW5nOiAxMHB4O1xuICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2Utd2VhaywgI2ZhZmFmYSk7XG4gICAgb3ZlcmZsb3cteDogYXV0bztcbiAgfVxuICBkZXRhaWxzLmNvbnRyb2xzLXJvb3QgLmNvbnRyb2xzLWNvbCB7IG1pbi13aWR0aDogMjYwcHg7IH1cbiAgZGV0YWlscy5jb250cm9scy1yb290IC5jb250cm9scy1jb2wgaDQge1xuICAgIG1hcmdpbjogMCAwIDZweCAwO1xuICAgIGZvbnQtc2l6ZTogdmFyKC0tY3RybC1mb250KTsgZm9udC13ZWlnaHQ6IDcwMDtcbiAgICBjb2xvcjogdmFyKC0tZmctbXV0ZWQsICM0NzU1NjkpO1xuICB9XG5cbiAgLyogLS0tLSBBbGlnbiBsYWJlbCAmIHNsaWRlciAoZm9ybS1sZXZlbCBncmlkKSAtLS0tICovXG4gIGRldGFpbHMuY29udHJvbHMtcm9vdCAuY29udHJvbHMtY29sIGZvcm0ge1xuICAgIGRpc3BsYXk6IGdyaWQgIWltcG9ydGFudDtcbiAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IG1pbm1heCgxNTBweCwgYXV0bykgMWZyOyAvKiBsYWJlbCB8IGlucHV0cyAqL1xuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7ICAgICAgICAgLyogdmVydGljYWwgY2VudHJpbmcgKi9cbiAgICBjb2x1bW4tZ2FwOiAxMHB4O1xuICAgIGZvbnQtc2l6ZTogdmFyKC0tY3RybC1mb250KSAhaW1wb3J0YW50O1xuICAgIGxpbmUtaGVpZ2h0OiAxLjI1O1xuICAgIG1hcmdpbjogNnB4IDA7XG4gIH1cblxuICAvKiBMYWJlbDoga2lsbCBkZWZhdWx0IDxwPiBtYXJnaW47IGFsaWduIEthVGVYICsgdGV4dCAqL1xuICBkZXRhaWxzLmNvbnRyb2xzLXJvb3QgLmNvbnRyb2xzLWNvbCBmb3JtID4gbGFiZWwge1xuICAgIG1hcmdpbjogMCAhaW1wb3J0YW50O1xuICAgIGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogOHB4O1xuICAgIGZvbnQtc2l6ZTogdmFyKC0tY3RybC1mb250KSAhaW1wb3J0YW50O1xuICAgIGNvbG9yOiB2YXIoLS1mZy1tdXRlZCwgIzQ3NTU2OSk7XG4gICAgZm9udC13ZWlnaHQ6IDYwMDtcbiAgfVxuICBkZXRhaWxzLmNvbnRyb2xzLXJvb3QgLmNvbnRyb2xzLWNvbCBmb3JtID4gbGFiZWwgcCB7IG1hcmdpbjogMCAhaW1wb3J0YW50OyB9XG5cbiAgLyogSW5wdXRzIHdyYXBwZXIgKGF1dG8tZ2VuZXJhdGVkLCBlLmcuIC5vaS0qLWlucHV0KTogYWxpZ24gbnVtYmVyICsgc2xpZGVyICovXG4gIGRldGFpbHMuY29udHJvbHMtcm9vdCAuY29udHJvbHMtY29sIGZvcm0gPiBbY2xhc3MkPVwiLWlucHV0XCJdLFxuICBkZXRhaWxzLmNvbnRyb2xzLXJvb3QgLmNvbnRyb2xzLWNvbCBmb3JtID4gW2NsYXNzKj1cIi1pbnB1dFwiXSB7XG4gICAgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA4cHg7XG4gICAgbWluLWhlaWdodDogMjJweDtcbiAgfVxuXG4gIC8qIE51bWJlciBpbnB1dCBub3JtYWxpc2F0aW9uICovXG4gIGRldGFpbHMuY29udHJvbHMtcm9vdCAuY29udHJvbHMtY29sIGlucHV0W3R5cGU9XCJudW1iZXJcIl0ge1xuICAgIGhlaWdodDogMjRweDsgcGFkZGluZzogMnB4IDZweDtcbiAgICBmb250LXNpemU6IHZhcigtLWN0cmwtZm9udCk7XG4gICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyLCAjZTVlN2ViKTsgYm9yZGVyLXJhZGl1czogNnB4O1xuICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UsICNmMWY1ZjkpOyBjb2xvcjogdmFyKC0tZmctc3Ryb25nLCAjMzM0MTU1KTtcbiAgfVxuXG4gIC8qIFNsaWRlciBzdHlsaW5nICovXG4gIGRldGFpbHMuY29udHJvbHMtcm9vdCAuY29udHJvbHMtY29sIGlucHV0W3R5cGU9XCJyYW5nZVwiXSB7XG4gICAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOyBhcHBlYXJhbmNlOiBub25lO1xuICAgIHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDE4cHg7IGJhY2tncm91bmQ6IHRyYW5zcGFyZW50O1xuICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7XG4gICAgYWNjZW50LWNvbG9yOiB2YXIoLS1icmFuZC10ZWFsLCAjNTVDM0NCKTtcbiAgfVxuICBkZXRhaWxzLmNvbnRyb2xzLXJvb3QgLmNvbnRyb2xzLWNvbCBpbnB1dFt0eXBlPVwicmFuZ2VcIl06Oi13ZWJraXQtc2xpZGVyLXJ1bm5hYmxlLXRyYWNrIHtcbiAgICBoZWlnaHQ6IDRweDsgYm9yZGVyLXJhZGl1czogOTk5cHg7XG4gICAgYmFja2dyb3VuZDogY29sb3ItbWl4KGluIHNyZ2IsIHZhcigtLWJyYW5kLXRlYWwsICM1NUMzQ0IpIDM1JSwgdHJhbnNwYXJlbnQpO1xuICB9XG4gIGRldGFpbHMuY29udHJvbHMtcm9vdCAuY29udHJvbHMtY29sIGlucHV0W3R5cGU9XCJyYW5nZVwiXTo6LXdlYmtpdC1zbGlkZXItdGh1bWIge1xuICAgIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsgYXBwZWFyYW5jZTogbm9uZTtcbiAgICB3aWR0aDogMTJweDsgaGVpZ2h0OiAxMnB4OyBib3JkZXItcmFkaXVzOiA1MCU7XG4gICAgYmFja2dyb3VuZDogdmFyKC0tYnJhbmQtdGVhbCwgIzU1QzNDQik7IGJvcmRlcjogMDsgbWFyZ2luLXRvcDogLTRweDsgLyogY2VudHJlIHRodW1iIG92ZXIgNHB4IHRyYWNrICovXG4gIH1cbiAgZGV0YWlscy5jb250cm9scy1yb290IC5jb250cm9scy1jb2wgaW5wdXRbdHlwZT1cInJhbmdlXCJdOjotbW96LXJhbmdlLXRyYWNrIHtcbiAgICBoZWlnaHQ6IDRweDsgYm9yZGVyLXJhZGl1czogOTk5cHg7XG4gICAgYmFja2dyb3VuZDogY29sb3ItbWl4KGluIHNyZ2IsIHZhcigtLWJyYW5kLXRlYWwsICM1NUMzQ0IpIDM1JSwgdHJhbnNwYXJlbnQpO1xuICB9XG4gIGRldGFpbHMuY29udHJvbHMtcm9vdCAuY29udHJvbHMtY29sIGlucHV0W3R5cGU9XCJyYW5nZVwiXTo6LW1vei1yYW5nZS10aHVtYiB7XG4gICAgd2lkdGg6IDEycHg7IGhlaWdodDogMTJweDsgYm9yZGVyLXJhZGl1czogNTAlO1xuICAgIGJhY2tncm91bmQ6IHZhcigtLWJyYW5kLXRlYWwsICM1NUMzQ0IpOyBib3JkZXI6IDA7XG4gIH1cblxuICAvKiBCdXR0b24gKi9cbiAgZGV0YWlscy5jb250cm9scy1yb290IC5idG4tcmVzaW0gYnV0dG9uIHtcbiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1icmFuZC10ZWFsLCAjNTVDM0NCKTsgY29sb3I6ICNmZmY7XG4gICAgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiA2cHg7IHBhZGRpbmc6IDZweCAxMnB4O1xuICAgIGZvbnQtd2VpZ2h0OiA2MDA7IGZvbnQtc2l6ZTogdmFyKC0tY3RybC1mb250KTsgY3Vyc29yOiBwb2ludGVyO1xuICAgIHRyYW5zaXRpb246IGZpbHRlciAxMjBtcyBlYXNlLCBiYWNrZ3JvdW5kLWNvbG9yIDEyMG1zIGVhc2U7XG4gIH1cbiAgZGV0YWlscy5jb250cm9scy1yb290IC5idG4tcmVzaW0gYnV0dG9uOmhvdmVyIHtcbiAgICBiYWNrZ3JvdW5kOiBjb2xvci1taXgoaW4gc3JnYiwgdmFyKC0tYnJhbmQtdGVhbCwgIzU1QzNDQikgODglLCBibGFjayk7XG4gIH1cblxuICAvKiBDaGV2cm9uICovXG4gIGRldGFpbHMuY29udHJvbHMtcm9vdCA+IHN1bW1hcnk6OmJlZm9yZSB7XG4gICAgY29udGVudDogXCJcIjsgZGlzcGxheTogaW5saW5lLWJsb2NrOyBtYXJnaW4tcmlnaHQ6IDhweDsgd2lkdGg6IDA7IGhlaWdodDogMDtcbiAgICBib3JkZXItc3R5bGU6IHNvbGlkOyBib3JkZXItd2lkdGg6IDNweCAwIDNweCA2cHg7XG4gICAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB2YXIoLS1mZy1zdHJvbmcpO1xuICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOyB0cmFuc2Zvcm0tb3JpZ2luOiAzcHggNTAlOyB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gNTBtcyBlYXNlO1xuICB9XG4gIGRldGFpbHMuY29udHJvbHMtcm9vdFtvcGVuXSA+IHN1bW1hcnk6OmJlZm9yZSB7IHRyYW5zZm9ybTogcm90YXRlKDkwZGVnKTsgfVxuYFxuXG4vLyAtLS0gQnVpbGQgb25lIG1lcmdlZCwgY29sbGFwc2libGUgY29udHJvbCBcImlucHV0XCIgLS0tXG52aWV3b2YgY29udHJvbHMgPSB7XG4gIGNvbnN0IHJlc2ltQnRuID0gSW5wdXRzLmJ1dHRvbihcIlJlc2ltdWxhdGUgZGF0YVwiKTtcbiAgcmVzaW1CdG4uY2xhc3NMaXN0LmFkZChcImJ0bi1yZXNpbVwiKTtcblxuICBjb25zdCBsZWZ0Rm9ybSA9IElucHV0cy5mb3JtKHtcbiAgICBuOiBJbnB1dHMucmFuZ2UoWzEsIDQwMF0sIHsgdmFsdWU6IDEwLCBzdGVwOiAxLCBsYWJlbDogbWRgJHt0ZXhgbmB9YCB9KSxcbiAgICB0cnVlTXU6IElucHV0cy5yYW5nZShbLTMsIDNdLCB7IHZhbHVlOiAwLjUsIHN0ZXA6IDAuMDUsIGxhYmVsOiBtZGAke3RleGBcXG11X3tcXHRleHR7dHJ1ZX19YH1gIH0pLFxuICAgIHRydWVTaWdtYTogSW5wdXRzLnJhbmdlKFswLjMsIDNdLCB7IHZhbHVlOiAxLjIsIHN0ZXA6IDAuMDUsIGxhYmVsOiBtZGAke3RleGBcXHNpZ21hX3tcXHRleHR7dHJ1ZX19YH1gIH0pXG4gIH0sIHsgc3VibWl0OiBmYWxzZSB9KTtcblxuICBjb25zdCByaWdodEZvcm0gPSBJbnB1dHMuZm9ybSh7XG4gICAgbXVIYWxmV2lkdGg6IElucHV0cy5yYW5nZShbMSwgNV0sIHsgdmFsdWU6IDIuNSwgc3RlcDogMC4wNSwgbGFiZWw6IG1kYCR7dGV4YFxcbXVcXHRleHR7LXJhbmdlfWB9YCB9KSxcbiAgICBzaWcyTWF4OiBJbnB1dHMucmFuZ2UoWzAuMiwgNl0sIHsgdmFsdWU6IDMsIHN0ZXA6IDAuMDUsIGxhYmVsOiBtZGAke3RleGBcXHNpZ21hXjJcXHRleHR7IG1heH1gfWAgfSksXG4gICAgZ3JpZE46IElucHV0cy5yYW5nZShbMjUsIDEyMV0sIHsgdmFsdWU6IDgxLCBzdGVwOiA0LCBsYWJlbDogXCJHcmlkIHNpemVcIiB9KSxcbiAgICBiaW5zOiBJbnB1dHMucmFuZ2UoWzEwLCA2MF0sIHsgdmFsdWU6IDI0LCBzdGVwOiAxLCBsYWJlbDogXCJIaXN0b2dyYW0gYmluc1wiIH0pXG4gIH0sIHsgc3VibWl0OiBmYWxzZSB9KTtcblxuICBjb25zdCByb290ID0gaHRtbGA8ZGV0YWlscyBjbGFzcz1cImNvbnRyb2xzLXJvb3RcIiBvcGVuPlxuICAgIDxzdW1tYXJ5PlNpbXVsYXRpb24gY29udHJvbHM8L3N1bW1hcnk+XG4gICAgPGRpdiBjbGFzcz1cImNvbnRyb2xzLWdyaWRcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9scy1jb2xcIj48aDQ+RGF0YSAmIHRydXRoPC9oND48L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJjb250cm9scy1jb2xcIj48aDQ+R3JpZCAmIGRpc3BsYXk8L2g0PjwvZGl2PlxuICAgIDwvZGl2PlxuICA8L2RldGFpbHM+YDtcblxuICBjb25zdCBncmlkID0gcm9vdC5xdWVyeVNlbGVjdG9yKFwiLmNvbnRyb2xzLWdyaWRcIik7XG4gIGNvbnN0IGxlZnRDb2wgPSBncmlkLmNoaWxkcmVuWzBdO1xuICBjb25zdCByaWdodENvbCA9IGdyaWQuY2hpbGRyZW5bMV07XG5cbiAgbGVmdENvbC5hcHBlbmQobGVmdEZvcm0pO1xuXG4gIHJpZ2h0Q29sLmFwcGVuZChyaWdodEZvcm0pO1xuICBjb25zdCBidG5XcmFwID0gaHRtbGA8ZGl2IHN0eWxlPVwiZGlzcGxheTpmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1zdGFydDsgbWFyZ2luLXRvcDo2cHg7XCI+PC9kaXY+YDtcbiAgYnRuV3JhcC5hcHBlbmQocmVzaW1CdG4pO1xuICByaWdodENvbC5hcHBlbmQoYnRuV3JhcCk7XG5cbiAgLy8gLS0tIE1lcmdlIHZhbHVlc1xuICBjb25zdCBnZXRWYWx1ZSA9ICgpID0+ICh7IC4uLmxlZnRGb3JtLnZhbHVlLCAuLi5yaWdodEZvcm0udmFsdWUsIHJlc2ltOiByZXNpbUJ0bi52YWx1ZSB9KTtcbiAgY29uc3QgdXBkYXRlID0gKCkgPT4ge1xuICAgIHJvb3QudmFsdWUgPSBnZXRWYWx1ZSgpO1xuICAgIHJvb3QuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJpbnB1dFwiLCB7IGJ1YmJsZXM6IHRydWUgfSkpO1xuICB9O1xuXG4gIC8vIE9ORSBsaXN0ZW5lciBmb3IgYWxsIGNoaWxkcmVuIChzbGlkZXJzICsgYnV0dG9uKVxuICBncmlkLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCB1cGRhdGUpO1xuXG4gIHF1ZXVlTWljcm90YXNrKHVwZGF0ZSk7XG4gIHJldHVybiByb290O1xufVxuXG4vLyAtLS0gRXhwb3NlIHJlYWN0aXZlIHZhcnNcbm4gPSBjb250cm9scy5uXG50cnVlTXUgPSBjb250cm9scy50cnVlTXVcbnRydWVTaWdtYSA9IGNvbnRyb2xzLnRydWVTaWdtYVxubXVIYWxmV2lkdGggPSBjb250cm9scy5tdUhhbGZXaWR0aFxuc2lnMk1heCA9IGNvbnRyb2xzLnNpZzJNYXhcbmdyaWROID0gY29udHJvbHMuZ3JpZE5cbmJpbnMgPSBjb250cm9scy5iaW5zXG5yZXNpbSA9IGNvbnRyb2xzLnJlc2ltXG5cblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd0aGV0YScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdsZWZ0UGFuZWwnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnY29udHJvbHMnKSJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../content/main/part2";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../content/main/part2/4-freq-point-estimation.html" class="pagination-link" aria-label="Frequentist Point Estimation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Frequentist Point Estimation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../content/main/part2/6-bayes-inference.html" class="pagination-link" aria-label="Bayesian Inference">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bayesian Inference</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>